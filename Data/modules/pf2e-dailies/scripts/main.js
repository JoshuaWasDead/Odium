(()=>{var Sd=Object.create;var xe=Object.defineProperty;var Ms=Object.getOwnPropertyDescriptor;var Pd=Object.getOwnPropertyNames;var Od=Object.getPrototypeOf,Md=Object.prototype.hasOwnProperty;var i=(e,t)=>xe(e,"name",{value:t,configurable:!0});var Id=(e,t)=>()=>(e&&(t=e(e=0)),t);var p=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Is=(e,t)=>{for(var r in t)xe(e,r,{get:t[r],enumerable:!0})},Mr=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of Pd(t))!Md.call(e,a)&&a!==r&&xe(e,a,{get:()=>t[a],enumerable:!(n=Ms(t,a))||n.enumerable});return e},se=(e,t,r)=>(Mr(e,t,"default"),r&&Mr(r,t,"default")),Yi=(e,t,r)=>(r=e!=null?Sd(Od(e)):{},Mr(t||!e||!e.__esModule?xe(r,"default",{value:e,enumerable:!0}):r,e)),Te=e=>Mr(xe({},"__esModule",{value:!0}),e),ws=(e,t,r,n)=>{for(var a=n>1?void 0:n?Ms(t,r):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(a=(n?o(t,r,a):o(a))||a);return n&&a&&xe(t,r,a),a};var Zi=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)};var Qi=(e,t,r)=>(Zi(e,t,"read from private field"),r?r.call(e):t.get(e)),Re=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},Ji=(e,t,r,n)=>(Zi(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r);var Ir=(e,t,r)=>(Zi(e,t,"access private method"),r);var P=p(je=>{"use strict";var wd=je&&je.__spreadArray||function(e,t,r){if(r||arguments.length===2)for(var n=0,a=t.length,s;n<a;n++)(s||!(n in t))&&(s||(s=Array.prototype.slice.call(t,0,n)),s[n]=t[n]);return e.concat(s||Array.prototype.slice.call(t))};Object.defineProperty(je,"__esModule",{value:!0});je.purry=void 0;function Ed(e,t,r){var n=e.length-t.length,a=Array.from(t);if(n===0)return e.apply(void 0,a);if(n===1){var s=i(function(o){return e.apply(void 0,wd([o],a,!1))},"ret");return(r||e.lazy)&&(s.lazy=r||e.lazy,s.lazyArgs=t),s}throw new Error("Wrong number of arguments")}i(Ed,"purry");je.purry=Ed});var Es=p(wr=>{"use strict";Object.defineProperty(wr,"__esModule",{value:!0});wr.add=void 0;var Td=P();function Dd(){return(0,Td.purry)(Fd,arguments)}i(Dd,"add");wr.add=Dd;function Fd(e,t){return e+t}i(Fd,"_add")});var Ts=p(ze=>{"use strict";var Er=ze&&ze.__assign||function(){return Er=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},Er.apply(this,arguments)};Object.defineProperty(ze,"__esModule",{value:!0});ze.addProp=void 0;var Cd=P();function Ld(){return(0,Cd.purry)(qd,arguments)}i(Ld,"addProp");ze.addProp=Ld;function qd(e,t,r){var n;return Er(Er({},e),(n={},n[t]=r,n))}i(qd,"_addProp")});var Ds=p(Tr=>{"use strict";Object.defineProperty(Tr,"__esModule",{value:!0});Tr.allPass=void 0;var kd=P();function Ad(){return(0,kd.purry)(xd,arguments)}i(Ad,"allPass");Tr.allPass=Ad;function xd(e,t){return t.every(function(r){return r(e)})}i(xd,"_allPass")});var Fs=p(Dr=>{"use strict";Object.defineProperty(Dr,"__esModule",{value:!0});Dr.anyPass=void 0;var Rd=P();function jd(){return(0,Rd.purry)(zd,arguments)}i(jd,"anyPass");Dr.anyPass=jd;function zd(e,t){return t.some(function(r){return r(e)})}i(zd,"_anyPass")});var Cr=p(Fr=>{"use strict";Object.defineProperty(Fr,"__esModule",{value:!0});Fr._withPrecision=void 0;var Cs=15;function Nd(e){return function(t,r){if(r===0)return e(t);if(!Number.isInteger(r))throw new TypeError("precision must be an integer: ".concat(r));if(r>Cs||r<-Cs)throw new RangeError("precision must be between -15 and 15");if(Number.isNaN(t)||!Number.isFinite(t))return e(t);var n=Math.pow(10,r);return e(t*n)/n}}i(Nd,"_withPrecision");Fr._withPrecision=Nd});var Ls=p(Lr=>{"use strict";Object.defineProperty(Lr,"__esModule",{value:!0});Lr.ceil=void 0;var Hd=Cr(),Bd=P();function $d(){return(0,Bd.purry)((0,Hd._withPrecision)(Math.ceil),arguments)}i($d,"ceil");Lr.ceil=$d});var qs=p(qr=>{"use strict";Object.defineProperty(qr,"__esModule",{value:!0});qr.chunk=void 0;var Wd=P();function Ud(){return(0,Wd.purry)(Gd,arguments)}i(Ud,"chunk");qr.chunk=Ud;function Gd(e,t){for(var r=Array.from({length:Math.ceil(e.length/t)}),n=0;n<r.length;n+=1)r[n]=e.slice(n*t,(n+1)*t);return r}i(Gd,"_chunk")});var ks=p(kr=>{"use strict";Object.defineProperty(kr,"__esModule",{value:!0});kr.clamp=void 0;var Vd=P();function Kd(){return(0,Vd.purry)(Yd,arguments)}i(Kd,"clamp");kr.clamp=Kd;function Yd(e,t){return t.min!=null&&t.min>e?t.min:t.max!=null&&t.max<e?t.max:e}i(Yd,"_clamp")});var Xi=p(Ar=>{"use strict";Object.defineProperty(Ar,"__esModule",{value:!0});Ar.type=void 0;function Zd(e){return e===null?"Null":e===void 0?"Undefined":Object.prototype.toString.call(e).slice(8,-1)}i(Zd,"type");Ar.type=Zd});var xs=p(xr=>{"use strict";Object.defineProperty(xr,"__esModule",{value:!0});xr.clone=void 0;var Qd=Xi();function Jd(e){return new RegExp(e.source,(e.global?"g":"")+(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.sticky?"y":"")+(e.unicode?"u":""))}i(Jd,"_cloneRegExp");function As(e,t,r,n){function a(s){for(var o=t.length,l=0;l<o;){if(e===t[l])return r[l];l+=1}t[l+1]=e,r[l+1]=s;for(var f in e)s[f]=n?As(e[f],t,r,!0):e[f];return s}switch(i(a,"copy"),(0,Qd.type)(e)){case"Object":return a({});case"Array":return a([]);case"Date":return new Date(e.valueOf());case"RegExp":return Jd(e);default:return e}}i(As,"_clone");function Xd(e){return e!=null&&typeof e.clone=="function"?e.clone():As(e,[],[],!0)}i(Xd,"clone");xr.clone=Xd});var ea=p(Rr=>{"use strict";Object.defineProperty(Rr,"__esModule",{value:!0});Rr.isTruthy=void 0;function ep(e){return!!e}i(ep,"isTruthy");Rr.isTruthy=ep});var Rs=p(jr=>{"use strict";Object.defineProperty(jr,"__esModule",{value:!0});jr.compact=void 0;var tp=ea();function rp(e){return e.filter(tp.isTruthy)}i(rp,"compact");jr.compact=rp});var js=p(zr=>{"use strict";Object.defineProperty(zr,"__esModule",{value:!0});zr.concat=void 0;var np=P();function ip(){return(0,np.purry)(ap,arguments)}i(ip,"concat");zr.concat=ip;function ap(e,t){return e.concat(t)}i(ap,"_concat")});var Ns=p(Ne=>{"use strict";var zs=Ne&&Ne.__spreadArray||function(e,t,r){if(r||arguments.length===2)for(var n=0,a=t.length,s;n<a;n++)(s||!(n in t))&&(s||(s=Array.prototype.slice.call(t,0,n)),s[n]=t[n]);return e.concat(s||Array.prototype.slice.call(t))};Object.defineProperty(Ne,"__esModule",{value:!0});Ne.purryOn=void 0;function sp(e,t,r){var n=Array.from(r),a=n[0],s=n.slice(1);return e(a)?function(o){return t.apply(void 0,zs([o],n,!1))}:t.apply(void 0,zs([a],s,!1))}i(sp,"purryOn");Ne.purryOn=sp});var Hs=p(_t=>{"use strict";Object.defineProperty(_t,"__esModule",{value:!0});_t.conditional=void 0;var op=Ns();function ta(){return(0,op.purryOn)(lp,up,arguments)}i(ta,"conditional");_t.conditional=ta;function up(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(var n=0,a=t;n<a.length;n++){var s=a[n],o=s[0],l=s[1];if(o(e))return l(e)}throw new Error("conditional: data failed for all cases")}i(up,"conditionalImplementation");function lp(e){if(!Array.isArray(e))return!1;var t=e[0],r=e[1],n=e.slice(2);return typeof t=="function"&&t.length<=1&&typeof r=="function"&&r.length<=1&&n.length===0}i(lp,"isCase");(function(e){e.defaultCase=function(t){return t===void 0&&(t=cp),[function(){return!0},t]}})(ta||(_t.conditional=ta={}));var cp=i(function(){},"trivialDefaultCase")});var Ws=p(St=>{"use strict";Object.defineProperty(St,"__esModule",{value:!0});St.countBy=void 0;var Bs=P(),$s=i(function(e){return function(t,r){return t.reduce(function(n,a,s){var o=e?r(a,s,t):r(a);return n+(o?1:0)},0)}},"_countBy");function ra(){return(0,Bs.purry)($s(!1),arguments)}i(ra,"countBy");St.countBy=ra;(function(e){function t(){return(0,Bs.purry)($s(!0),arguments)}i(t,"indexed"),e.indexed=t})(ra||(St.countBy=ra={}))});var na=p(Nr=>{"use strict";Object.defineProperty(Nr,"__esModule",{value:!0});Nr.pipe=void 0;function fp(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(var n=e,a=t.map(function(S){var M=S,E=M.lazy,F=M.lazyArgs;if(E){var C=E.apply(void 0,F||[]);return C.indexed=E.indexed,C.single=E.single,C.index=0,C.items=[],C}return null}),s=0;s<t.length;){var o=t[s],l=a[s];if(!l){n=o(n),s++;continue}for(var f=[],c=s;c<t.length&&a[c];c++)if(f.push(a[c]),a[c].single)break;for(var d=[],m=0,b=n;m<b.length;m++){var v=b[m];if(Us({item:v,acc:d,lazySeq:f}))break}var h=f[f.length-1];h.single?n=d[0]:n=d,s+=f.length}return n}i(fp,"pipe");Nr.pipe=fp;function Us(e){var t=e.item,r=e.lazySeq,n=e.acc;if(r.length===0)return n.push(t),!1;for(var a={done:!1,hasNext:!1},s=!1,o=0;o<r.length;o++){var l=r[o],f=l.indexed,c=l.index,d=l.items;if(d.push(t),a=f?l(t,c,d):l(t),l.index++,a.hasNext)if(a.hasMany){for(var m=a.next,b=0,v=m;b<v.length;b++){var h=v[b],S=Us({item:h,acc:n,lazySeq:r.slice(o+1)});if(S)return!0}return!1}else t=a.next;if(!a.hasNext)break;a.done&&(s=!0)}return a.hasNext&&n.push(t),!!s}i(Us,"_processItem")});var Gs=p(He=>{"use strict";var dp=He&&He.__spreadArray||function(e,t,r){if(r||arguments.length===2)for(var n=0,a=t.length,s;n<a;n++)(s||!(n in t))&&(s||(s=Array.prototype.slice.call(t,0,n)),s[n]=t[n]);return e.concat(s||Array.prototype.slice.call(t))};Object.defineProperty(He,"__esModule",{value:!0});He.createPipe=void 0;var pp=na();function mp(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(r){return pp.pipe.apply(void 0,dp([r],e,!1))}}i(mp,"createPipe");He.createPipe=mp});var Vs=p(Hr=>{"use strict";Object.defineProperty(Hr,"__esModule",{value:!0});Hr.debounce=void 0;function yp(e,t){var r=t.waitMs,n=t.timing,a=n===void 0?"trailing":n,s=t.maxWaitMs;if(s!==void 0&&r!==void 0&&s<r)throw new Error("debounce: maxWaitMs (".concat(s,") cannot be less than waitMs (").concat(r,")"));var o,l,f,c,d=i(function(){if(f!==void 0){if(l!==void 0){var v=l;l=void 0,clearTimeout(v)}var h=f;f=void 0,c=e.apply(void 0,h)}},"handleInvoke"),m=i(function(){if(o!==void 0){var v=o;o=void 0,clearTimeout(v),f!==void 0&&d()}},"handleCoolDownEnd"),b=i(function(v){f=v,s!==void 0&&l===void 0&&(l=setTimeout(d,s))},"handleDebouncedCall");return{call:function(){for(var v,h=[],S=0;S<arguments.length;S++)h[S]=arguments[S];if(o===void 0)a==="trailing"?b(h):c=e.apply(void 0,h);else{a!=="leading"&&b(h);var M=o;o=void 0,clearTimeout(M)}return o=setTimeout(m,(v=r??s)!==null&&v!==void 0?v:0),c},cancel:function(){if(o!==void 0){var v=o;o=void 0,clearTimeout(v)}if(l!==void 0){var v=l;l=void 0,clearTimeout(v)}f=void 0},flush:function(){return m(),c},get isPending(){return o!==void 0},get cachedValue(){return c}}}i(yp,"debounce");Hr.debounce=yp});var Y=p(Br=>{"use strict";Object.defineProperty(Br,"__esModule",{value:!0});Br._reduceLazy=void 0;function gp(e,t,r){for(var n=[],a=0;a<e.length;a++){var s=e[a],o=r?t(s,a,e):t(s);o.hasMany===!0?n.push.apply(n,o.next):o.hasNext&&n.push(o.next)}return n}i(gp,"_reduceLazy");Br._reduceLazy=gp});var Ks=p(Ot=>{"use strict";Object.defineProperty(Ot,"__esModule",{value:!0});Ot.difference=void 0;var hp=P(),vp=Y();function Pt(){return(0,hp.purry)(bp,arguments,Pt.lazy)}i(Pt,"difference");Ot.difference=Pt;function bp(e,t){var r=Pt.lazy(t);return(0,vp._reduceLazy)(e,r)}i(bp,"_difference");(function(e){function t(r){var n=new Set(r);return function(a){return n.has(a)?{done:!1,hasNext:!1}:{done:!1,hasNext:!0,next:a}}}i(t,"lazy"),e.lazy=t})(Pt||(Ot.difference=Pt={}))});var Ys=p(It=>{"use strict";Object.defineProperty(It,"__esModule",{value:!0});It.differenceWith=void 0;var _p=P(),Sp=Y();function Mt(){return(0,_p.purry)(Pp,arguments,Mt.lazy)}i(Mt,"differenceWith");It.differenceWith=Mt;function Pp(e,t,r){var n=Mt.lazy(t,r);return(0,Sp._reduceLazy)(e,n)}i(Pp,"_differenceWith");(function(e){function t(r,n){return function(a){return r.every(function(s){return!n(a,s)})?{done:!1,hasNext:!0,next:a}:{done:!1,hasNext:!1}}}i(t,"lazy"),e.lazy=t})(Mt||(It.differenceWith=Mt={}))});var Zs=p($r=>{"use strict";Object.defineProperty($r,"__esModule",{value:!0});$r.divide=void 0;var Op=P();function Mp(){return(0,Op.purry)(Ip,arguments)}i(Mp,"divide");$r.divide=Mp;function Ip(e,t){return e/t}i(Ip,"_divide")});var Qs=p(Et=>{"use strict";Object.defineProperty(Et,"__esModule",{value:!0});Et.drop=void 0;var wp=P(),Ep=Y();function wt(){return(0,wp.purry)(Tp,arguments,wt.lazy)}i(wt,"drop");Et.drop=wt;function Tp(e,t){return(0,Ep._reduceLazy)(e,wt.lazy(t))}i(Tp,"_drop");(function(e){function t(r){var n=r;return function(a){return n>0?(n--,{done:!1,hasNext:!1}):{done:!1,hasNext:!0,next:a}}}i(t,"lazy"),e.lazy=t})(wt||(Et.drop=wt={}))});var ia=p(Wr=>{"use strict";Object.defineProperty(Wr,"__esModule",{value:!0});Wr.swapInPlace=void 0;function Dp(e,t,r){var n;n=[e[r],e[t]],e[t]=n[0],e[r]=n[1]}i(Dp,"swapInPlace");Wr.swapInPlace=Dp});var aa=p(Be=>{"use strict";Object.defineProperty(Be,"__esModule",{value:!0});Be.heapMaybeInsert=Be.heapify=void 0;var Fp=ia();function Cp(e,t){for(var r=Math.floor(e.length/2)-1;r>=0;r--)Js(e,r,t)}i(Cp,"heapify");Be.heapify=Cp;function Lp(e,t,r){var n=e[0];if(!(t(r,n)>=0))return e[0]=r,Js(e,0,t),n}i(Lp,"heapMaybeInsert");Be.heapMaybeInsert=Lp;function Js(e,t,r){for(var n=t;n*2+1<e.length;){var a=n*2+1,s=r(e[n],e[a])<0?a:n,o=a+1;if(o<e.length&&r(e[s],e[o])<0&&(s=o),s===n)return;(0,Fp.swapInPlace)(e,n,s),n=s}}i(Js,"heapSiftDown")});var De=p(me=>{"use strict";var $e=me&&me.__spreadArray||function(e,t,r){if(r||arguments.length===2)for(var n=0,a=t.length,s;n<a;n++)(s||!(n in t))&&(s||(s=Array.prototype.slice.call(t,0,n)),s[n]=t[n]);return e.concat(s||Array.prototype.slice.call(t))};Object.defineProperty(me,"__esModule",{value:!0});me.purryOrderRulesWithArgument=me.purryOrderRules=void 0;var eo={asc:function(e,t){return e>t},desc:function(e,t){return e<t}};function to(e,t){var r=Array.isArray(t)?t:Array.from(t),n=r[0],a=r.slice(1);if(!ro(n)){var s=sa.apply(void 0,a);return e(n,s)}var o=sa.apply(void 0,$e([n],a,!1));return function(l){return e(l,o)}}i(to,"purryOrderRules");me.purryOrderRules=to;function qp(e,t){var r=Array.from(t),n=r[0],a=r[1],s=r.slice(2),o,l;return ro(a)?(o=n,l=$e([a],s,!0)):(o=a,l=$e([n],s,!0)),to(function(){for(var f=[],c=0;c<arguments.length;c++)f[c]=arguments[c];return e.apply(void 0,$e($e([],f,!1),[o],!1))},l)}i(qp,"purryOrderRulesWithArgument");me.purryOrderRulesWithArgument=qp;function sa(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var a=typeof e=="function"?e:e[0],s=typeof e=="function"?"asc":e[1],o=eo[s],l=t===void 0?void 0:sa.apply(void 0,$e([t],r,!1));return function(f,c){var d,m=a(f),b=a(c);return o(m,b)?1:o(b,m)?-1:(d=l?.(f,c))!==null&&d!==void 0?d:0}}i(sa,"orderRuleComparer");function ro(e){if(Xs(e))return!0;if(typeof e!="object"||!Array.isArray(e))return!1;var t=e[0],r=e[1],n=e.slice(2);return Xs(t)&&r in eo&&n.length===0}i(ro,"isOrderRule");var Xs=i(function(e){return typeof e=="function"&&e.length===1},"isProjection")});var io=p(We=>{"use strict";var kp=We&&We.__spreadArray||function(e,t,r){if(r||arguments.length===2)for(var n=0,a=t.length,s;n<a;n++)(s||!(n in t))&&(s||(s=Array.prototype.slice.call(t,0,n)),s[n]=t[n]);return e.concat(s||Array.prototype.slice.call(t))};Object.defineProperty(We,"__esModule",{value:!0});We.dropFirstBy=void 0;var no=aa(),Ap=De();function xp(){return(0,Ap.purryOrderRulesWithArgument)(Rp,arguments)}i(xp,"dropFirstBy");We.dropFirstBy=xp;function Rp(e,t,r){if(r>=e.length)return[];if(r<=0)return kp([],e,!0);var n=e.slice(0,r);(0,no.heapify)(n,t);for(var a=[],s=e.slice(r),o=0,l=s;o<l.length;o++){var f=l[o],c=(0,no.heapMaybeInsert)(n,t,f);a.push(c??f)}return a}i(Rp,"dropFirstByImplementation")});var ao=p(Ue=>{"use strict";var jp=Ue&&Ue.__spreadArray||function(e,t,r){if(r||arguments.length===2)for(var n=0,a=t.length,s;n<a;n++)(s||!(n in t))&&(s||(s=Array.prototype.slice.call(t,0,n)),s[n]=t[n]);return e.concat(s||Array.prototype.slice.call(t))};Object.defineProperty(Ue,"__esModule",{value:!0});Ue.dropLast=void 0;var zp=P();function Np(){return(0,zp.purry)(Hp,arguments)}i(Np,"dropLast");Ue.dropLast=Np;function Hp(e,t){var r=jp([],e,!0);return t>0&&r.splice(-t),r}i(Hp,"_dropLast")});var so=p(Ur=>{"use strict";Object.defineProperty(Ur,"__esModule",{value:!0});Ur.dropLastWhile=void 0;var Bp=P();function $p(){return(0,Bp.purry)(Wp,arguments)}i($p,"dropLastWhile");Ur.dropLastWhile=$p;function Wp(e,t){for(var r=e.length-1;r>=0;r--)if(!t(e[r]))return e.slice(0,r+1);return[]}i(Wp,"_dropLastWhile")});var oo=p(Gr=>{"use strict";Object.defineProperty(Gr,"__esModule",{value:!0});Gr.dropWhile=void 0;var Up=P();function Gp(){return(0,Up.purry)(Vp,arguments)}i(Gp,"dropWhile");Gr.dropWhile=Gp;function Vp(e,t){for(var r=0;r<e.length;r++)if(!t(e[r]))return e.slice(r);return[]}i(Vp,"_dropWhile")});var co=p(Vr=>{"use strict";Object.defineProperty(Vr,"__esModule",{value:!0});Vr.equals=void 0;var Kp=P(),uo=Array.isArray,lo=Object.keys;function oa(){return(0,Kp.purry)(Yp,arguments)}i(oa,"equals");Vr.equals=oa;function Yp(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var r=uo(e),n=uo(t),a=void 0,s,o=void 0;if(r&&n){if(s=e.length,s!==t.length)return!1;for(a=s;a--!==0;)if(!oa(e[a],t[a]))return!1;return!0}if(r!==n)return!1;var l=e instanceof Date,f=t instanceof Date;if(l!==f)return!1;if(l&&f)return e.getTime()===t.getTime();var c=e instanceof RegExp,d=t instanceof RegExp;if(c!==d)return!1;if(c&&d)return e.toString()===t.toString();var m=lo(e);if(s=m.length,s!==lo(t).length)return!1;for(a=s;a--!==0;)if(!Object.prototype.hasOwnProperty.call(t,m[a]))return!1;for(a=s;a--!==0;)if(o=m[a],!oa(e[o],t[o]))return!1;return!0}return e!==e&&t!==t}i(Yp,"_equals")});var la=p(Tt=>{"use strict";Object.defineProperty(Tt,"__esModule",{value:!0});Tt.toPairs=void 0;function ua(e){return Object.entries(e)}i(ua,"toPairs");Tt.toPairs=ua;(function(e){function t(r){return Object.entries(r)}i(t,"strict"),e.strict=t})(ua||(Tt.toPairs=ua={}))});var po=p(Ge=>{"use strict";var ca=Ge&&Ge.__assign||function(){return ca=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},ca.apply(this,arguments)};Object.defineProperty(Ge,"__esModule",{value:!0});Ge.evolve=void 0;var Zp=P(),Qp=la();function Jp(){return(0,Zp.purry)(fo,arguments)}i(Jp,"evolve");Ge.evolve=Jp;function fo(e,t){return typeof e!="object"||e===null?e:Qp.toPairs.strict(t).reduce(function(r,n){var a=n[0],s=n[1];return a in r&&(r[a]=typeof s=="function"?s(r[a]):fo(r[a],s)),r},ca({},e))}i(fo,"_evolve")});var ye=p(Kr=>{"use strict";Object.defineProperty(Kr,"__esModule",{value:!0});Kr._toLazyIndexed=void 0;var Xp=i(function(e){return e.indexed=!0,e},"_toLazyIndexed");Kr._toLazyIndexed=Xp});var ho=p(Dt=>{"use strict";Object.defineProperty(Dt,"__esModule",{value:!0});Dt.filter=void 0;var yo=P(),em=Y(),tm=ye();function Ve(){return(0,yo.purry)(go(!1),arguments,Ve.lazy)}i(Ve,"filter");Dt.filter=Ve;var go=i(function(e){return function(t,r){return(0,em._reduceLazy)(t,e?Ve.lazyIndexed(r):Ve.lazy(r),e)}},"_filter"),mo=i(function(e){return function(t){return function(r,n,a){var s=e?t(r,n,a):t(r);return s?{done:!1,hasNext:!0,next:r}:{done:!1,hasNext:!1}}}},"_lazy");(function(e){function t(){return(0,yo.purry)(go(!0),arguments,e.lazyIndexed)}i(t,"indexed"),e.indexed=t,e.lazy=mo(!1),e.lazyIndexed=(0,tm._toLazyIndexed)(mo(!0))})(Ve||(Dt.filter=Ve={}))});var fa=p(Yr=>{"use strict";Object.defineProperty(Yr,"__esModule",{value:!0});Yr._toSingle=void 0;var rm=i(function(e){return e.single=!0,e},"_toSingle");Yr._toSingle=rm});var Po=p(Ft=>{"use strict";Object.defineProperty(Ft,"__esModule",{value:!0});Ft.find=void 0;var _o=P(),nm=ye(),vo=fa();function Zr(){return(0,_o.purry)(So(!1),arguments,Zr.lazy)}i(Zr,"find");Ft.find=Zr;var So=i(function(e){return function(t,r){return e?t.find(r):t.find(function(n){return r(n)})}},"_find"),bo=i(function(e){return function(t){return function(r,n,a){var s=e?t(r,n,a):t(r);return{done:s,hasNext:s,next:r}}}},"_lazy");(function(e){function t(){return(0,_o.purry)(So(!0),arguments,e.lazyIndexed)}i(t,"indexed"),e.indexed=t,e.lazy=(0,vo._toSingle)(bo(!1)),e.lazyIndexed=(0,vo._toSingle)((0,nm._toLazyIndexed)(bo(!0)))})(Zr||(Ft.find=Zr={}))});var Eo=p(Ct=>{"use strict";Object.defineProperty(Ct,"__esModule",{value:!0});Ct.findIndex=void 0;var Io=P(),im=ye(),Oo=fa();function Qr(){return(0,Io.purry)(wo(!1),arguments,Qr.lazy)}i(Qr,"findIndex");Ct.findIndex=Qr;var wo=i(function(e){return function(t,r){return e?t.findIndex(r):t.findIndex(function(n){return r(n)})}},"_findIndex"),Mo=i(function(e){return function(t){var r=0;return function(n,a,s){var o=e?t(n,a,s):t(n);return o?{done:!0,hasNext:!0,next:r}:(r++,{done:!1,hasNext:!1})}}},"_lazy");(function(e){function t(){return(0,Io.purry)(wo(!0),arguments,e.lazyIndexed)}i(t,"indexed"),e.indexed=t,e.lazy=(0,Oo._toSingle)(Mo(!1)),e.lazyIndexed=(0,Oo._toSingle)((0,im._toLazyIndexed)(Mo(!0)))})(Qr||(Ct.findIndex=Qr={}))});var Fo=p(Lt=>{"use strict";Object.defineProperty(Lt,"__esModule",{value:!0});Lt.findLast=void 0;var To=P();function da(){return(0,To.purry)(Do(!1),arguments)}i(da,"findLast");Lt.findLast=da;var Do=i(function(e){return function(t,r){for(var n=t.length-1;n>=0;n--)if(e?r(t[n],n,t):r(t[n]))return t[n]}},"_findLast");(function(e){function t(){return(0,To.purry)(Do(!0),arguments)}i(t,"indexed"),e.indexed=t})(da||(Lt.findLast=da={}))});var qo=p(qt=>{"use strict";Object.defineProperty(qt,"__esModule",{value:!0});qt.findLastIndex=void 0;var Co=P();function pa(){return(0,Co.purry)(Lo(!1),arguments)}i(pa,"findLastIndex");qt.findLastIndex=pa;var Lo=i(function(e){return function(t,r){for(var n=t.length-1;n>=0;n--)if(e?r(t[n],n,t):r(t[n]))return n;return-1}},"_findLastIndex");(function(e){function t(){return(0,Co.purry)(Lo(!0),arguments)}i(t,"indexed"),e.indexed=t})(pa||(qt.findLastIndex=pa={}))});var ko=p(kt=>{"use strict";Object.defineProperty(kt,"__esModule",{value:!0});kt.first=void 0;var am=P();function Jr(){return(0,am.purry)(sm,arguments,Jr.lazy)}i(Jr,"first");kt.first=Jr;function sm(e){var t=e[0];return t}i(sm,"_first");(function(e){function t(){return function(r){return{done:!0,hasNext:!0,next:r}}}i(t,"lazy"),e.lazy=t,function(r){r.single=!0}(t=e.lazy||(e.lazy={}))})(Jr||(kt.first=Jr={}))});var ma=p(Xr=>{"use strict";Object.defineProperty(Xr,"__esModule",{value:!0});Xr.hasAtLeast=void 0;var om=P();function um(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(0,om.purry)(lm,e)}i(um,"hasAtLeast");Xr.hasAtLeast=um;var lm=i(function(e,t){return e.length>=t},"hasAtLeastImplementation")});var Ao=p(en=>{"use strict";Object.defineProperty(en,"__esModule",{value:!0});en.firstBy=void 0;var cm=De(),fm=ma();function dm(){return(0,cm.purryOrderRules)(pm,arguments)}i(dm,"firstBy");en.firstBy=dm;function pm(e,t){var r=e[0];if(!(0,fm.hasAtLeast)(e,2))return r;for(var n=e.slice(1),a=0,s=n;a<s.length;a++){var o=s[a];t(o,r)<0&&(r=o)}return r}i(pm,"firstByImplementation")});var ya=p(xt=>{"use strict";Object.defineProperty(xt,"__esModule",{value:!0});xt.flatten=void 0;var mm=Y(),ym=P();function At(){return(0,ym.purry)(gm,arguments,At.lazy)}i(At,"flatten");xt.flatten=At;function gm(e){return(0,mm._reduceLazy)(e,At.lazy())}i(gm,"_flatten");(function(e){function t(){return function(r){return Array.isArray(r)?{done:!1,hasNext:!0,hasMany:!0,next:r}:{done:!1,hasNext:!0,next:r}}}i(t,"lazy"),e.lazy=t})(At||(xt.flatten=At={}))});var xo=p(Rt=>{"use strict";Object.defineProperty(Rt,"__esModule",{value:!0});Rt.flatMap=void 0;var hm=ya(),vm=P();function tn(){return(0,vm.purry)(bm,arguments,tn.lazy)}i(tn,"flatMap");Rt.flatMap=tn;function bm(e,t){return(0,hm.flatten)(e.map(function(r){return t(r)}))}i(bm,"_flatMap");(function(e){function t(r){return function(n){var a=r(n);return Array.isArray(a)?{done:!1,hasNext:!0,hasMany:!0,next:a}:{done:!1,hasNext:!0,next:a}}}i(t,"lazy"),e.lazy=t})(tn||(Rt.flatMap=tn={}))});var zo=p(jt=>{"use strict";Object.defineProperty(jt,"__esModule",{value:!0});jt.flatMapToObj=void 0;var Ro=P();function ga(){return(0,Ro.purry)(jo(!1),arguments)}i(ga,"flatMapToObj");jt.flatMapToObj=ga;var jo=i(function(e){return function(t,r){return t.reduce(function(n,a,s){var o=e?r(a,s,t):r(a);return o.forEach(function(l){var f=l[0],c=l[1];n[f]=c}),n},{})}},"_flatMapToObj");(function(e){function t(){return(0,Ro.purry)(jo(!0),arguments)}i(t,"indexed"),e.indexed=t})(ga||(jt.flatMapToObj=ga={}))});var No=p(zt=>{"use strict";Object.defineProperty(zt,"__esModule",{value:!0});zt.flattenDeep=void 0;var _m=Y(),Sm=P();function Ke(){return(0,Sm.purry)(Pm,arguments,Ke.lazy)}i(Ke,"flattenDeep");zt.flattenDeep=Ke;function Pm(e){return(0,_m._reduceLazy)(e,Ke.lazy())}i(Pm,"_flattenDeep");function Om(e){if(!Array.isArray(e))return e;var t=[];return e.forEach(function(r){Array.isArray(r)?t.push.apply(t,Ke(r)):t.push(r)}),t}i(Om,"_flattenDeepValue");(function(e){function t(){return function(r){var n=Om(r);return Array.isArray(n)?{done:!1,hasNext:!0,hasMany:!0,next:n}:{done:!1,hasNext:!0,next:n}}}i(t,"lazy"),e.lazy=t})(Ke||(zt.flattenDeep=Ke={}))});var Ho=p(rn=>{"use strict";Object.defineProperty(rn,"__esModule",{value:!0});rn.floor=void 0;var Mm=Cr(),Im=P();function wm(){return(0,Im.purry)((0,Mm._withPrecision)(Math.floor),arguments)}i(wm,"floor");rn.floor=wm});var Uo=p(Nt=>{"use strict";Object.defineProperty(Nt,"__esModule",{value:!0});Nt.forEach=void 0;var $o=P(),Em=Y(),Tm=ye();function Ye(){return(0,$o.purry)(Wo(!1),arguments,Ye.lazy)}i(Ye,"forEach");Nt.forEach=Ye;var Wo=i(function(e){return function(t,r){return(0,Em._reduceLazy)(t,e?Ye.lazyIndexed(r):Ye.lazy(r),e)}},"_forEach"),Bo=i(function(e){return function(t){return function(r,n,a){return e?t(r,n,a):t(r),{done:!1,hasNext:!0,next:r}}}},"_lazy");(function(e){function t(){return(0,$o.purry)(Wo(!0),arguments,e.lazyIndexed)}i(t,"indexed"),e.indexed=t,e.lazy=Bo(!1),e.lazyIndexed=(0,Tm._toLazyIndexed)(Bo(!0))})(Ye||(Nt.forEach=Ye={}))});var Ko=p(Ht=>{"use strict";Object.defineProperty(Ht,"__esModule",{value:!0});Ht.forEachObj=void 0;var Go=P();function ha(){return(0,Go.purry)(Vo(!1),arguments)}i(ha,"forEachObj");Ht.forEachObj=ha;var Vo=i(function(e){return function(t,r){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var a=t[n];e?r(a,n,t):r(a)}return t}},"_forEachObj");(function(e){function t(){return(0,Go.purry)(Vo(!0),arguments)}i(t,"indexed"),e.indexed=t})(ha||(Ht.forEachObj=ha={}))});var ba=p(Bt=>{"use strict";Object.defineProperty(Bt,"__esModule",{value:!0});Bt.fromPairs=void 0;function va(e){for(var t={},r=0,n=e;r<n.length;r++){var a=n[r],s=a[0],o=a[1];t[s]=o}return t}i(va,"fromPairs");Bt.fromPairs=va;(function(e){e.strict=e})(va||(Bt.fromPairs=va={}))});var Qo=p($t=>{"use strict";Object.defineProperty($t,"__esModule",{value:!0});$t.groupBy=void 0;var Yo=P();function _a(){return(0,Yo.purry)(Zo(!1),arguments)}i(_a,"groupBy");$t.groupBy=_a;var Zo=i(function(e){return function(t,r){var n={};return t.forEach(function(a,s){var o=e?r(a,s,t):r(a);if(o!==void 0){var l=String(o);n[l]||(n[l]=[]),n[l].push(a)}}),n}},"_groupBy");(function(e){function t(){return(0,Yo.purry)(Zo(!0),arguments)}i(t,"indexed"),e.indexed=t,e.strict=e})(_a||($t.groupBy=_a={}))});var Jo=p(nn=>{"use strict";Object.defineProperty(nn,"__esModule",{value:!0});nn.identity=void 0;function Dm(e){return e}i(Dm,"identity");nn.identity=Dm});var eu=p(Wt=>{"use strict";Object.defineProperty(Wt,"__esModule",{value:!0});Wt.indexBy=void 0;var Pa=P();function Sa(){return(0,Pa.purry)(Xo(!1),arguments)}i(Sa,"indexBy");Wt.indexBy=Sa;var Xo=i(function(e){return function(t,r){return t.reduce(function(n,a,s){var o=e?r(a,s,t):r(a),l=String(o);return n[l]=a,n},{})}},"_indexBy");function Fm(){return(0,Pa.purry)(Cm,arguments)}i(Fm,"indexByStrict");var Cm=i(function(e,t){return e.reduce(function(r,n){var a=t(n);return r[a]=n,r},{})},"_indexByStrict");(function(e){function t(){return(0,Pa.purry)(Xo(!0),arguments)}i(t,"indexed"),e.indexed=t,e.strict=Fm})(Sa||(Wt.indexBy=Sa={}))});var tu=p(Gt=>{"use strict";Object.defineProperty(Gt,"__esModule",{value:!0});Gt.intersection=void 0;var Lm=P(),qm=Y();function Ut(){return(0,Lm.purry)(km,arguments,Ut.lazy)}i(Ut,"intersection");Gt.intersection=Ut;function km(e,t){var r=Ut.lazy(t);return(0,qm._reduceLazy)(e,r)}i(km,"_intersection");(function(e){function t(r){return function(n){var a=new Set(r);return a.has(n)?{done:!1,hasNext:!0,next:n}:{done:!1,hasNext:!1}}}i(t,"lazy"),e.lazy=t})(Ut||(Gt.intersection=Ut={}))});var ru=p(Kt=>{"use strict";Object.defineProperty(Kt,"__esModule",{value:!0});Kt.intersectionWith=void 0;var Am=Y(),xm=P();function Vt(){return(0,xm.purry)(Rm,arguments,Vt.lazy)}i(Vt,"intersectionWith");Kt.intersectionWith=Vt;function Rm(e,t,r){var n=Vt.lazy(t,r);return(0,Am._reduceLazy)(e,n)}i(Rm,"_intersectionWith");(function(e){function t(r,n){return function(a){return r.some(function(s){return n(a,s)})?{done:!1,hasNext:!0,next:a}:{done:!1,hasNext:!1}}}i(t,"lazy"),e.lazy=t})(Vt||(Kt.intersectionWith=Vt={}))});var nu=p(an=>{"use strict";Object.defineProperty(an,"__esModule",{value:!0});an.invert=void 0;var jm=P();function zm(){return(0,jm.purry)(Nm,arguments)}i(zm,"invert");an.invert=zm;function Nm(e){var t={};for(var r in e)t[e[r]]=r;return t}i(Nm,"_invert")});var Oa=p(sn=>{"use strict";Object.defineProperty(sn,"__esModule",{value:!0});sn.isArray=void 0;function Hm(e){return Array.isArray(e)}i(Hm,"isArray");sn.isArray=Hm});var iu=p(on=>{"use strict";Object.defineProperty(on,"__esModule",{value:!0});on.isBoolean=void 0;function Bm(e){return typeof e=="boolean"}i(Bm,"isBoolean");on.isBoolean=Bm});var au=p(un=>{"use strict";Object.defineProperty(un,"__esModule",{value:!0});un.isDate=void 0;function $m(e){return e instanceof Date}i($m,"isDate");un.isDate=$m});var su=p(Yt=>{"use strict";Object.defineProperty(Yt,"__esModule",{value:!0});Yt.isDefined=void 0;function Ma(e){return typeof e<"u"&&e!==null}i(Ma,"isDefined");Yt.isDefined=Ma;(function(e){function t(r){return r!==void 0}i(t,"strict"),e.strict=t})(Ma||(Yt.isDefined=Ma={}))});var Ia=p(ln=>{"use strict";Object.defineProperty(ln,"__esModule",{value:!0});ln.isObject=void 0;function Wm(e){return!!e&&!Array.isArray(e)&&typeof e=="object"}i(Wm,"isObject");ln.isObject=Wm});var wa=p(cn=>{"use strict";Object.defineProperty(cn,"__esModule",{value:!0});cn.isString=void 0;function Um(e){return typeof e=="string"}i(Um,"isString");cn.isString=Um});var ou=p(fn=>{"use strict";Object.defineProperty(fn,"__esModule",{value:!0});fn.isEmpty=void 0;var Gm=Oa(),Vm=Ia(),Km=wa();function Ym(e){return e===void 0?!0:(0,Gm.isArray)(e)||(0,Km.isString)(e)?e.length===0:(0,Vm.isObject)(e)?Object.keys(e).length===0:!1}i(Ym,"isEmpty");fn.isEmpty=Ym});var uu=p(dn=>{"use strict";Object.defineProperty(dn,"__esModule",{value:!0});dn.isError=void 0;function Zm(e){return e instanceof Error}i(Zm,"isError");dn.isError=Zm});var lu=p(pn=>{"use strict";Object.defineProperty(pn,"__esModule",{value:!0});pn.isFunction=void 0;function Qm(e){return typeof e=="function"}i(Qm,"isFunction");pn.isFunction=Qm});var cu=p(mn=>{"use strict";Object.defineProperty(mn,"__esModule",{value:!0});mn.isNil=void 0;function Jm(e){return e==null}i(Jm,"isNil");mn.isNil=Jm});var fu=p(yn=>{"use strict";Object.defineProperty(yn,"__esModule",{value:!0});yn.isNonNull=void 0;function Xm(e){return e!==null}i(Xm,"isNonNull");yn.isNonNull=Xm});var du=p(gn=>{"use strict";Object.defineProperty(gn,"__esModule",{value:!0});gn.isNot=void 0;function ey(e){return function(t){return!e(t)}}i(ey,"isNot");gn.isNot=ey});var pu=p(hn=>{"use strict";Object.defineProperty(hn,"__esModule",{value:!0});hn.isNumber=void 0;function ty(e){return typeof e=="number"&&!isNaN(e)}i(ty,"isNumber");hn.isNumber=ty});var mu=p(vn=>{"use strict";Object.defineProperty(vn,"__esModule",{value:!0});vn.isObjectType=void 0;var ry=i(function(e){return typeof e=="object"&&e!==null},"isObjectType");vn.isObjectType=ry});var yu=p(bn=>{"use strict";Object.defineProperty(bn,"__esModule",{value:!0});bn.isPlainObject=void 0;function ny(e){if(typeof e!="object"||e===null)return!1;var t=Object.getPrototypeOf(e);return t===null||t===Object.prototype}i(ny,"isPlainObject");bn.isPlainObject=ny});var gu=p(_n=>{"use strict";Object.defineProperty(_n,"__esModule",{value:!0});_n.isPromise=void 0;function iy(e){return e instanceof Promise}i(iy,"isPromise");_n.isPromise=iy});var hu=p(Sn=>{"use strict";Object.defineProperty(Sn,"__esModule",{value:!0});Sn.isSymbol=void 0;function ay(e){return typeof e=="symbol"}i(ay,"isSymbol");Sn.isSymbol=ay});var vu=p(Pn=>{"use strict";Object.defineProperty(Pn,"__esModule",{value:!0});Pn.join=void 0;var sy=P();function oy(){return(0,sy.purry)(uy,arguments)}i(oy,"join");Pn.join=oy;var uy=i(function(e,t){return e.join(t)},"joinImplementation")});var bu=p(Zt=>{"use strict";Object.defineProperty(Zt,"__esModule",{value:!0});Zt.keys=void 0;function Ea(e){return Object.keys(e)}i(Ea,"keys");Zt.keys=Ea;(function(e){e.strict=e})(Ea||(Zt.keys=Ea={}))});var _u=p(On=>{"use strict";Object.defineProperty(On,"__esModule",{value:!0});On.last=void 0;var ly=P();function cy(){return(0,ly.purry)(fy,arguments)}i(cy,"last");On.last=cy;function fy(e){return e[e.length-1]}i(fy,"_last")});var Su=p(Mn=>{"use strict";Object.defineProperty(Mn,"__esModule",{value:!0});Mn.length=void 0;var dy=P();function py(){return(0,dy.purry)(my,arguments)}i(py,"length");Mn.length=py;function my(e){return"length"in e?e.length:Array.from(e).length}i(my,"_length")});var Iu=p(Qt=>{"use strict";Object.defineProperty(Qt,"__esModule",{value:!0});Qt.map=void 0;var Ou=P(),yy=Y(),gy=ye();function Ze(){return(0,Ou.purry)(Mu(!1),arguments,Ze.lazy)}i(Ze,"map");Qt.map=Ze;var Mu=i(function(e){return function(t,r){return(0,yy._reduceLazy)(t,e?Ze.lazyIndexed(r):Ze.lazy(r),e)}},"_map"),Pu=i(function(e){return function(t){return function(r,n,a){return{done:!1,hasNext:!0,next:e?t(r,n,a):t(r)}}}},"_lazy");(function(e){function t(){return(0,Ou.purry)(Mu(!0),arguments,e.lazyIndexed)}i(t,"indexed"),e.indexed=t,e.lazy=Pu(!1),e.lazyIndexed=(0,gy._toLazyIndexed)(Pu(!0)),e.strict=e})(Ze||(Qt.map=Ze={}))});var Eu=p(In=>{"use strict";Object.defineProperty(In,"__esModule",{value:!0});In.mapKeys=void 0;function hy(e,t){return arguments.length===1?function(r){return wu(r,e)}:wu(e,t)}i(hy,"mapKeys");In.mapKeys=hy;function wu(e,t){return Object.keys(e).reduce(function(r,n){return r[t(n,e[n])]=e[n],r},{})}i(wu,"_mapKeys")});var Fu=p(Jt=>{"use strict";Object.defineProperty(Jt,"__esModule",{value:!0});Jt.mapToObj=void 0;var Tu=P();function Ta(){return(0,Tu.purry)(Du(!1),arguments)}i(Ta,"mapToObj");Jt.mapToObj=Ta;var Du=i(function(e){return function(t,r){return t.reduce(function(n,a,s){var o=e?r(a,s,t):r(a),l=o[0],f=o[1];return n[l]=f,n},{})}},"_mapToObj");(function(e){function t(){return(0,Tu.purry)(Du(!0),arguments)}i(t,"indexed"),e.indexed=t})(Ta||(Jt.mapToObj=Ta={}))});var Lu=p(wn=>{"use strict";Object.defineProperty(wn,"__esModule",{value:!0});wn.mapValues=void 0;function vy(e,t){return arguments.length===1?function(r){return Cu(r,e)}:Cu(e,t)}i(vy,"mapValues");wn.mapValues=vy;function Cu(e,t){return Object.keys(e).reduce(function(r,n){return r[n]=t(e[n],n),r},{})}i(Cu,"_mapValues")});var Au=p(Xt=>{"use strict";Object.defineProperty(Xt,"__esModule",{value:!0});Xt.maxBy=void 0;var qu=P(),ku=i(function(e){return function(t,r){var n=void 0,a=void 0;return t.forEach(function(s,o){var l=e?r(s,o,t):r(s);(a===void 0||l>a)&&(n=s,a=l)}),n}},"_maxBy");function Da(){return(0,qu.purry)(ku(!1),arguments)}i(Da,"maxBy");Xt.maxBy=Da;(function(e){function t(){return(0,qu.purry)(ku(!0),arguments)}i(t,"indexed"),e.indexed=t})(Da||(Xt.maxBy=Da={}))});var ju=p(er=>{"use strict";Object.defineProperty(er,"__esModule",{value:!0});er.meanBy=void 0;var xu=P(),Ru=i(function(e){return function(t,r){if(t.length===0)return NaN;var n=0;return t.forEach(function(a,s){n+=e?r(a,s,t):r(a)}),n/t.length}},"_meanBy");function Fa(){return(0,xu.purry)(Ru(!1),arguments)}i(Fa,"meanBy");er.meanBy=Fa;(function(e){function t(){return(0,xu.purry)(Ru(!0),arguments)}i(t,"indexed"),e.indexed=t})(Fa||(er.meanBy=Fa={}))});var zu=p(En=>{"use strict";Object.defineProperty(En,"__esModule",{value:!0});En.merge=void 0;var by=P();function _y(){return(0,by.purry)(Sy,arguments)}i(_y,"merge");En.merge=_y;function Sy(e,t){return Object.assign({},e,t)}i(Sy,"_merge")});var Nu=p(Qe=>{"use strict";var Tn=Qe&&Qe.__assign||function(){return Tn=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},Tn.apply(this,arguments)};Object.defineProperty(Qe,"__esModule",{value:!0});Qe.mergeAll=void 0;function Py(e){return e.reduce(function(t,r){return Tn(Tn({},t),r)},{})}i(Py,"mergeAll");Qe.mergeAll=Py});var $u=p(Je=>{"use strict";var Dn=Je&&Je.__assign||function(){return Dn=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},Dn.apply(this,arguments)};Object.defineProperty(Je,"__esModule",{value:!0});Je.mergeDeep=void 0;var Oy=P();function My(){return(0,Oy.purry)(Bu,arguments)}i(My,"mergeDeep");Je.mergeDeep=My;function Bu(e,t){var r=Dn(Dn({},e),t);for(var n in t)if(n in e){var a=e[n];if(Hu(a)){var s=t[n];Hu(s)&&(r[n]=Bu(a,s))}}return r}i(Bu,"mergeDeepImplementation");function Hu(e){return typeof e=="object"&&e!==null&&Object.getPrototypeOf(e)===Object.prototype}i(Hu,"isRecord")});var Gu=p(tr=>{"use strict";Object.defineProperty(tr,"__esModule",{value:!0});tr.minBy=void 0;var Wu=P(),Uu=i(function(e){return function(t,r){var n=void 0,a=void 0;return t.forEach(function(s,o){var l=e?r(s,o,t):r(s);(a===void 0||l<a)&&(n=s,a=l)}),n}},"_minBy");function Ca(){return(0,Wu.purry)(Uu(!1),arguments)}i(Ca,"minBy");tr.minBy=Ca;(function(e){function t(){return(0,Wu.purry)(Uu(!0),arguments)}i(t,"indexed"),e.indexed=t})(Ca||(tr.minBy=Ca={}))});var Vu=p(Fn=>{"use strict";Object.defineProperty(Fn,"__esModule",{value:!0});Fn.multiply=void 0;var Iy=P();function wy(){return(0,Iy.purry)(Ey,arguments)}i(wy,"multiply");Fn.multiply=wy;function Ey(e,t){return e*t}i(Ey,"_multiply")});var Ku=p(Cn=>{"use strict";Object.defineProperty(Cn,"__esModule",{value:!0});Cn.noop=void 0;var Ty=i(function(){},"noop");Cn.noop=Ty});var Qu=p(Xe=>{"use strict";var Dy=Xe&&Xe.__spreadArray||function(e,t,r){if(r||arguments.length===2)for(var n=0,a=t.length,s;n<a;n++)(s||!(n in t))&&(s||(s=Array.prototype.slice.call(t,0,n)),s[n]=t[n]);return e.concat(s||Array.prototype.slice.call(t))};Object.defineProperty(Xe,"__esModule",{value:!0});Xe.quickSelect=void 0;var Yu=ia(),Fy=i(function(e,t,r){return t<0||t>=e.length?void 0:Zu(Dy([],e,!0),0,e.length-1,t,r)},"quickSelect");Xe.quickSelect=Fy;function Zu(e,t,r,n,a){if(t===r)return e[t];var s=Cy(e,t,r,a);return n===s?e[n]:Zu(e,n<s?t:s+1,n<s?s-1:r,n,a)}i(Zu,"quickSelectImplementation");function Cy(e,t,r,n){for(var a=e[r],s=t,o=t;o<r;o++)n(e[o],a)<0&&((0,Yu.swapInPlace)(e,s,o),s++);return(0,Yu.swapInPlace)(e,s,r),s}i(Cy,"partition")});var Ju=p(Ln=>{"use strict";Object.defineProperty(Ln,"__esModule",{value:!0});Ln.nthBy=void 0;var Ly=De(),qy=Qu();function ky(){return(0,Ly.purryOrderRulesWithArgument)(Ay,arguments)}i(ky,"nthBy");Ln.nthBy=ky;var Ay=i(function(e,t,r){return(0,qy.quickSelect)(e,r>=0?r:e.length+r,t)},"nthByImplementation")});var Xu=p(qn=>{"use strict";Object.defineProperty(qn,"__esModule",{value:!0});qn.objOf=void 0;var xy=P();function Ry(){return(0,xy.purry)(jy,arguments)}i(Ry,"objOf");qn.objOf=Ry;function jy(e,t){var r;return r={},r[t]=e,r}i(jy,"_objOf")});var el=p(ge=>{"use strict";var kn=ge&&ge.__assign||function(){return kn=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},kn.apply(this,arguments)},zy=ge&&ge.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]]);return r};Object.defineProperty(ge,"__esModule",{value:!0});ge.omit=void 0;var Ny=ba(),Hy=P();function By(){return(0,Hy.purry)($y,arguments)}i(By,"omit");ge.omit=By;function $y(e,t){if(t.length===0)return kn({},e);if(t.length===1){var r=t[0],n=e,a=r,s=n[a],o=zy(n,[typeof a=="symbol"?a:a+""]);return o}if(!t.some(function(f){return f in e}))return kn({},e);var l=new Set(t);return(0,Ny.fromPairs)(Object.entries(e).filter(function(f){var c=f[0];return!l.has(c)}))}i($y,"_omit")});var tl=p(An=>{"use strict";Object.defineProperty(An,"__esModule",{value:!0});An.omitBy=void 0;var Wy=P();function Uy(){return(0,Wy.purry)(Gy,arguments)}i(Uy,"omitBy");An.omitBy=Uy;function Gy(e,t){return Object.keys(e).reduce(function(r,n){return t(e[n],n)||(r[n]=e[n]),r},{})}i(Gy,"_omitBy")});var rl=p(xn=>{"use strict";Object.defineProperty(xn,"__esModule",{value:!0});xn.once=void 0;function Vy(e){var t=!1,r;return function(){return t||(r=e(),t=!0),r}}i(Vy,"once");xn.once=Vy});var nl=p(Rn=>{"use strict";Object.defineProperty(Rn,"__esModule",{value:!0});Rn.only=void 0;var Ky=P();function Yy(){return(0,Ky.purry)(Zy,arguments)}i(Yy,"only");Rn.only=Yy;function Zy(e){if(e.length===1)return e[0]}i(Zy,"_only")});var sl=p(rr=>{"use strict";Object.defineProperty(rr,"__esModule",{value:!0});rr.partition=void 0;var il=P();function La(){return(0,il.purry)(al(!1),arguments)}i(La,"partition");rr.partition=La;var al=i(function(e){return function(t,r){var n=[[],[]];return t.forEach(function(a,s){var o=e?r(a,s,t):r(a);n[o?0:1].push(a)}),n}},"_partition");(function(e){function t(){return(0,il.purry)(al(!0),arguments)}i(t,"indexed"),e.indexed=t})(La||(rr.partition=La={}))});var ol=p(jn=>{"use strict";Object.defineProperty(jn,"__esModule",{value:!0});jn.pathOr=void 0;var Qy=P();function Jy(){return(0,Qy.purry)(Xy,arguments)}i(Jy,"pathOr");jn.pathOr=Jy;function Xy(e,t,r){for(var n=e,a=0,s=t;a<s.length;a++){var o=s[a];if(n==null||n[o]==null)return r;n=n[o]}return n}i(Xy,"_pathOr")});var ul=p(zn=>{"use strict";Object.defineProperty(zn,"__esModule",{value:!0});zn.pick=void 0;var eg=P();function tg(){return(0,eg.purry)(rg,arguments)}i(tg,"pick");zn.pick=tg;function rg(e,t){return e==null?{}:t.reduce(function(r,n){return n in e&&(r[n]=e[n]),r},{})}i(rg,"_pick")});var ll=p(Nn=>{"use strict";Object.defineProperty(Nn,"__esModule",{value:!0});Nn.pickBy=void 0;var ng=P();function ig(){return(0,ng.purry)(ag,arguments)}i(ig,"pickBy");Nn.pickBy=ig;function ag(e,t){return e==null?{}:Object.keys(e).reduce(function(r,n){return t(e[n],n)&&(r[n]=e[n]),r},{})}i(ag,"_pickBy")});var cl=p(Hn=>{"use strict";Object.defineProperty(Hn,"__esModule",{value:!0});Hn.prop=void 0;var sg=i(function(e){return function(t){var r=e,n=t[r];return n}},"prop");Hn.prop=sg});var qa=p(Bn=>{"use strict";Object.defineProperty(Bn,"__esModule",{value:!0});Bn.range=void 0;var og=P();function ug(){return(0,og.purry)(lg,arguments)}i(ug,"range");Bn.range=ug;function lg(e,t){for(var r=[],n=e;n<t;n++)r.push(n);return r}i(lg,"_range")});var fl=p($n=>{"use strict";Object.defineProperty($n,"__esModule",{value:!0});$n.randomString=void 0;var cg=qa();function fg(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=i(function(){return t[Math.floor(Math.random()*t.length)]},"randomChar");return(0,cg.range)(0,e).reduce(function(n){return n+r()},"")}i(fg,"randomString");$n.randomString=fg});var dl=p(Wn=>{"use strict";Object.defineProperty(Wn,"__esModule",{value:!0});Wn.rankBy=void 0;var dg=De();function pg(){return(0,dg.purryOrderRulesWithArgument)(mg,arguments)}i(pg,"rankBy");Wn.rankBy=pg;function mg(e,t,r){for(var n=0,a=0,s=e;a<s.length;a++){var o=s[a];t(r,o)>0&&n++}return n}i(mg,"rankByImplementation")});var yl=p(nr=>{"use strict";Object.defineProperty(nr,"__esModule",{value:!0});nr.reduce=void 0;var pl=P();function ka(){return(0,pl.purry)(ml(!1),arguments)}i(ka,"reduce");nr.reduce=ka;var ml=i(function(e){return function(t,r,n){return t.reduce(function(a,s,o){return e?r(a,s,o,t):r(a,s)},n)}},"_reduce");(function(e){function t(){return(0,pl.purry)(ml(!0),arguments)}i(t,"indexed"),e.indexed=t})(ka||(nr.reduce=ka={}))});var bl=p(ir=>{"use strict";Object.defineProperty(ir,"__esModule",{value:!0});ir.reject=void 0;var hl=P(),yg=Y(),gg=ye();function et(){return(0,hl.purry)(vl(!1),arguments,et.lazy)}i(et,"reject");ir.reject=et;var vl=i(function(e){return function(t,r){return(0,yg._reduceLazy)(t,e?et.lazyIndexed(r):et.lazy(r),e)}},"_reject"),gl=i(function(e){return function(t){return function(r,n,a){var s=e?t(r,n,a):t(r);return s?{done:!1,hasNext:!1}:{done:!1,hasNext:!0,next:r}}}},"_lazy");(function(e){function t(){return(0,hl.purry)(vl(!0),arguments,e.lazyIndexed)}i(t,"indexed"),e.indexed=t,e.lazy=gl(!1),e.lazyIndexed=(0,gg._toLazyIndexed)(gl(!0))})(et||(ir.reject=et={}))});var _l=p(Un=>{"use strict";Object.defineProperty(Un,"__esModule",{value:!0});Un.reverse=void 0;var hg=P();function vg(){return(0,hg.purry)(bg,arguments)}i(vg,"reverse");Un.reverse=vg;function bg(e){return e.slice().reverse()}i(bg,"_reverse")});var Sl=p(Gn=>{"use strict";Object.defineProperty(Gn,"__esModule",{value:!0});Gn.round=void 0;var _g=Cr(),Sg=P();function Pg(){return(0,Sg.purry)((0,_g._withPrecision)(Math.round),arguments)}i(Pg,"round");Gn.round=Pg});var Pl=p(Vn=>{"use strict";Object.defineProperty(Vn,"__esModule",{value:!0});Vn.sample=void 0;var Og=P();function Mg(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(0,Og.purry)(Ig,e)}i(Mg,"sample");Vn.sample=Mg;function Ig(e,t){if(t<0)throw new RangeError("sampleSize must cannot be negative: ".concat(t));if(!Number.isInteger(t))throw new TypeError("sampleSize must be an integer: ".concat(t));if(t>=e.length)return e;if(t===0)return[];for(var r=Math.min(t,e.length-t),n=new Set;n.size<r;){var a=Math.floor(Math.random()*e.length);n.add(a)}return t===r?Array.from(n).sort(function(s,o){return s-o}).map(function(s){return e[s]}):e.filter(function(s,o){return!n.has(o)})}i(Ig,"sampleImplementation")});var Ol=p(tt=>{"use strict";var Kn=tt&&tt.__assign||function(){return Kn=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},Kn.apply(this,arguments)};Object.defineProperty(tt,"__esModule",{value:!0});tt.set=void 0;var wg=P();function Eg(){return(0,wg.purry)(Tg,arguments)}i(Eg,"set");tt.set=Eg;function Tg(e,t,r){var n;return Kn(Kn({},e),(n={},n[t]=r,n))}i(Tg,"_set")});var Ml=p(he=>{"use strict";var Yn=he&&he.__assign||function(){return Yn=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},Yn.apply(this,arguments)};Object.defineProperty(he,"__esModule",{value:!0});he._setPath=he.setPath=void 0;var Dg=P();function Fg(){return(0,Dg.purry)(Zn,arguments)}i(Fg,"setPath");he.setPath=Fg;function Zn(e,t,r){var n;return t.length===0?r:Array.isArray(e)?e.map(function(a,s){return s===t[0]?Zn(a,t.slice(1),r):a}):Yn(Yn({},e),(n={},n[t[0]]=Zn(e[t[0]],t.slice(1),r),n))}i(Zn,"_setPath");he._setPath=Zn});var Il=p(Qn=>{"use strict";Object.defineProperty(Qn,"__esModule",{value:!0});Qn.shuffle=void 0;var Cg=P();function Lg(){return(0,Cg.purry)(qg,arguments)}i(Lg,"shuffle");Qn.shuffle=Lg;function qg(e){for(var t=e.slice(),r=0;r<e.length;r+=1){var n=r+Math.floor(Math.random()*(e.length-r)),a=t[n];t[n]=t[r],t[r]=a}return t}i(qg,"_shuffle")});var wl=p(Jn=>{"use strict";Object.defineProperty(Jn,"__esModule",{value:!0});Jn.sliceString=void 0;var kg=i(function(e,t){return function(r){return r.slice(e,t)}},"sliceString");Jn.sliceString=kg});var El=p(Fe=>{"use strict";var Ag=Fe&&Fe.__spreadArray||function(e,t,r){if(r||arguments.length===2)for(var n=0,a=t.length,s;n<a;n++)(s||!(n in t))&&(s||(s=Array.prototype.slice.call(t,0,n)),s[n]=t[n]);return e.concat(s||Array.prototype.slice.call(t))};Object.defineProperty(Fe,"__esModule",{value:!0});Fe.sort=void 0;var xg=P();function Aa(){return(0,xg.purry)(Rg,arguments)}i(Aa,"sort");Fe.sort=Aa;function Rg(e,t){var r=Ag([],e,!0);return r.sort(t),r}i(Rg,"_sort");(function(e){e.strict=e})(Aa||(Fe.sort=Aa={}))});var Tl=p(Ce=>{"use strict";var jg=Ce&&Ce.__spreadArray||function(e,t,r){if(r||arguments.length===2)for(var n=0,a=t.length,s;n<a;n++)(s||!(n in t))&&(s||(s=Array.prototype.slice.call(t,0,n)),s[n]=t[n]);return e.concat(s||Array.prototype.slice.call(t))};Object.defineProperty(Ce,"__esModule",{value:!0});Ce.sortBy=void 0;var zg=De();function xa(){return(0,zg.purryOrderRules)(Ng,arguments)}i(xa,"sortBy");Ce.sortBy=xa;var Ng=i(function(e,t){return jg([],e,!0).sort(t)},"_sortBy");(function(e){e.strict=e})(xa||(Ce.sortBy=xa={}))});var rt=p(Xn=>{"use strict";Object.defineProperty(Xn,"__esModule",{value:!0});Xn._binarySearchCutoffIndex=void 0;function Hg(e,t){for(var r=0,n=e.length;r<n;){var a=r+n>>>1,s=e[a];t(s,a)?r=a+1:n=a}return n}i(Hg,"_binarySearchCutoffIndex");Xn._binarySearchCutoffIndex=Hg});var Dl=p(ei=>{"use strict";Object.defineProperty(ei,"__esModule",{value:!0});ei.sortedIndex=void 0;var Bg=P(),$g=rt();function Wg(){return(0,Bg.purry)(Ug,arguments)}i(Wg,"sortedIndex");ei.sortedIndex=Wg;var Ug=i(function(e,t){return(0,$g._binarySearchCutoffIndex)(e,function(r){return r<t})},"sortedIndexImplementation")});var Ll=p(ar=>{"use strict";Object.defineProperty(ar,"__esModule",{value:!0});ar.sortedIndexBy=void 0;var Fl=P(),Gg=rt();function Ra(){return(0,Fl.purry)(Cl,arguments)}i(Ra,"sortedIndexBy");ar.sortedIndexBy=Ra;(function(e){function t(){return(0,Fl.purry)(Cl,arguments)}i(t,"indexed"),e.indexed=t})(Ra||(ar.sortedIndexBy=Ra={}));function Cl(e,t,r){var n=r(t);return(0,Gg._binarySearchCutoffIndex)(e,function(a,s){return r(a,s)<n})}i(Cl,"sortedIndexByImplementation")});var Al=p(sr=>{"use strict";Object.defineProperty(sr,"__esModule",{value:!0});sr.sortedIndexWith=void 0;var ql=P(),kl=rt();function ja(){return(0,ql.purry)(kl._binarySearchCutoffIndex,arguments)}i(ja,"sortedIndexWith");sr.sortedIndexWith=ja;(function(e){function t(){return(0,ql.purry)(kl._binarySearchCutoffIndex,arguments)}i(t,"indexed"),e.indexed=t})(ja||(sr.sortedIndexWith=ja={}))});var xl=p(ti=>{"use strict";Object.defineProperty(ti,"__esModule",{value:!0});ti.sortedLastIndex=void 0;var Vg=P(),Kg=rt();function Yg(){return(0,Vg.purry)(Zg,arguments)}i(Yg,"sortedLastIndex");ti.sortedLastIndex=Yg;var Zg=i(function(e,t){return(0,Kg._binarySearchCutoffIndex)(e,function(r){return r<=t})},"sortedLastIndexImplementation")});var zl=p(or=>{"use strict";Object.defineProperty(or,"__esModule",{value:!0});or.sortedLastIndexBy=void 0;var Rl=P(),Qg=rt();function za(){return(0,Rl.purry)(jl,arguments)}i(za,"sortedLastIndexBy");or.sortedLastIndexBy=za;(function(e){function t(){return(0,Rl.purry)(jl,arguments)}i(t,"indexed"),e.indexed=t})(za||(or.sortedLastIndexBy=za={}));function jl(e,t,r){var n=r(t);return(0,Qg._binarySearchCutoffIndex)(e,function(a,s){return r(a,s)<=n})}i(jl,"sortedLastIndexByImplementation")});var Hl=p(nt=>{"use strict";var Nl=nt&&nt.__spreadArray||function(e,t,r){if(r||arguments.length===2)for(var n=0,a=t.length,s;n<a;n++)(s||!(n in t))&&(s||(s=Array.prototype.slice.call(t,0,n)),s[n]=t[n]);return e.concat(s||Array.prototype.slice.call(t))};Object.defineProperty(nt,"__esModule",{value:!0});nt.splice=void 0;var Jg=P();function Xg(){return(0,Jg.purry)(eh,arguments)}i(Xg,"splice");nt.splice=Xg;function eh(e,t,r,n){var a=Nl([],e,!0);return a.splice.apply(a,Nl([t,r],n,!1)),a}i(eh,"_splice")});var Na=p(it=>{"use strict";var th=it&&it.__spreadArray||function(e,t,r){if(r||arguments.length===2)for(var n=0,a=t.length,s;n<a;n++)(s||!(n in t))&&(s||(s=Array.prototype.slice.call(t,0,n)),s[n]=t[n]);return e.concat(s||Array.prototype.slice.call(t))};Object.defineProperty(it,"__esModule",{value:!0});it.splitAt=void 0;var rh=P();function nh(){return(0,rh.purry)(ih,arguments)}i(nh,"splitAt");it.splitAt=nh;function ih(e,t){var r=th([],e,!0),n=r.splice(t);return[r,n]}i(ih,"_splitAt")});var Bl=p(ri=>{"use strict";Object.defineProperty(ri,"__esModule",{value:!0});ri.splitWhen=void 0;var ah=Na(),sh=P();function oh(){return(0,sh.purry)(uh,arguments)}i(oh,"splitWhen");ri.splitWhen=oh;function uh(e,t){for(var r=0;r<e.length;r++)if(t(e[r]))return(0,ah.splitAt)(e,r);return[e,[]]}i(uh,"_splitWhen")});var Wl=p(at=>{"use strict";var lh=at&&at.__spreadArray||function(e,t,r){if(r||arguments.length===2)for(var n=0,a=t.length,s;n<a;n++)(s||!(n in t))&&(s||(s=Array.prototype.slice.call(t,0,n)),s[n]=t[n]);return e.concat(s||Array.prototype.slice.call(t))};Object.defineProperty(at,"__esModule",{value:!0});at.stringToPath=void 0;function ch(e){return $l(e)}i(ch,"stringToPath");at.stringToPath=ch;function $l(e){var t;if(e.length===0)return[];var r=(t=e.match(/^\[(.+?)\](.*)$/))!==null&&t!==void 0?t:e.match(/^\.?([^.[\]]+)(.*)$/);if(r){var n=r[1],a=r[2];return lh([n],$l(a),!0)}return[e]}i($l,"_stringToPath")});var Ul=p(ni=>{"use strict";Object.defineProperty(ni,"__esModule",{value:!0});ni.subtract=void 0;var fh=P();function dh(){return(0,fh.purry)(ph,arguments)}i(dh,"subtract");ni.subtract=dh;function ph(e,t){return e-t}i(ph,"_subtract")});var Kl=p(ur=>{"use strict";Object.defineProperty(ur,"__esModule",{value:!0});ur.sumBy=void 0;var Gl=P(),Vl=i(function(e){return function(t,r){var n=0;return t.forEach(function(a,s){var o=e?r(a,s,t):r(a);n+=o}),n}},"_sumBy");function Ha(){return(0,Gl.purry)(Vl(!1),arguments)}i(Ha,"sumBy");ur.sumBy=Ha;(function(e){function t(){return(0,Gl.purry)(Vl(!0),arguments)}i(t,"indexed"),e.indexed=t})(Ha||(ur.sumBy=Ha={}))});var Zl=p(ii=>{"use strict";Object.defineProperty(ii,"__esModule",{value:!0});ii.swapIndices=void 0;var mh=P();function yh(){return(0,mh.purry)(gh,arguments)}i(yh,"swapIndices");ii.swapIndices=yh;function gh(e,t,r){return typeof e=="string"?hh(e,t,r):Yl(e,t,r)}i(gh,"_swapIndices");function Yl(e,t,r){var n=e.slice();if(isNaN(t)||isNaN(r))return n;var a=t<0?e.length+t:t,s=r<0?e.length+r:r;return a<0||a>e.length||s<0||s>e.length||(n[a]=e[s],n[s]=e[a]),n}i(Yl,"_swapArray");function hh(e,t,r){var n=Yl(e.split(""),t,r);return n.join("")}i(hh,"_swapString")});var Ql=p(st=>{"use strict";var ai=st&&st.__assign||function(){return ai=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},ai.apply(this,arguments)};Object.defineProperty(st,"__esModule",{value:!0});st.swapProps=void 0;var vh=P();function bh(){return(0,vh.purry)(_h,arguments)}i(bh,"swapProps");st.swapProps=bh;function _h(e,t,r){var n,a=e,s=t,o=a[s],l=r,f=a[l];return ai(ai({},e),(n={},n[t]=f,n[r]=o,n))}i(_h,"_swapProps")});var Jl=p(cr=>{"use strict";Object.defineProperty(cr,"__esModule",{value:!0});cr.take=void 0;var Sh=P(),Ph=Y();function lr(){return(0,Sh.purry)(Oh,arguments,lr.lazy)}i(lr,"take");cr.take=lr;function Oh(e,t){return(0,Ph._reduceLazy)(e,lr.lazy(t))}i(Oh,"_take");(function(e){function t(r){return function(n){return r===0?{done:!0,hasNext:!1}:(r--,r===0?{done:!0,hasNext:!0,next:n}:{done:!1,hasNext:!0,next:n})}}i(t,"lazy"),e.lazy=t})(lr||(cr.take=lr={}))});var ec=p(ot=>{"use strict";var Mh=ot&&ot.__spreadArray||function(e,t,r){if(r||arguments.length===2)for(var n=0,a=t.length,s;n<a;n++)(s||!(n in t))&&(s||(s=Array.prototype.slice.call(t,0,n)),s[n]=t[n]);return e.concat(s||Array.prototype.slice.call(t))};Object.defineProperty(ot,"__esModule",{value:!0});ot.takeFirstBy=void 0;var Xl=aa(),Ih=De();function wh(){return(0,Ih.purryOrderRulesWithArgument)(Eh,arguments)}i(wh,"takeFirstBy");ot.takeFirstBy=wh;function Eh(e,t,r){if(r<=0)return[];if(r>=e.length)return Mh([],e,!0);var n=e.slice(0,r);(0,Xl.heapify)(n,t);for(var a=e.slice(r),s=0,o=a;s<o.length;s++){var l=o[s];(0,Xl.heapMaybeInsert)(n,t,l)}return n}i(Eh,"takeFirstByImplementation")});var tc=p(si=>{"use strict";Object.defineProperty(si,"__esModule",{value:!0});si.takeLastWhile=void 0;var Th=P();function Dh(){return(0,Th.purry)(Fh,arguments)}i(Dh,"takeLastWhile");si.takeLastWhile=Dh;function Fh(e,t){for(var r=e.length-1;r>=0;r--)if(!t(e[r]))return e.slice(r+1);return e.slice()}i(Fh,"_takeLastWhile")});var rc=p(oi=>{"use strict";Object.defineProperty(oi,"__esModule",{value:!0});oi.takeWhile=void 0;var Ch=P();function Lh(){return(0,Ch.purry)(qh,arguments)}i(Lh,"takeWhile");oi.takeWhile=Lh;function qh(e,t){for(var r=[],n=0,a=e;n<a.length;n++){var s=a[n];if(!t(s))break;r.push(s)}return r}i(qh,"_takeWhile")});var nc=p(li=>{"use strict";Object.defineProperty(li,"__esModule",{value:!0});li.tap=void 0;var kh=P();function Ah(){return(0,kh.purry)(xh,arguments)}i(Ah,"tap");li.tap=Ah;function xh(e,t){return t(e),e}i(xh,"_tap")});var ic=p(ci=>{"use strict";Object.defineProperty(ci,"__esModule",{value:!0});ci.times=void 0;var Rh=P();function jh(){return(0,Rh.purry)(zh,arguments)}i(jh,"times");ci.times=jh;function zh(e,t){if(e<0)throw new RangeError("n must be a non-negative number");for(var r=[],n=0;n<e;n++)r.push(t(n));return r}i(zh,"_times")});var ac=p(dr=>{"use strict";Object.defineProperty(dr,"__esModule",{value:!0});dr.uniq=void 0;var Nh=P(),Hh=Y();function fr(){return(0,Nh.purry)(Bh,arguments,fr.lazy)}i(fr,"uniq");dr.uniq=fr;function Bh(e){return(0,Hh._reduceLazy)(e,fr.lazy())}i(Bh,"_uniq");(function(e){function t(){var r=new Set;return function(n){return r.has(n)?{done:!1,hasNext:!1}:(r.add(n),{done:!1,hasNext:!0,next:n})}}i(t,"lazy"),e.lazy=t})(fr||(dr.uniq=fr={}))});var oc=p(fi=>{"use strict";Object.defineProperty(fi,"__esModule",{value:!0});fi.uniqBy=void 0;var $h=P(),Wh=Y();function Uh(){return(0,$h.purry)(Gh,arguments,sc)}i(Uh,"uniqBy");fi.uniqBy=Uh;function Gh(e,t){return(0,Wh._reduceLazy)(e,sc(t))}i(Gh,"_uniqBy");function sc(e){var t=new Set;return function(r){var n=e(r);return t.has(n)?{done:!1,hasNext:!1}:(t.add(n),{done:!1,hasNext:!0,next:r})}}i(sc,"lazyUniqBy")});var uc=p(mr=>{"use strict";Object.defineProperty(mr,"__esModule",{value:!0});mr.uniqWith=void 0;var Vh=P(),Kh=Y(),Yh=ye();function pr(){return(0,Vh.purry)(Zh,arguments,pr.lazy)}i(pr,"uniqWith");mr.uniqWith=pr;function Zh(e,t){var r=pr.lazy(t);return(0,Kh._reduceLazy)(e,r,!0)}i(Zh,"_uniqWith");function Qh(e){return function(t,r,n){return n&&n.findIndex(function(a){return e(t,a)})===r?{done:!1,hasNext:!0,next:t}:{done:!1,hasNext:!1}}}i(Qh,"_lazy");(function(e){e.lazy=(0,Yh._toLazyIndexed)(Qh)})(pr||(mr.uniqWith=pr={}))});var lc=p(di=>{"use strict";Object.defineProperty(di,"__esModule",{value:!0});di.values=void 0;function Jh(e){return Object.values(e)}i(Jh,"values");di.values=Jh});var cc=p(yr=>{"use strict";Object.defineProperty(yr,"__esModule",{value:!0});yr.zip=void 0;var Xh=P();function Ba(){return(0,Xh.purry)(ev,arguments)}i(Ba,"zip");yr.zip=Ba;function ev(e,t){for(var r=e.length>t.length?t.length:e.length,n=[],a=0;a<r;a++)n.push([e[a],t[a]]);return n}i(ev,"_zip");(function(e){e.strict=e})(Ba||(yr.zip=Ba={}))});var fc=p(pi=>{"use strict";Object.defineProperty(pi,"__esModule",{value:!0});pi.zipObj=void 0;var tv=P();function rv(){return(0,tv.purry)(nv,arguments)}i(rv,"zipObj");pi.zipObj=rv;function nv(e,t){for(var r=e.length>t.length?t.length:e.length,n={},a=0;a<r;a++)n[e[a]]=t[a];return n}i(nv,"_zipObj")});var dc=p(mi=>{"use strict";Object.defineProperty(mi,"__esModule",{value:!0});mi.zipWith=void 0;function iv(){var e=Array.from(arguments);if(typeof e[0]=="function"&&e.length===1)return function(t,r){return $a(t,r,e[0])};if(typeof e[0]=="function"&&e.length===2)return function(t){return $a(t,e[1],e[0])};if(e.length===3)return $a(e[0],e[1],e[2])}i(iv,"zipWith");mi.zipWith=iv;function $a(e,t,r){for(var n=e.length>t.length?t.length:e.length,a=[],s=0;s<n;s++)a.push(r(e[s],t[s]));return a}i($a,"_zipWith")});var ut=p(y=>{"use strict";var av=y&&y.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),g=y&&y.__exportStar||function(e,t){for(var r in e)r!=="default"&&!Object.prototype.hasOwnProperty.call(t,r)&&av(t,e,r)};Object.defineProperty(y,"__esModule",{value:!0});g(Es(),y);g(Ts(),y);g(Ds(),y);g(Fs(),y);g(Ls(),y);g(qs(),y);g(ks(),y);g(xs(),y);g(Rs(),y);g(js(),y);g(Hs(),y);g(Ws(),y);g(Gs(),y);g(Vs(),y);g(Ks(),y);g(Ys(),y);g(Zs(),y);g(Qs(),y);g(io(),y);g(ao(),y);g(so(),y);g(oo(),y);g(co(),y);g(po(),y);g(ho(),y);g(Po(),y);g(Eo(),y);g(Fo(),y);g(qo(),y);g(ko(),y);g(Ao(),y);g(xo(),y);g(zo(),y);g(ya(),y);g(No(),y);g(Ho(),y);g(Uo(),y);g(Ko(),y);g(ba(),y);g(Qo(),y);g(ma(),y);g(Jo(),y);g(eu(),y);g(tu(),y);g(ru(),y);g(nu(),y);g(Oa(),y);g(iu(),y);g(au(),y);g(su(),y);g(ou(),y);g(uu(),y);g(lu(),y);g(cu(),y);g(fu(),y);g(du(),y);g(pu(),y);g(Ia(),y);g(mu(),y);g(yu(),y);g(gu(),y);g(wa(),y);g(hu(),y);g(ea(),y);g(vu(),y);g(bu(),y);g(_u(),y);g(Su(),y);g(Iu(),y);g(Eu(),y);g(Fu(),y);g(Lu(),y);g(Au(),y);g(ju(),y);g(zu(),y);g(Nu(),y);g($u(),y);g(Gu(),y);g(Vu(),y);g(Ku(),y);g(Ju(),y);g(Xu(),y);g(el(),y);g(tl(),y);g(rl(),y);g(nl(),y);g(sl(),y);g(ol(),y);g(ul(),y);g(ll(),y);g(na(),y);g(cl(),y);g(P(),y);g(fl(),y);g(qa(),y);g(dl(),y);g(yl(),y);g(bl(),y);g(_l(),y);g(Sl(),y);g(Pl(),y);g(Ol(),y);g(Ml(),y);g(Il(),y);g(wl(),y);g(El(),y);g(Tl(),y);g(Dl(),y);g(Ll(),y);g(Al(),y);g(xl(),y);g(zl(),y);g(Hl(),y);g(Na(),y);g(Bl(),y);g(Wl(),y);g(Ul(),y);g(Kl(),y);g(Zl(),y);g(Ql(),y);g(Jl(),y);g(ec(),y);g(tc(),y);g(rc(),y);g(nc(),y);g(ic(),y);g(la(),y);g(Xi(),y);g(ac(),y);g(oc(),y);g(uc(),y);g(lc(),y);g(cc(),y);g(fc(),y);g(dc(),y)});var mc=p(oe=>{"use strict";Object.defineProperty(oe,"__esModule",{value:!0});oe.isPlayedActor=oe.isOwner=oe.getOwner=oe.getHighestName=void 0;function sv(e){return!!e?.id&&!e.pack&&game.actors.has(e.id)}i(sv,"isPlayedActor");oe.isPlayedActor=sv;function ov(e){return e.token?.name??e.prototypeToken?.name??e.name}i(ov,"getHighestName");oe.getHighestName=ov;function pc(e){let t=i(n=>n.active&&!n.isGM,"isValidUser"),r=game.users.filter(n=>t(n)&&n.character===e);return r.length||(r=game.users.filter(n=>t(n)&&e.testUserPermission(n,"OWNER"))),r.sort((n,a)=>n.id>a.id?1:-1),r[0]||null}i(pc,"getOwner");oe.getOwner=pc;function uv(e){return pc(e)===game.user}i(uv,"isOwner");oe.isOwner=uv});var yc=p(ue=>{"use strict";Object.defineProperty(ue,"__esModule",{value:!0});ue.renderApplication=ue.canRender=ue.refreshApplication=ue.openApplication=void 0;function lv(e,...t){let r=t.at(-1).id,n=Object.values(ui.windows).find(a=>a instanceof e&&a.id===r);return n?(n.bringToTop(),n):new e(...t).render(!0)}i(lv,"openApplication");ue.openApplication=lv;function cv(e){e.setPosition({height:"auto"})}i(cv,"refreshApplication");ue.refreshApplication=cv;function fv(e,t){return t||e._state<=Application.RENDER_STATES.NONE}i(fv,"canRender");ue.canRender=fv;function dv(e){Object.values(ui.windows).find(r=>r.id===e)?.render()}i(dv,"renderApplication");ue.renderApplication=dv});var hc=p(te=>{"use strict";var pv=te&&te.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),mv=te&&te.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),yv=te&&te.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&pv(t,e,r);return mv(t,e),t};Object.defineProperty(te,"__esModule",{value:!0});te.getOnly=te.compareArrays=te.arrayIncludesOne=void 0;var gc=yv(ut());function gv(e,t){return t.some(r=>e.includes(r))}i(gv,"arrayIncludesOne");te.arrayIncludesOne=gv;function hv(e,t,r=!1){if(e=r?gc.compact(e):e,t=r?gc.compact(t):t.slice(),e.length!==t.length)return!1;for(let n of e){let a=t.findIndex(s=>n===s);if(a===-1)return!1;t.splice(a,1)}return!0}i(hv,"compareArrays");te.compareArrays=hv;function vv(e,t){if(!e)return;let r=Array.isArray(e);if(r&&e.length!==1||!r&&e.size!==1)return;let n=r?e[0]:e.first();if(n)return(!t||t(n))&&n||void 0}i(vv,"getOnly");te.getOnly=vv});var vc=p(yi=>{"use strict";Object.defineProperty(yi,"__esModule",{value:!0});yi.getDropTarget=void 0;function bv(e,t,r){return[...e.tokens.placeables].sort((n,a)=>a.document.sort-n.document.sort).find(n=>{if(r&&!r(n))return!1;let a=n.x+(n.hitArea?.right??0),s=n.y+(n.hitArea?.bottom??0);return t.x>=n.x&&t.y>=n.y&&t.x<=a&&t.y<=s})}i(bv,"getDropTarget");yi.getDropTarget=bv});var _c=p(ve=>{"use strict";Object.defineProperty(ve,"__esModule",{value:!0});ve.latestChatMessages=ve.refreshLatestMessages=ve.createChatLink=void 0;function _v(e,{label:t,html:r}={}){let n=e instanceof foundry.abstract.Document;!t&&n&&(t=e.name);let a=`@UUID[${n?e.uuid:e}]`;return t&&(a=`${a}{${t}}`),r?TextEditor.enrichHTML(a):a}i(_v,"createChatLink");ve.createChatLink=_v;function*bc(e,t){let r=ui.chat?.element;if(!r)return;let n=game.messages.contents,a=(t?n.findLastIndex(s=>s===t):n.length)-1;for(let s=a;s>=a-e;s--){let o=n[s];if(!o)return;let l=r.find(`[data-message-id=${o.id}]`);l.length&&(yield{message:o,li:l})}}i(bc,"latestChatMessages");ve.latestChatMessages=bc;async function Sv(e){for(let{message:t,li:r}of bc(20)){let n=await t.getHTML();r.replaceWith(n)}}i(Sv,"refreshLatestMessages");ve.refreshLatestMessages=Sv});var Sc=p(gi=>{"use strict";Object.defineProperty(gi,"__esModule",{value:!0});gi.createTimeout=void 0;function Pv(e,t=1){let r=null,n=i(()=>{r!==null&&(clearTimeout(r),r=null)},"cancel"),a=i((...s)=>{r!==null&&n(),t<1?e(...s):r=setTimeout(e,t,...s)},"fn");return Object.defineProperty(a,"start",{value:(s,...o)=>{r!==null&&n(),s<1?e(...o):r=setTimeout(e,s,...o)},enumerable:!1,configurable:!1}),Object.defineProperty(a,"cancel",{value:n,enumerable:!1,configurable:!1}),a}i(Pv,"createTimeout");gi.createTimeout=Pv});var Pc=p(hi=>{"use strict";Object.defineProperty(hi,"__esModule",{value:!0});hi.waitDialog=void 0;var Ov=ae();async function Mv(e){let t=e.yes.icon??"fa-solid fa-check",r=e.no.icon??"fa-solid fa-xmark",n={yes:{icon:`<i class='${t}'></i>`,label:e.yes.label,callback:e.yes.callback},no:{icon:`<i class='${r}'></i>`,label:e.no.label,callback:e.no.callback??(()=>null)}},a=await(0,Ov.render)(e.template,e.data);return Dialog.wait({title:e.title,content:a,buttons:n,default:e.default??"yes",close:()=>null},{id:e.id})}i(Mv,"waitDialog");hi.waitDialog=Mv});var Oc=p(be=>{"use strict";Object.defineProperty(be,"__esModule",{value:!0});be.getSortBounds=be.getSourceIdCondition=be.getSourceId=void 0;function Wa(e){return e.getFlag("core","sourceId")}i(Wa,"getSourceId");be.getSourceId=Wa;function Iv(e,t){let r=Wa(e);return r?t.includes(r):!1}i(Iv,"includesSourceId");function wv(e){return Array.isArray(e)?t=>Iv(t,e):t=>Wa(t)===e}i(wv,"getSourceIdCondition");be.getSourceIdCondition=wv;function Ev(e){let t=0,r=0;for(let n of e)n.sort>r?r=n.sort:n.sort<t&&(t=n.sort);return{min:t,max:r}}i(Ev,"getSortBounds");be.getSortBounds=Ev});var Mc=p(vi=>{"use strict";Object.defineProperty(vi,"__esModule",{value:!0});vi.withEventManager=void 0;function Tv(e){let t=1,r={};return class extends e{registerListener(n,a,s){r[n]??=[];let o=t++;return r[n].push({id:o,listener:a,once:typeof s=="boolean"?s:s?.once??!1,context:typeof s=="object"?s.context:void 0}),o}removeListener(n,a){let s=typeof a=="number"?l=>l.id===a:l=>l.listener===a,o=r[n]?.findIndex(s)??-1;return o===-1?!1:(r[n].splice(o,1),!0)}emitEvent(n,...a){let s=r[n];if(s)for(let{listener:o,once:l,context:f,id:c}of s)f?o.apply(f,a):o(...a),l&&this.removeListener(n,c)}purgeListeners(){r={}}}}i(Tv,"withEventManager");vi.withEventManager=Tv});var wc=p(x=>{"use strict";var Dv=x&&x.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),Fv=x&&x.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),Cv=x&&x.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&Dv(t,e,r);return Fv(t,e),t};Object.defineProperty(x,"__esModule",{value:!0});x.updateSourceFlag=x.updateFlag=x.unsetMofuleFlag=x.unsetFlag=x.setFlagProperty=x.setFlag=x.hasModuleFlag=x.getFlagProperty=x.getModuleFlag=x.getFlag=x.flagPath=void 0;var Lv=Cv(ut()),lt=ae();function qv(e,...t){return e.getFlag(lt.MODULE.id,t.join("."))}i(qv,"getFlag");x.getFlag=qv;function kv(e,...t){let r=t.pop();return e.setFlag(lt.MODULE.id,t.join("."),r)}i(kv,"setFlag");x.setFlag=kv;function Av(e,...t){return e.unsetFlag(lt.MODULE.id,t.join("."))}i(Av,"unsetFlag");x.unsetFlag=Av;function gr(...e){return`flags.${lt.MODULE.path(e)}`}i(gr,"flagPath");x.flagPath=gr;function xv(e,t){let r=Lv.mapKeys(t,n=>gr(n));return e.update(r)}i(xv,"updateFlag");x.updateFlag=xv;function Rv(e,...t){let r=t.pop();return e.updateSource({[gr(...t)]:r})}i(Rv,"updateSourceFlag");x.updateSourceFlag=Rv;function jv(e,...t){return getProperty(e,gr(...t))}i(jv,"getFlagProperty");x.getFlagProperty=jv;function zv(e,...t){let r=t.pop();return setProperty(e,gr(...t),r),e}i(zv,"setFlagProperty");x.setFlagProperty=zv;function Ic(e){return getProperty(e,`flags.${lt.MODULE.id}`)}i(Ic,"getModuleFlag");x.getModuleFlag=Ic;function Nv(e){return Ic(e)!==void 0}i(Nv,"hasModuleFlag");x.hasModuleFlag=Nv;function Hv(e){return e.update({[`flags.-=${lt.MODULE.id}`]:!0})}i(Hv,"unsetMofuleFlag");x.unsetMofuleFlag=Hv});var Dc=p(ct=>{"use strict";Object.defineProperty(ct,"__esModule",{value:!0});ct.render=ct.templatePath=void 0;var Ec=ae();function Tc(...e){return`modules/${Ec.MODULE.id}/templates/${(0,Ec.joinStr)("/",e)}.hbs`}i(Tc,"templatePath");ct.templatePath=Tc;function Bv(...e){let t=typeof e.at(-1)=="object"?e.pop():{},r=Tc(...e);return renderTemplate(r,t)}i(Bv,"render");ct.render=Bv});var Fc=p(ft=>{"use strict";Object.defineProperty(ft,"__esModule",{value:!0});ft.registerUpstreamHook=ft.createHook=void 0;function $v(e,t){let r=Hooks.on(e,t),n=Hooks.events[e].findIndex(a=>a.id===r);if(n!==0){let[a]=Hooks.events[e].splice(n,1);Hooks.events[e].unshift(a)}return r}i($v,"registerUpstreamHook");ft.registerUpstreamHook=$v;function Wv(e,t){let r=null;return{activate(){r===null&&(r=Hooks.on(e,t))},disable(){r!==null&&(Hooks.off(e,r),r=null)},toggle(n){n?this.activate():this.disable()}}}i(Wv,"createHook");ft.createHook=Wv});var qc=p(k=>{"use strict";Object.defineProperty(k,"__esModule",{value:!0});k.queryInParent=k.queryInClosest=k.querySelectorArray=k.querySelector=k.prependHTMLFromString=k.parentElement=k.isCheckboxElement=k.htmlElement=k.elementData=k.dataToDatasetString=k.createHTMLFromString=k.closest=k.beforeHTMLFromString=k.appendHTMLFromString=k.afterHTMLFromString=k.addListenerAll=k.addListener=void 0;function Uv(e){return e instanceof HTMLElement?e:e[0]}i(Uv,"htmlElement");k.htmlElement=Uv;function Gv(e){return e instanceof HTMLInputElement&&e.type==="checkbox"}i(Gv,"isCheckboxElement");k.isCheckboxElement=Gv;function bi(e,t=!0){let r=document.createElement("div");r.innerHTML=e;let n=r.children;return n.length===1?n[0]:t?r:n}i(bi,"createHTMLFromString");k.createHTMLFromString=bi;function Ua(e,t,r){let n=r?e.bind(r):e;t instanceof HTMLCollection?n(...t):n(t)}i(Ua,"applyHtmlMethod");function Cc(e,t,r=!1){if(!e)return;let n=bi(t,!1);return Ua(r?e.prepend:e.append,n,e),n}i(Cc,"insertHTMLFromString");function Vv(e,t){return Cc(e,t,!1)}i(Vv,"appendHTMLFromString");k.appendHTMLFromString=Vv;function Kv(e,t){return Cc(e,t,!0)}i(Kv,"prependHTMLFromString");k.prependHTMLFromString=Kv;function Yv(e,t){if(!e)return;let r=bi(t,!1);return Ua(e.before,r,e),r}i(Yv,"beforeHTMLFromString");k.beforeHTMLFromString=Yv;function Zv(e,t){if(!e)return;let r=bi(t,!1);return Ua(e.after,r,e),r}i(Zv,"afterHTMLFromString");k.afterHTMLFromString=Zv;function Qv(e,t,r,n,a){let s=e.querySelector(t);if(!s)return;let o=typeof r=="string"?r:"click",l=typeof r=="function"?r:n,f=typeof n=="boolean"?n:a;return s.addEventListener(o,c=>l(c,s),f),s}i(Qv,"addListener");k.addListener=Qv;function Jv(e,t,r,n){let a=e.querySelectorAll(t),s=typeof r=="string"?r:"click",o=typeof r=="function"?r:n;for(let l of a)l.addEventListener(s,f=>o(f,l));return a}i(Jv,"addListenerAll");k.addListenerAll=Jv;function Ga(e,t){return e?e.querySelector(t):null}i(Ga,"querySelector");k.querySelector=Ga;function Xv(e,t){return e?Array.from(e.querySelectorAll(t)):[]}i(Xv,"querySelectorArray");k.querySelectorArray=Xv;function eb(e,t,r){let n=Lc(e,t);return Ga(n,r)}i(eb,"queryInClosest");k.queryInClosest=eb;function tb(e,t){return Ga(e.parentElement,t)}i(tb,"queryInParent");k.queryInParent=tb;function Lc(e,t){return e?e.closest(t):null}i(Lc,"closest");k.closest=Lc;function rb(e){return e.parentElement}i(rb,"parentElement");k.parentElement=rb;function nb(e){return e.dataset}i(nb,"elementData");k.elementData=nb;function ib(e){return Object.entries(e).map(([t,r])=>{let n=typeof r=="object"?JSON.stringify(r):r;return`data-${t}='${n}'`}).join(" ")}i(ib,"dataToDatasetString");k.dataToDatasetString=ib});var Ac=p(_e=>{"use strict";Object.defineProperty(_e,"__esModule",{value:!0});_e.getItems=_e.hasItemWithSourceId=_e.getItemWithSourceId=void 0;var kc=ae();function Va(e,t=[]){let r=typeof t=="string"?[t]:t;return r.length?r.flatMap(n=>e.itemTypes[n]):e.items}i(Va,"getItems");_e.getItems=Va;function ab(e,t,r){return Va(e,r).some((0,kc.getSourceIdCondition)(t))}i(ab,"hasItemWithSourceId");_e.hasItemWithSourceId=ab;function sb(e,t,r){return Va(e,r).find((0,kc.getSourceIdCondition)(t))}i(sb,"getItemWithSourceId");_e.getItemWithSourceId=sb});var Qa=p(Z=>{"use strict";Object.defineProperty(Z,"__esModule",{value:!0});Z.subLocalize=Z.templateLocalize=Z.localizePath=Z.hasLocalization=Z.localizeIfExist=Z.localize=Z.localeCompare=void 0;var de=ae();function Ka(...e){e.unshift(de.MODULE.id);let t=typeof e.at(-1)=="object"?e.pop():void 0,r=(0,de.joinStr)(".",e);return typeof t=="object"?game.i18n.format(r,t):game.i18n.localize(r)}i(Ka,"localize");Z.localize=Ka;function xc(...e){e.unshift(de.MODULE.id);let t=typeof e.at(-1)=="object"?e.pop():void 0,r=(0,de.joinStr)(".",e);if(game.i18n.has(r,!1))return typeof t=="object"?game.i18n.format(r,t):game.i18n.localize(r)}i(xc,"localizeIfExist");Z.localizeIfExist=xc;function Rc(...e){return game.i18n.has(`${de.MODULE.path(e)}`,!1)}i(Rc,"hasLocalization");Z.hasLocalization=Rc;function Ya(...e){return de.MODULE.path(e)}i(Ya,"localizePath");Z.localizePath=Ya;function jc(e){let t=i((r,{hash:n})=>Ka(e,r,n),"fn");return Object.defineProperties(t,{path:{value:r=>Ya(e,r),enumerable:!1,configurable:!1},sub:{value:r=>{let n=e?`${e}.${r}`:r;return Za(n).i18n},enumerable:!1,configurable:!1}}),t}i(jc,"templateLocalize");Z.templateLocalize=jc;function Za(e){let t=i((...r)=>Ka(e,...r),"fn");return Object.defineProperties(t,{ifExist:{value:(...r)=>xc(e,...r),enumerable:!1,configurable:!1},warn:{value:(r,n,a)=>(0,de.warn)(`${e}.${r}`,n,a),enumerable:!1,configurable:!1},info:{value:(r,n,a)=>(0,de.info)(`${e}.${r}`,n,a),enumerable:!1,configurable:!1},error:{value:(r,n,a)=>(0,de.error)(`${e}.${r}`,n,a),enumerable:!1,configurable:!1},has:{value:r=>Rc(e,r),enumerable:!1,configurable:!1},path:{value:r=>Ya(e,r),enumerable:!1,configurable:!1},sub:{value:r=>Za(`${e}.${r}`),enumerable:!1,configurable:!1},i18n:{get(){return jc(e)},enumerable:!1,configurable:!1}}),t}i(Za,"subLocalize");Z.subLocalize=Za;function ob(e,t){return e.localeCompare(t,game.i18n.lang)}i(ob,"localeCompare");Z.localeCompare=ob});var vr=p(dt=>{"use strict";Object.defineProperty(dt,"__esModule",{value:!0});dt.getActiveModule=dt.MODULE=void 0;var ub=ae(),hr="",zc="",lb={get id(){if(!hr)throw new Error("Module needs to be registered.");return hr},get name(){if(!hr)throw new Error("Module needs to be registered.");return zc},get current(){return game.modules.get(this.id)},throwError(e){throw new Error(`
[${this.name}] ${e}`)},error(e,t){let r=`[${this.name}] ${e}`;t instanceof Error?r+=`
${t.message}`:typeof t=="string"&&(r+=`
${t}`),console.error(r)},log(e){console.log(`[${this.name}] ${e}`)},path(...e){return`${this.id}.${(0,ub.joinStr)(".",...e)}`},register(e,t){if(hr)throw new Error("Module was already registered.");hr=e,zc=t}};dt.MODULE=lb;function cb(e){let t=game.modules.get(e);return t?.active?t:void 0}i(cb,"getActiveModule");dt.getActiveModule=cb});var Hc=p(_i=>{"use strict";Object.defineProperty(_i,"__esModule",{value:!0});_i.registerKeybind=void 0;var Nc=Qa(),fb=vr();function db(e,t){game.keybindings.register(fb.MODULE.id,e,{...t,name:(0,Nc.localizePath)("keybindings",e,"name"),hint:(0,Nc.localizePath)("keybindings",e,"hint")})}i(db,"registerKeybind");_i.registerKeybind=db});var Uc=p(Se=>{"use strict";Object.defineProperty(Se,"__esModule",{value:!0});Se.unregisterWrapper=Se.registerWrapper=Se.createWrapper=void 0;var Bc=ae();function $c(e,t,r){let n=[],a=Array.isArray(e)?e:[e];for(let s of a){let o=libWrapper.register(Bc.MODULE.id,s,t,r);n.push(o)}return n.length===1?n[0]:n}i($c,"registerWrapper");Se.registerWrapper=$c;function Wc(e){libWrapper.unregister(Bc.MODULE.id,e)}i(Wc,"unregisterWrapper");Se.unregisterWrapper=Wc;function pb(e,t,r,n){let a=null;return{activate(){a===null&&(a=$c(e,t,r??"WRAPPER"),n?.onActivate?.())},disable(){a!==null&&(Wc(a),a=null,n?.onDisable?.())},toggle(s){s?this.activate():this.disable()}}}i(pb,"createWrapper");Se.createWrapper=pb});var Gc=p(Pe=>{"use strict";Object.defineProperty(Pe,"__esModule",{value:!0});Pe.warn=Pe.info=Pe.error=void 0;var mb=ae();function Ja(e,t,r,n){let a=typeof t=="string"?t:"info",s=typeof t=="object"?t:typeof r=="object"?r:void 0,o=typeof t=="boolean"?t:typeof r=="boolean"?r:n??!1;ui.notifications.notify((0,mb.localize)(e,s),a,{permanent:o})}i(Ja,"notify");function yb(e,t,r){Ja(e,"warning",t,r)}i(yb,"warn");Pe.warn=yb;function gb(e,t,r){Ja(e,"info",t,r)}i(gb,"info");Pe.info=gb;function hb(e,t,r){Ja(e,"error",t,r)}i(hb,"error");Pe.error=hb});var Yc=p(re=>{"use strict";Object.defineProperty(re,"__esModule",{value:!0});re.setInMemory=re.getInMemoryAndSetIfNot=re.getInMemory=re.isInstanceOf=re.deleteInMemory=re.AsyncFunction=void 0;var Xa=vr(),vb=Object.getPrototypeOf(async function(){}).constructor;re.AsyncFunction=vb;function bb(e,t){if(typeof e!="object")return!1;let r=Reflect.getPrototypeOf(e);for(;r;){if(r.constructor.name===t)return!0;r=Reflect.getPrototypeOf(r)}return!1}i(bb,"isInstanceOf");re.isInstanceOf=bb;function Vc(e,...t){return getProperty(e,`modules.${Xa.MODULE.id}.${t.join(".")}`)}i(Vc,"getInMemory");re.getInMemory=Vc;function Kc(e,...t){let r=t.pop();return setProperty(e,`modules.${Xa.MODULE.id}.${t.join(".")}`,r)}i(Kc,"setInMemory");re.setInMemory=Kc;function _b(e,...t){let r=t.pop(),n=Vc(e,...t);if(n!=null)return n;let a=typeof r=="function"?r():r;return Kc(e,...t,a),a}i(_b,"getInMemoryAndSetIfNot");re.getInMemoryAndSetIfNot=_b;function Sb(e,...t){let r=["modules",Xa.MODULE.id,...t.flatMap(s=>s.split("."))],n=r.pop(),a=e;for(let s of r){if(typeof a!="object"||!(s in a))return!0;a=a[s]}return delete a[n]}i(Sb,"deleteInMemory");re.deleteInMemory=Sb});var Zc=p(H=>{"use strict";var Pb=H&&H.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),Ob=H&&H.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),Mb=H&&H.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&Pb(t,e,r);return Ob(t,e),t};Object.defineProperty(H,"__esModule",{value:!0});H.settingPath=H.setSetting=H.registerSettingMenu=H.registerSetting=H.isClientSetting=H.isWorldSetting=H.isMenuSetting=H.getSetting=void 0;var Ib=Mb(ut()),br=ae();function wb(e){"choices"in e&&Array.isArray(e.choices)&&(e.choices=Ib.mapToObj(e.choices,t=>[t,Le(e.key,"choices",t)])),e.name??=Le(e.key,"name"),e.hint??=Le(e.key,"hint"),e.scope??="world",e.config??=!0,game.settings.register(br.MODULE.id,e.key,e)}i(wb,"registerSetting");H.registerSetting=wb;function Eb(e){e.name??=Le("menus",e.key,"name"),e.label??=Le("menus",e.key,"label"),e.hint??=Le("menus",e.key,"hint"),e.restricted??=!0,e.icon??="fas fa-cogs",game.settings.registerMenu(br.MODULE.id,e.key,e)}i(Eb,"registerSettingMenu");H.registerSettingMenu=Eb;function Le(...e){return br.MODULE.path("settings",...e)}i(Le,"settingPath");H.settingPath=Le;function Tb(e){return game.settings.get(br.MODULE.id,e)}i(Tb,"getSetting");H.getSetting=Tb;function Db(e,t){return game.settings.set(br.MODULE.id,e,t)}i(Db,"setSetting");H.setSetting=Db;function Fb(e){return"restricted"in e?!e.restricted:"scope"in e&&e.scope==="client"}i(Fb,"isClientSetting");H.isClientSetting=Fb;function Cb(e){return"restricted"in e?!!e.restricted:"scope"in e&&e.scope==="world"}i(Cb,"isWorldSetting");H.isWorldSetting=Cb;function Lb(e){return e.type.prototype instanceof FormApplication}i(Lb,"isMenuSetting");H.isMenuSetting=Lb});var Qc=p(Oe=>{"use strict";Object.defineProperty(Oe,"__esModule",{value:!0});Oe.socketOn=Oe.socketOff=Oe.socketEmit=void 0;var es=vr();function qb(e){game.socket.on(`module.${es.MODULE.id}`,e)}i(qb,"socketOn");Oe.socketOn=qb;function kb(e){game.socket.off(`module.${es.MODULE.id}`,e)}i(kb,"socketOff");Oe.socketOff=kb;function Ab(e){game.socket.emit(`module.${es.MODULE.id}`,e)}i(Ab,"socketEmit");Oe.socketEmit=Ab});var Jc=p(K=>{"use strict";var xb=K&&K.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),Rb=K&&K.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),jb=K&&K.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&xb(t,e,r);return Rb(t,e),t};Object.defineProperty(K,"__esModule",{value:!0});K.stringNumber=K.stringBoolean=K.safeSplit=K.joinStr=K.beautity=void 0;var Si=jb(ut());function zb(e,...t){return Si.pipe(t,Si.flatten(),Si.filter(r=>typeof r=="string"),Si.join(e))}i(zb,"joinStr");K.joinStr=zb;function Nb(e,t=","){return e.split(t).map(r=>r.trim()).filter(Boolean)}i(Nb,"safeSplit");K.safeSplit=Nb;function Hb(e){return e.replaceAll(/[-_.]([a-z])/g,(t,r)=>` ${r.toUpperCase()}`).capitalize()}i(Hb,"beautity");K.beautity=Hb;function Bb(e){return String(e)}i(Bb,"stringBoolean");K.stringBoolean=Bb;function $b(e){return String(e)}i($b,"stringNumber");K.stringNumber=$b});var Xc=p(Me=>{"use strict";Object.defineProperty(Me,"__esModule",{value:!0});Me.userIsGM=Me.isActiveGM=Me.hasGMOnline=void 0;function Wb(){return game.user??game.data.users.find(e=>e._id===game.data.userId)}i(Wb,"getCurrentUser");function Ub(){return game.user===game.users.activeGM}i(Ub,"isActiveGM");Me.isActiveGM=Ub;function Gb(e){return e??=Wb(),e&&e.role>=CONST.USER_ROLES.ASSISTANT}i(Gb,"userIsGM");Me.userIsGM=Gb;function Vb(){return game.users.some(e=>e.active&&e.isGM)}i(Vb,"hasGMOnline");Me.hasGMOnline=Vb});var ae=p(A=>{"use strict";var Kb=A&&A.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),B=A&&A.__exportStar||function(e,t){for(var r in e)r!=="default"&&!Object.prototype.hasOwnProperty.call(t,r)&&Kb(t,e,r)};Object.defineProperty(A,"__esModule",{value:!0});A.isOfType=void 0;B(mc(),A);B(yc(),A);B(hc(),A);B(vc(),A);B(_c(),A);B(Sc(),A);B(Pc(),A);B(Oc(),A);B(Mc(),A);B(wc(),A);B(Dc(),A);B(Fc(),A);B(qc(),A);B(Ac(),A);B(Hc(),A);B(Uc(),A);B(Qa(),A);B(vr(),A);B(Gc(),A);B(Yc(),A);B(Zc(),A);B(Qc(),A);B(Jc(),A);B(Xc(),A);function Yb(e,...t){let r=typeof e;return t.includes(r)}i(Yb,"isOfType");A.isOfType=Yb});var X={};Is(X,{R:()=>_});var _,pe=Id(()=>{_=Yi(ut());se(X,Yi(ae()))});var pt=p(j=>{"use strict";Object.defineProperty(j,"__esModule",{value:!0});j.tupleHasValue=j.traitSlugToObject=j.setHasElement=j.ordinalString=j.objectHasKey=j.localizer=j.htmlQuery=j.htmlClosest=j.getActionGlyph=j.extractNotes=j.ErrorPF2e=j.createHTMLElement=void 0;var Zb=(pe(),Te(X));function Qb(e){return Error(`PF2e System | ${e}`)}i(Qb,"ErrorPF2e");j.ErrorPF2e=Qb;function ef(e,t){return(typeof t=="string"||typeof t=="number")&&t in e}i(ef,"objectHasKey");j.objectHasKey=ef;function Jb(e,t){return e.includes(t)}i(Jb,"tupleHasValue");j.tupleHasValue=Jb;function Xb(e,t){return e.has(t)}i(Xb,"setHasElement");j.setHasElement=Xb;function e_(e){let t=new Intl.PluralRules(game.i18n.lang,{type:"ordinal"}),r=game.i18n.localize(`PF2E.OrdinalSuffixes.${t.select(e)}`);return game.i18n.format("PF2E.OrdinalNumber",{value:e,suffix:r})}i(e_,"ordinalString");j.ordinalString=e_;function t_(e,t){return e instanceof Element?e.closest(t):null}i(t_,"htmlClosest");j.htmlClosest=t_;function r_(e,t){return e instanceof Element||e instanceof Document?e.querySelector(t):null}i(r_,"htmlQuery");j.htmlQuery=r_;function n_(e){return(...[t,r])=>r?game.i18n.format(`${e}.${t}`,r):game.i18n.localize(`${e}.${t}`)}i(n_,"localizer");j.localizer=n_;function i_(e,t){let r={name:e,label:game.i18n.localize(t[e]??e),description:null};return ef(CONFIG.PF2E.traitsDescriptions,e)&&(r.description=CONFIG.PF2E.traitsDescriptions[e]),r}i(i_,"traitSlugToObject");j.traitSlugToObject=i_;var a_={0:"F",free:"F",1:"1",2:"2",3:"3","1 or 2":"1/2","1 to 3":"1 - 3","2 or 3":"2/3","2 rounds":"3,3",reaction:"R"};function s_(e){if(!e&&e!==0)return"";let t=typeof e!="object"?e:e.type==="action"?e.value:e.type,r=String(t??"").toLowerCase().trim();return a_[r]?.replace("-","\u2013")??""}i(s_,"getActionGlyph");j.getActionGlyph=s_;function o_(e,t){return t.flatMap(r=>(e[r]??[]).map(n=>n.clone()))}i(o_,"extractNotes");j.extractNotes=o_;function u_(e,{classes:t=[],dataset:r={},children:n=[],innerHTML:a}={}){let s=document.createElement(e);t.length>0&&s.classList.add(...t);for(let[o,l]of Object.entries(r).filter(([,f])=>!Zb.R.isNil(f)&&f!==!1))s.dataset[o]=l===!0?"":String(l);if(a)s.innerHTML=a;else for(let o of n){let l=o instanceof HTMLElement?o:new Text(o);s.appendChild(l)}return s}i(u_,"createHTMLElement");j.createHTMLElement=u_});var rf=p(mt=>{"use strict";Object.defineProperty(mt,"__esModule",{value:!0});mt.transferItemToActor=mt.resetActors=void 0;var ts=(pe(),Te(X)),tf=pt();async function l_(e,t,r,n,a=!1){if(!t.isOfType("physical"))throw(0,tf.ErrorPF2e)("Only physical items (with quantities) can be transfered between actors");let s=e.inventory.get(n??"");if(s&&!s?.isOfType("backpack"))throw(0,tf.ErrorPF2e)("containerId refers to a non-container");r=Math.min(r,t.quantity);let o=t.quantity-r;o<1?await t.delete():await t.update({"system.quantity":o});let f=t.toObject();return f.system.quantity=r,f.system.equipped.carryType="worn","invested"in f.system.equipped&&(f.system.equipped.invested=t.traits.has("invested")?!1:null),e.addToInventory(f,s,a)}i(l_,"transferItemToActor");mt.transferItemToActor=l_;async function c_(e,t={}){e??=[game.actors.contents,game.scenes.contents.flatMap(n=>n.tokens.contents).flatMap(n=>n.actor??[])].flat(),e=ts.R.uniq(Array.from(e)),t.sheets??=!0;for(let n of e)n.reset(),t.sheets&&n.render();if(game.pf2e.effectPanel.refresh(),game.settings.get("pf2e","automation.effectExpiration")&&!game.settings.get("pf2e","automation.removeExpiredEffects")){let n=ts.R.uniq(Array.from(e).flatMap(a=>a.getActiveTokens(!1,!0)).flatMap(a=>a.scene));for(let a of n)a.reset(),a.isView&&canvas.perception.update({initializeVision:!0},!0)}if(t.tokens)for(let n of ts.R.uniq(Array.from(e).flatMap(a=>a.getActiveTokens(!0,!0))))n.simulateUpdate()}i(c_,"resetActors");mt.resetActors=c_});var sf=p(Ie=>{"use strict";Object.defineProperty(Ie,"__esModule",{value:!0});Ie.renderItemSheets=Ie.renderCharacterSheets=Ie.renderActorSheets=void 0;var f_=(pe(),Te(X));function nf(e){let t=Array.isArray(e)?e:[e],r=Object.values(ui.windows).filter(n=>t.some(a=>(0,f_.isInstanceOf)(n,a)));for(let n of r)n.render()}i(nf,"renderApplication");function af(e=["ActorSheetPF2e"]){nf(e)}i(af,"renderActorSheets");Ie.renderActorSheets=af;function d_(){af(["CharacterSheetPF2e"])}i(d_,"renderCharacterSheets");Ie.renderCharacterSheets=d_;function p_(e=["ItemSheetPF2e"]){nf(e)}i(p_,"renderItemSheets");Ie.renderItemSheets=p_});var of=p(yt=>{"use strict";Object.defineProperty(yt,"__esModule",{value:!0});yt.getTabFilterData=yt.filterTraits=void 0;function m_(e){let t=game.pf2e.compendiumBrowser.tabs[e];return deepClone(t.defaultFilterData??t.filterData)}i(m_,"getTabFilterData");yt.getTabFilterData=m_;function y_(e,t,r){let n=t.filter(s=>!s.not).map(s=>s.value),a=t.filter(s=>s.not).map(s=>s.value);return!((n.length||a.length)&&(a.some(o=>e.includes(o))||!(r==="and"?n.every(o=>e.includes(o)):n.some(o=>e.includes(o)))))}i(y_,"filterTraits");yt.filterTraits=y_});var rs=p(Pi=>{"use strict";Object.defineProperty(Pi,"__esModule",{value:!0});Pi.extractEphemeralEffects=void 0;async function g_({affects:e,origin:t,target:r,item:n,domains:a,options:s}){if(!(t&&r))return[];let[o,l]=e==="target"?[t,r]:[r,t],f=[...s,o.getRollOptions(a),l.getSelfRollOptions(e)].flat(),c=n?n.isOfType("spell")?{spell:n}:{weapon:n}:{};return(await Promise.all(a.flatMap(d=>o.synthetics.ephemeralEffects[d]?.[e]??[]).map(d=>d({test:f,resolvables:c})))).flatMap(d=>d??[])}i(g_,"extractEphemeralEffects");Pi.extractEphemeralEffects=g_});var cf=p(ne=>{"use strict";Object.defineProperty(ne,"__esModule",{value:!0});ne.toggleOffShieldBlock=ne.selfApplyEffectFromMessage=ne.onClickShieldBlock=ne.createTradeMessage=ne.createTradeContent=ne.applyDamageFromMessage=void 0;var Oi=(pe(),Te(X)),qe=pt(),h_=rs();function uf(e,t){return renderTemplate("systems/pf2e/templates/chat/action/content.hbs",{imgPath:t,message:e.replace(/\b1 × /,"")})}i(uf,"createTradeContent");ne.createTradeContent=uf;async function v_(e,t,r,n,a){let s=await uf(t,n.img);return b_(e,s,r,a)}i(v_,"createTradeMessage");ne.createTradeMessage=v_;async function b_(e,t,r,n){return ChatMessage.implementation.create({user:n??game.user.id,speaker:{alias:(0,Oi.getHighestName)(r)},flavor:await __(e),content:t,type:CONST.CHAT_MESSAGE_TYPES.EMOTE})}i(b_,"createManipulationMessage");function __(e){return renderTemplate("systems/pf2e/templates/chat/action/flavor.hbs",{action:{title:"PF2E.Actions.Interact.Title",subtitle:e,glyph:(0,qe.getActionGlyph)(1)},traits:[{name:"manipulate",label:CONFIG.PF2E.featTraits.manipulate,description:CONFIG.PF2E.traitsDescriptions.manipulate}]})}i(__,"createManipulateFlavor");async function lf({message:e,multiplier:t=1,addend:r=0,promptModifier:n=!1,rollIndex:a=0,tokens:s,onDamageApplied:o}){if(n)return S_(e,t,a,s,o);let l=(0,qe.htmlQuery)(ui.chat.element[0],`li.chat-message[data-message-id="${e.id}"]`);if(s??=l?.dataset.actorIsTarget&&e.token?[e.token]:game.user.getActiveTokens(),s.length===0){ui.notifications.error("PF2E.ErrorMessage.NoTokenSelected",{localize:!0});return}let f=CONFIG.PF2E.chatDamageButtonShieldToggle,c=e.rolls.at(a);if(!(0,Oi.isInstanceOf)(c,"DamageRoll"))throw(0,qe.ErrorPF2e)("Unexpected error retrieving damage roll");let d=t<0?t*c.total+r:c.alter(t,r),m=[...e.flags.pf2e.context?.options??[]],b=m.filter(S=>S.startsWith("self:")).map(S=>S.replace(/^self/,"origin")),v=e.item,h=v?.isOfType("affliction","condition","effect")?v.getRollOptions("item"):[];for(let S of s){if(!S.actor)continue;m.some(N=>N.startsWith("target"))||m.push(...S.actor.getSelfRollOptions("target"));let M=t>0?"damage-received":"healing-received",E=t>0?await(0,h_.extractEphemeralEffects)({affects:"target",origin:e.actor,target:S.actor,item:e.item,domains:[M],options:m}):[],F=S.actor.getContextualClone(b,E),C=new Set([...m.filter(N=>!/^(?:self|target):/.test(N)),...h,...b,...F.getSelfRollOptions()]);await F.applyDamage({damage:d,token:S,item:e.item,skipIWR:t<=0,rollOptions:C,shieldBlockRequest:f,outcome:e.flags.pf2e.context?.outcome})}ns(e.id),o?.(e,s,a)}i(lf,"applyDamageFromMessage");ne.applyDamageFromMessage=lf;async function S_(e,t,r,n,a){let s=await renderTemplate("systems/pf2e/templates/chat/damage/adjustment-dialog.hbs"),o=class extends Dialog{static{i(this,"AdjustmentDialog")}activateListeners(f){super.activateListeners(f),f[0].querySelector("input")?.focus()}},l=t<0;new o({title:game.i18n.localize(l?"PF2E.UI.shiftModifyHealingTitle":"PF2E.UI.shiftModifyDamageTitle"),content:s,buttons:{ok:{label:game.i18n.localize("PF2E.OK"),callback:async f=>{let c=(Number(f[0].querySelector("input")?.value)||0)*Math.sign(t);lf({message:e,multiplier:t,addend:c,promptModifier:!1,rollIndex:r,tokens:n,onDamageApplied:a})}},cancel:{label:"Cancel"}},default:"ok",close:()=>{ns(e.id)}}).render(!0)}i(S_,"shiftAdjustDamage");function ns(e){for(let t of["#chat-log","#chat-popout"]){let r=`${t} > li.chat-message[data-message-id="${e}"] button[data-action$=shield-block]`;for(let n of document.body.querySelectorAll(r))n?.classList.remove("shield-activated")}CONFIG.PF2E.chatDamageButtonShieldToggle=!1}i(ns,"toggleOffShieldBlock");ne.toggleOffShieldBlock=ns;function P_(e,t,r){let n=i(()=>{if(r)return[r];let s=game.user.getActiveTokens();return s.length===0&&ui.notifications.error("PF2E.ErrorMessage.NoTokenSelected",{localize:!0}),s},"getTokens"),a=i(s=>s.find(l=>!!l.actor)?.actor?.itemTypes.shield.filter(l=>l.isEquipped&&!l.isBroken&&!l.isDestroyed)??[],"getNonBrokenShields");e.classList.contains("tooltipstered")||$(e).tooltipster({animation:"fade",trigger:"click",arrow:!1,content:(0,qe.htmlQuery)(t,"div.hover-content"),contentAsHTML:!0,contentCloning:!0,debug:!1,interactive:!0,side:["top"],theme:"crb-hover",functionBefore:()=>{let s=n();if(s.length===0)return!1;let o=a(s),l=s.length===1&&o.length>1,f=e.classList.contains("shield-activated");return l&&!f?!0:l&&e.dataset.shieldId?(e.attributes.removeNamedItem("data-shield-id"),e.classList.remove("shield-activated"),CONFIG.PF2E.chatDamageButtonShieldToggle=!1,!0):(e.classList.toggle("shield-activated"),CONFIG.PF2E.chatDamageButtonShieldToggle=!CONFIG.PF2E.chatDamageButtonShieldToggle,!1)},functionFormat:(s,o,l)=>{let f=n(),c=a(f),d=f.length===1&&c.length>1,m=e.classList.contains("shield-activated");if(d&&!m){let b=(0,qe.htmlQuery)(l,"ul.shield-options");if(!b)return $(l);let v=c.map(h=>{let S=document.createElement("input");S.classList.add("data"),S.type="radio",S.name="shield-id",S.value=h.id,S.addEventListener("click",()=>{e.dataset.shieldId=S.value,e.classList.add("shield-activated"),CONFIG.PF2E.chatDamageButtonShieldToggle=!0,s.close()});let M=document.createElement("span");M.classList.add("label"),M.innerHTML=h.name;let E=document.createElement("span");E.classList.add("tag");let F=game.i18n.localize("PF2E.HardnessLabel");E.innerHTML=`${F}: ${h.hardness}`;let C=document.createElement("li");return C.classList.add("item"),C.append(S,M,E),C});b.replaceChildren(...v)}return $(l)}}).tooltipster("open")}i(P_,"onClickShieldBlock");ne.onClickShieldBlock=P_;async function O_(e,t){let r=e.item,n=r?.actor??e.actor;if(!r||!n)return;let a=t.querySelector(".message-content .message-buttons button[data-action='apply-effect'][data-targets]");if(!a)return;a.disabled=!0;let s=fromUuidSync(a.dataset.targets??""),o=r.isOfType("action","feat")&&r.system.selfEffect?await fromUuid(r.system.selfEffect.uuid):null;if((0,Oi.isInstanceOf)(s,"ActorPF2e")&&(0,Oi.isInstanceOf)(o,"EffectPF2e")){let l=r.system.traits.value?.filter(m=>m in CONFIG.PF2E.effectTraits)??[],f=mergeObject(o.toObject(),{_id:null,system:{context:{origin:{actor:n.uuid,token:e.token?.uuid??null,item:r.uuid,spellcasting:null,rollOptions:r.getOriginData().rollOptions},target:{actor:s.uuid,token:s.getActiveTokens(!0,!0).at(0)?.uuid??null},roll:null},traits:{value:l}}});await s.createEmbeddedDocuments("Item",[f]);let c=(()=>{let m=document.createElement("div");return m.innerHTML=e.content,m})(),d=(0,qe.htmlQuery)(c,".message-buttons");if(d){let m=(0,qe.createHTMLElement)("span",{classes:["effect-applied"]}),b=o.toAnchor({attrs:{draggable:"true"}}),h=game.i18n.format("PF2E.Item.Action.SelfAppliedEffect.Applied",{effect:b.outerHTML});m.innerHTML=h,d.replaceChildren(m),await e.update({content:c.innerHTML})}}}i(O_,"selfApplyEffectFromMessage");ne.selfApplyEffectFromMessage=O_});var Mi=p(le=>{"use strict";Object.defineProperty(le,"__esModule",{value:!0});le.getSpellCollectionClass=le.getStatisticClass=le.getSpellClass=le.getDamageRollClass=void 0;function M_(e){return e.constructor}i(M_,"getStatisticClass");le.getStatisticClass=M_;function I_(e){return e.spellcasting.get("rituals").spells.constructor}i(I_,"getSpellCollectionClass");le.getSpellCollectionClass=I_;function w_(){return CONFIG.PF2E.Item.documentClasses.spell}i(w_,"getSpellClass");le.getSpellClass=w_;function E_(){return CONFIG.Dice.rolls.find(e=>e.name==="DamageRoll")}i(E_,"getDamageRollClass");le.getDamageRollClass=E_});var ff=p(Ii=>{"use strict";Object.defineProperty(Ii,"__esModule",{value:!0});Ii.saveTypes=void 0;var T_=["fortitude","reflex","will"];Ii.saveTypes=T_});var df=p(wi=>{"use strict";Object.defineProperty(wi,"__esModule",{value:!0});wi.calculateRemainingDuration=void 0;var D_={rounds:6,minutes:60,hours:3600,days:86400};function F_(e,t,r){if(t.unit==="encounter"){let m=e.system.expired;return{expired:!!m,remaining:m?0:1/0}}else if(t.unit==="unlimited"||!("start"in e.system))return{expired:!1,remaining:1/0};let n=e.system.start.value,{combatant:a}=game.combat??{},{unit:s,expiry:o}=t,l=t.value*(D_[t.unit]??0),f=!a&&l===0&&s==="rounds"&&["turn-end","round-end"].includes(o??"")?1:0,c=n+l+f-game.time.worldTime,d={remaining:c,expired:c<=0};if(c===0&&a?.actor){let m=e.system.start.initiative??0,b=a.initiative??0;r??=e.actor?.isOfType("familiar")?e.actor.master??e.actor:e.actor;let v=i(()=>m===b&&a.actor===(e.origin??r),"atTurnStart");d.expired=o==="turn-start"?v():o==="turn-end"?b<m:o==="round-end"?c<=0&&game.time.worldTime>n:!1}return d}i(F_,"calculateRemainingDuration");wi.calculateRemainingDuration=F_});var hf=p(W=>{"use strict";Object.defineProperty(W,"__esModule",{value:!0});W.hasFreePropertySlot=W.getEquippedHandwraps=W.getCarryTypeActionData=W.getAnnotationLabel=W.consumeItem=W.changeCarryType=W.calculateItemPrice=W.MoveLootPopup=W.HANDWRAPS_SLUG=W.BANDS_OF_FORCE_SLUGS=void 0;var C_=(pe(),Te(X)),L_=Mi(),pf=pt(),mf="handwraps-of-mighty-blows";W.HANDWRAPS_SLUG=mf;var q_=["bands-of-force","bands-of-force-greater","bands-of-force-major"];W.BANDS_OF_FORCE_SLUGS=q_;function yf(e,t){if(!e)return null;let r=["draw","pick-up","retrieve"].includes(e)?`${e}${t}H`:["grip","sheathe","modular","drop"].includes(e)?e:null;return r?game.pf2e.system.sluggify(r,{camel:"bactrian"}):null}i(yf,"getAnnotationLabel");W.getAnnotationLabel=yf;function gf(e,t,r="interact"){switch(t){case"draw":return[1,"held"];case"pick-up":return[1,"held"];case"retrieve":{let{container:n}=e;if(n?.isHeld)return[1,"held"];let a=n?.system.usage;return[a?.type==="held"||a?.where==="backpack"?2:1,"held"]}case"grip":return[r==="interact"?1:0,"held"];case"sheathe":return[1,"worn"];case"modular":return[1,null];case"drop":return[0,"dropped"];case"tower-shield":return[r==="take-cover"?1:0,null];default:return[1,null]}}i(gf,"getCarryTypeActionData");W.getCarryTypeActionData=gf;async function k_(e,t,r,n,a="interact"){let[s,o]=gf(t,n,a);if(!o||(await e.changeCarryType(t,{carryType:o,handsHeld:r}),!game.combat))return;let l={flavor:"./systems/pf2e/templates/chat/action/flavor.hbs",content:"./systems/pf2e/templates/chat/action/content.hbs"},f=game.pf2e.system.sluggify,c=f(a,{camel:"bactrian"}),d=n?f(n,{camel:"bactrian"}):null,m=yf(n,r),b={title:`PF2E.Actions.${c}.Title`,subtitle:m?`PF2E.Actions.${c}.${m}.Title`:null,glyph:(0,pf.getActionGlyph)(s)},[v,h]=a==="raise-a-shield"?[[],`PF2E.Actions.${c}.Content`]:["take-cover","end-cover"].includes(a)?[[],`PF2E.Actions.${c}.${d}.Description`]:[[(0,pf.traitSlugToObject)("manipulate",CONFIG.PF2E.actionTraits)],`PF2E.Actions.${c}.${m}.Description`],S=await renderTemplate(l.flavor,{action:b,traits:v}),M=await renderTemplate(l.content,{imgPath:t.img,message:game.i18n.format(h,{actor:e.name,weapon:t.name})}),E=e.getActiveTokens(!1,!0).shift();await ChatMessage.implementation.create({content:M,speaker:ChatMessage.getSpeaker({actor:e,token:E}),flavor:S,type:CONST.CHAT_MESSAGE_TYPES.EMOTE})}i(k_,"changeCarryType");W.changeCarryType=k_;function A_(e){let t=e.system.runes.potency;return t>0&&e.system.runes.property.length<t}i(A_,"hasFreePropertySlot");W.hasFreePropertySlot=A_;function x_(e){return e.itemTypes.weapon.find(t=>{let{category:r,slug:n,equipped:a,identification:s}=t._source.system,{carryType:o,invested:l,inSlot:f}=a;return r==="unarmed"&&o==="worn"&&f&&l&&s.status==="identified"&&n===mf})}i(x_,"getEquippedHandwraps");W.getEquippedHandwraps=x_;function R_(e,t=1,r=1){let n=game.pf2e.Coins.fromPrice(e.price,t);return r===1?n:n.scale(r)}i(R_,"calculateItemPrice");W.calculateItemPrice=R_;async function j_(e,t){let r=t.uses;if(r.max&&r.value<1)return null;if(["wand","scroll"].includes(t.category)&&t.system.spell)return t.consume();let n=t.actor,a=r.max>1,s=r.value===1&&a?"UseExhausted":a?"UseMulti":"UseSingle",o={pf2e:{origin:{sourceId:t.sourceId,uuid:t.uuid,type:t.type}}},l=ChatMessage.getSpeaker({actor:n}),f=(await t.toMessage(e,{create:!1})).content,c=(0,C_.createHTMLFromString)(f);c.querySelector("button[data-action='consume']")?.remove(),c.querySelector("footer")?.remove();let d=c.outerHTML;if(t.system.damage){let m=(0,L_.getDamageRollClass)(),{formula:b,type:v,kind:h}=t.system.damage;new m(`(${b})[${v},${h}]`).toMessage({speaker:l,flavor:d,flags:o})}else ChatMessage.create({speaker:l,content:d,flags:o});if(t.system.uses.autoDestroy&&r.value<=1){let m=t.quantity,b=t.category==="ammo"&&t.system.rules.length>0;return m<=1&&!b?t.delete():t.update({"system.quantity":Math.max(m-1,0),"system.uses.value":r.max})}else return t.update({"system.uses.value":Math.max(r.value-1,0)})}i(j_,"consumeItem");W.consumeItem=j_;var is=class extends FormApplication{static{i(this,"MoveLootPopup")}onSubmitCallback;constructor(t,r,n){super(t,r),this.onSubmitCallback=n}async getData(){let[t,r]=this.options.isPurchase?["PF2E.loot.PurchaseLootMessage","PF2E.loot.PurchaseLoot"]:["PF2E.loot.MoveLootMessage","PF2E.loot.MoveLoot"];return{...await super.getData(),quantity:{default:this.options.quantity.default,max:this.options.quantity.max},newStack:this.options.newStack,lockStack:this.options.lockStack,prompt:t,buttonLabel:r}}static get defaultOptions(){return{...super.defaultOptions,id:"MoveLootPopup",classes:[],title:game.i18n.localize("PF2E.loot.MoveLootPopupTitle"),template:"systems/pf2e/templates/popups/loot/move-loot-popup.hbs",width:"auto",quantity:{default:1,max:1},newStack:!1,lockStack:!1,isPurchase:!1}}async _updateObject(t,r){this.onSubmitCallback(r.quantity,r.newStack)}};W.MoveLootPopup=is});var vf=p(Ei=>{"use strict";Object.defineProperty(Ei,"__esModule",{value:!0});Ei.RollNotePF2e=void 0;var as=pt(),ss=class e{static{i(this,"RollNotePF2e")}selector;title;text;predicate;outcome;visibility;rule;constructor(t){this.selector=t.selector,this.title=t.title??null,this.text=t.text,this.predicate=new game.pf2e.Predicate(t.predicate??[]),this.outcome=[...t.outcome??[]],this.visibility=t.visibility??null,this.rule=t.rule??null}static notesToHTML(t){return t.length===0?null:(0,as.createHTMLElement)("ul",{classes:["notes"],children:[...t.flatMap(r=>[`
`,r.toHTML()]),`
`]})}toHTML(){let t=(0,as.createHTMLElement)("li",{classes:["roll-note"],dataset:{itemId:this.rule?.item.id,visibility:this.visibility},innerHTML:game.i18n.localize(this.text)});if(t.childNodes.length===1&&t.firstChild instanceof HTMLElement&&(t.innerHTML=t.firstChild.innerHTML),this.title){let r=(0,as.createHTMLElement)("strong",{innerHTML:game.i18n.localize(this.title)});t.prepend(r," ")}return t}clone(){return new e({...this.toObject(),rule:this.rule})}toObject(){return{selector:this.selector,title:this.title,text:this.text,predicate:this.predicate.toObject(),outcome:this.outcome,visibility:this.visibility}}};Ei.RollNotePF2e=ss});var _f=p(z=>{"use strict";Object.defineProperty(z,"__esModule",{value:!0});z.warnInvalidDrop=z.upgradeStatisticRank=z.spellSlotGroupIdToNumber=z.getSummarizedSpellsDataForRender=z.getRankLabel=z.getHighestSyntheticStatistic=z.getHighestSpellcastingStatistic=z.getActorMaxRank=z.createCounteractStatistic=z.coerceToSpellGroupId=z.MAGIC_TRADITIONS=z.EFFECT_AREA_SHAPES=void 0;var Q=(pe(),Te(X)),gt=Ti(),z_=["burst","cone","cube","cylinder","emanation","line","square"];z.EFFECT_AREA_SHAPES=z_;var N_=new Set(["arcane","divine","occult","primal"]);z.MAGIC_TRADITIONS=N_;function H_(e){let t=deepClone(e.data);return t.modifiers=(e.modifiers??[]).map(r=>r.toObject()),t}i(H_,"getStatisticData");function B_(e,t){let r=(0,gt.getStatisticClass)(e.skills.acrobatics),n=deepClone(t);return n.modifiers=t.modifiers.map(a=>new game.pf2e.Modifier(a)),new r(e,n)}i(B_,"createStatisticFromRawData");function $_(e,t){if(e.rank&&e.rank>=t)return e;let r=H_(e);return B_(e.actor,r)}i($_,"upgradeStatisticRank");z.upgradeStatisticRank=$_;function W_(e){let t=e.actor,r=t.isOfType("npc")?e.statistic.check.modifiers.find(a=>a.type==="untyped"&&a.slug==="base")?.clone():null,n=(0,gt.getStatisticClass)(e.statistic);return new n(t,{slug:"counteract",label:"PF2E.Item.Spell.Counteract.Label",attribute:e.statistic.attribute,rank:e.statistic.rank||1,check:{type:"check",modifiers:Q.R.compact([r])}})}i(W_,"createCounteractStatistic");z.createCounteractStatistic=W_;function U_(e,t=!0){let r=Array.from(e.synthetics.statistics.values()),n=t?[...r,...Object.values(e.classDCs)]:r;if(!n.length)return;let a=e.classDC,s=Q.R.groupBy(n,Q.R.prop("mod")),o=Q.R.pipe(s,Q.R.keys,Q.R.sortBy([Q.R.identity,"desc"]),Q.R.first());return a&&o&&a.mod===o?a:s[o][0]}i(U_,"getHighestSyntheticStatistic");z.getHighestSyntheticStatistic=U_;function G_(e){let t=e.spellcasting.spellcastingFeatures;if(!t.length)return;let r=e.classDC?.attribute,n=Q.R.groupBy(t,o=>o.statistic.mod),a=Q.R.pipe(n,Q.R.keys,Q.R.sortBy([o=>Number(o),"desc"]),Q.R.first()),s=n[a].map(o=>({tradition:o.tradition,statistic:o.statistic}));return s.length===1||!r?s[0]:s.find(o=>o.statistic.attribute===r)||s[0]}i(G_,"getHighestSpellcastingStatistic");z.getHighestSpellcastingStatistic=G_;function V_(e){return Math.max(1,Math.ceil(e.level/2))}i(V_,"getActorMaxRank");z.getActorMaxRank=V_;function K_(e){return game.i18n.format("PF2E.Item.Spell.Rank.Ordinal",{rank:(0,gt.ordinalString)(e)})}i(K_,"getRankLabel");z.getRankLabel=K_;function Y_(e){if(e==="cantrips")return e;let t=Number(e)||NaN;return t.between(1,10)?t:null}i(Y_,"coerceToSpellGroupId");z.coerceToSpellGroupId=Y_;function bf(e){if(e==="cantrips")return 0;let t=Number(e??NaN);return t.between(0,10)?t:null}i(bf,"spellSlotGroupIdToNumber");z.spellSlotGroupIdToNumber=bf;function Z_(e,{spell:t,groupId:r}){let n=(0,gt.localizer)("PF2E.Item.Spell.Warning");if(e==="invalid-rank"&&typeof r=="number"){let a=game.i18n.format("PF2E.Item.Spell.Rank.Ordinal",{rank:(0,gt.ordinalString)(t.baseRank)}),s=game.i18n.format("PF2E.Item.Spell.Rank.Ordinal",{rank:(0,gt.ordinalString)(r)});ui.notifications.warn(n("InvalidRank",{spell:t.name,spellRank:a,targetRank:s}))}else if(e==="cantrip-mismatch"){let a=t.isCantrip?"CantripToRankedSlots":"NonCantripToCantrips";ui.notifications.warn(n(a,{spell:t.name}))}else if(e==="invalid-spell"){let a=game.i18n.localize("PF2E.TraitFocus");ui.notifications.warn(n("WrongSpellType",{type:a}))}}i(Z_,"warnInvalidDrop");z.warnInvalidDrop=Z_;async function Q_(e,t,r,n){n??=await Promise.all(e.spellcasting.collections.map(c=>c.entry.getSheetData({spells:c})));let a=e.system.resources?.focus??{value:0,max:0},s=(0,Q.getActiveModule)("pf2e-dailies"),o=[],l=[],f=!1;for(let c of n){let d=c.id,m=c.statistic?.dc.value,b=m?`${c.name} - ${game.i18n.format("PF2E.DCWithValue",{dc:m,text:""})}`:c.name,v=c.isFocusPool,h=c.isRitual,S=c.category==="charges",M=c.isStaff,E=c.isInnate,F=c.isPrepared,C=c.isSpontaneous,N=c.isFlexible,q=c.category==="items"?e.items.get(d.split("-")[0]):void 0;for(let I of c.groups){if(!I.active.length||I.uses?.max===0)continue;let w=bf(I.id),L=[],D=I.id==="cantrips",T=!D&&S&&!s?.active,R=typeof I.uses?.value=="number"?I.uses:void 0;for(let G=0;G<I.active.length;G++){let ee=I.active[G];if(!ee?.spell||ee.uses?.max===0)continue;let{spell:fe}=ee,Ps=fe.id,Os=D||v||q||F&&!N?void 0:S&&!T?c.uses:ee.uses??R;L.push({name:fe.name,itemId:Ps,entryId:d,groupId:I.id,slotId:G,action:fe.system.time.value,castRank:ee.castRank??fe.rank,expended:v?!D&&a.value<=0:ee.expended,img:fe.img,range:fe.system.range.value||"-&nbsp;",rank:fe.rank,entryName:c.name,entryDc:m,entryTooltip:b,consumable:q,isBroken:T,isFocus:v,isRitual:h,isCharges:S,isStaff:M,isInnate:E,isPrepared:F,isSpontaneous:C,isFlexible:N,uses:Os?{...Os,input:M?"":S?"system.slots.slot1.value":E?"system.location.uses.value":`system.slots.slot${w}.value`,itemId:M?"":E?Ps:d}:void 0,order:S?0:F?1:v?2:E?3:C?4:5,category:q?`PF2E.Item.Consumable.Category.${q.category}`:M?r("staff"):S?r("charges"):E?"PF2E.PreparationTypeInnate":C?"PF2E.PreparationTypeSpontaneous":N?"PF2E.SpellFlexibleLabel":v?"PF2E.TraitFocus":"PF2E.SpellPreparedLabel"})}if(L.length){if(v)if(D)f=!0;else{o[12]??=[],o[12].push(...L);continue}else if(h){o[13]??=[],o[13].push(...L);continue}l[w]??=I.label,o[w]??=[],o[w].push(...L)}}}if(o.length){let m=t?i((b,v)=>b.order===v.order?(0,Q.localeCompare)(b.name,v.name):b.order-v.order,"orderSort"):i((b,v)=>(0,Q.localeCompare)(b.name,v.name),"nameSort");for(let b=0;b<o.length;b++){let v=o[b];!v||b>11||v.sort(m)}}return l[12]="PF2E.Focus.Spells",l[13]="PF2E.Actor.Character.Spellcasting.Tab.Rituals",{labels:l,spells:o,focusPool:a,isOwner:e.isOwner,hasFocusCantrip:f}}i(Q_,"getSummarizedSpellsDataForRender");z.getSummarizedSpellsDataForRender=Q_});var Pf=p(Di=>{"use strict";Object.defineProperty(Di,"__esModule",{value:!0});Di.createConsumableFromSpell=void 0;var Sf=(pe(),Te(X)),os=Ti(),J_="tLa4bewBhyqzi6Ow",X_={1:"RjuupS9xyXDLgyIr",2:"Y7UD64foDbDMV9sx",3:"ZmefGBXGJF3CFDbn",4:"QSQZJ5BC3DeHv153",5:"tjLvRWklAylFhBHQ",6:"4sGIy77COooxhQuC",7:"fomEZZ4MxVVK3uVu",8:"iPki3yuoucnj7bIt",9:"cFHomF3tty8Wi1e5",10:"o1XIHJ4MJyroAHfF"},eS={1:"UJWiN0K3jqVjxvKk",2:"vJZ49cgi8szuQXAD",3:"wrDmWkGxmwzYtfiA",4:"Sn7v9SsbEDMUIwrO",5:"5BF7zMnrPYzyigCs",6:"kiXh4SUWKr166ZeM",7:"nmXPj9zuMRQBNT60",8:"Qs8RgNH6thRPv2jt",9:"Fgv722039TVM5JTc"},tS={cantripDeck5:"PF2E.Item.Physical.FromSpell.CantripDeck5",scroll:"PF2E.Item.Physical.FromSpell.Scroll",wand:"PF2E.Item.Physical.FromSpell.Wand"};function rS(e,t){switch(e){case"cantripDeck5":return J_;case"scroll":return X_[t]??null;default:return eS[t]??null}}i(rS,"getIdForSpellConsumable");function nS(e,t,r){let n=tS[e]||`${e} of {name} (Rank {level})`;return game.i18n.format(n,{name:t,level:r})}i(nS,"getNameForSpellConsumable");async function iS(e,{type:t,heightenedLevel:r=e.baseRank,mystified:n=!1,temp:a,itemName:s,itemImg:o}){let l=game.packs.find(v=>v.collection==="pf2e.equipment-srd"),f=rS(t,r),c=await l?.getDocument(f??"");if(!(0,Sf.isInstanceOf)(c,"ConsumablePF2e"))throw(0,os.ErrorPF2e)("Failed to retrieve consumable item");let d={...c.toObject(),_id:null},m=d.system.traits;m.value=Sf.R.uniq([...m.value,...e.traits]),m.rarity=e.rarity,m.value.includes("magical")&&m.value.some(v=>(0,os.setHasElement)(os.MAGIC_TRADITIONS,v))&&m.value.splice(m.value.indexOf("magical"),1),m.value.sort(),d.name=nS(s??t,e.name,r);let b=d.system.description.value;return d.system.description.value=(()=>{let v=document.createElement("p");v.append(e.sourceId?`@UUID[${e.sourceId}]{${e.name}}`:e.description);let h=document.createElement("div"),S=document.createElement("hr");return h.append(v,S),S.insertAdjacentHTML("afterend",b),h.innerHTML})(),t!=="cantripDeck5"&&(d.system.spell=mergeObject(e._source,{_id:randomID(),system:{location:{value:null,heightenedLevel:r}}},{inplace:!1})),n&&(d.system.identification.status="unidentified"),typeof o=="string"&&(d.img=o),a&&(d.system.temporary=!0),d}i(iS,"createConsumableFromSpell");Di.createConsumableFromSpell=iS});var Mf=p(ie=>{"use strict";Object.defineProperty(ie,"__esModule",{value:!0});ie.getTranslatedSkills=ie.SKILL_LONG_FORMS=ie.SKILL_EXPANDED=ie.SKILL_DICTIONARY=ie.SKILL_ABBREVIATIONS=ie.ATTRIBUTE_ABBREVIATIONS=void 0;var aS=["acr","arc","ath","cra","dec","dip","itm","med","nat","occ","prf","rel","soc","ste","sur","thi"];ie.SKILL_ABBREVIATIONS=aS;var Of={acr:"acrobatics",arc:"arcana",ath:"athletics",cra:"crafting",dec:"deception",dip:"diplomacy",itm:"intimidation",med:"medicine",nat:"nature",occ:"occultism",prf:"performance",rel:"religion",soc:"society",ste:"stealth",sur:"survival",thi:"thievery"};ie.SKILL_DICTIONARY=Of;var sS={acrobatics:{attribute:"dex",shortForm:"acr"},arcana:{attribute:"int",shortForm:"arc"},athletics:{attribute:"str",shortForm:"ath"},crafting:{attribute:"int",shortForm:"cra"},deception:{attribute:"cha",shortForm:"dec"},diplomacy:{attribute:"cha",shortForm:"dip"},intimidation:{attribute:"cha",shortForm:"itm"},medicine:{attribute:"wis",shortForm:"med"},nature:{attribute:"wis",shortForm:"nat"},occultism:{attribute:"int",shortForm:"occ"},performance:{attribute:"cha",shortForm:"prf"},religion:{attribute:"wis",shortForm:"rel"},society:{attribute:"int",shortForm:"soc"},stealth:{attribute:"dex",shortForm:"ste"},survival:{attribute:"wis",shortForm:"sur"},thievery:{attribute:"dex",shortForm:"thi"}};ie.SKILL_EXPANDED=sS;var oS=new Set(["str","dex","con","int","wis","cha"]);ie.ATTRIBUTE_ABBREVIATIONS=oS;var uS=new Set(Object.values(Of));ie.SKILL_LONG_FORMS=uS;var Fi;function lS(){if(!Fi){Fi={};for(let[e,t]of Object.entries(CONFIG.PF2E.skillList))Fi[e]=game.i18n.localize(t).toLocaleLowerCase(game.i18n.lang)}return deepClone(Fi)}i(lS,"getTranslatedSkills");ie.getTranslatedSkills=lS});var If=p(Ci=>{"use strict";Object.defineProperty(Ci,"__esModule",{value:!0});Ci.getTemplateTokens=void 0;function cS(e,{collisionOrigin:t,collisionType:r="move"}={}){let{grid:n,dimensions:a}=canvas,s=e instanceof MeasuredTemplateDocument?e.object:e;if(!canvas.scene||!s?.highlightId||!n||!a)return[];let o=n.getHighlightLayer(s.highlightId);if(!o||n.type!==CONST.GRID_TYPES.SQUARE)return[];let l=t??s.center,f=canvas.tokens.quadtree.getObjects(o.getLocalBounds(void 0,!0)),c=n.size,d=[];for(let m of f){let b=m.document,v=[];for(let h=0;h<b.height;h++){let S=Math.floor(m.x/c)*c,E=Math.floor(m.y/c)*c+h*c;if(v.push(`${S}.${E}`),b.width>1)for(let F=1;F<b.width;F++)v.push(`${S+F*c}.${E}`)}for(let h of v){if(!o.positions.has(h))continue;let[S,M]=h.split(".").map(C=>Number(C)),E={x:S+a.size*.5,y:M+a.size*.5};if(E.x<0||E.y<0)continue;if(!(canvas.ready&&r&&CONFIG.Canvas.polygonBackends[r].testCollision(l,E,{type:r,mode:"any"}))){d.push(m);break}}}return d}i(cS,"getTemplateTokens");Ci.getTemplateTokens=cS});var Ti=p(U=>{"use strict";var fS=U&&U.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),J=U&&U.__exportStar||function(e,t){for(var r in e)r!=="default"&&!Object.prototype.hasOwnProperty.call(t,r)&&fS(t,e,r)};Object.defineProperty(U,"__esModule",{value:!0});J(rf(),U);J(sf(),U);J(of(),U);J(cf(),U);J(Mi(),U);J(Mi(),U);J(ff(),U);J(df(),U);J(hf(),U);J(vf(),U);J(rs(),U);J(_f(),U);J(Pf(),U);J(Mf(),U);J(If(),U);J(pt(),U)});var u={};Is(u,{R:()=>_});pe();se(u,X);se(u,Yi(Ti()));function V(e){return e}i(V,"createDaily");function us(e,t){return e.type===t}i(us,"filterIsOfType");function ke(e,...t){return t.some(r=>e.type===r)}i(ke,"rowIsOfType");var O={getChoiSetRuleSelection:(e,t)=>e._source.system.rules.find(a=>a.key==="ChoiceSet"&&(!t||a.rollOption===t))?.selection,hasFreePropertySlot:e=>(0,u.hasFreePropertySlot)(e),getResistanceLabel:(e,t=!0)=>{let r=CONFIG.PF2E.resistanceTypes[e];return t?game.i18n.localize(r).capitalize():r},getResistances:()=>ls("resistanceTypes").map(({label:e,value:t})=>({value:t,label:e.capitalize()})),getLanguageLabel:(e,t=!0)=>{let r=CONFIG.PF2E.languages[e];return t?game.i18n.localize(r):r},getLanguages:()=>ls("languages"),getSkillLabel:(e,t=!0)=>{let r=CONFIG.PF2E.skillList[e];return t?game.i18n.localize(r):r},getSkills:()=>ls("skillList").filter(e=>e.value!=="lore"),getSpellRankLabel:e=>(0,u.getRankLabel)(e),createExcludeFeatList:(e,t,r)=>_.pipe(e.itemTypes.feat,_.filter(n=>t.some(a=>n.category===a)),_.filter(n=>r.every(a=>n.traits.has(a))),_.map(n=>n.sourceId)),getActorMaxRank:u.getActorMaxRank,getSpellcastingMaxRank:(e,{tradition:t}={})=>_.pipe(e.spellcasting.spellcastingFeatures,t?_.filter(n=>n.tradition===t):_.identity,_.map(n=>n.highestRank),_.firstBy([_.identity,"desc"]))??0,getActors:e=>(e&&(0,u.getSetting)("partyMembers")&&e.parties.size?Array.from(e.parties).flatMap(r=>r.members):game.actors.filter(r=>r.hasPlayerOwner)).filter(r=>r!==e),getProficiencyLabel:e=>game.i18n.localize(CONFIG.PF2E.proficiencyLevels[e]),getWeaponPropertyRuneLabel:e=>game.i18n.localize(`PF2E.WeaponPropertyRune.${e}.Name`),getWeaponPotencyRuneLabel:e=>game.i18n.localize(`PF2E.WeaponPotencyRune${e}`),getWeaponTraitLabel:e=>game.i18n.localize(CONFIG.PF2E.weaponTraits[e]),getWeaponDamageLabel:e=>game.i18n.localize(CONFIG.PF2E.damageTypes[e]),getWeaponGroupLabel:e=>game.i18n.localize(CONFIG.PF2E.weaponGroups[e]),getPreciousMaterialLabel(e){return game.i18n.localize(CONFIG.PF2E.preciousMaterials[e])},createFeatSource:async e=>{let t=(await fromUuid(e))?.toObject();if(t?.type!=="feat")throw new Error(`An error occured while trying to create a feat source with uuid: ${e}`);return t},createSpellScrollSource:e=>wf("scroll",e),createWandSource:e=>wf("wand",e),createSkillRuleElement:({skill:e,mode:t="upgrade",value:r,predicate:n})=>({key:"ActiveEffectLike",mode:t,path:`system.skills.${e}.rank`,value:r,predicate:n}),createLoreSource:({name:e,rank:t})=>({type:"lore",img:"systems/pf2e/icons/default-icons/lore.svg",name:e,system:{proficient:{value:t}}}),createResistanceRuleElement:({type:e,value:t,predicate:r})=>({key:"Resistance",type:e,value:dS(t),predicate:r}),createLanguageRuleElement:({language:e,mode:t="add",predicate:r})=>({key:"ActiveEffectLike",mode:t,path:"system.build.languages.granted",value:{slug:e,source:"{item|name}"},predicate:r}),createChatLink:(e,t)=>{let r=e instanceof Item?e.sourceId??e.uuid:e;return(0,u.createChatLink)(r,{label:t})},selectRandomOption:e=>{if(e=e instanceof HTMLSelectElement?e.options:e,e=e instanceof HTMLOptionsCollection?Array.from(e).map(n=>n.value):e,e.length===0)return"";let t=new Roll(`1d${e.length}`).evaluate({async:!1}),r=e[t.total-1];return typeof r=="object"?r.value:r},createSpellcastingEntrySource:({category:e,identifier:t,name:r,sort:n,attribute:a,proficiencySlug:s,showSlotlessRanks:o,proficiencyRank:l,tradition:f,flags:c})=>{let d={type:"spellcastingEntry",name:r,sort:n??0,system:{ability:{value:!s&&a||""},prepared:{value:e},showSlotlessLevels:{value:o??!1},proficiency:{value:l??1,slug:s??""},tradition:{value:f??"arcane"}}};return(0,u.setFlagProperty)(d,"identifier",t),_.isPlainObject(c)&&(0,u.setFlagProperty)(d,"extra",c),d},createSpellSource:async(e,{identifier:t,rank:r}={})=>{let n=(await fromUuid(e))?.toObject();if(n?.type!=="spell")throw new Error(`An error occured while trying to create a spell source with uuid: ${e}`);return t&&(0,u.setFlagProperty)(n,"identifier",t),_.isNumber(r)&&(0,u.setFlagProperty)(n,"rank",r),n},getSpellWithRankLabel:(e,t)=>`${fromUuidSync(e)?.name??""} (${(0,u.getRankLabel)(t)})`};function ls(e,t=!1){return _.pipe(CONFIG.PF2E[e],_.toPairs.strict,_.map(([r,n])=>({value:r,label:n})))}i(ls,"configToOptions");async function wf(e,{uuid:t,level:r,itemName:n,itemImg:a}){let s=await fromUuid(t);if(!s?.isOfType("spell"))throw new Error(`An error occured while trying to create a spell scroll source with uuid: ${t}`);return(0,u.createConsumableFromSpell)(s,{type:e,heightenedLevel:r,temp:!0,itemName:n,itemImg:a})}i(wf,"createSpellConsumableSource");function dS(e){return e==="half"?"max(1,floor(@actor.level/2))":e==="level"?"max(1,@actor.level)":e}i(dS,"simplifyRuleValue");var Ef="Compendium.pf2e.feats-srd.Item.WoLh16gyDp8y9WOZ",Tf="Compendium.pf2e.feats-srd.Item.vfuHVSuExvtyajkW",Df={key:"ancestral-longevity",items:[{slug:"trained",uuid:Ef,required:!0},{slug:"expert",uuid:Tf}],label:(e,t)=>t.trained.name,rows:(e,t)=>{let r=O.getSkills(),n=e.skills;return[{slug:"trained",type:"combo",label:"PF2E.ProficiencyLevel1",unique:"skill-1",options:r.filter(({value:a})=>n[a].rank===0)},{slug:"expert",type:"combo",label:"PF2E.ProficiencyLevel2",unique:"skill-2",options:r.filter(({value:a})=>n[a].rank===1),condition:!!t.expert}]},process:({items:e,rows:t,messages:r,addItem:n,addRule:a,removeRule:s})=>{let o=[["trained",1,Ef],["expert",2,Tf]];for(let[l,f,c]of o){let d=t[l],m=e[l];if(!d||!m)continue;s(m,()=>!0);let b=d.selected;if(d.input){let v=O.createLoreSource({name:b,rank:f});n(v)}else{let v=b,h=O.createSkillRuleElement({skill:v,value:f});b=O.getSkillLabel(v),a(m,h)}r.add("skills",{uuid:c,selected:b})}}};var pS="Compendium.pf2e.classfeatures.Item.EtltLdiy9kNfHU0c",Ff={key:"blade-ally",items:[{slug:"blade",uuid:pS,required:!0},{slug:"good",uuid:"Compendium.pf2e.classfeatures.Item.nxZYP3KGfTSkaW6J"},{slug:"evil",uuid:"Compendium.pf2e.classfeatures.Item.JiY2ZB4FkK8RJm4T"},{slug:"spirit",uuid:"Compendium.pf2e.feats-srd.Item.h5ksUZlrVGBjq6p4"},{slug:"master",uuid:"Compendium.pf2e.feats-srd.Item.jYEMVfrXJLpXS6aC"}],label:(e,t)=>t.blade.name,rows:(e,t)=>{let r=e.itemTypes.weapon.filter(o=>!o.isAlchemical);if(!r.length)return[];let n=e.traits.has("holy"),a=e.traits.has("unholy"),s=[];return s.push("returning","shifting"),t.spirit&&(s.push("flaming"),n&&s.push("holy"),a&&s.push("unholy")),t.master&&s.push("dancing","greaterDisrupting","keen"),t.good&&s.push("ghostTouch","disrupting"),t.evil&&s.push("fearsome"),[{type:"select",slug:"weapon",label:"TYPES.Item.weapon",options:r.map(o=>({value:o.id,label:o.name}))},{type:"select",slug:"rune",label:(0,u.localizePath)("label.rune"),options:_.pipe(s,_.map(o=>({value:o,label:O.getWeaponPropertyRuneLabel(o)})),_.sortBy([_.prop("label"),"asc"]))}]},process:({actor:e,rows:t,messages:r,addRule:n})=>{let a=t.weapon,s=t.rune,o=e.items.get(a);if(!o)return;let l=[{or:["item:category:{item|_id}","item:id:{item|_id}"]}];n(o,{key:"AdjustStrike",definition:l,mode:"add",property:"property-runes",value:s}),n(o,{key:"CriticalSpecialization",predicate:l});let f=o.name!==o._source.name?`... ${o._source.name}`:o.name;r.add("blade",{uuid:o.uuid,label:f,selected:O.getWeaponPropertyRuneLabel(s)})}};var mS="systems/pf2e/icons/equipment/weapons/wish-knife.webp",yS="Compendium.pf2e.feats-srd.Item.78pkCdFaY8hI07Lj",Cf={key:"ceremonial-knife",condition:e=>e.itemTypes.weapon.some(t=>t.group==="knife"),items:[{slug:"ceremonial",uuid:yS,required:!0}],label:(e,t)=>t.ceremonial.name,prepare:e=>{let t=Math.ceil((e.level-5)/2);return{rank:Math.max(t,1)}},rows:(e,t,r)=>[{type:"drop",slug:"spell",filter:{type:"spell",search:{category:["spell"],rank:r.rank}}}],process:async({items:e,rows:t,custom:r,messages:n,addItem:a})=>{let s=t.spell.uuid,o=r.rank,l=O.getSpellWithRankLabel(s,o),f=await O.createWandSource({uuid:s,level:o,itemImg:mS,itemName:e.ceremonial.name});a(f),n.add("ceremonial",{uuid:s,label:l})}};var gS="Compendium.pf2e.classfeatures.Item.8g6HzARbhfcgilP8",hS="Compendium.pf2e.classfeatures.Item.W2rwudMNcAxs8VoX",Lf={key:"combat-flexibility",items:[{slug:"combat",uuid:gS,required:!0},{slug:"improved",uuid:hS}],label:(e,t)=>t.combat.name,rows:(e,t)=>[{type:"drop",slug:"combat",label:"PF2E.Level8",filter:{type:"feat",search:{category:["class"],traits:["fighter"],level:8}}},{type:"drop",slug:"improved",label:"PF2E.Level14",filter:{type:"feat",search:{category:["class"],traits:["fighter"],level:14}},condition:!!t.improved}],process:async({items:e,rows:t,messages:r,addFeat:n})=>{let a=await O.createFeatSource(t.combat.uuid);if(n(a,e.combat),r.add("feats",{uuid:t.combat.uuid}),t.improved){let s=await O.createFeatSource(t.improved.uuid);n(s,e.improved),r.add("feats",{uuid:t.improved.uuid})}}};var qf={key:"experimental-spellshaping",items:[{slug:"experimental",uuid:"Compendium.pf2e.classfeatures.Item.89zWKD2CN7nRu2xp",required:!0,condition:e=>e.level>=4}],label:(e,t)=>t.experimental.name,rows:()=>[{slug:"feat",type:"drop",filter:{type:"feat",search:{category:["class"],traits:["spellshape","wizard"],level:"half"}}}],process:async({rows:e,items:t,messages:r,addFeat:n})=>{let a=e.feat.uuid,s=await O.createFeatSource(a);n(s,t.experimental),r.add("feats",{uuid:a})}};function kf(){return game.packs.get("pf2e.familiar-abilities")}i(kf,"getPack");function cs(e){let t=e.attributes.familiarAbilities.value,r=(0,u.getFlag)(e,"familiar");if(!r)return t;if(r.max===t)return r.value;let n=r.value-(r.max-t);return Math.clamped(n,0,t)}i(cs,"getFamiliarAbilityCount");var Af={key:"familiar",condition:e=>!!e.familiar,rows:async e=>{let t=cs(e);if(!t)return[];let r=kf(),n=randomID(),a=r.index.map(({_id:o,name:l})=>({value:o,label:l})),s=(0,u.getSetting)("familiarAbilities").split(",");for(let o of s){o=o.trim();let l=await fromUuid(o);l?.isOfType("action")&&a.push({value:o,label:l.name})}return a.sort((o,l)=>(0,u.localeCompare)(o.label,l.label)),_.range(1,t+1).map(o=>({type:"select",slug:`ability${o}`,label:(0,u.localize)("label.ability",{nb:o}),unique:n,order:100,options:a}))},process:async({actor:e,rows:t,messages:r})=>{let n=e.familiar;if(!n)return;let a=kf(),s=[],o=[];if(await Promise.all(Object.values(t).map(async l=>{let c=await(l.includes(".")?fromUuid(l):a.getDocument(l));if(!c?.isOfType("action"))return;let d=c.toObject();(0,u.setFlagProperty)(d,"temporary",!0),s.push(d),o.push({uuid:c})})),s.length){await n.createEmbeddedDocuments("Item",s);for(let l of o)r.add("familiar",l)}},rest:async({actor:e})=>{let t=e.familiar;if(!t)return;let r=t.itemTypes.action.filter(n=>ht(n)).map(n=>n.id);r.length&&await t.deleteEmbeddedDocuments("Item",r)}};function Li(e,t){return{key:e,items:[{slug:"item",uuid:t,required:!0}],label:(r,n)=>n.item.name,rows:r=>{let n=O.getLanguages(),a=r.system.details.languages.value;return[{type:"select",slug:"language",options:n.filter(({value:o})=>!a.includes(o))}]},process:({rows:r,items:n,messages:a,addRule:s})=>{let o=r.language,l=O.createLanguageRuleElement({language:o});s(n.item,l),a.add("languages",{uuid:t,selected:O.getLanguageLabel(o)})}}}i(Li,"createLanguageDaily");var xf="Compendium.pf2e.feats-srd.Item.juikoiIA0Jy8PboY",Rf="Compendium.pf2e.feats-srd.Item.PccekOihIbRWdDky",jf="Compendium.pf2e.feats-srd.Item.8KUvJuAWCoxWg5FH",zf="Compendium.pf2e.feats-srd.Item.2uQbQgz1AbjzcFSp",Nf="Compendium.pf2e.feats-srd.Item.fgnfXwFcn9jZlXGD",fs="mind-weapon",Hf=[{die:"d4",traits:["finesse","agile"],usage:"held-in-one-hand"},{die:"d6",traits:["finesse"],usage:"held-in-one-hand"},{die:"d8",traits:[],usage:"held-in-one-hand"},{die:"d10",traits:["reach"],usage:"held-in-two-hands"}],ds={slashing:"sword",bludgeoning:"club",piercing:"spear"},vS=["grapple","modular","nonlethal","shove","trip"],bS=["cold-iron","silver"],_S=["corrosive","disrupting","flaming","frost","shock","thundering"],SS=["greaterCorrosive","greaterDisrupting","greaterFlaming","greaterFrost","greaterShock","greaterThundering","holy","unholy"];async function PS(e){let t=(0,u.subLocalize)("dialog.mind-weapon"),r=Hf.map(({die:m,traits:b,usage:v},h)=>{let S=h===1?"checked":"",M=t("label",{die:m,hand:t(v),hasTrait:b.length?t(b.length===1?"oneTrait":"twoTraits",{trait1:O.getWeaponTraitLabel(b[0]),trait2:b[1]?O.getWeaponTraitLabel(b[1]):""}):""});return`<label>
            <input type="radio" name="type" value="${h}" ${S}>
            ${M}
        </label>`}),n=`<div class="flavor">${t("flavor")}</div>`,a=_.pipe(_.range(0,5),_.map(m=>{let b=m?O.getWeaponPotencyRuneLabel(m):"";return`<option value="${m}">${b}</option>`})),s=`<label class="runes">
        ${game.i18n.localize("PF2E.PotencyRuneLabel")}
        <select name="rune">
            ${a.join("")}
        </select>
    </label>`,o=await Dialog.wait({title:t("title"),content:n+r.join("")+s,buttons:{yes:{icon:'<i class="fas fa-save"></i>',label:t("yes"),callback:m=>{let b=(0,u.htmlElement)(m),v=(0,u.querySelector)(b,"input[name='type']:checked"),h=(0,u.querySelector)(b,"select[name='rune']");return{type:Number(v.value),rune:Number(h.value)}}},no:{icon:'<i class="fas fa-times"></i>',label:t("no"),callback:()=>null}},close:()=>null},{id:"pf2e-dailies-weapon",width:600});if(o===null)return!1;let{die:l,traits:f,usage:c}=Hf[o.type],d={type:"weapon",name:(0,u.localize)("mindsmith.weapon.name"),img:"systems/pf2e/icons/spells/disrupting-weapons.webp",system:{slug:fs,level:{value:e.level},category:"martial",damage:{damageType:"slashing",die:l,dice:1},traits:{value:f},usage:{value:c},runes:{potency:o.rune}}};return await e.createEmbeddedDocuments("Item",[d]),!0}i(PS,"createMindWeapon");function Bf(e){let t=O.getWeaponDamageLabel(e);return`${O.getWeaponGroupLabel(ds[e])} (${t})`}i(Bf,"damageLabel");var $f={key:"mind-smith",items:[{slug:"mind",uuid:xf,required:!0},{slug:"mental",uuid:Rf},{slug:"metallic",uuid:jf},{slug:"runic",uuid:zf},{slug:"advanced",uuid:Nf}],label:(e,t)=>t.mind.name,rows:(e,t)=>{let r=e.itemTypes.weapon.find(f=>f.slug===fs);if(!r)return[{type:"alert",slug:"alert",message:(0,u.localize)("interface.mindsmith.missing"),resolve:()=>PS(e)}];let n=i(f=>(0,u.localize)("label.select",{that:game.i18n.localize(f)}),"selectThat"),a=i((f,c,d)=>f?_.pipe(c,_.map.strict(m=>({value:m,label:d(m)})),_.sortBy([_.prop("label"),"asc"])):[],"arrayToOptions"),s=randomID(),o=a(!!t.mental,vS,O.getWeaponTraitLabel),l=(!!t.runic||!!t.advanced)&&O.hasFreePropertySlot(r);return[{type:"select",slug:"damage",label:n("PF2E.WeaponGroupLabel"),options:_.pipe(_.keys.strict(ds),_.map(f=>({value:f,label:Bf(f)})),_.sortBy([_.prop("label"),"asc"]))},{type:"select",slug:"trait1",label:"PF2E.NPC.AddTrait",options:o,unique:s,condition:!!t.mental},{type:"select",slug:"trait2",label:"PF2E.NPC.AddTrait",options:o,unique:s,condition:!!t.mental},{type:"select",slug:"material",label:"PF2E.PreciousMaterialLabel",options:a(!!t.metallic,bS,O.getPreciousMaterialLabel),condition:!!t.metallic},{type:"select",slug:"rune",label:(0,u.localizePath)("label.rune"),options:a(l,t.advanced?SS:_S,O.getWeaponPropertyRuneLabel),condition:l}]},process:({actor:e,items:t,rows:r,messages:n,updateItem:a,addRule:s})=>{let o=e.itemTypes.weapon.find(d=>d.slug===fs);if(!o)return;let l=r.damage;a({_id:o.id,"system.damage.damageType":l,"system.group":ds[l]}),n.add("mindsmith",{uuid:xf,label:(0,u.localize)("label.mind-smith"),selected:Bf(l)});let f=[{or:["item:category:{item|_id}","item:id:{item|_id}"]}],c=_.pipe([1,2],_.map(d=>r[`trait${d}`]),_.compact);for(let d of c)s(o,{key:"ItemAlteration",itemType:"weapon",mode:"add",property:"traits",predicate:f,value:d});if(c.length&&n.add("mindsmith",{uuid:Rf,label:(0,u.localize)("label.mind-mental"),selected:c.map(O.getWeaponTraitLabel).join(" & ")}),r.material){let d=r.material;s(o,{key:"ItemAlteration",itemType:"weapon",mode:"override",property:"material-type",predicate:f,value:d}),n.add("mindsmith",{uuid:jf,selected:O.getPreciousMaterialLabel(d)})}if(r.rune&&O.hasFreePropertySlot(o)){let d=r.rune;s(o,{key:"AdjustStrike",definition:f,mode:"add",property:"property-runes",value:r.rune}),n.add("mindsmith",{uuid:t.advanced?Nf:zf,label:(0,u.localize)("label.mind-runic"),selected:O.getWeaponPropertyRuneLabel(d)})}}};var Wf="Compendium.pf2e.equipment-srd.Item.L9ZV076913otGtiB",Uf={key:"rations",items:[{slug:"rations",uuid:Wf,required:!0}],label:(e,t)=>t.rations.name,rows:(e,t)=>{let r=t.rations,{value:n,max:a}=r.uses,s=(r.quantity-1)*a+n,o=s<=1;return[{slug:"rations",type:"select",order:200,save:!1,options:[{value:"false",label:(0,u.localize)("interface.rations.no")},{value:"true",label:o?(0,u.localize)("interface.rations.last"):(0,u.localize)("interface.rations.yes",{nb:s})}]}]},process:({rows:e,items:t,messages:r,updateItem:n,deleteItem:a})=>{if(e.rations!=="true")return;let s=t.rations,{value:o,max:l}=s.uses,f=s.quantity;o>1?n({_id:s.id,"system.uses.value":--o}):f>1?n({_id:s.id,"system.quantity":--f,"system.uses.value":o=l}):(a(s),f=0,o=0);let c=(f-1)*l+o,d=O.createChatLink(Wf,s.name),m=c<1?(0,u.localize)("message.rations.last",{name:d}):c<3?(0,u.localize)("message.rations.almost",{name:d,nb:c}):(0,u.localize)("message.rations.used",{name:d,nb:c});r.addRaw(m,200)}};function qi(e,t,r,n,a=!1){return{key:e,items:[{slug:"item",uuid:t,required:!0}],label:(s,o)=>o.item.name,rows:()=>{let s=r.map(o=>({value:o,label:O.getResistanceLabel(o,!0)}));return[{type:a?"random":"select",slug:"resistance",options:s}]},process:({rows:s,items:o,messages:l,addRule:f})=>{let c=O.createResistanceRuleElement({type:s.resistance,value:n});f(o.item,c),l.add("resistances",{uuid:t,selected:O.getResistanceLabel(s.resistance),random:a})}}}i(qi,"createResistanceDaily");var OS="Compendium.pf2e.feats-srd.Item.22P7IFyhrF7Fbw8B",MS="Compendium.pf2e.feat-effects.Item.jO7wMhnjT7yoAtQg",Gf={key:"root-magic",items:[{slug:"root",uuid:OS,required:!0}],label:(e,t)=>t.root.name,rows:e=>[{type:"select",slug:"target",options:O.getActors(e).map(t=>({value:t.id,label:t.name}))}],process:({rows:e,messages:t})=>{let r=game.actors.get(e.target);r&&t.add("root",{uuid:MS,selected:r.name})}};var IS="Compendium.pf2e.feats-srd.Item.u5DBg0LrBUKP0JsJ",Vf={key:"scroll-adept",items:[{slug:"adept",uuid:IS,required:!0}],label:(e,t)=>t.adept.name,prepare:e=>{let t=O.getSpellcastingMaxRank(e,{tradition:"arcane"}),r=e.system.proficiencies.spellcasting.rank;return{ranks:_.pipe(_.range(2,Math.clamped(r,2,4)+2),_.map(a=>{let s=t-a;return{rank:s,row:`rank${s}`}}),_.filter(({rank:a})=>a>0))}},rows:(e,t,r)=>r.ranks.map(({rank:n,row:a})=>({slug:a,type:"drop",label:O.getSpellRankLabel(n),filter:{type:"spell",search:{category:["spell"],traditions:["arcane"],rank:n}}})),process:async({rows:e,custom:t,messages:r,addItem:n})=>{for(let a of t.ranks){let{uuid:s}=e[a.row];if(!s)continue;let o=O.getSpellWithRankLabel(s,a.rank),l=await O.createSpellScrollSource({uuid:s,level:a.rank});n(l),r.add("scrolls",{uuid:s,label:o})}}};function ki(e,t){return{key:e,items:[{slug:"trained",uuid:t[0],required:!0},{slug:"expert",uuid:t[1]},{slug:"master",uuid:t[2]}],label:(r,n)=>n.trained.name,rows:(r,n)=>{let a=r.level,s=[1];return a>=8&&s.push(2),n.expert&&(s.push(3),a>=14&&s.push(4),a>=16&&s.push(5)),n.master&&(s.push(6),a>=20&&s.push(7)),s.map(o=>({type:"drop",slug:`rank${o}`,label:O.getSpellRankLabel(o),filter:{type:"spell",search:{category:["spell"],rank:o,rarity:["common"]}}}))},process:async({rows:r,messages:n,addItem:a})=>{for(let s of _.range(1,8)){let{uuid:o}=r[`rank${s}`]??{};if(!o)continue;let l=O.getSpellWithRankLabel(o,s),f=await O.createSpellScrollSource({uuid:o,level:s});a(f),n.add("scrolls",{uuid:o,label:l})}}}}i(ki,"createScrollChainDaily");function _r(e,t,{rank:r=1,removeRules:n=!0}={}){return{key:e,items:[{slug:"item",uuid:t,required:!0}],label:(a,s)=>s.item.name,rows:a=>{let s=O.getSkills(),o=a.skills,l=s.filter(({value:f})=>o[f].rank===r-1);return[{slug:"skill",type:"combo",label:"PF2E.ProficiencyLevel1",unique:`skill-${r}`,options:l}]},process:({rows:a,items:s,messages:o,addItem:l,addRule:f,removeRule:c})=>{let d=a.skill.selected;if(n&&c(s.item,()=>!0),a.skill.input){let m=O.createLoreSource({name:d,rank:r});l(m)}else{let m=d,b=O.createSkillRuleElement({skill:m,value:r});d=O.getSkillLabel(m),f(s.item,b)}o.add("skills",{uuid:t,selected:d})}}}i(_r,"createComboSkillDaily");function ps(e,t){return{key:e,items:[{slug:"item",uuid:t,required:!0}],label:(r,n)=>n.item.name,rows:()=>[{type:"input",slug:"lore"}],process:({rows:r,messages:n,addItem:a})=>{let s=O.createLoreSource({name:r.lore,rank:1});a(s),n.add("skills",{uuid:t,selected:r.lore})}}}i(ps,"createLoreSkillDaily");var wS="Compendium.pf2e.feats-srd.Item.NV9H39kbkbjhAK6X",ES="Compendium.pf2e.classfeatures.Item.Klb35AwlkNrq1gpB",TS=/@(uuid|compendium)\[([a-z0-9\._-]+)\]/gi,DS=/\d+/;function Ai(e){let t=e.isOfType("weapon")?"magical":"coda",r=e.system.traits?.value;return r?.includes("staff")&&r.includes(t)}i(Ai,"isStaff");function FS(e){return[...e.itemTypes.weapon.filter(Ai),...e.itemTypes.equipment.filter(Ai)]}i(FS,"getStaves");function ms(e){return e.itemTypes.weapon.some(Ai)||e.itemTypes.equipment.some(Ai)}i(ms,"hasStaves");var Kf={key:"staves",condition:e=>ms(e),prepare:e=>{let t=e.spellcasting.spellcastingFeatures,r=0,n=O.getActorMaxRank(e),a=e.getStatistic("kineticist")&&(0,u.hasItemWithSourceId)(e,wS,"feat")?"kineticist":void 0;if(a?r=Math.max(r,n):r=_.pipe(t,_.map(o=>o.highestRank),_.firstBy([_.identity,"desc"]))??0,r>n&&(r=n),!r)return{};let s={};for(let o of t.filter(l=>l.isPrepared)){let l=o.id,f=o.isFlexible;for(let c=1;c<=10;c++){let d=`slot${c}`,m=o.system.slots[d];if(!(m.max<1))if(f){if(m.value<1)continue;s[l]??={id:l,name:o.name,slots:[]},s[l].slots.push({rank:c,value:m.value,max:m.max})}else for(let[b,{id:v,expended:h}]of Object.entries(m.prepared)){if(h)continue;let S=o.spells?.get(v);s[l]??={id:l,name:o.name,spells:[]},s[l].spells.push({name:S?.name,rank:c,index:Number(b)})}}s[l]?.spells?.sort((c,d)=>c.rank-d.rank)}return{entries:t,maxCharges:r,preparedEntries:s,activationType:a}},rows:(e,t,r)=>{if(!r.entries)return[];let a={type:"select",slug:"staff",label:"PF2E.Weapon.Base.staff",options:FS(e).map(h=>({value:h.id,label:h.name}))},s=Object.values(r.preparedEntries);if(!s.length)return[a];let o=e.level,l=o>=8&&(0,u.hasItemWithSourceId)(e,ES,"feat"),f=[{value:"",label:""}],c=(0,u.localize)("interface.staves.flexible"),d=(0,u.localize)("interface.staves.empty"),m=l?o>=16?3:2:1;for(let h of Object.values(s))if(f.push({group:h.name}),"slots"in h)for(let S=0;S<h.slots.length;S++){let M=h.slots[S],E=O.getSpellRankLabel(M.rank),F=`${h.id}.slots.${S}`,C={value:F,label:`${c} ${M.value}/${M.max} (${E})`};M.value>=m?C.skipUnique=!0:C.unique=F,f.push(C)}else for(let S=0;S<h.spells.length;S++){let M=h.spells[S],E=M.name??d,F=`${h.id}.spells.${S}`,C=O.getSpellRankLabel(M.rank);f.push({value:F,label:`${E} (${C})`,unique:F})}let b=randomID(),v=_.range(1,m+1).map(h=>({type:"select",slug:`expend${h}`,save:!1,empty:!0,label:(0,u.localize)("label.expend",{nb:h}),unique:b,options:f}));return v.unshift(a),v},process:async({actor:e,rows:t,custom:r,messages:n,updateItem:a,setExtraFlags:s})=>{let o=e.inventory.get(t.staff);if(!r.entries||!o)return;let f=(0,u.createHTMLFromString)(o.description).querySelectorAll("ul");if(!f.length)return;let c=(0,u.querySelectorArray)(f[f.length-1],"li"),d=_.pipe(c,_.flatMap(q=>{let I=q.firstChild,w=Number(I.textContent?.match(DS)?.[0]||"0");return Array.from(q.textContent.matchAll(TS)).map(D=>D[1]==="Compendium"?`Compendium.${D[2]}`:D[2]).map(D=>({rank:w,uuid:D}))}),_.filter(({rank:q})=>q<=r.maxCharges)),m=_.compact(await Promise.all(d.map(async({rank:q,uuid:I})=>{let w=await fromUuid(I);if(w?.isOfType("spell"))return mergeObject(w._source,{_id:randomID(),system:{location:{value:null,heightenedLevel:q}}},{inplace:!1})})));if(!m.length)return;let b=0,v=e.spellcasting,h=r.preparedEntries,S=(0,u.localize)("interface.staves.flexible"),M=(0,u.localize)("interface.staves.empty"),E=[],F={},C=_.pipe(t,_.omit(["staff"]),_.values,_.compact);for(let q of C){let I=q?.split(".")[0],w=v.get(I),L=getProperty(h,q);if(!w||!L)continue;let D=L.rank,T=w._source.system.slots[`slot${D}`];if("max"in L){if(T.max<1||T.value<1)continue;F[I]??={},F[I][D]??=T.value;let R=F[I][D];if(R<1)continue;b+=D,F[I][D]-=1,a({_id:I,[`system.slots.slot${D}.value`]:R-1}),E.push({name:S,rank:D})}else{let R=deepClone(T.prepared),G=R[L.index];if(T.max<1||G.expended)continue;b+=D,G.expended=!0,a({_id:I,[`system.slots.slot${D}.prepared`]:R});let ee=e.items.get(G.id);E.push({uuid:ee?.uuid,name:ee?.name??M,rank:D})}}let N={staffId:o.id,charges:{value:r.maxCharges+b,max:r.maxCharges+b},expended:E.length>0,spells:m};if(r.activationType){let q=e.synthetics.statistics.get("impulse")??e.synthetics.statistics.get("kinetic-activation");q&&(N.statistic={slug:q.slug,tradition:"primal"})}s({staffData:N}),n.addGroup("staff",void 0,45),n.add("staff",{uuid:o.uuid});for(let{name:q,rank:I,uuid:w}of E){let L=O.getSpellRankLabel(I),D=`${q} (${L})`;n.add("staff",{uuid:w,label:w?D:`<span class="fake-link">
                    <i class='fa-solid fa-sparkles'></i>
                    ${D}
                </span>`})}}},xi=class{static{i(this,"StaffSpellcasting")}id;name;actor;statistic;tradition;castPredicate;staff;constructor({id:t,name:r,actor:n,statistic:a,tradition:s,castPredicate:o},l){this.id=t,this.name=r,this.actor=n,this.statistic=a,this.tradition=s??null,this.castPredicate=new game.pf2e.Predicate(o),this.staff=l}get counteraction(){return(0,u.createCounteractStatistic)(this)}get attribute(){return this.statistic.attribute??"cha"}get category(){return"charges"}get sort(){return Math.max(0,...this.actor.itemTypes.spellcastingEntry.map(t=>t.sort))+10}get spells(){return null}get isFlexible(){return!1}get isFocusPool(){return!1}get isInnate(){return!1}get isPrepared(){return!1}get isSpontaneous(){return!1}get isRitual(){return!1}get isEphemeral(){return!0}canCast(t){if(this.actor!==t.actor)return!1;let r=new Set([...this.staff.getRollOptions("item"),...t.getRollOptions("spell",{includeVariants:!0})]);return this.castPredicate.test(r)}async cast(t,r={}){let n=this.actor,a=t.rank,s=t.isCantrip||Sr(n,a),o=ce(this.actor);if(!o||s===null){(0,u.error)("staves.error.missing");return}let l=n.inventory.get(o.staffId);if(!l.isEquipped){(0,u.warn)("staves.error.notEquipped",{staff:l.name});return}if(!s){(0,u.warn)("charges.error.notEnough",{spell:t.name,rank:(0,u.getRankLabel)(a)});return}if(!o||r.message===!1||!this.canCast(t))return;if(t.isCantrip){t.toMessage(null,{rollMode:r.rollMode,data:{castRank:t.rank}});return}let f=o.charges.value,c=f<a,d=!1;if(!o.expended){let b=Math.min(r.spontaneous?.rank??a,a),v=(0,u.getActorMaxRank)(n),h=_.range(b,v+1),S=_.pipe(n.spellcasting.filter(M=>M.isSpontaneous&&(!r.spontaneous||r.spontaneous.entryId===M.id)),_.map(M=>({id:M.id,name:M.name,slots:_.pipe(h,_.filter(E=>{let F=M.system.slots[`slot${E}`];return F.max>0&&F.value>0}),_.map(E=>{let F=`slot${E}`;return{key:F,rank:(0,u.getRankLabel)(E),value:M.system.slots[F].value}}))})),_.filter(M=>M.slots.length>0));if(S.length&&r.spontaneous)d={entry:S[0].id,slot:S[0].slots[0].key};else if(S.length){let M=(0,u.subLocalize)("staves.spontaneous"),E=S.length>1,F=M(c?"must":"would",{rank:(0,u.getRankLabel)(a),higher:S.some(N=>N.slots.length>1)?M("higher"):"",from:M(E?"multi":"one",{entry:S[0].name})}),C=i(N=>{let q=(0,u.querySelector)((0,u.htmlElement)(N),"[name=entry]:checked");return(0,u.elementData)(q)},"callback");if(d=await(0,u.waitDialog)({title:M("title"),template:"spontaneous",default:"no",yes:{label:game.i18n.localize("Yes"),callback:C},no:{label:game.i18n.localize(c?"Cancel":"No"),callback:()=>!1},data:{hint:F,entries:S,multiEntries:E,i18n:M.i18n}}),d===null)return}d&&(f=ce(n)?.charges.value??0,c=f<a)}let m=d?n.spellcasting.get(d.entry)?.system.slots[d.slot].value:void 0;f<1||c&&!m||(m&&d&&await n.updateEmbeddedDocuments("Item",[{_id:d.entry,[`system.slots.${d.slot}.value`]:m-1}]),await Ae(n,m?f-1:f-a),t.toMessage(null,{rollMode:r.rollMode,data:{castRank:t.rank}}))}async getSheetData({spells:t}={}){let r=this.actor;if(!r?.isOfType("character","npc"))throw(0,u.ErrorPF2e)("Spellcasting entries can only exist on characters and npcs");let n=Math.max(1,Math.ceil(r.level/2)),a=_.pipe(Array.from(t?.values()??[]),_.groupBy.strict(s=>s.isCantrip?0:s.rank),_.toPairs.strict,_.sortBy(s=>s[0]),_.map(([s,o])=>(s=Number(s),{id:s===0?"cantrips":s,label:s===0?"PF2E.Actor.Creature.Spellcasting.Cantrips":(0,u.getRankLabel)(s),maxRank:s===0?n:s,number:s,active:o.map(l=>({spell:l,expended:!Sr(r,s)}))})));return{..._.pick(this,["category","tradition","sort","isFlexible","isFocusPool","isInnate","isPrepared","isRitual","isSpontaneous","isEphemeral"]),groups:a,prepList:null,id:t?.id??this.id,name:t?.name??this.name,statistic:this.statistic.getChatData(),attribute:this.statistic.attribute,hasCollection:!!t?.size,usesSpellProficiency:!1,isCharges:!0,isStaff:!0,uses:ce(r)?.charges??{value:0,max:0}}}};var Yf="Compendium.pf2e.classfeatures.Item.MyN1cQgE0HsLF20e";function ys(e,t){let r=O.getChoiSetRuleSelection(t);return e.items.get(r)?.sourceId===Yf}i(ys,"itemCondition");var Zf={key:"thaumaturge-tome",items:[{slug:"tome",uuid:Yf,required:!0},{slug:"adept",uuid:"Compendium.pf2e.classfeatures.Item.Obm4ItMIIr0whYeO",condition:ys},{slug:"second",uuid:"Compendium.pf2e.classfeatures.Item.ZEUxZ4Ta1kDPHiq5",condition:ys},{slug:"intense",uuid:"Compendium.pf2e.feats-srd.Item.yRRM1dsY6jakEMaC"},{slug:"paragon",uuid:"Compendium.pf2e.classfeatures.Item.QEtgbY8N2V4wTbsI",condition:ys}],prepare:(e,t)=>{let r=e.level,n=e.skills,a=O.getSkills(),s={first:{options:[],label:"",rank:1},second:{options:[],label:"",rank:1}},o=i((l,f)=>{let c=a.filter(({value:d})=>n[d].rank<l);s.first={rank:l,label:O.getProficiencyLabel(l),options:c},s.second={rank:f,label:O.getProficiencyLabel(f),options:l===f?c:a.filter(({value:d})=>n[d].rank<f)}},"setCustom");return t.paragon?o(4,4):t.intense||t.adept||t.second?r>=9?o(3,3):o(2,3):r>=5?o(2,2):r>=3?o(1,2):o(1,1),s},rows:(e,t,r)=>[{type:"combo",slug:"first",label:O.getProficiencyLabel(r.first.rank),unique:`skill-${r.first.rank}`,options:r.first.options},{type:"combo",slug:"second",label:O.getProficiencyLabel(r.second.rank),unique:`skill-${r.second.rank}`,options:r.second.options}],process:({items:e,rows:t,custom:r,messages:n,addItem:a,addRule:s})=>{n.addGroup("tome",void 0,65);for(let o of["first","second"]){let l=r[o].rank,f=t[o].selected;if(t[o].input){let c=O.createLoreSource({name:f,rank:l});a(c)}else{let c=f,d=O.createSkillRuleElement({skill:c,value:l});f=O.getSkillLabel(c),s(e.tome,d)}n.add("tome",{label:r[o].label,selected:f})}}};var Qf={key:"trickster-ace",items:[{slug:"ace",uuid:"Compendium.pf2e.feats-srd.Item.POrE3ZgBRdBL9MsW",required:!0}],label:(e,t)=>t.ace.name,rows:()=>[{type:"drop",slug:"spell",note:(0,u.localize)("interface.drop.notes.ace"),onDrop:e=>!0,filter:{type:"spell",search:{rank:4}}}],process:async({actor:e,items:t,rows:r,messages:n,addItem:a})=>{let s=randomID(),o=r.spell.uuid,l=e.classDC,f=await O.createSpellSource(o,{identifier:s}),c=O.createSpellcastingEntrySource({category:"innate",identifier:s,name:t.ace.name,tradition:f.system.traits.traditions[0],proficiencyRank:l?.rank,attribute:l?.attribute,proficiencySlug:l?.slug});a(c),a(f),n.add("spells",{uuid:o})}};var we="3.0.0",CS=[Uf,Af,Kf,qf,Df,Lf,Vf,Gf,Cf,Qf,Zf,Ff,$f,ps("quick-study","Compendium.pf2e.feats-srd.Item.aLJsBBZzlUK3G8MW"),_r("ageless-spirit","Compendium.pf2e.feats-srd.Item.wylnETwIz32Au46y"),_r("ancient-memories","Compendium.pf2e.feats-srd.Item.ptEOt3lqjxUnAW62"),_r("flexible-studies","Compendium.pf2e.feats-srd.Item.9bgl6qYWKHzqWZj0"),Li("ancestral-linguistics","Compendium.pf2e.feats-srd.Item.eCWQU16hRLfN1KaX"),Li("borts-blesing","Compendium.pf2e.equipment-srd.Item.iS7hAQMAaThHYE8g"),qi("elementalist","Compendium.pf2e.feats-srd.Item.tx9pkrpmtqe4FnvS",["air","earth","fire","water"],"half"),qi("ganzi","Compendium.pf2e.heritages.Item.3reGfXH0S82hM7Gp",["acid","electricity","sonic"],"half",!0),ki("esoterica",["Compendium.pf2e.feats-srd.Item.OqObuRB8oVSAEKFR","Compendium.pf2e.feats-srd.Item.nWd7m0yRcIEVUy7O","Compendium.pf2e.feats-srd.Item.LHjPTV5vP3MOsPPJ"]),ki("trickster",["Compendium.pf2e.feats-srd.Item.ROAUR1GhC19Pjk9C","Compendium.pf2e.feats-srd.Item.UrOj9TROtn8nuxPf","Compendium.pf2e.feats-srd.Item.lIg5Gzz7W70jfbk1"])],Jf=new Map,Xf=[],Ri=new Map,ed=[];function td(e,t){let r=new Map,n=[];for(let a of e){let s=a.key;try{let o=`${t}.${s}`,l=deepClone(a);l.key=o,l.items??=[],l.condition&&(!l.items.length||!l.items.some(f=>f.required))&&n.push(l);for(let f=0;f<l.items.length;f++){let{uuid:c,condition:d}=l.items[f];r.set(c,{daily:l,index:f,condition:d})}}catch(o){(0,u.error)("error.unexpected"),console.error(o),console.error(`The error occured during data gathering of ${t}.${s}`)}}return{uuids:r,always:n}}i(td,"prepareDailies");async function gs(e){try{let r=await new u.AsyncFunction("utils","createDaily","createComboSkillDaily","createLoreSkillDaily","createLanguageDaily","createResistanceDaily","createScrollChainDaily",e.code)(O,V,_r,ps,Li,qi,ki);if(typeof r.key=="string"&&r.key.trim()&&typeof r.rows=="function"&&typeof r.process=="function"&&(typeof r.condition=="function"||Array.isArray(r.items)))return r}catch(t){(0,u.error)("error.unexpected"),console.error(t),console.error(`The error occured during creation of custom daily for ${e.key}`)}}i(gs,"parseCustomDaily");async function hs(){Ri.clear();let e=[],t=(0,u.getSetting)("customDailies");for(let a of t){if(isNewerVersion(we,a.schema??""))continue;let s=await gs(a);s&&e.push(s)}for(let[a,s]of Jf)Ri.set(a,s);let{always:r,uuids:n}=td(e,"custom");for(let[a,s]of n)Ri.set(a,s);ed=[...Xf,...r]}i(hs,"parseDailies");async function rd(){let{uuids:e,always:t}=td(CS,"dailies");Jf=e,Xf=t,hs()}i(rd,"initDailies");async function ji(e){let t={},r=i(async(n,a)=>{if(t[n.key]!==null)try{if(a){let{condition:o,item:l}=a;if(o&&!await o(e,l))return}if(n.condition&&!await n.condition(e)){t[n.key]=null;return}n.key in t||(t[n.key]=deepClone(n));let s=t[n.key];if(s.prepared??={items:{},custom:{},rows:{}},a){let{index:o,item:l}=a,f=n.items[o].slug;s.prepared.items[f]=l}}catch(s){(0,u.error)("error.unexpected"),console.error(s),console.error(`The error occured during data gathering of ${n.key}`)}},"getDaily");return await Promise.all(ed.map(n=>r(n))),await Promise.all(e.items.map(n=>{let a=n.sourceId;if(!a||n.isOfType("physical")&&n.isInvested===!1)return;let s=Ri.get(a);if(!s)return;let{daily:o,index:l,condition:f}=s;return r(o,{condition:f,index:l,item:n})})),t}i(ji,"getDailies");function zi(e){return Object.values(e).filter(t=>_.isNonNull(t)&&Array.isArray(t.items)&&!t.items.some(r=>r.required===!0&&!t.prepared.items[r.slug]))}i(zi,"filterDailies");var Pr,Or,Ni,nd,Hi,id,Bi,ad,Ee=class extends Application{constructor(r,n,a){super(a);Re(this,Ni);Re(this,Hi);Re(this,Bi);Re(this,Pr,void 0);Re(this,Or,void 0);Ji(this,Pr,r),Ji(this,Or,n)}get template(){return(0,u.templatePath)("config")}get title(){return this.actor.name}get actor(){return Qi(this,Pr)}close(r){return r?.noEmit||this.emitEvent("close"),this.purgeListeners(),super.close(r)}getData(r){let n=this.actor,a=$i(n);return{familiar:n.familiar?{value:cs(n),max:n.attributes.familiarAbilities.value}:void 0,dailies:Qi(this,Or).map(o=>({key:o.key,label:o.label,enabled:a[o.key]!==!0})),i18n:(0,u.templateLocalize)("config")}}activateListeners(r){let n=(0,u.htmlElement)(r);(0,u.addListenerAll)(n,"[name='daily-enabled']","change",Ir(this,Bi,ad).bind(this)),(0,u.addListener)(n,"[name='familiar-range']","input",Ir(this,Hi,id).bind(this)),(0,u.addListener)(n,"[name='familiar-range']","change",Ir(this,Ni,nd).bind(this))}};Pr=new WeakMap,Or=new WeakMap,Ni=new WeakSet,nd=i(async function(r,n){let a=this.actor;await(0,u.setFlag)(a,"familiar",{value:n.valueAsNumber,max:a.attributes.familiarAbilities.value}),this.emitEvent("update")},"#onFamiliarRangeChange"),Hi=new WeakSet,id=i(function(r,n){let a=(0,u.queryInParent)(n,"[name='familiar-value']");a&&(a.value=n.value)},"#onFamiliarRangeInput"),Bi=new WeakSet,ad=i(async function(r,n){let{dailyKey:a}=(0,u.elementData)(n);n.checked?await(0,u.unsetFlag)(this.actor,"disabled",a):await(0,u.setFlag)(this.actor,"disabled",a,!0),this.emitEvent("update")},"#onDailyEnabledChange"),i(Ee,"DailyConfig"),Ee=ws([u.withEventManager],Ee);var vs="3.0.0",LS={select:100,combo:80,random:60,alert:40,input:20,notify:20,drop:0};function Wi(e,...t){return t.some(r=>e.dataset.type===r)}i(Wi,"rowElementIsOFType");var qS=[{schema:"3.0.0",reset:!0,messages:["filter",{condition:e=>!!e.familiar,messages:["familiar.now-remove","familiar.cant-remove"]},{condition:e=>ms(e),messages:"staves.moved"}]}];async function kS(e){if(!(0,u.hasModuleFlag)(e))return;let t=!1,r=[],n=vt(e,"schema")??"";if(isNewerVersion(vs,n)){for(let a of qS){if(!isNewerVersion(a.schema,n))continue;t||=a.reset===!0;let s=[];for(let o of a.messages){if(_.isPlainObject(o)){if(_.isFunction(o.condition)&&!await o.condition(e))continue;o=o.messages}o=_.isArray(o)?o:[o];let l=o.map(f=>`<p>${(0,u.localize)("interface.migration",f)}</p>`).join("");s.push(l)}s.length&&r.push(`<h3>${a.schema}</h3>`,s.join("<hr />"))}t?(r.unshift((0,u.localize)("interface.migration.reset"),"<br>"),await(0,u.unsetMofuleFlag)(e)):await(0,u.setFlag)(e,"schema",vs),r.length&&(r.push("<br>"),setTimeout(()=>{Dialog.prompt({content:r.join(""),title:(0,u.localize)("interface.migration.title"),label:(0,u.localize)("interface.migration.label"),rejectClose:!1})},200))}}i(kS,"migration");var Ui=class extends Application{static{i(this,"DailyInterface")}#e;#n;#i;#t=null;#a;#s;#o={};constructor(t,r,n={}){n.dragDrop=[{dropSelector:'[data-droppable="true"]'}],super(n),this.#e=t,this.#n=r,this.#i=zi(r)}get template(){return(0,u.templatePath)("interface")}get title(){return this.actor.name}get actor(){return this.#e}_canDragDrop(t){return!0}async _onDrop(t){let r=(0,u.subLocalize)("interface.drop.error"),n=t.target instanceof HTMLInputElement?t.target:t.target instanceof HTMLLabelElement?(0,u.queryInClosest)(t.target,".group",`input[data-row="${t.target.dataset.row}"]`):null;if(!n)return;let a=TextEditor.getDragEventData(t);if(a?.type!=="Item"||typeof a.uuid!="string")return r.warn("wrongDataType");let s=await fromUuid(a.uuid),o=await this.#f(n);if(!s||!o)return r.warn("wrongDataType");if(s.type!==o.type)return this.#r("type",game.i18n.localize(`TYPES.Item.${o.type}`),game.i18n.localize(`TYPES.Item.${s.type}`));let l=this.#u(o.daily,o.row);if(typeof l.onDrop=="function"){let d=await l.onDrop(s,this.actor);if(d===!1)return r.warn("exclude",{item:s.name});if(typeof d=="string")return ui.notifications.warn(d)}let f=s.isOfType("feat");if((f?this.#S(s,o.filter):this.#P(s,o.filter))&&(n.value=s.name,n.dataset.uuid=s.uuid,(0,u.queryInClosest)(n,".drop",".clear").classList.remove("disabled"),f)){let d=!!this.actor.itemTypes.feat.find(m=>m.sourceId===a.uuid);n.classList.toggle("exists",d),n.dataset.tooltip=d?n.dataset.cacheTooltip:""}}_getHeaderButtons(){let t=super._getHeaderButtons();return t.splice(-1,0,{class:"pf2e-dailies-config",label:(0,u.localizePath)("interface.config"),icon:"fa-solid fa-user-gear",onclick:r=>{if(this.#t){this.#t.bringToTop();return}let n=this.actor,a=`pf2e-dailies-settings-${n.uuid}`;this.#t=new Ee(n,this.#i,{id:a}),this.#t.registerListener("update",()=>this.render(!1,{height:"auto"})),this.#t.registerListener("close",()=>this.#t=null,!0),this.#t.render(!0)}}),t}close(t){return this.#t?.close({noEmit:!0}),clearInterval(this.#a),super.close(t)}async getData(){let t=this.actor;await kS(t);let r=!1,n=this.#i,a=[],s=$i(t);await Promise.all(n.map(async c=>{let d=c.prepared.items;if(c.label=typeof c.label=="function"?await c.label(t,d):typeof c.label=="string"?game.i18n.localize(c.label):(0,u.localizeIfExist)("builtin",c.key)??c.key,s[c.key])return;let m=typeof c.prepare=="function"?await c.prepare(t,d):{},b=await c.rows(t,d,m),v={label:c.label,rows:[]};c.prepared.custom=m,c.prepared.rows=_.mapToObj(b,h=>[h.slug,h]);for(let h of b){if(typeof h.condition=="boolean"&&!h.condition)continue;let S=typeof h.label=="string"?game.i18n.localize(h.label):h.slug,M={type:h.type,row:h.slug,daily:c.key,label:S,order:h.order??LS[h.type],data:""},E=h.save!==!1,F=i(()=>E?(0,u.getFlag)(t,c.key,h.slug):void 0,"getSavedFlag"),C={daily:c.key,type:h.type,row:h.slug,save:(0,u.stringBoolean)(E),empty:(0,u.stringBoolean)(h.empty??!1)};if(ke(h,"select","combo","random")){let N=[];M.options=[];for(let q of h.options)"group"in q?(N.pop()&&M.options.push({groupEnd:!0}),N.push(q.group),q.group=game.i18n.localize(q.group)):q.label=game.i18n.localize(q.label),M.options.push(q);for(let q of N)M.options.push({groupEnd:!0});if(ke(h,"combo","select")&&h.unique&&M.options.length>1&&(M.unique=h.unique),ke(h,"combo")){let{input:q,selected:I}=F()??{},w=q??!0,L=w?void 0:M.options.find(D=>"value"in D&&D.value===I);M.value=(w?I:L?.label)??"",M.selected=!w&&L?.value||"",C.input=(0,u.stringBoolean)(w)}else if(h.options.length)M.selected=F()??"";else continue}else if(ke(h,"drop")){let{name:N,uuid:q}=F()??{};h.filter.type==="feat"&&(this.#s??=_.pipe(this.actor.itemTypes.feat,_.map(I=>I.sourceId),_.compact)),M.note=h.note,M.value=N??"",C.uuid=q??"",C.droptype=h.filter.type}else ke(h,"alert")?(r=!0,C.save=(0,u.stringBoolean)(!1),C.empty=(0,u.stringBoolean)(!1),delete M.unique,M.value=h.message):ke(h,"input")&&(M.value=F()??"");M.data=(0,u.dataToDatasetString)(C),v.rows.push(M)}v.rows.length&&a.push(v)}));let o=[],l=[];for(let c of a)if(c.rows.length===1&&c.rows[0].type!=="alert"){let d=c.rows[0];d.label=c.label,o.push(d)}else c.rows.length&&l.push(c);o.sort((c,d)=>d.order-c.order),l.sort((c,d)=>c.rows.length-d.rows.length);let f=!!o.length||!!l.length;return{rows:o,groups:l,i18n:(0,u.templateLocalize)("interface"),hasDailies:f,hasAlert:r,canAccept:f&&!r}}activateListeners(t){let r=(0,u.htmlElement)(t);(0,u.addListener)(r,"[data-action='accept']",()=>this.#v(r)),(0,u.addListener)(r,"[data-action='cancel']",()=>this.close()),(0,u.addListenerAll)(r,"input[type='text']","keyup",(l,f)=>l.key==="Enter"&&f.blur()),(0,u.addListenerAll)(r,"[data-action='resolve-alert']",this.#d.bind(this)),(0,u.addListenerAll)(r,"[data-action='clear-field']",this.#h.bind(this)),(0,u.addListenerAll)(r,"[data-action='open-browser']",this.#g.bind(this)),(0,u.addListenerAll)(r,".combo input","change",this.#m.bind(this)),(0,u.addListenerAll)(r,".combo select","change",this.#y.bind(this)),(0,u.addListenerAll)(r,"[data-unique]","change",this.#l.bind(this)),(0,u.addListenerAll)(r,".input input[type='text']","change",this.#p.bind(this));let n=[],a=r.querySelectorAll("[data-unique]");for(let l of a){let{unique:f,dailykey:c}=(0,u.elementData)(l),d=`${c}.${f}`;n.includes(d)||(this.#l(null,l),n.push(d))}let s=r.querySelectorAll("select.random");s.length&&(this.#a=setInterval(()=>{for(let l of s)l.selectedIndex=(l.selectedIndex+1)%l.options.length},1e3));let o=r.querySelectorAll("input[data-droptype='feat']");for(let l of o){let f=l.dataset.uuid;f&&this.#s.includes(f)&&(l.classList.add("exists"),l.dataset.tooltip=l.dataset.cacheTooltip)}}async#d(t,r){let n=(0,u.elementData)(r);await this.#u(n.daily,n.row).resolve()&&this.render(!1,{height:"auto"})}#p(t,r){(0,u.queryInClosest)(r,".input",".clear").classList.toggle("disabled",!r.value.trim())}#l(t,r){let n=(0,u.elementData)(r).unique,a=new Set,s=(0,u.closest)(r,".dailies").querySelectorAll(`select[data-unique="${n}"]`);for(let o of s){let l=o.selectedIndex,f=o.options,c=o.options.length-1,d=i(()=>{let v=f[l];return v.dataset.skipUnique==="true"?void 0:v.dataset.unique??v.value},"optionUniqueValue"),m=i(()=>{let v=d();return v&&a.has(v)},"optionExists");for(;m()&&l>0;)l-=1;for(;m()&&l<c;)l+=1;if(m())continue;let b=d();b&&a.add(b),o.selectedIndex!==l&&(o.selectedIndex=l)}for(let o of s){let l=o.selectedIndex,f=o.options;for(let c=0;c<f.length;c++){if(c===l)continue;let d=f[c];d.disabled=a.has(d.dataset.unique??d.value)}}}#m(t,r){let n=r.value.trim().toLowerCase(),a=(0,u.queryInClosest)(r,".combo","select"),s=n?Array.from(a.options).find(o=>o.value===n||o.text.toLowerCase()===n):void 0;s?(a.value=s.value,r.value=s.text,r.dataset.input="false"):(a.value="",r.dataset.input="true")}#y(t,r){let n=(0,u.queryInClosest)(r,".combo","input");n.dataset.input="false",n.value=r.options[r.selectedIndex].text}async#g(t,r){let n=(0,u.queryInClosest)(r,".drop","input"),a=await this.#f(n,!0);a&&game.pf2e.compendiumBrowser.openTab(a.type,a.filter)}#h(t,r){let n=(0,u.queryInParent)(r,"input");n.dataset.tooltip="",n.classList.remove("exists"),n.value="",n.dataset.uuid="",r.classList.add("disabled")}async#v(t){let r=t.querySelectorAll("label.empty");for(let a of r)a.classList.remove("empty");let n=(0,u.querySelectorArray)(t,"[data-empty='false']").filter(a=>a.value.trim()==="");if(n.length){(0,u.warn)("interface.error.empty");for(let a of n){let{row:s}=(0,u.elementData)(a);(0,u.queryInClosest)(a,".group",`label[data-row="${s}"]`).classList.add("empty")}return}this.#_(),await this.#b(t),this.close()}async#b(t){let r=t.querySelectorAll("[data-daily]"),n={},a={},s={};for(let I of r){let w;if(Wi(I,"drop"))w={uuid:I.dataset.uuid,name:I.value};else if(Wi(I,"combo")){let D=I.dataset.input==="true";w={selected:D?I.value.trim():(0,u.queryInClosest)(I,".combo","select").value,input:D}}else if(Wi(I,"select","input"))w=I.value.trim();else if(Wi(I,"random"))w=O.selectRandomOption(I);else continue;let L=I.dataset;s[L.daily]??={daily:this.#n[L.daily],rows:{}},s[L.daily].rows[L.row]=w,L.save==="true"&&(n[L.daily]??={},n[L.daily][L.row]=w)}let o=this.actor,l=[],f=[],c=new Map,[d,m]=Gi(),b=[],v=[],h={languages:{order:80,messages:[]},skills:{order:70,messages:[]},resistances:{order:60,messages:[]},feats:{order:50,messages:[]},spells:{order:40,messages:[]},scrolls:{order:30,messages:[]}},S=i(I=>{let w=I.id,L=c.get(w);if(L)return L;let D=deepClone(I._source.system.rules);for(let T=D.length-1;T>=0;T--)u.MODULE.id in D[T]&&D.splice(T,1);return c.set(w,D),D},"getRules");await Promise.all(Object.values(s).map(({daily:I,rows:w})=>{try{let L=I.prepared.items,D=I.prepared.custom;return I.process({actor:o,items:L,custom:D,rows:w,messages:{add:(T,R)=>{h[T]??={order:0,messages:[]},h[T].messages.push(R)},addGroup:(T,R,G=0)=>{T in h?(h[T].label??=R,h[T].order??=G):h[T]={label:R,order:G,messages:[]}},addRaw:(T,R=1)=>{b.push({message:T,order:R})}},updateItem:m,addItem:T=>f.push(T),addFeat:(T,R)=>{if(R?.isOfType("feat")){let G=R.id;setProperty(T,"flags.pf2e.grantedBy",{id:G,onDelete:"cascade"}),(0,u.setFlagProperty)(T,"grantedBy",G)}f.push(T)},deleteItem:T=>l.push(T.id),removeRule:(T,R)=>{let G=S(T);for(let ee=G.length-1;ee>=0;ee--){let fe=G[ee];R(fe)&&G.splice(ee,1)}},addRule:(T,R)=>{R[u.MODULE.id]=!0,S(T).push(R)},setExtraFlags:T=>{mergeObject(a,T)}})}catch(L){(0,u.error)("error.unexpected"),console.error(L),console.error(`The error occured during processing of ${I.key}`)}}));let M=!1,E=randomID();for(let I of f)getProperty(I,"system.temporary")||(0,u.setFlagProperty)(I,"temporary",!0),I.type==="spell"&&!getProperty(I,"system.location.value")&&!(0,u.getFlagProperty)(I,"identifier")&&(M=!0,(0,u.setFlagProperty)(I,"identifier",E));if(M){let I=(0,u.getHighestSpellcastingStatistic)(o),w=(0,u.getHighestSyntheticStatistic)(o),[L,D]=I&&(!w||I.statistic.mod>=w.mod)?[I.tradition,I.statistic]:w?[null,w]:[null,null];if(D){let T=O.createSpellcastingEntrySource({name:(0,u.localize)("spellEntry.name"),identifier:E,category:"innate",tradition:L??"arcane",attribute:D.attribute,showSlotlessRanks:!1,proficiencyRank:D.rank??1,proficiencySlug:D===w?D.slug:void 0});(0,u.setFlagProperty)(T,"temporary",!0),f.push(T)}}if(f.length){let I=await o.createEmbeddedDocuments("Item",f);for(let w of I)v.push(w.id);for(let w of I)if(w.isOfType("feat")){let L=(0,u.getFlag)(w,"grantedBy");if(L){let T=`flags.pf2e.itemGrants.${game.pf2e.system.sluggify(w.name,{camel:"dromedary"})}`;m({_id:L,[T]:{id:w.id,onDelete:"detach"}})}}else if(w.isOfType("spellcastingEntry")){let L=(0,u.getFlag)(w,"identifier");if(!L)continue;let D=I.filter(T=>T.isOfType("spell")&&(0,u.getFlag)(T,"identifier")===L);for(let T of D){let R=(0,u.getFlag)(T,"rank"),G={_id:T.id,"system.location.value":w.id,"system.location.heightenedLevel":R};m(G)}}}for(let[I,w]of c)m({_id:I,"system.rules":w});d.size&&await o.updateEmbeddedDocuments("Item",d.contents),l.length&&await o.deleteEmbeddedDocuments("Item",l),await(0,u.updateFlag)(o,{...n,extra:a,rested:!1,schema:vs,addedItems:v});let F=Object.entries(h),C=b.map(({message:I,order:w})=>({message:`<p>${I}</p>`,order:w}));for(let[I,w]of F){if(!w.messages.length)continue;let D=`<p><strong>${w.label?game.i18n.localize(w.label):(0,u.localizeIfExist)("message.groups",I)??(0,u.localize)("message.gained",{type:I})}</strong></p>`;for(let T of w.messages){D+="<p>";let R=T.label?.trim();"uuid"in T&&T.uuid?D+=(0,u.createChatLink)(T.uuid,{label:R}):R&&(D+=` ${R}`),T.selected&&(D+=`<i class="fa-solid fa-caret-right"></i>${T.selected}`),T.random&&(D+='<i class="fa-solid fa-dice-d20"></i>'),D+="</p>"}C.push({message:D,order:w.order})}let N=(0,u.localize)(C.length?"message.changes":"message.noChanges");C.unshift({message:N,order:1/0}),C.sort((I,w)=>w.order-I.order);let q=C.map(I=>I.message).join("<hr />");ChatMessage.create({content:`<div class="pf2e-dailies-summary">${q}</div>`,speaker:ChatMessage.getSpeaker({actor:o})})}#_(){this.element.addClass("disabled")}#M(){this.element.removeClass("disabled")}#r(t,r,n){let a=(0,u.localize)("interface.drop.error.type",t),s=Array.isArray(r)?r.length===1?r[0]:`[${r.join(", ")}]`:r,l=(Array.isArray(n)?n.length===1?n[0]:`[${n.join(", ")}]`:n)||(0,u.localize)("interface.drop.error.none"),f=r&&n?(0,u.localize)("interface.drop.error.require",{need:s,has:l}):r?(0,u.localize)("interface.drop.error.missing",{need:s}):(0,u.localize)("interface.drop.error.invalid",{has:l});(0,u.warn)("interface.drop.error.wrongData",{type:a,require:f})}#c(t,r){let{multiselects:n,checkboxes:a}=r,s=game.pf2e.compendiumBrowser.tabs[t.type],o=t.system.traits.value.map(c=>c.replace(/^hb_/,""));if(!s.filterTraits(o,n.traits.selected,n.traits.conjunction))return(0,u.warn)("interface.drop.error.wrongTraits"),!1;let l=a.rarity.selected;if(l.length&&!l.includes(t.rarity))return this.#r("rarity",l.map(c=>game.i18n.localize(CONFIG.PF2E.rarityTraits[c])),game.i18n.localize(CONFIG.PF2E.rarityTraits[t.rarity])),!1;let f=a.source.selected;if(f.length){let{system:c}=t._source,d=String(c.publication?.title??c.source?.value??"").trim(),m=game.pf2e.system.sluggify(d);if(!f.includes(m))return this.#r("source","",d),!1}return!0}#S(t,r){let{checkboxes:n,sliders:a}=r,s=a.level.values;if(!t.level.between(s.min,s.max))return this.#r("level",`${s.min}-${s.max}`,String(t.level)),!1;let o=n.category.selected;if(o.length&&!o.includes(t.category))return this.#r("category",o.map(f=>game.i18n.localize(CONFIG.PF2E.featCategories[f])),game.i18n.localize(CONFIG.PF2E.featCategories[t.category])),!1;let l=n.skills.selected;if(l.length){let c=t.system.prerequisites.value.map(S=>S?.value?S.value.toLowerCase():""),d=(0,u.getTranslatedSkills)(),m=Object.entries(d),b=new Set;for(let S of c)for(let[M,E]of m)(S.includes(M)||S.includes(E))&&b.add(M);let v=[...b],h=_.difference(l,v);if(h.length)return this.#r("skills",h.map(S=>d[S])),!1}return!!this.#c(t,r)}#P(t,r){let{checkboxes:n,selects:a}=r,s=String(t.rank),o=n.rank.selected;if(o.length&&!o.includes(s))return this.#r("rank",o,s),!1;let l=n.category.selected;if(l.length){let d=t.isCantrip,m=t.isFocusSpell,b=t.isRitual,v=!d&&!m&&!b,h=_.compact([v?"spell":null,d?"cantrip":null,m?"focus":null,b?"ritual":null]),S=l.sort(),M=h.sort();if(!_.equals(S,M))return this.#r("categories",S.map(E=>game.i18n.localize(CONFIG.PF2E.spellTraits[E])),M.map(E=>game.i18n.localize(CONFIG.PF2E.spellTraits[E]??"TYPES.Item.spell"))),!1}let f=n.traditions.selected,c=t.system.traits.traditions;return f.length&&!_.intersection(f,c).length?(this.#r("traditions",f.map(d=>game.i18n.localize(CONFIG.PF2E.magicTraditions[d])),c.map(d=>game.i18n.localize(CONFIG.PF2E.magicTraditions[d]))),!1):!!this.#c(t,r)}#u(t,r){return this.#n[t]?.prepared.rows[r]}async#f(t,r){try{let n=(0,u.elementData)(t),a=this.#u(n.daily,n.row),s=`${n.daily}.${n.row}`;return this.#o[s]??=await(async()=>{let o=deepClone(a.filter);return{daily:n.daily,row:n.row,type:o.type,filter:await this.#O(o,r)}})(),deepClone(this.#o[s])}catch(n){(0,u.error)("error.unexpected"),console.error(n),console.error("The error occured when trying to open a drop filter.")}}async#O(t,r){let n=t.type,a=game.pf2e.compendiumBrowser.tabs[n],s=r?await a.getFilterData():a.isInitialized?deepClone(a.defaultFilterData):deepClone(a.filterData);if(us(t,"spell")){let o=Array.isArray(t.search.rank)?t.search.rank.map(u.stringNumber):typeof t.search.rank=="string"?bs(this.actor,t.search.rank):t.search.rank;t.search.rank=Array.isArray(o)?o:typeof o=="number"?_.range(1,o+1).map(u.stringNumber):void 0}if(us(t,"feat")&&sd(t.search.level)){let o=bs(this.actor,t.search.level)??20;t.search.level={min:0,max:o}}for(let o of Object.entries(s.checkboxes)){let[l,f]=o,c=t.search[l];if(c){f.selected=c,f.isExpanded=!0;for(let d of c){let m=f.options[d];m&&(m.selected=!0)}}}for(let o of Object.entries(s.multiselects)){let[l,f]=o,c=t.search[l];if(!c)continue;let d=Array.isArray(c)?{selected:c}:c;f.conjunction=d.conjunction??"and";for(let m of d.selected){let b=typeof m=="string"?{value:m,not:void 0}:m;f.selected.push(b)}}if("sliders"in s)for(let o of Object.entries(s.sliders)){let[l,f]=o,c=t.search[l];c&&(f.values.min=c.min,f.values.max=c.max,f.isExpanded=!0)}return s}};function od(e){return e instanceof Actor&&e.isOfType("character")}i(od,"isValidActor");function _s(e){return od(e)&&vt(e,"rested")!==!1}i(_s,"canPrepareDailies");async function Vi(e){if(!od(e)||!e.isOwner||!_s(e))return;let t=`pf2e-dailies-interface-${e.uuid}`,r=await ji(e);(0,u.openApplication)(Ui,e,r,{id:t})}i(Vi,"openDailiesInterface");function $i(e){let t=vt(e,"disabled")??{};return flattenObject(t)}i($i,"getDisabledDailies");function bs(e,t){if(typeof t=="number")return t;if(t==="level")return e.level;if(t==="half")return Math.max(1,Math.floor(e.level/2));let r=Number(t)||0;return Number.isNaN(r)?void 0:r}i(bs,"simplifyValue");function sd(e){return typeof e=="number"||e==="level"||e==="half"||typeof e=="string"&&!Number.isNaN(Number(e))}i(sd,"isSimplifiableValue");function Gi(){let e=new Collection;return[e,t=>{if(t._id){let r=e.get(t._id)??{};e.set(t._id,mergeObject(r,t))}}]}i(Gi,"createUpdateCollection");function vt(e,t){return(0,u.getFlag)(e,t)}i(vt,"getActorFlag");function ht(e){return!!(0,u.getFlag)(e,"temporary")}i(ht,"isTemporary");function ce(e){return(0,u.getFlag)(e,"extra.staffData")}i(ce,"getStaffFlags");function Ae(e,t){let r=ce(e)?.charges;if(!(!r||t!=null&&r.value===t))return(0,u.setFlag)(e,"extra.staffData.charges.value",Math.clamped(t??r.max,0,r.max))}i(Ae,"setStaffChargesValue");function Sr(e,t){let r=ce(e);if(!r||!e.inventory.get(r.staffId))return null;if(t===0)return!0;let a=(0,u.getActorMaxRank)(e);if(t>a)return!1;let s=r.charges.value;if(s<1)return!1;if(s>=t)return!0;if(r.expended&&s<t)return!1;let o=_.range(t,a+1),l=e.spellcasting.filter(c=>c.isSpontaneous);return _.pipe(l,_.flatMap(c=>o.map(d=>c.system.slots[`slot${d}`])),_.filter(c=>c.max>0),_.sumBy(_.prop("value")))>=1}i(Sr,"canCastRank");async function ud(){let e=(await this.getCraftingEntries()).filter(a=>a.isDailyPrep),r=e.filter(a=>a.isAlchemical).reduce((a,s)=>a+s.reagentCost,0),n=(this.system.resources.crafting.infusedReagents.value||0)-r;if(n<0){ui.notifications.warn(game.i18n.localize("PF2E.CraftingTab.Alerts.MissingReagents"));return}else{await this.update({"system.resources.crafting.infusedReagents.value":n});let a=r===0?"ZeroConsumed":r===1?"OneConsumed":"NConsumed";ui.notifications.info(game.i18n.format(`PF2E.Actor.Character.Crafting.Daily.Complete.${a}`,{quantity:r}))}for(let a of e)for(let s of a.preparedCraftingFormulas){let o=s.item.toObject();o.system.quantity=s.quantity,o.system.temporary=!0,o.system.size=this.ancestry?.size==="tiny"?"tiny":"med",a.isAlchemical&&["consumable","equipment","weapon"].includes(o.type)&&o.system.traits.value.push("infused"),await this.addToInventory(o)}}i(ud,"performDailyCrafting");async function ld(e,t,r){let n=e.spellcasting.regular.filter(a=>a.system.prepared.value==="charges");for(let a of n){let s=t.querySelector(`[data-container-id="${a.id}"]`);if(!s)continue;let o=a.system.slots.slot1,l=await dd(e,o,!0);(0,u.addListener)(l,"[data-action='change-charges']","change",(m,b)=>{let v=Math.clamped(b.valueAsNumber,0,o.max);a.update({"system.slots.slot1.value":v})}),(0,u.addListener)(l,"[data-action='change-max-charges']","change",(m,b)=>{let v=Math.clamped(b.valueAsNumber,0,50);a.update({"system.slots.slot1.max":v,"system.slots.slot1.value":Math.min(v,o.value)})}),(0,u.addListener)(l,"[data-action='reset-charges']",async()=>{a.update({"system.slots.slot1.value":o.max})});let c=`<a data-action="toggle-show-slotless-ranks" data-tooltip="PF2E.ToggleSlotlessSpellLevelsTitle">
<i class="${a.showSlotlessRanks?"fa-solid":"fa-regular"} fa-fw fa-list-alt"></i>
</a>`,d=(0,u.createHTMLFromString)(c);r?.(s,l,d)}}i(ld,"renderChargesEntries");function cd(e,t){let r=e.actor,n=(0,u.htmlElement)(t),a=(0,u.querySelector)(n,".tab[data-tab='spells']");a&&ld(r,a,(s,o,l)=>{(0,u.querySelector)(s,":scope > .header")?.after(o),r.isOwner&&(0,u.querySelector)(s,":scope > .header > .item-controls")?.prepend(l)})}i(cd,"onRenderNPCSheetPF2e");async function fd(e,t){let r=e.actor,n=(0,u.htmlElement)(t),a=(0,u.querySelector)(n,".sheet-content");if(!a)return;let s=(0,u.querySelector)(a,".tab[data-tab='spellcasting']"),o=(0,u.getSetting)("addedHighlight");if(r.isOwner){let l=_s(r),f=(0,u.localize)(l?"sheet.title":"sheet.unrested"),c=l?"":" disabled",d=(0,u.querySelector)(n,"aside .sidebar .hitpoints .hp-small");d&&((0,u.appendHTMLFromString)(d,`<a class="roll-icon dailies${c}" data-action="prepare-dailies" data-tooltip="${f}">
            <i class="fas fa-mug-saucer"></i>
            </a>`),l&&(0,u.addListener)(d,"[data-action='prepare-dailies']",()=>Vi(r)))}s&&ld(r,s,(l,f,c)=>{(0,u.querySelector)(l,".spell-ability-data .statistic-values")?.after(f),r.isOwner&&(0,u.querySelector)(l,".action-header .item-controls")?.prepend(c)});{let l=ce(r),f=l?r.inventory.get(l.staffId):void 0,c=l?.staffId,d=c?a.querySelector(`[data-container-id="${c}-casting"]`):void 0;if(d&&l&&f){let m=d.querySelectorAll(".item-controls"),b=d.querySelectorAll(".item-name");o&&d.classList.add("temporary");for(let F of m??[])F.innerHTML="";for(let F of b??[])F.classList.remove("drag-handle"),F.draggable=!1,delete F.dataset.dragHandle;let v=l.charges,h=f.isEquipped,S=h?"sheathe":f.carryType==="dropped"?"pick-up":f.isStowed?"retrieve":"draw",M=h?void 0:{cost:S==="retrieve"?2:1,id:f.id,label:(0,u.localize)("staves.action",S)},E=await dd(r,v,!1,M);(0,u.addListener)(E,"[data-action='change-charges']","change",(F,C)=>{let N=Math.clamped(C.valueAsNumber,0,v.max);Ae(r,N)}),(0,u.addListener)(E,"[data-action='reset-charges']",async()=>{Ae(r,v.max)}),h||(0,u.addListener)(E,"button",()=>{(0,u.changeCarryType)(r,f,S==="sheathe"?0:1,S)}),(0,u.querySelector)(d,".spell-ability-data .statistic-values")?.after(E)}}{let l=vt(r,"addedItems");if(o)for(let f of l??[]){let c=a.querySelectorAll(`[data-item-id="${f}"]`);for(let d of c)d.classList.add("temporary")}}}i(fd,"onRenderCharacterSheetPF2e");async function dd(e,t,r,n){let a=e.isOwner,s=await(0,u.render)("charges",{isOwner:a,charges:t,withMax:r,action:n,i18n:(0,u.templateLocalize)("sheet.charges")});return(0,u.createHTMLFromString)(s)}i(dd,"createChargesElement");function pd(e,t){let r=e.actor,a=(0,u.htmlElement)(t).querySelectorAll(".section-container:not(.familiar-section) .actions-list [data-item-id]");for(let s of a){let{itemId:o}=(0,u.elementData)(s),l=r.items.get(o);l&&ht(l)&&s.classList.add("temporary")}}i(pd,"onRenderFamiliarSheetPF2e");async function md(e,t){let r=await e(t);try{let n=this.actor,a=ce(n)?.staffId;if(!a)return r;let s=n.inventory.get(a);if(!s)return r;let o=`${s.id}-casting`,l=r.spellCollectionGroups["known-spells"],f=l.findIndex(d=>d.id===o);if(f===-1)return r;let c=l.splice(f,1)[0];r.spellCollectionGroups.activations.unshift(c)}catch(n){u.MODULE.error("CharacterSheetPF2e#getData",n)}return r}i(md,"onCharacterSheetGetData");function yd(e){e();try{let t=ce(this);if(!t)return;let r=this.items.get(t.staffId);if(!r)return;let n=(()=>{if(t.statistic){let c=this.getStatistic(t.statistic.slug);return c?{statistic:c,tradition:t.statistic.tradition}:void 0}return(0,u.getHighestSpellcastingStatistic)(this)})();if(!n)return;let a=`${r.id}-casting`,s=new xi({...n,id:a,name:r.name,actor:this,castPredicate:[`item:id:${r.id}`,{or:t.spells.map(c=>`spell:id:${c._id}`)}]},r);class o extends(0,u.getSpellClass)(){static{i(this,"StaffSpell")}async toMessage(d,{create:m=!0,data:b,rollMode:v}={}){let h=await super.toMessage(d,{rollMode:v,data:b,create:!1});if(!h)return;let S=h.toObject(),M=S.flags.pf2e;return M.casting.embeddedSpell=this.toObject(),m?ChatMessage.implementation.create(S,{renderSheet:!1}):(h.updateSource(S),h)}}let l=(0,u.getSpellCollectionClass)(this),f=new l(s);for(let c of t.spells){let d=mergeObject(c,{"system.location.value":a},{inplace:!1}),m=new o(d,{parent:this});f.set(m.id,m)}this.spellcasting.set(s.id,s),this.spellcasting.collections.set(a,f)}catch(t){u.MODULE.error("CharacterPF2e#prepareData",t)}}i(yd,"onCharacterPrepareData");var bt=(0,u.subLocalize)("customs"),Ss="    ",gd={"(":"()","{":"{}","[":"[]","'":"''",'"':'"',"`":"``"};function AS(e){return`return {
    key: "${e}",
    items: [],
    label: "",
    rows: (actor, items) => {
        return []
    },
    process: ({actor, rows, messages}) => {

    }
}`}i(AS,"generateDefaultCode");var Ki=class extends FormApplication{static{i(this,"CustomDailies")}#e=null;static get defaultOptions(){return mergeObject(super.defaultOptions,{id:"pf2e-dailies-customs",title:bt("title"),template:(0,u.templatePath)("customs"),submitOnChange:!1,submitOnClose:!1,closeOnSubmit:!1,scrollY:[".left .list"]})}get dailies(){return(0,u.getSetting)("customDailies")}getData(t){let r=this.#e,n=this.dailies,a=n.find(({key:s})=>s===r);return{i18n:bt.i18n,list:n.map(({key:s,schema:o})=>({key:s,readonly:isNewerVersion(we,o??""),selected:s===r})),code:a?.code??"",readonly:a&&isNewerVersion(we,a?.schema??"")||!1,disabled:!a}}activateListeners(t){let r=(0,u.htmlElement)(t);(0,u.addListener)(r,".editor","keydown",this.#t.bind(this)),(0,u.addListener)(r,"[data-action='create-daily']",this.#s.bind(this)),(0,u.addListener)(r,"[data-action='save-daily']",this.#n.bind(this)),(0,u.addListener)(r,".right .readonly a",this.#i.bind(this)),(0,u.addListenerAll)(r,"[data-action='select-daily']",this.#a.bind(this)),(0,u.addListenerAll)(r,"[data-action='delete-daily']",this.#o.bind(this))}_updateObject(t,r){throw new Error("Method not implemented.")}async#n(){if(!this.#e)return;let t=(0,u.htmlElement)(this.element),r=(0,u.querySelector)(t,".editor").value,n=await gs({code:r,key:this.#e});if(!n){bt.error("code.error");return}let a=this.dailies.slice(),s=a.findIndex(l=>l.key===this.#e),o={key:n.key,code:r,schema:we};s!==-1?a.splice(s,1,o):a.push(o),await(0,u.setSetting)("customDailies",a),bt.info("code.saved"),this.#e=n.key,this.render()}#i(){let t=(0,u.htmlElement)(this.element),r=t.querySelector(".right .readonly");r&&(r.remove(),(0,u.querySelector)(t,".editor").disabled=!1,(0,u.querySelector)(t,"[data-action='save-daily']").disabled=!1)}#t(t,r){let n=r.selectionStart;t.key==="Tab"?(t.preventDefault(),r.value=r.value.slice(0,n)+Ss+r.value.slice(r.selectionEnd),r.selectionStart=n+Ss.length,r.selectionEnd=n+Ss.length):gd[t.key]&&(t.preventDefault(),r.value=r.value.slice(0,n)+gd[t.key]+r.value.slice(r.selectionEnd),r.selectionStart=n+1,r.selectionEnd=n+1)}#a(t,r){let n=(0,u.closest)(r,".row").dataset.key;this.#e=n,this.render()}async#s(){let t=randomID(),r=this.dailies.slice();r.push({key:t,code:AS(t),schema:we}),await(0,u.setSetting)("customDailies",r),this.#e=t,this.render()}async#o(t,r){let n=(0,u.closest)(r,".row").dataset.key,a=this.dailies.slice(),s=a.findIndex(l=>l.key===n);if(s===-1)return!1;await Dialog.confirm({title:bt("delete.title"),content:bt("delete.content")})&&(a.splice(s,1),await(0,u.setSetting)("customDailies",a),this.#e=null,this.render())}};async function hd(e,t){let r=await e(t);try{if(!r?.length)return r;let a=(Array.isArray(t.actors)?t.actors:[t.actors]).filter(s=>!!s?.isOfType("character"));await Promise.all(a.map(xS))}catch(n){u.MODULE.error("game.pf2e.actions.restForTheNight",n)}return r}i(hd,"restForTheNight");async function xS(e){let t=[],[r,n]=Gi(),a=zi(await ji(e));await Promise.all(a.map(s=>s.rest?.({actor:e,updateItem:n,removeItem:o=>{t.push(o)}}))),await Promise.all(e.items.map(async s=>{if(ht(s)){if(t.push(s.id),s.isOfType("feat")){let f=(0,u.getFlag)(s,"grantedBy");if(f){let c=game.pf2e.system.sluggify(s.name,{camel:"dromedary"});n({_id:f,[`flags.pf2e.itemGrants.-=${c}`]:!0})}}return}let o=deepClone(s._source.system.rules),l=!1;for(let f=o.length-1;f>=0;f--)u.MODULE.id in o[f]&&(o.splice(f,1),l=!0);l&&n({_id:s.id,"system.rules":o})})),r.size&&await e.updateEmbeddedDocuments("Item",r.contents),t.length&&await e.deleteEmbeddedDocuments("Item",t),await(0,u.updateFlag)(e,{rested:!0,addedItems:[],"-=extra":!0})}i(xS,"cleanup");function vd(e){let t=this.actor;if(!t.isOfType("creature")||!t.spellcasting||this.system.prepared.value!=="charges"){e();return}try{let r=(0,u.getSpellCollectionClass)(t);class n extends r{static{i(this,"ChargesSpellCollection")}async addSpell(o,l){let f=this.actor,c=l?.groupId,d=(0,u.spellSlotGroupIdToNumber)(c)??o.rank;if(o.system.location.value===this.id&&o.rank===d)return null;if(o.isFocusSpell)return(0,u.warnInvalidDrop)("invalid-spell",{spell:o}),null;if(o.baseRank>d&&this.id===o.system.location?.value)return(0,u.warnInvalidDrop)("invalid-rank",{spell:o,groupId:c}),null;let b=d>=o.baseRank?{"system.location.heightenedLevel":d}:{};if(o.actor===f)return o.update({"system.location.value":this.id,...b});{let v=o.clone({sort:0,"system.location.value":this.id,...b}).toObject(),h=(await f.createEmbeddedDocuments("Item",[v])).shift();return(0,u.isInstanceOf)(h,"SpellPF2e")?h:null}}async getSpellData(o){let l=await super.getSpellData(o),f=this.entry.system?.slots.slot1.value||0;for(let c of l.groups)if(!(c.id==="cantrips"||f>=c.id))for(let d of c.active)d&&(d.expended=!0);return l}}this.spells=new n(this);let a=t.itemTypes.spell.filter(s=>s.system.location.value===this.id);for(let s of a)this.spells.set(s.id,s);t.spellcasting.collections.set(this.spells.id,this.spells)}catch(r){u.MODULE.error("SpPellcastingEntryPF2e#prepareSiblingData",r)}}i(vd,"spellcastingEntryPrepareSiblingData");async function bd(e,t,r,n){let a=this.actor;if(!a.isOfType("npc","character")||!a.spellcasting||this.system.prepared.value!=="charges")return e(t,r,n);try{let s=this.system.slots.slot1.value;return s<r?((0,u.warn)("charges.error.notEnough",{spell:t.name,rank:(0,u.getRankLabel)(r)}),!1):(await this.update({"system.slots.slot1.value":s-r}),!0)}catch(s){return u.MODULE.error("SpPellcastingEntryPF2e#consume",s),!1}}i(bd,"spellcastingEntryConsume");async function _d(e,t={}){let r=this.actor,n=await e(t);return!r.isOfType("npc","character")||!r.spellcasting||this.system.prepared.value!=="charges"||(n.isCharges=!0,n.isStaff=!1,n.uses={value:this.system.slots.slot1.value,max:this.system.slots.slot1.max}),n}i(_d,"spellcastingEntryGetSheetData");u.MODULE.register("pf2e-dailies","PF2e Dailies");Hooks.once("init",()=>{(0,u.registerSetting)({key:"customDailies",type:Array,default:[],config:!1,onChange:hs}),(0,u.registerSettingMenu)({key:"customs",type:Ki}),(0,u.registerSetting)({key:"familiarAbilities",type:String,default:""}),(0,u.registerSetting)({key:"partyMembers",type:Boolean,default:!0}),(0,u.registerSetting)({key:"addedHighlight",type:Boolean,default:!0,scope:"client",onChange:u.renderCharacterSheets}),(0,u.registerWrapper)("CONFIG.PF2E.Actor.documentClasses.character.prototype.prepareData",yd,"WRAPPER"),u.MODULE.current.api={canCastRank:Sr,setStaffChargesValue:Ae,openDailiesInterface:Vi},CONFIG.PF2E.preparationType.charges="Charges",(0,u.registerWrapper)("CONFIG.PF2E.Item.documentClasses.spellcastingEntry.prototype.prepareSiblingData",vd,"MIXED"),(0,u.registerWrapper)("CONFIG.PF2E.Item.documentClasses.spellcastingEntry.prototype.consume",bd,"MIXED"),(0,u.registerWrapper)("CONFIG.PF2E.Item.documentClasses.spellcastingEntry.prototype.getSheetData",_d,"WRAPPER")});Hooks.once("ready",()=>{rd(),(0,u.registerWrapper)("game.pf2e.actions.restForTheNight",hd,"WRAPPER"),(0,u.registerWrapper)("CONFIG.PF2E.Actor.documentClasses.character.prototype.performDailyCrafting",ud,"OVERRIDE"),(0,u.registerWrapper)("CONFIG.Actor.sheetClasses.character['pf2e.CharacterSheetPF2e'].cls.prototype.getData",md,"WRAPPER"),game.user.isGM&&(0,u.getSetting)("customDailies").some(t=>isNewerVersion(we,t.schema??""))&&(0,u.warn)("error.incompatible",!0)});Hooks.on("renderCharacterSheetPF2e",fd);Hooks.on("renderFamiliarSheetPF2e",pd);Hooks.on("renderNPCSheetPF2e",cd);})();
//# sourceMappingURL=main.js.map
