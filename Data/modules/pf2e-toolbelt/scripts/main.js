(()=>{var rm=Object.create;var qt=Object.defineProperty;var nm=Object.getOwnPropertyDescriptor;var am=Object.getOwnPropertyNames;var im=Object.getPrototypeOf,om=Object.prototype.hasOwnProperty;var a=(e,t)=>qt(e,"name",{value:t,configurable:!0});var sm=(e,t)=>()=>(e&&(t=e(e=0)),t);var g=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),ss=(e,t)=>{for(var r in t)qt(e,r,{get:t[r],enumerable:!0})},Ur=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of am(t))!om.call(e,i)&&i!==r&&qt(e,i,{get:()=>t[i],enumerable:!(n=nm(t,i))||n.enumerable});return e},ce=(e,t,r)=>(Ur(e,t,"default"),r&&Ur(r,t,"default")),vi=(e,t,r)=>(r=e!=null?rm(im(e)):{},Ur(t||!e||!e.__esModule?qt(r,"default",{value:e,enumerable:!0}):r,e)),De=e=>Ur(qt({},"__esModule",{value:!0}),e);var P=g(Ge=>{"use strict";var cm=Ge&&Ge.__spreadArray||function(e,t,r){if(r||arguments.length===2)for(var n=0,i=t.length,o;n<i;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))};Object.defineProperty(Ge,"__esModule",{value:!0});Ge.purry=void 0;function um(e,t,r){var n=e.length-t.length,i=Array.from(t);if(n===0)return e.apply(void 0,i);if(n===1){var o=a(function(s){return e.apply(void 0,cm([s],i,!1))},"ret");return(r||e.lazy)&&(o.lazy=r||e.lazy,o.lazyArgs=t),o}throw new Error("Wrong number of arguments")}a(um,"purry");Ge.purry=um});var cs=g($r=>{"use strict";Object.defineProperty($r,"__esModule",{value:!0});$r.add=void 0;var lm=P();function fm(){return(0,lm.purry)(dm,arguments)}a(fm,"add");$r.add=fm;function dm(e,t){return e+t}a(dm,"_add")});var us=g(Ve=>{"use strict";var Gr=Ve&&Ve.__assign||function(){return Gr=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},Gr.apply(this,arguments)};Object.defineProperty(Ve,"__esModule",{value:!0});Ve.addProp=void 0;var pm=P();function mm(){return(0,pm.purry)(gm,arguments)}a(mm,"addProp");Ve.addProp=mm;function gm(e,t,r){var n;return Gr(Gr({},e),(n={},n[t]=r,n))}a(gm,"_addProp")});var ls=g(Vr=>{"use strict";Object.defineProperty(Vr,"__esModule",{value:!0});Vr.allPass=void 0;var ym=P();function hm(){return(0,ym.purry)(vm,arguments)}a(hm,"allPass");Vr.allPass=hm;function vm(e,t){return t.every(function(r){return r(e)})}a(vm,"_allPass")});var fs=g(Kr=>{"use strict";Object.defineProperty(Kr,"__esModule",{value:!0});Kr.anyPass=void 0;var bm=P();function _m(){return(0,bm.purry)(Pm,arguments)}a(_m,"anyPass");Kr.anyPass=_m;function Pm(e,t){return t.some(function(r){return r(e)})}a(Pm,"_anyPass")});var Qr=g(Jr=>{"use strict";Object.defineProperty(Jr,"__esModule",{value:!0});Jr._withPrecision=void 0;var ds=15;function Sm(e){return function(t,r){if(r===0)return e(t);if(!Number.isInteger(r))throw new TypeError("precision must be an integer: ".concat(r));if(r>ds||r<-ds)throw new RangeError("precision must be between -15 and 15");if(Number.isNaN(t)||!Number.isFinite(t))return e(t);var n=Math.pow(10,r);return e(t*n)/n}}a(Sm,"_withPrecision");Jr._withPrecision=Sm});var ps=g(Yr=>{"use strict";Object.defineProperty(Yr,"__esModule",{value:!0});Yr.ceil=void 0;var Tm=Qr(),Mm=P();function Em(){return(0,Mm.purry)((0,Tm._withPrecision)(Math.ceil),arguments)}a(Em,"ceil");Yr.ceil=Em});var ms=g(Xr=>{"use strict";Object.defineProperty(Xr,"__esModule",{value:!0});Xr.chunk=void 0;var Om=P();function Im(){return(0,Om.purry)(Am,arguments)}a(Im,"chunk");Xr.chunk=Im;function Am(e,t){for(var r=Array.from({length:Math.ceil(e.length/t)}),n=0;n<r.length;n+=1)r[n]=e.slice(n*t,(n+1)*t);return r}a(Am,"_chunk")});var gs=g(Zr=>{"use strict";Object.defineProperty(Zr,"__esModule",{value:!0});Zr.clamp=void 0;var Cm=P();function Fm(){return(0,Cm.purry)(wm,arguments)}a(Fm,"clamp");Zr.clamp=Fm;function wm(e,t){return t.min!=null&&t.min>e?t.min:t.max!=null&&t.max<e?t.max:e}a(wm,"_clamp")});var bi=g(en=>{"use strict";Object.defineProperty(en,"__esModule",{value:!0});en.type=void 0;function km(e){return e===null?"Null":e===void 0?"Undefined":Object.prototype.toString.call(e).slice(8,-1)}a(km,"type");en.type=km});var hs=g(tn=>{"use strict";Object.defineProperty(tn,"__esModule",{value:!0});tn.clone=void 0;var Lm=bi();function Rm(e){return new RegExp(e.source,(e.global?"g":"")+(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.sticky?"y":"")+(e.unicode?"u":""))}a(Rm,"_cloneRegExp");function ys(e,t,r,n){function i(o){for(var s=t.length,u=0;u<s;){if(e===t[u])return r[u];u+=1}t[u+1]=e,r[u+1]=o;for(var f in e)o[f]=n?ys(e[f],t,r,!0):e[f];return o}switch(a(i,"copy"),(0,Lm.type)(e)){case"Object":return i({});case"Array":return i([]);case"Date":return new Date(e.valueOf());case"RegExp":return Rm(e);default:return e}}a(ys,"_clone");function Dm(e){return e!=null&&typeof e.clone=="function"?e.clone():ys(e,[],[],!0)}a(Dm,"clone");tn.clone=Dm});var _i=g(rn=>{"use strict";Object.defineProperty(rn,"__esModule",{value:!0});rn.isTruthy=void 0;function qm(e){return!!e}a(qm,"isTruthy");rn.isTruthy=qm});var vs=g(nn=>{"use strict";Object.defineProperty(nn,"__esModule",{value:!0});nn.compact=void 0;var jm=_i();function xm(e){return e.filter(jm.isTruthy)}a(xm,"compact");nn.compact=xm});var bs=g(an=>{"use strict";Object.defineProperty(an,"__esModule",{value:!0});an.concat=void 0;var Nm=P();function Hm(){return(0,Nm.purry)(Bm,arguments)}a(Hm,"concat");an.concat=Hm;function Bm(e,t){return e.concat(t)}a(Bm,"_concat")});var Ps=g(Ke=>{"use strict";var _s=Ke&&Ke.__spreadArray||function(e,t,r){if(r||arguments.length===2)for(var n=0,i=t.length,o;n<i;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))};Object.defineProperty(Ke,"__esModule",{value:!0});Ke.purryOn=void 0;function zm(e,t,r){var n=Array.from(r),i=n[0],o=n.slice(1);return e(i)?function(s){return t.apply(void 0,_s([s],n,!1))}:t.apply(void 0,_s([i],o,!1))}a(zm,"purryOn");Ke.purryOn=zm});var Ss=g(jt=>{"use strict";Object.defineProperty(jt,"__esModule",{value:!0});jt.conditional=void 0;var Wm=Ps();function Pi(){return(0,Wm.purryOn)($m,Um,arguments)}a(Pi,"conditional");jt.conditional=Pi;function Um(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(var n=0,i=t;n<i.length;n++){var o=i[n],s=o[0],u=o[1];if(s(e))return u(e)}throw new Error("conditional: data failed for all cases")}a(Um,"conditionalImplementation");function $m(e){if(!Array.isArray(e))return!1;var t=e[0],r=e[1],n=e.slice(2);return typeof t=="function"&&t.length<=1&&typeof r=="function"&&r.length<=1&&n.length===0}a($m,"isCase");(function(e){e.defaultCase=function(t){return t===void 0&&(t=Gm),[function(){return!0},t]}})(Pi||(jt.conditional=Pi={}));var Gm=a(function(){},"trivialDefaultCase")});var Es=g(xt=>{"use strict";Object.defineProperty(xt,"__esModule",{value:!0});xt.countBy=void 0;var Ts=P(),Ms=a(function(e){return function(t,r){return t.reduce(function(n,i,o){var s=e?r(i,o,t):r(i);return n+(s?1:0)},0)}},"_countBy");function Si(){return(0,Ts.purry)(Ms(!1),arguments)}a(Si,"countBy");xt.countBy=Si;(function(e){function t(){return(0,Ts.purry)(Ms(!0),arguments)}a(t,"indexed"),e.indexed=t})(Si||(xt.countBy=Si={}))});var Ti=g(on=>{"use strict";Object.defineProperty(on,"__esModule",{value:!0});on.pipe=void 0;function Vm(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(var n=e,i=t.map(function(_){var S=_,T=S.lazy,M=S.lazyArgs;if(T){var O=T.apply(void 0,M||[]);return O.indexed=T.indexed,O.single=T.single,O.index=0,O.items=[],O}return null}),o=0;o<t.length;){var s=t[o],u=i[o];if(!u){n=s(n),o++;continue}for(var f=[],l=o;l<t.length&&i[l];l++)if(f.push(i[l]),i[l].single)break;for(var p=[],d=0,y=n;d<y.length;d++){var m=y[d];if(Os({item:m,acc:p,lazySeq:f}))break}var b=f[f.length-1];b.single?n=p[0]:n=p,o+=f.length}return n}a(Vm,"pipe");on.pipe=Vm;function Os(e){var t=e.item,r=e.lazySeq,n=e.acc;if(r.length===0)return n.push(t),!1;for(var i={done:!1,hasNext:!1},o=!1,s=0;s<r.length;s++){var u=r[s],f=u.indexed,l=u.index,p=u.items;if(p.push(t),i=f?u(t,l,p):u(t),u.index++,i.hasNext)if(i.hasMany){for(var d=i.next,y=0,m=d;y<m.length;y++){var b=m[y],_=Os({item:b,acc:n,lazySeq:r.slice(s+1)});if(_)return!0}return!1}else t=i.next;if(!i.hasNext)break;i.done&&(o=!0)}return i.hasNext&&n.push(t),!!o}a(Os,"_processItem")});var Is=g(Je=>{"use strict";var Km=Je&&Je.__spreadArray||function(e,t,r){if(r||arguments.length===2)for(var n=0,i=t.length,o;n<i;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))};Object.defineProperty(Je,"__esModule",{value:!0});Je.createPipe=void 0;var Jm=Ti();function Qm(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(r){return Jm.pipe.apply(void 0,Km([r],e,!1))}}a(Qm,"createPipe");Je.createPipe=Qm});var As=g(sn=>{"use strict";Object.defineProperty(sn,"__esModule",{value:!0});sn.debounce=void 0;function Ym(e,t){var r=t.waitMs,n=t.timing,i=n===void 0?"trailing":n,o=t.maxWaitMs;if(o!==void 0&&r!==void 0&&o<r)throw new Error("debounce: maxWaitMs (".concat(o,") cannot be less than waitMs (").concat(r,")"));var s,u,f,l,p=a(function(){if(f!==void 0){if(u!==void 0){var m=u;u=void 0,clearTimeout(m)}var b=f;f=void 0,l=e.apply(void 0,b)}},"handleInvoke"),d=a(function(){if(s!==void 0){var m=s;s=void 0,clearTimeout(m),f!==void 0&&p()}},"handleCoolDownEnd"),y=a(function(m){f=m,o!==void 0&&u===void 0&&(u=setTimeout(p,o))},"handleDebouncedCall");return{call:function(){for(var m,b=[],_=0;_<arguments.length;_++)b[_]=arguments[_];if(s===void 0)i==="trailing"?y(b):l=e.apply(void 0,b);else{i!=="leading"&&y(b);var S=s;s=void 0,clearTimeout(S)}return s=setTimeout(d,(m=r??o)!==null&&m!==void 0?m:0),l},cancel:function(){if(s!==void 0){var m=s;s=void 0,clearTimeout(m)}if(u!==void 0){var m=u;u=void 0,clearTimeout(m)}f=void 0},flush:function(){return d(),l},get isPending(){return s!==void 0},get cachedValue(){return l}}}a(Ym,"debounce");sn.debounce=Ym});var G=g(cn=>{"use strict";Object.defineProperty(cn,"__esModule",{value:!0});cn._reduceLazy=void 0;function Xm(e,t,r){for(var n=[],i=0;i<e.length;i++){var o=e[i],s=r?t(o,i,e):t(o);s.hasMany===!0?n.push.apply(n,s.next):s.hasNext&&n.push(s.next)}return n}a(Xm,"_reduceLazy");cn._reduceLazy=Xm});var Cs=g(Ht=>{"use strict";Object.defineProperty(Ht,"__esModule",{value:!0});Ht.difference=void 0;var Zm=P(),eg=G();function Nt(){return(0,Zm.purry)(tg,arguments,Nt.lazy)}a(Nt,"difference");Ht.difference=Nt;function tg(e,t){var r=Nt.lazy(t);return(0,eg._reduceLazy)(e,r)}a(tg,"_difference");(function(e){function t(r){var n=new Set(r);return function(i){return n.has(i)?{done:!1,hasNext:!1}:{done:!1,hasNext:!0,next:i}}}a(t,"lazy"),e.lazy=t})(Nt||(Ht.difference=Nt={}))});var Fs=g(zt=>{"use strict";Object.defineProperty(zt,"__esModule",{value:!0});zt.differenceWith=void 0;var rg=P(),ng=G();function Bt(){return(0,rg.purry)(ag,arguments,Bt.lazy)}a(Bt,"differenceWith");zt.differenceWith=Bt;function ag(e,t,r){var n=Bt.lazy(t,r);return(0,ng._reduceLazy)(e,n)}a(ag,"_differenceWith");(function(e){function t(r,n){return function(i){return r.every(function(o){return!n(i,o)})?{done:!1,hasNext:!0,next:i}:{done:!1,hasNext:!1}}}a(t,"lazy"),e.lazy=t})(Bt||(zt.differenceWith=Bt={}))});var ws=g(un=>{"use strict";Object.defineProperty(un,"__esModule",{value:!0});un.divide=void 0;var ig=P();function og(){return(0,ig.purry)(sg,arguments)}a(og,"divide");un.divide=og;function sg(e,t){return e/t}a(sg,"_divide")});var ks=g(Ut=>{"use strict";Object.defineProperty(Ut,"__esModule",{value:!0});Ut.drop=void 0;var cg=P(),ug=G();function Wt(){return(0,cg.purry)(lg,arguments,Wt.lazy)}a(Wt,"drop");Ut.drop=Wt;function lg(e,t){return(0,ug._reduceLazy)(e,Wt.lazy(t))}a(lg,"_drop");(function(e){function t(r){var n=r;return function(i){return n>0?(n--,{done:!1,hasNext:!1}):{done:!1,hasNext:!0,next:i}}}a(t,"lazy"),e.lazy=t})(Wt||(Ut.drop=Wt={}))});var Mi=g(ln=>{"use strict";Object.defineProperty(ln,"__esModule",{value:!0});ln.swapInPlace=void 0;function fg(e,t,r){var n;n=[e[r],e[t]],e[t]=n[0],e[r]=n[1]}a(fg,"swapInPlace");ln.swapInPlace=fg});var Ei=g(Qe=>{"use strict";Object.defineProperty(Qe,"__esModule",{value:!0});Qe.heapMaybeInsert=Qe.heapify=void 0;var dg=Mi();function pg(e,t){for(var r=Math.floor(e.length/2)-1;r>=0;r--)Ls(e,r,t)}a(pg,"heapify");Qe.heapify=pg;function mg(e,t,r){var n=e[0];if(!(t(r,n)>=0))return e[0]=r,Ls(e,0,t),n}a(mg,"heapMaybeInsert");Qe.heapMaybeInsert=mg;function Ls(e,t,r){for(var n=t;n*2+1<e.length;){var i=n*2+1,o=r(e[n],e[i])<0?i:n,s=i+1;if(s<e.length&&r(e[o],e[s])<0&&(o=s),o===n)return;(0,dg.swapInPlace)(e,n,o),n=o}}a(Ls,"heapSiftDown")});var qe=g(be=>{"use strict";var Ye=be&&be.__spreadArray||function(e,t,r){if(r||arguments.length===2)for(var n=0,i=t.length,o;n<i;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))};Object.defineProperty(be,"__esModule",{value:!0});be.purryOrderRulesWithArgument=be.purryOrderRules=void 0;var Ds={asc:function(e,t){return e>t},desc:function(e,t){return e<t}};function qs(e,t){var r=Array.isArray(t)?t:Array.from(t),n=r[0],i=r.slice(1);if(!js(n)){var o=Oi.apply(void 0,i);return e(n,o)}var s=Oi.apply(void 0,Ye([n],i,!1));return function(u){return e(u,s)}}a(qs,"purryOrderRules");be.purryOrderRules=qs;function gg(e,t){var r=Array.from(t),n=r[0],i=r[1],o=r.slice(2),s,u;return js(i)?(s=n,u=Ye([i],o,!0)):(s=i,u=Ye([n],o,!0)),qs(function(){for(var f=[],l=0;l<arguments.length;l++)f[l]=arguments[l];return e.apply(void 0,Ye(Ye([],f,!1),[s],!1))},u)}a(gg,"purryOrderRulesWithArgument");be.purryOrderRulesWithArgument=gg;function Oi(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var i=typeof e=="function"?e:e[0],o=typeof e=="function"?"asc":e[1],s=Ds[o],u=t===void 0?void 0:Oi.apply(void 0,Ye([t],r,!1));return function(f,l){var p,d=i(f),y=i(l);return s(d,y)?1:s(y,d)?-1:(p=u?.(f,l))!==null&&p!==void 0?p:0}}a(Oi,"orderRuleComparer");function js(e){if(Rs(e))return!0;if(typeof e!="object"||!Array.isArray(e))return!1;var t=e[0],r=e[1],n=e.slice(2);return Rs(t)&&r in Ds&&n.length===0}a(js,"isOrderRule");var Rs=a(function(e){return typeof e=="function"&&e.length===1},"isProjection")});var Ns=g(Xe=>{"use strict";var yg=Xe&&Xe.__spreadArray||function(e,t,r){if(r||arguments.length===2)for(var n=0,i=t.length,o;n<i;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))};Object.defineProperty(Xe,"__esModule",{value:!0});Xe.dropFirstBy=void 0;var xs=Ei(),hg=qe();function vg(){return(0,hg.purryOrderRulesWithArgument)(bg,arguments)}a(vg,"dropFirstBy");Xe.dropFirstBy=vg;function bg(e,t,r){if(r>=e.length)return[];if(r<=0)return yg([],e,!0);var n=e.slice(0,r);(0,xs.heapify)(n,t);for(var i=[],o=e.slice(r),s=0,u=o;s<u.length;s++){var f=u[s],l=(0,xs.heapMaybeInsert)(n,t,f);i.push(l??f)}return i}a(bg,"dropFirstByImplementation")});var Hs=g(Ze=>{"use strict";var _g=Ze&&Ze.__spreadArray||function(e,t,r){if(r||arguments.length===2)for(var n=0,i=t.length,o;n<i;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))};Object.defineProperty(Ze,"__esModule",{value:!0});Ze.dropLast=void 0;var Pg=P();function Sg(){return(0,Pg.purry)(Tg,arguments)}a(Sg,"dropLast");Ze.dropLast=Sg;function Tg(e,t){var r=_g([],e,!0);return t>0&&r.splice(-t),r}a(Tg,"_dropLast")});var Bs=g(fn=>{"use strict";Object.defineProperty(fn,"__esModule",{value:!0});fn.dropLastWhile=void 0;var Mg=P();function Eg(){return(0,Mg.purry)(Og,arguments)}a(Eg,"dropLastWhile");fn.dropLastWhile=Eg;function Og(e,t){for(var r=e.length-1;r>=0;r--)if(!t(e[r]))return e.slice(0,r+1);return[]}a(Og,"_dropLastWhile")});var zs=g(dn=>{"use strict";Object.defineProperty(dn,"__esModule",{value:!0});dn.dropWhile=void 0;var Ig=P();function Ag(){return(0,Ig.purry)(Cg,arguments)}a(Ag,"dropWhile");dn.dropWhile=Ag;function Cg(e,t){for(var r=0;r<e.length;r++)if(!t(e[r]))return e.slice(r);return[]}a(Cg,"_dropWhile")});var $s=g(pn=>{"use strict";Object.defineProperty(pn,"__esModule",{value:!0});pn.equals=void 0;var Fg=P(),Ws=Array.isArray,Us=Object.keys;function Ii(){return(0,Fg.purry)(wg,arguments)}a(Ii,"equals");pn.equals=Ii;function wg(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var r=Ws(e),n=Ws(t),i=void 0,o,s=void 0;if(r&&n){if(o=e.length,o!==t.length)return!1;for(i=o;i--!==0;)if(!Ii(e[i],t[i]))return!1;return!0}if(r!==n)return!1;var u=e instanceof Date,f=t instanceof Date;if(u!==f)return!1;if(u&&f)return e.getTime()===t.getTime();var l=e instanceof RegExp,p=t instanceof RegExp;if(l!==p)return!1;if(l&&p)return e.toString()===t.toString();var d=Us(e);if(o=d.length,o!==Us(t).length)return!1;for(i=o;i--!==0;)if(!Object.prototype.hasOwnProperty.call(t,d[i]))return!1;for(i=o;i--!==0;)if(s=d[i],!Ii(e[s],t[s]))return!1;return!0}return e!==e&&t!==t}a(wg,"_equals")});var Ci=g($t=>{"use strict";Object.defineProperty($t,"__esModule",{value:!0});$t.toPairs=void 0;function Ai(e){return Object.entries(e)}a(Ai,"toPairs");$t.toPairs=Ai;(function(e){function t(r){return Object.entries(r)}a(t,"strict"),e.strict=t})(Ai||($t.toPairs=Ai={}))});var Vs=g(et=>{"use strict";var Fi=et&&et.__assign||function(){return Fi=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},Fi.apply(this,arguments)};Object.defineProperty(et,"__esModule",{value:!0});et.evolve=void 0;var kg=P(),Lg=Ci();function Rg(){return(0,kg.purry)(Gs,arguments)}a(Rg,"evolve");et.evolve=Rg;function Gs(e,t){return typeof e!="object"||e===null?e:Lg.toPairs.strict(t).reduce(function(r,n){var i=n[0],o=n[1];return i in r&&(r[i]=typeof o=="function"?o(r[i]):Gs(r[i],o)),r},Fi({},e))}a(Gs,"_evolve")});var _e=g(mn=>{"use strict";Object.defineProperty(mn,"__esModule",{value:!0});mn._toLazyIndexed=void 0;var Dg=a(function(e){return e.indexed=!0,e},"_toLazyIndexed");mn._toLazyIndexed=Dg});var Ys=g(Gt=>{"use strict";Object.defineProperty(Gt,"__esModule",{value:!0});Gt.filter=void 0;var Js=P(),qg=G(),jg=_e();function tt(){return(0,Js.purry)(Qs(!1),arguments,tt.lazy)}a(tt,"filter");Gt.filter=tt;var Qs=a(function(e){return function(t,r){return(0,qg._reduceLazy)(t,e?tt.lazyIndexed(r):tt.lazy(r),e)}},"_filter"),Ks=a(function(e){return function(t){return function(r,n,i){var o=e?t(r,n,i):t(r);return o?{done:!1,hasNext:!0,next:r}:{done:!1,hasNext:!1}}}},"_lazy");(function(e){function t(){return(0,Js.purry)(Qs(!0),arguments,e.lazyIndexed)}a(t,"indexed"),e.indexed=t,e.lazy=Ks(!1),e.lazyIndexed=(0,jg._toLazyIndexed)(Ks(!0))})(tt||(Gt.filter=tt={}))});var wi=g(gn=>{"use strict";Object.defineProperty(gn,"__esModule",{value:!0});gn._toSingle=void 0;var xg=a(function(e){return e.single=!0,e},"_toSingle");gn._toSingle=xg});var rc=g(Vt=>{"use strict";Object.defineProperty(Vt,"__esModule",{value:!0});Vt.find=void 0;var ec=P(),Ng=_e(),Xs=wi();function yn(){return(0,ec.purry)(tc(!1),arguments,yn.lazy)}a(yn,"find");Vt.find=yn;var tc=a(function(e){return function(t,r){return e?t.find(r):t.find(function(n){return r(n)})}},"_find"),Zs=a(function(e){return function(t){return function(r,n,i){var o=e?t(r,n,i):t(r);return{done:o,hasNext:o,next:r}}}},"_lazy");(function(e){function t(){return(0,ec.purry)(tc(!0),arguments,e.lazyIndexed)}a(t,"indexed"),e.indexed=t,e.lazy=(0,Xs._toSingle)(Zs(!1)),e.lazyIndexed=(0,Xs._toSingle)((0,Ng._toLazyIndexed)(Zs(!0)))})(yn||(Vt.find=yn={}))});var sc=g(Kt=>{"use strict";Object.defineProperty(Kt,"__esModule",{value:!0});Kt.findIndex=void 0;var ic=P(),Hg=_e(),nc=wi();function hn(){return(0,ic.purry)(oc(!1),arguments,hn.lazy)}a(hn,"findIndex");Kt.findIndex=hn;var oc=a(function(e){return function(t,r){return e?t.findIndex(r):t.findIndex(function(n){return r(n)})}},"_findIndex"),ac=a(function(e){return function(t){var r=0;return function(n,i,o){var s=e?t(n,i,o):t(n);return s?{done:!0,hasNext:!0,next:r}:(r++,{done:!1,hasNext:!1})}}},"_lazy");(function(e){function t(){return(0,ic.purry)(oc(!0),arguments,e.lazyIndexed)}a(t,"indexed"),e.indexed=t,e.lazy=(0,nc._toSingle)(ac(!1)),e.lazyIndexed=(0,nc._toSingle)((0,Hg._toLazyIndexed)(ac(!0)))})(hn||(Kt.findIndex=hn={}))});var lc=g(Jt=>{"use strict";Object.defineProperty(Jt,"__esModule",{value:!0});Jt.findLast=void 0;var cc=P();function ki(){return(0,cc.purry)(uc(!1),arguments)}a(ki,"findLast");Jt.findLast=ki;var uc=a(function(e){return function(t,r){for(var n=t.length-1;n>=0;n--)if(e?r(t[n],n,t):r(t[n]))return t[n]}},"_findLast");(function(e){function t(){return(0,cc.purry)(uc(!0),arguments)}a(t,"indexed"),e.indexed=t})(ki||(Jt.findLast=ki={}))});var pc=g(Qt=>{"use strict";Object.defineProperty(Qt,"__esModule",{value:!0});Qt.findLastIndex=void 0;var fc=P();function Li(){return(0,fc.purry)(dc(!1),arguments)}a(Li,"findLastIndex");Qt.findLastIndex=Li;var dc=a(function(e){return function(t,r){for(var n=t.length-1;n>=0;n--)if(e?r(t[n],n,t):r(t[n]))return n;return-1}},"_findLastIndex");(function(e){function t(){return(0,fc.purry)(dc(!0),arguments)}a(t,"indexed"),e.indexed=t})(Li||(Qt.findLastIndex=Li={}))});var mc=g(Yt=>{"use strict";Object.defineProperty(Yt,"__esModule",{value:!0});Yt.first=void 0;var Bg=P();function vn(){return(0,Bg.purry)(zg,arguments,vn.lazy)}a(vn,"first");Yt.first=vn;function zg(e){var t=e[0];return t}a(zg,"_first");(function(e){function t(){return function(r){return{done:!0,hasNext:!0,next:r}}}a(t,"lazy"),e.lazy=t,function(r){r.single=!0}(t=e.lazy||(e.lazy={}))})(vn||(Yt.first=vn={}))});var Ri=g(bn=>{"use strict";Object.defineProperty(bn,"__esModule",{value:!0});bn.hasAtLeast=void 0;var Wg=P();function Ug(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(0,Wg.purry)($g,e)}a(Ug,"hasAtLeast");bn.hasAtLeast=Ug;var $g=a(function(e,t){return e.length>=t},"hasAtLeastImplementation")});var gc=g(_n=>{"use strict";Object.defineProperty(_n,"__esModule",{value:!0});_n.firstBy=void 0;var Gg=qe(),Vg=Ri();function Kg(){return(0,Gg.purryOrderRules)(Jg,arguments)}a(Kg,"firstBy");_n.firstBy=Kg;function Jg(e,t){var r=e[0];if(!(0,Vg.hasAtLeast)(e,2))return r;for(var n=e.slice(1),i=0,o=n;i<o.length;i++){var s=o[i];t(s,r)<0&&(r=s)}return r}a(Jg,"firstByImplementation")});var Di=g(Zt=>{"use strict";Object.defineProperty(Zt,"__esModule",{value:!0});Zt.flatten=void 0;var Qg=G(),Yg=P();function Xt(){return(0,Yg.purry)(Xg,arguments,Xt.lazy)}a(Xt,"flatten");Zt.flatten=Xt;function Xg(e){return(0,Qg._reduceLazy)(e,Xt.lazy())}a(Xg,"_flatten");(function(e){function t(){return function(r){return Array.isArray(r)?{done:!1,hasNext:!0,hasMany:!0,next:r}:{done:!1,hasNext:!0,next:r}}}a(t,"lazy"),e.lazy=t})(Xt||(Zt.flatten=Xt={}))});var yc=g(er=>{"use strict";Object.defineProperty(er,"__esModule",{value:!0});er.flatMap=void 0;var Zg=Di(),ey=P();function Pn(){return(0,ey.purry)(ty,arguments,Pn.lazy)}a(Pn,"flatMap");er.flatMap=Pn;function ty(e,t){return(0,Zg.flatten)(e.map(function(r){return t(r)}))}a(ty,"_flatMap");(function(e){function t(r){return function(n){var i=r(n);return Array.isArray(i)?{done:!1,hasNext:!0,hasMany:!0,next:i}:{done:!1,hasNext:!0,next:i}}}a(t,"lazy"),e.lazy=t})(Pn||(er.flatMap=Pn={}))});var bc=g(tr=>{"use strict";Object.defineProperty(tr,"__esModule",{value:!0});tr.flatMapToObj=void 0;var hc=P();function qi(){return(0,hc.purry)(vc(!1),arguments)}a(qi,"flatMapToObj");tr.flatMapToObj=qi;var vc=a(function(e){return function(t,r){return t.reduce(function(n,i,o){var s=e?r(i,o,t):r(i);return s.forEach(function(u){var f=u[0],l=u[1];n[f]=l}),n},{})}},"_flatMapToObj");(function(e){function t(){return(0,hc.purry)(vc(!0),arguments)}a(t,"indexed"),e.indexed=t})(qi||(tr.flatMapToObj=qi={}))});var _c=g(rr=>{"use strict";Object.defineProperty(rr,"__esModule",{value:!0});rr.flattenDeep=void 0;var ry=G(),ny=P();function rt(){return(0,ny.purry)(ay,arguments,rt.lazy)}a(rt,"flattenDeep");rr.flattenDeep=rt;function ay(e){return(0,ry._reduceLazy)(e,rt.lazy())}a(ay,"_flattenDeep");function iy(e){if(!Array.isArray(e))return e;var t=[];return e.forEach(function(r){Array.isArray(r)?t.push.apply(t,rt(r)):t.push(r)}),t}a(iy,"_flattenDeepValue");(function(e){function t(){return function(r){var n=iy(r);return Array.isArray(n)?{done:!1,hasNext:!0,hasMany:!0,next:n}:{done:!1,hasNext:!0,next:n}}}a(t,"lazy"),e.lazy=t})(rt||(rr.flattenDeep=rt={}))});var Pc=g(Sn=>{"use strict";Object.defineProperty(Sn,"__esModule",{value:!0});Sn.floor=void 0;var oy=Qr(),sy=P();function cy(){return(0,sy.purry)((0,oy._withPrecision)(Math.floor),arguments)}a(cy,"floor");Sn.floor=cy});var Ec=g(nr=>{"use strict";Object.defineProperty(nr,"__esModule",{value:!0});nr.forEach=void 0;var Tc=P(),uy=G(),ly=_e();function nt(){return(0,Tc.purry)(Mc(!1),arguments,nt.lazy)}a(nt,"forEach");nr.forEach=nt;var Mc=a(function(e){return function(t,r){return(0,uy._reduceLazy)(t,e?nt.lazyIndexed(r):nt.lazy(r),e)}},"_forEach"),Sc=a(function(e){return function(t){return function(r,n,i){return e?t(r,n,i):t(r),{done:!1,hasNext:!0,next:r}}}},"_lazy");(function(e){function t(){return(0,Tc.purry)(Mc(!0),arguments,e.lazyIndexed)}a(t,"indexed"),e.indexed=t,e.lazy=Sc(!1),e.lazyIndexed=(0,ly._toLazyIndexed)(Sc(!0))})(nt||(nr.forEach=nt={}))});var Ac=g(ar=>{"use strict";Object.defineProperty(ar,"__esModule",{value:!0});ar.forEachObj=void 0;var Oc=P();function ji(){return(0,Oc.purry)(Ic(!1),arguments)}a(ji,"forEachObj");ar.forEachObj=ji;var Ic=a(function(e){return function(t,r){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var i=t[n];e?r(i,n,t):r(i)}return t}},"_forEachObj");(function(e){function t(){return(0,Oc.purry)(Ic(!0),arguments)}a(t,"indexed"),e.indexed=t})(ji||(ar.forEachObj=ji={}))});var Ni=g(ir=>{"use strict";Object.defineProperty(ir,"__esModule",{value:!0});ir.fromPairs=void 0;function xi(e){for(var t={},r=0,n=e;r<n.length;r++){var i=n[r],o=i[0],s=i[1];t[o]=s}return t}a(xi,"fromPairs");ir.fromPairs=xi;(function(e){e.strict=e})(xi||(ir.fromPairs=xi={}))});var wc=g(or=>{"use strict";Object.defineProperty(or,"__esModule",{value:!0});or.groupBy=void 0;var Cc=P();function Hi(){return(0,Cc.purry)(Fc(!1),arguments)}a(Hi,"groupBy");or.groupBy=Hi;var Fc=a(function(e){return function(t,r){var n={};return t.forEach(function(i,o){var s=e?r(i,o,t):r(i);if(s!==void 0){var u=String(s);n[u]||(n[u]=[]),n[u].push(i)}}),n}},"_groupBy");(function(e){function t(){return(0,Cc.purry)(Fc(!0),arguments)}a(t,"indexed"),e.indexed=t,e.strict=e})(Hi||(or.groupBy=Hi={}))});var kc=g(Tn=>{"use strict";Object.defineProperty(Tn,"__esModule",{value:!0});Tn.identity=void 0;function fy(e){return e}a(fy,"identity");Tn.identity=fy});var Rc=g(sr=>{"use strict";Object.defineProperty(sr,"__esModule",{value:!0});sr.indexBy=void 0;var zi=P();function Bi(){return(0,zi.purry)(Lc(!1),arguments)}a(Bi,"indexBy");sr.indexBy=Bi;var Lc=a(function(e){return function(t,r){return t.reduce(function(n,i,o){var s=e?r(i,o,t):r(i),u=String(s);return n[u]=i,n},{})}},"_indexBy");function dy(){return(0,zi.purry)(py,arguments)}a(dy,"indexByStrict");var py=a(function(e,t){return e.reduce(function(r,n){var i=t(n);return r[i]=n,r},{})},"_indexByStrict");(function(e){function t(){return(0,zi.purry)(Lc(!0),arguments)}a(t,"indexed"),e.indexed=t,e.strict=dy})(Bi||(sr.indexBy=Bi={}))});var Dc=g(ur=>{"use strict";Object.defineProperty(ur,"__esModule",{value:!0});ur.intersection=void 0;var my=P(),gy=G();function cr(){return(0,my.purry)(yy,arguments,cr.lazy)}a(cr,"intersection");ur.intersection=cr;function yy(e,t){var r=cr.lazy(t);return(0,gy._reduceLazy)(e,r)}a(yy,"_intersection");(function(e){function t(r){return function(n){var i=new Set(r);return i.has(n)?{done:!1,hasNext:!0,next:n}:{done:!1,hasNext:!1}}}a(t,"lazy"),e.lazy=t})(cr||(ur.intersection=cr={}))});var qc=g(fr=>{"use strict";Object.defineProperty(fr,"__esModule",{value:!0});fr.intersectionWith=void 0;var hy=G(),vy=P();function lr(){return(0,vy.purry)(by,arguments,lr.lazy)}a(lr,"intersectionWith");fr.intersectionWith=lr;function by(e,t,r){var n=lr.lazy(t,r);return(0,hy._reduceLazy)(e,n)}a(by,"_intersectionWith");(function(e){function t(r,n){return function(i){return r.some(function(o){return n(i,o)})?{done:!1,hasNext:!0,next:i}:{done:!1,hasNext:!1}}}a(t,"lazy"),e.lazy=t})(lr||(fr.intersectionWith=lr={}))});var jc=g(Mn=>{"use strict";Object.defineProperty(Mn,"__esModule",{value:!0});Mn.invert=void 0;var _y=P();function Py(){return(0,_y.purry)(Sy,arguments)}a(Py,"invert");Mn.invert=Py;function Sy(e){var t={};for(var r in e)t[e[r]]=r;return t}a(Sy,"_invert")});var Wi=g(En=>{"use strict";Object.defineProperty(En,"__esModule",{value:!0});En.isArray=void 0;function Ty(e){return Array.isArray(e)}a(Ty,"isArray");En.isArray=Ty});var xc=g(On=>{"use strict";Object.defineProperty(On,"__esModule",{value:!0});On.isBoolean=void 0;function My(e){return typeof e=="boolean"}a(My,"isBoolean");On.isBoolean=My});var Nc=g(In=>{"use strict";Object.defineProperty(In,"__esModule",{value:!0});In.isDate=void 0;function Ey(e){return e instanceof Date}a(Ey,"isDate");In.isDate=Ey});var Hc=g(dr=>{"use strict";Object.defineProperty(dr,"__esModule",{value:!0});dr.isDefined=void 0;function Ui(e){return typeof e<"u"&&e!==null}a(Ui,"isDefined");dr.isDefined=Ui;(function(e){function t(r){return r!==void 0}a(t,"strict"),e.strict=t})(Ui||(dr.isDefined=Ui={}))});var $i=g(An=>{"use strict";Object.defineProperty(An,"__esModule",{value:!0});An.isObject=void 0;function Oy(e){return!!e&&!Array.isArray(e)&&typeof e=="object"}a(Oy,"isObject");An.isObject=Oy});var Gi=g(Cn=>{"use strict";Object.defineProperty(Cn,"__esModule",{value:!0});Cn.isString=void 0;function Iy(e){return typeof e=="string"}a(Iy,"isString");Cn.isString=Iy});var Bc=g(Fn=>{"use strict";Object.defineProperty(Fn,"__esModule",{value:!0});Fn.isEmpty=void 0;var Ay=Wi(),Cy=$i(),Fy=Gi();function wy(e){return e===void 0?!0:(0,Ay.isArray)(e)||(0,Fy.isString)(e)?e.length===0:(0,Cy.isObject)(e)?Object.keys(e).length===0:!1}a(wy,"isEmpty");Fn.isEmpty=wy});var zc=g(wn=>{"use strict";Object.defineProperty(wn,"__esModule",{value:!0});wn.isError=void 0;function ky(e){return e instanceof Error}a(ky,"isError");wn.isError=ky});var Wc=g(kn=>{"use strict";Object.defineProperty(kn,"__esModule",{value:!0});kn.isFunction=void 0;function Ly(e){return typeof e=="function"}a(Ly,"isFunction");kn.isFunction=Ly});var Uc=g(Ln=>{"use strict";Object.defineProperty(Ln,"__esModule",{value:!0});Ln.isNil=void 0;function Ry(e){return e==null}a(Ry,"isNil");Ln.isNil=Ry});var $c=g(Rn=>{"use strict";Object.defineProperty(Rn,"__esModule",{value:!0});Rn.isNonNull=void 0;function Dy(e){return e!==null}a(Dy,"isNonNull");Rn.isNonNull=Dy});var Gc=g(Dn=>{"use strict";Object.defineProperty(Dn,"__esModule",{value:!0});Dn.isNot=void 0;function qy(e){return function(t){return!e(t)}}a(qy,"isNot");Dn.isNot=qy});var Vc=g(qn=>{"use strict";Object.defineProperty(qn,"__esModule",{value:!0});qn.isNumber=void 0;function jy(e){return typeof e=="number"&&!isNaN(e)}a(jy,"isNumber");qn.isNumber=jy});var Kc=g(jn=>{"use strict";Object.defineProperty(jn,"__esModule",{value:!0});jn.isObjectType=void 0;var xy=a(function(e){return typeof e=="object"&&e!==null},"isObjectType");jn.isObjectType=xy});var Jc=g(xn=>{"use strict";Object.defineProperty(xn,"__esModule",{value:!0});xn.isPlainObject=void 0;function Ny(e){if(typeof e!="object"||e===null)return!1;var t=Object.getPrototypeOf(e);return t===null||t===Object.prototype}a(Ny,"isPlainObject");xn.isPlainObject=Ny});var Qc=g(Nn=>{"use strict";Object.defineProperty(Nn,"__esModule",{value:!0});Nn.isPromise=void 0;function Hy(e){return e instanceof Promise}a(Hy,"isPromise");Nn.isPromise=Hy});var Yc=g(Hn=>{"use strict";Object.defineProperty(Hn,"__esModule",{value:!0});Hn.isSymbol=void 0;function By(e){return typeof e=="symbol"}a(By,"isSymbol");Hn.isSymbol=By});var Xc=g(Bn=>{"use strict";Object.defineProperty(Bn,"__esModule",{value:!0});Bn.join=void 0;var zy=P();function Wy(){return(0,zy.purry)(Uy,arguments)}a(Wy,"join");Bn.join=Wy;var Uy=a(function(e,t){return e.join(t)},"joinImplementation")});var Zc=g(pr=>{"use strict";Object.defineProperty(pr,"__esModule",{value:!0});pr.keys=void 0;function Vi(e){return Object.keys(e)}a(Vi,"keys");pr.keys=Vi;(function(e){e.strict=e})(Vi||(pr.keys=Vi={}))});var eu=g(zn=>{"use strict";Object.defineProperty(zn,"__esModule",{value:!0});zn.last=void 0;var $y=P();function Gy(){return(0,$y.purry)(Vy,arguments)}a(Gy,"last");zn.last=Gy;function Vy(e){return e[e.length-1]}a(Vy,"_last")});var tu=g(Wn=>{"use strict";Object.defineProperty(Wn,"__esModule",{value:!0});Wn.length=void 0;var Ky=P();function Jy(){return(0,Ky.purry)(Qy,arguments)}a(Jy,"length");Wn.length=Jy;function Qy(e){return"length"in e?e.length:Array.from(e).length}a(Qy,"_length")});var iu=g(mr=>{"use strict";Object.defineProperty(mr,"__esModule",{value:!0});mr.map=void 0;var nu=P(),Yy=G(),Xy=_e();function at(){return(0,nu.purry)(au(!1),arguments,at.lazy)}a(at,"map");mr.map=at;var au=a(function(e){return function(t,r){return(0,Yy._reduceLazy)(t,e?at.lazyIndexed(r):at.lazy(r),e)}},"_map"),ru=a(function(e){return function(t){return function(r,n,i){return{done:!1,hasNext:!0,next:e?t(r,n,i):t(r)}}}},"_lazy");(function(e){function t(){return(0,nu.purry)(au(!0),arguments,e.lazyIndexed)}a(t,"indexed"),e.indexed=t,e.lazy=ru(!1),e.lazyIndexed=(0,Xy._toLazyIndexed)(ru(!0)),e.strict=e})(at||(mr.map=at={}))});var su=g(Un=>{"use strict";Object.defineProperty(Un,"__esModule",{value:!0});Un.mapKeys=void 0;function Zy(e,t){return arguments.length===1?function(r){return ou(r,e)}:ou(e,t)}a(Zy,"mapKeys");Un.mapKeys=Zy;function ou(e,t){return Object.keys(e).reduce(function(r,n){return r[t(n,e[n])]=e[n],r},{})}a(ou,"_mapKeys")});var lu=g(gr=>{"use strict";Object.defineProperty(gr,"__esModule",{value:!0});gr.mapToObj=void 0;var cu=P();function Ki(){return(0,cu.purry)(uu(!1),arguments)}a(Ki,"mapToObj");gr.mapToObj=Ki;var uu=a(function(e){return function(t,r){return t.reduce(function(n,i,o){var s=e?r(i,o,t):r(i),u=s[0],f=s[1];return n[u]=f,n},{})}},"_mapToObj");(function(e){function t(){return(0,cu.purry)(uu(!0),arguments)}a(t,"indexed"),e.indexed=t})(Ki||(gr.mapToObj=Ki={}))});var du=g($n=>{"use strict";Object.defineProperty($n,"__esModule",{value:!0});$n.mapValues=void 0;function eh(e,t){return arguments.length===1?function(r){return fu(r,e)}:fu(e,t)}a(eh,"mapValues");$n.mapValues=eh;function fu(e,t){return Object.keys(e).reduce(function(r,n){return r[n]=t(e[n],n),r},{})}a(fu,"_mapValues")});var gu=g(yr=>{"use strict";Object.defineProperty(yr,"__esModule",{value:!0});yr.maxBy=void 0;var pu=P(),mu=a(function(e){return function(t,r){var n=void 0,i=void 0;return t.forEach(function(o,s){var u=e?r(o,s,t):r(o);(i===void 0||u>i)&&(n=o,i=u)}),n}},"_maxBy");function Ji(){return(0,pu.purry)(mu(!1),arguments)}a(Ji,"maxBy");yr.maxBy=Ji;(function(e){function t(){return(0,pu.purry)(mu(!0),arguments)}a(t,"indexed"),e.indexed=t})(Ji||(yr.maxBy=Ji={}))});var vu=g(hr=>{"use strict";Object.defineProperty(hr,"__esModule",{value:!0});hr.meanBy=void 0;var yu=P(),hu=a(function(e){return function(t,r){if(t.length===0)return NaN;var n=0;return t.forEach(function(i,o){n+=e?r(i,o,t):r(i)}),n/t.length}},"_meanBy");function Qi(){return(0,yu.purry)(hu(!1),arguments)}a(Qi,"meanBy");hr.meanBy=Qi;(function(e){function t(){return(0,yu.purry)(hu(!0),arguments)}a(t,"indexed"),e.indexed=t})(Qi||(hr.meanBy=Qi={}))});var bu=g(Gn=>{"use strict";Object.defineProperty(Gn,"__esModule",{value:!0});Gn.merge=void 0;var th=P();function rh(){return(0,th.purry)(nh,arguments)}a(rh,"merge");Gn.merge=rh;function nh(e,t){return Object.assign({},e,t)}a(nh,"_merge")});var _u=g(it=>{"use strict";var Vn=it&&it.__assign||function(){return Vn=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},Vn.apply(this,arguments)};Object.defineProperty(it,"__esModule",{value:!0});it.mergeAll=void 0;function ah(e){return e.reduce(function(t,r){return Vn(Vn({},t),r)},{})}a(ah,"mergeAll");it.mergeAll=ah});var Tu=g(ot=>{"use strict";var Kn=ot&&ot.__assign||function(){return Kn=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},Kn.apply(this,arguments)};Object.defineProperty(ot,"__esModule",{value:!0});ot.mergeDeep=void 0;var ih=P();function oh(){return(0,ih.purry)(Su,arguments)}a(oh,"mergeDeep");ot.mergeDeep=oh;function Su(e,t){var r=Kn(Kn({},e),t);for(var n in t)if(n in e){var i=e[n];if(Pu(i)){var o=t[n];Pu(o)&&(r[n]=Su(i,o))}}return r}a(Su,"mergeDeepImplementation");function Pu(e){return typeof e=="object"&&e!==null&&Object.getPrototypeOf(e)===Object.prototype}a(Pu,"isRecord")});var Ou=g(vr=>{"use strict";Object.defineProperty(vr,"__esModule",{value:!0});vr.minBy=void 0;var Mu=P(),Eu=a(function(e){return function(t,r){var n=void 0,i=void 0;return t.forEach(function(o,s){var u=e?r(o,s,t):r(o);(i===void 0||u<i)&&(n=o,i=u)}),n}},"_minBy");function Yi(){return(0,Mu.purry)(Eu(!1),arguments)}a(Yi,"minBy");vr.minBy=Yi;(function(e){function t(){return(0,Mu.purry)(Eu(!0),arguments)}a(t,"indexed"),e.indexed=t})(Yi||(vr.minBy=Yi={}))});var Iu=g(Jn=>{"use strict";Object.defineProperty(Jn,"__esModule",{value:!0});Jn.multiply=void 0;var sh=P();function ch(){return(0,sh.purry)(uh,arguments)}a(ch,"multiply");Jn.multiply=ch;function uh(e,t){return e*t}a(uh,"_multiply")});var Au=g(Qn=>{"use strict";Object.defineProperty(Qn,"__esModule",{value:!0});Qn.noop=void 0;var lh=a(function(){},"noop");Qn.noop=lh});var wu=g(st=>{"use strict";var fh=st&&st.__spreadArray||function(e,t,r){if(r||arguments.length===2)for(var n=0,i=t.length,o;n<i;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))};Object.defineProperty(st,"__esModule",{value:!0});st.quickSelect=void 0;var Cu=Mi(),dh=a(function(e,t,r){return t<0||t>=e.length?void 0:Fu(fh([],e,!0),0,e.length-1,t,r)},"quickSelect");st.quickSelect=dh;function Fu(e,t,r,n,i){if(t===r)return e[t];var o=ph(e,t,r,i);return n===o?e[n]:Fu(e,n<o?t:o+1,n<o?o-1:r,n,i)}a(Fu,"quickSelectImplementation");function ph(e,t,r,n){for(var i=e[r],o=t,s=t;s<r;s++)n(e[s],i)<0&&((0,Cu.swapInPlace)(e,o,s),o++);return(0,Cu.swapInPlace)(e,o,r),o}a(ph,"partition")});var ku=g(Yn=>{"use strict";Object.defineProperty(Yn,"__esModule",{value:!0});Yn.nthBy=void 0;var mh=qe(),gh=wu();function yh(){return(0,mh.purryOrderRulesWithArgument)(hh,arguments)}a(yh,"nthBy");Yn.nthBy=yh;var hh=a(function(e,t,r){return(0,gh.quickSelect)(e,r>=0?r:e.length+r,t)},"nthByImplementation")});var Lu=g(Xn=>{"use strict";Object.defineProperty(Xn,"__esModule",{value:!0});Xn.objOf=void 0;var vh=P();function bh(){return(0,vh.purry)(_h,arguments)}a(bh,"objOf");Xn.objOf=bh;function _h(e,t){var r;return r={},r[t]=e,r}a(_h,"_objOf")});var Ru=g(Pe=>{"use strict";var Zn=Pe&&Pe.__assign||function(){return Zn=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},Zn.apply(this,arguments)},Ph=Pe&&Pe.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]]);return r};Object.defineProperty(Pe,"__esModule",{value:!0});Pe.omit=void 0;var Sh=Ni(),Th=P();function Mh(){return(0,Th.purry)(Eh,arguments)}a(Mh,"omit");Pe.omit=Mh;function Eh(e,t){if(t.length===0)return Zn({},e);if(t.length===1){var r=t[0],n=e,i=r,o=n[i],s=Ph(n,[typeof i=="symbol"?i:i+""]);return s}if(!t.some(function(f){return f in e}))return Zn({},e);var u=new Set(t);return(0,Sh.fromPairs)(Object.entries(e).filter(function(f){var l=f[0];return!u.has(l)}))}a(Eh,"_omit")});var Du=g(ea=>{"use strict";Object.defineProperty(ea,"__esModule",{value:!0});ea.omitBy=void 0;var Oh=P();function Ih(){return(0,Oh.purry)(Ah,arguments)}a(Ih,"omitBy");ea.omitBy=Ih;function Ah(e,t){return Object.keys(e).reduce(function(r,n){return t(e[n],n)||(r[n]=e[n]),r},{})}a(Ah,"_omitBy")});var qu=g(ta=>{"use strict";Object.defineProperty(ta,"__esModule",{value:!0});ta.once=void 0;function Ch(e){var t=!1,r;return function(){return t||(r=e(),t=!0),r}}a(Ch,"once");ta.once=Ch});var ju=g(ra=>{"use strict";Object.defineProperty(ra,"__esModule",{value:!0});ra.only=void 0;var Fh=P();function wh(){return(0,Fh.purry)(kh,arguments)}a(wh,"only");ra.only=wh;function kh(e){if(e.length===1)return e[0]}a(kh,"_only")});var Hu=g(br=>{"use strict";Object.defineProperty(br,"__esModule",{value:!0});br.partition=void 0;var xu=P();function Xi(){return(0,xu.purry)(Nu(!1),arguments)}a(Xi,"partition");br.partition=Xi;var Nu=a(function(e){return function(t,r){var n=[[],[]];return t.forEach(function(i,o){var s=e?r(i,o,t):r(i);n[s?0:1].push(i)}),n}},"_partition");(function(e){function t(){return(0,xu.purry)(Nu(!0),arguments)}a(t,"indexed"),e.indexed=t})(Xi||(br.partition=Xi={}))});var Bu=g(na=>{"use strict";Object.defineProperty(na,"__esModule",{value:!0});na.pathOr=void 0;var Lh=P();function Rh(){return(0,Lh.purry)(Dh,arguments)}a(Rh,"pathOr");na.pathOr=Rh;function Dh(e,t,r){for(var n=e,i=0,o=t;i<o.length;i++){var s=o[i];if(n==null||n[s]==null)return r;n=n[s]}return n}a(Dh,"_pathOr")});var zu=g(aa=>{"use strict";Object.defineProperty(aa,"__esModule",{value:!0});aa.pick=void 0;var qh=P();function jh(){return(0,qh.purry)(xh,arguments)}a(jh,"pick");aa.pick=jh;function xh(e,t){return e==null?{}:t.reduce(function(r,n){return n in e&&(r[n]=e[n]),r},{})}a(xh,"_pick")});var Wu=g(ia=>{"use strict";Object.defineProperty(ia,"__esModule",{value:!0});ia.pickBy=void 0;var Nh=P();function Hh(){return(0,Nh.purry)(Bh,arguments)}a(Hh,"pickBy");ia.pickBy=Hh;function Bh(e,t){return e==null?{}:Object.keys(e).reduce(function(r,n){return t(e[n],n)&&(r[n]=e[n]),r},{})}a(Bh,"_pickBy")});var Uu=g(oa=>{"use strict";Object.defineProperty(oa,"__esModule",{value:!0});oa.prop=void 0;var zh=a(function(e){return function(t){var r=e,n=t[r];return n}},"prop");oa.prop=zh});var Zi=g(sa=>{"use strict";Object.defineProperty(sa,"__esModule",{value:!0});sa.range=void 0;var Wh=P();function Uh(){return(0,Wh.purry)($h,arguments)}a(Uh,"range");sa.range=Uh;function $h(e,t){for(var r=[],n=e;n<t;n++)r.push(n);return r}a($h,"_range")});var $u=g(ca=>{"use strict";Object.defineProperty(ca,"__esModule",{value:!0});ca.randomString=void 0;var Gh=Zi();function Vh(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=a(function(){return t[Math.floor(Math.random()*t.length)]},"randomChar");return(0,Gh.range)(0,e).reduce(function(n){return n+r()},"")}a(Vh,"randomString");ca.randomString=Vh});var Gu=g(ua=>{"use strict";Object.defineProperty(ua,"__esModule",{value:!0});ua.rankBy=void 0;var Kh=qe();function Jh(){return(0,Kh.purryOrderRulesWithArgument)(Qh,arguments)}a(Jh,"rankBy");ua.rankBy=Jh;function Qh(e,t,r){for(var n=0,i=0,o=e;i<o.length;i++){var s=o[i];t(r,s)>0&&n++}return n}a(Qh,"rankByImplementation")});var Ju=g(_r=>{"use strict";Object.defineProperty(_r,"__esModule",{value:!0});_r.reduce=void 0;var Vu=P();function eo(){return(0,Vu.purry)(Ku(!1),arguments)}a(eo,"reduce");_r.reduce=eo;var Ku=a(function(e){return function(t,r,n){return t.reduce(function(i,o,s){return e?r(i,o,s,t):r(i,o)},n)}},"_reduce");(function(e){function t(){return(0,Vu.purry)(Ku(!0),arguments)}a(t,"indexed"),e.indexed=t})(eo||(_r.reduce=eo={}))});var Zu=g(Pr=>{"use strict";Object.defineProperty(Pr,"__esModule",{value:!0});Pr.reject=void 0;var Yu=P(),Yh=G(),Xh=_e();function ct(){return(0,Yu.purry)(Xu(!1),arguments,ct.lazy)}a(ct,"reject");Pr.reject=ct;var Xu=a(function(e){return function(t,r){return(0,Yh._reduceLazy)(t,e?ct.lazyIndexed(r):ct.lazy(r),e)}},"_reject"),Qu=a(function(e){return function(t){return function(r,n,i){var o=e?t(r,n,i):t(r);return o?{done:!1,hasNext:!1}:{done:!1,hasNext:!0,next:r}}}},"_lazy");(function(e){function t(){return(0,Yu.purry)(Xu(!0),arguments,e.lazyIndexed)}a(t,"indexed"),e.indexed=t,e.lazy=Qu(!1),e.lazyIndexed=(0,Xh._toLazyIndexed)(Qu(!0))})(ct||(Pr.reject=ct={}))});var el=g(la=>{"use strict";Object.defineProperty(la,"__esModule",{value:!0});la.reverse=void 0;var Zh=P();function ev(){return(0,Zh.purry)(tv,arguments)}a(ev,"reverse");la.reverse=ev;function tv(e){return e.slice().reverse()}a(tv,"_reverse")});var tl=g(fa=>{"use strict";Object.defineProperty(fa,"__esModule",{value:!0});fa.round=void 0;var rv=Qr(),nv=P();function av(){return(0,nv.purry)((0,rv._withPrecision)(Math.round),arguments)}a(av,"round");fa.round=av});var rl=g(da=>{"use strict";Object.defineProperty(da,"__esModule",{value:!0});da.sample=void 0;var iv=P();function ov(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(0,iv.purry)(sv,e)}a(ov,"sample");da.sample=ov;function sv(e,t){if(t<0)throw new RangeError("sampleSize must cannot be negative: ".concat(t));if(!Number.isInteger(t))throw new TypeError("sampleSize must be an integer: ".concat(t));if(t>=e.length)return e;if(t===0)return[];for(var r=Math.min(t,e.length-t),n=new Set;n.size<r;){var i=Math.floor(Math.random()*e.length);n.add(i)}return t===r?Array.from(n).sort(function(o,s){return o-s}).map(function(o){return e[o]}):e.filter(function(o,s){return!n.has(s)})}a(sv,"sampleImplementation")});var nl=g(ut=>{"use strict";var pa=ut&&ut.__assign||function(){return pa=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},pa.apply(this,arguments)};Object.defineProperty(ut,"__esModule",{value:!0});ut.set=void 0;var cv=P();function uv(){return(0,cv.purry)(lv,arguments)}a(uv,"set");ut.set=uv;function lv(e,t,r){var n;return pa(pa({},e),(n={},n[t]=r,n))}a(lv,"_set")});var al=g(Se=>{"use strict";var ma=Se&&Se.__assign||function(){return ma=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},ma.apply(this,arguments)};Object.defineProperty(Se,"__esModule",{value:!0});Se._setPath=Se.setPath=void 0;var fv=P();function dv(){return(0,fv.purry)(ga,arguments)}a(dv,"setPath");Se.setPath=dv;function ga(e,t,r){var n;return t.length===0?r:Array.isArray(e)?e.map(function(i,o){return o===t[0]?ga(i,t.slice(1),r):i}):ma(ma({},e),(n={},n[t[0]]=ga(e[t[0]],t.slice(1),r),n))}a(ga,"_setPath");Se._setPath=ga});var il=g(ya=>{"use strict";Object.defineProperty(ya,"__esModule",{value:!0});ya.shuffle=void 0;var pv=P();function mv(){return(0,pv.purry)(gv,arguments)}a(mv,"shuffle");ya.shuffle=mv;function gv(e){for(var t=e.slice(),r=0;r<e.length;r+=1){var n=r+Math.floor(Math.random()*(e.length-r)),i=t[n];t[n]=t[r],t[r]=i}return t}a(gv,"_shuffle")});var ol=g(ha=>{"use strict";Object.defineProperty(ha,"__esModule",{value:!0});ha.sliceString=void 0;var yv=a(function(e,t){return function(r){return r.slice(e,t)}},"sliceString");ha.sliceString=yv});var sl=g(je=>{"use strict";var hv=je&&je.__spreadArray||function(e,t,r){if(r||arguments.length===2)for(var n=0,i=t.length,o;n<i;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))};Object.defineProperty(je,"__esModule",{value:!0});je.sort=void 0;var vv=P();function to(){return(0,vv.purry)(bv,arguments)}a(to,"sort");je.sort=to;function bv(e,t){var r=hv([],e,!0);return r.sort(t),r}a(bv,"_sort");(function(e){e.strict=e})(to||(je.sort=to={}))});var cl=g(xe=>{"use strict";var _v=xe&&xe.__spreadArray||function(e,t,r){if(r||arguments.length===2)for(var n=0,i=t.length,o;n<i;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))};Object.defineProperty(xe,"__esModule",{value:!0});xe.sortBy=void 0;var Pv=qe();function ro(){return(0,Pv.purryOrderRules)(Sv,arguments)}a(ro,"sortBy");xe.sortBy=ro;var Sv=a(function(e,t){return _v([],e,!0).sort(t)},"_sortBy");(function(e){e.strict=e})(ro||(xe.sortBy=ro={}))});var lt=g(va=>{"use strict";Object.defineProperty(va,"__esModule",{value:!0});va._binarySearchCutoffIndex=void 0;function Tv(e,t){for(var r=0,n=e.length;r<n;){var i=r+n>>>1,o=e[i];t(o,i)?r=i+1:n=i}return n}a(Tv,"_binarySearchCutoffIndex");va._binarySearchCutoffIndex=Tv});var ul=g(ba=>{"use strict";Object.defineProperty(ba,"__esModule",{value:!0});ba.sortedIndex=void 0;var Mv=P(),Ev=lt();function Ov(){return(0,Mv.purry)(Iv,arguments)}a(Ov,"sortedIndex");ba.sortedIndex=Ov;var Iv=a(function(e,t){return(0,Ev._binarySearchCutoffIndex)(e,function(r){return r<t})},"sortedIndexImplementation")});var dl=g(Sr=>{"use strict";Object.defineProperty(Sr,"__esModule",{value:!0});Sr.sortedIndexBy=void 0;var ll=P(),Av=lt();function no(){return(0,ll.purry)(fl,arguments)}a(no,"sortedIndexBy");Sr.sortedIndexBy=no;(function(e){function t(){return(0,ll.purry)(fl,arguments)}a(t,"indexed"),e.indexed=t})(no||(Sr.sortedIndexBy=no={}));function fl(e,t,r){var n=r(t);return(0,Av._binarySearchCutoffIndex)(e,function(i,o){return r(i,o)<n})}a(fl,"sortedIndexByImplementation")});var gl=g(Tr=>{"use strict";Object.defineProperty(Tr,"__esModule",{value:!0});Tr.sortedIndexWith=void 0;var pl=P(),ml=lt();function ao(){return(0,pl.purry)(ml._binarySearchCutoffIndex,arguments)}a(ao,"sortedIndexWith");Tr.sortedIndexWith=ao;(function(e){function t(){return(0,pl.purry)(ml._binarySearchCutoffIndex,arguments)}a(t,"indexed"),e.indexed=t})(ao||(Tr.sortedIndexWith=ao={}))});var yl=g(_a=>{"use strict";Object.defineProperty(_a,"__esModule",{value:!0});_a.sortedLastIndex=void 0;var Cv=P(),Fv=lt();function wv(){return(0,Cv.purry)(kv,arguments)}a(wv,"sortedLastIndex");_a.sortedLastIndex=wv;var kv=a(function(e,t){return(0,Fv._binarySearchCutoffIndex)(e,function(r){return r<=t})},"sortedLastIndexImplementation")});var bl=g(Mr=>{"use strict";Object.defineProperty(Mr,"__esModule",{value:!0});Mr.sortedLastIndexBy=void 0;var hl=P(),Lv=lt();function io(){return(0,hl.purry)(vl,arguments)}a(io,"sortedLastIndexBy");Mr.sortedLastIndexBy=io;(function(e){function t(){return(0,hl.purry)(vl,arguments)}a(t,"indexed"),e.indexed=t})(io||(Mr.sortedLastIndexBy=io={}));function vl(e,t,r){var n=r(t);return(0,Lv._binarySearchCutoffIndex)(e,function(i,o){return r(i,o)<=n})}a(vl,"sortedLastIndexByImplementation")});var Pl=g(ft=>{"use strict";var _l=ft&&ft.__spreadArray||function(e,t,r){if(r||arguments.length===2)for(var n=0,i=t.length,o;n<i;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))};Object.defineProperty(ft,"__esModule",{value:!0});ft.splice=void 0;var Rv=P();function Dv(){return(0,Rv.purry)(qv,arguments)}a(Dv,"splice");ft.splice=Dv;function qv(e,t,r,n){var i=_l([],e,!0);return i.splice.apply(i,_l([t,r],n,!1)),i}a(qv,"_splice")});var oo=g(dt=>{"use strict";var jv=dt&&dt.__spreadArray||function(e,t,r){if(r||arguments.length===2)for(var n=0,i=t.length,o;n<i;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))};Object.defineProperty(dt,"__esModule",{value:!0});dt.splitAt=void 0;var xv=P();function Nv(){return(0,xv.purry)(Hv,arguments)}a(Nv,"splitAt");dt.splitAt=Nv;function Hv(e,t){var r=jv([],e,!0),n=r.splice(t);return[r,n]}a(Hv,"_splitAt")});var Sl=g(Pa=>{"use strict";Object.defineProperty(Pa,"__esModule",{value:!0});Pa.splitWhen=void 0;var Bv=oo(),zv=P();function Wv(){return(0,zv.purry)(Uv,arguments)}a(Wv,"splitWhen");Pa.splitWhen=Wv;function Uv(e,t){for(var r=0;r<e.length;r++)if(t(e[r]))return(0,Bv.splitAt)(e,r);return[e,[]]}a(Uv,"_splitWhen")});var Ml=g(pt=>{"use strict";var $v=pt&&pt.__spreadArray||function(e,t,r){if(r||arguments.length===2)for(var n=0,i=t.length,o;n<i;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))};Object.defineProperty(pt,"__esModule",{value:!0});pt.stringToPath=void 0;function Gv(e){return Tl(e)}a(Gv,"stringToPath");pt.stringToPath=Gv;function Tl(e){var t;if(e.length===0)return[];var r=(t=e.match(/^\[(.+?)\](.*)$/))!==null&&t!==void 0?t:e.match(/^\.?([^.[\]]+)(.*)$/);if(r){var n=r[1],i=r[2];return $v([n],Tl(i),!0)}return[e]}a(Tl,"_stringToPath")});var El=g(Sa=>{"use strict";Object.defineProperty(Sa,"__esModule",{value:!0});Sa.subtract=void 0;var Vv=P();function Kv(){return(0,Vv.purry)(Jv,arguments)}a(Kv,"subtract");Sa.subtract=Kv;function Jv(e,t){return e-t}a(Jv,"_subtract")});var Al=g(Er=>{"use strict";Object.defineProperty(Er,"__esModule",{value:!0});Er.sumBy=void 0;var Ol=P(),Il=a(function(e){return function(t,r){var n=0;return t.forEach(function(i,o){var s=e?r(i,o,t):r(i);n+=s}),n}},"_sumBy");function so(){return(0,Ol.purry)(Il(!1),arguments)}a(so,"sumBy");Er.sumBy=so;(function(e){function t(){return(0,Ol.purry)(Il(!0),arguments)}a(t,"indexed"),e.indexed=t})(so||(Er.sumBy=so={}))});var Fl=g(Ta=>{"use strict";Object.defineProperty(Ta,"__esModule",{value:!0});Ta.swapIndices=void 0;var Qv=P();function Yv(){return(0,Qv.purry)(Xv,arguments)}a(Yv,"swapIndices");Ta.swapIndices=Yv;function Xv(e,t,r){return typeof e=="string"?Zv(e,t,r):Cl(e,t,r)}a(Xv,"_swapIndices");function Cl(e,t,r){var n=e.slice();if(isNaN(t)||isNaN(r))return n;var i=t<0?e.length+t:t,o=r<0?e.length+r:r;return i<0||i>e.length||o<0||o>e.length||(n[i]=e[o],n[o]=e[i]),n}a(Cl,"_swapArray");function Zv(e,t,r){var n=Cl(e.split(""),t,r);return n.join("")}a(Zv,"_swapString")});var wl=g(mt=>{"use strict";var Ma=mt&&mt.__assign||function(){return Ma=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},Ma.apply(this,arguments)};Object.defineProperty(mt,"__esModule",{value:!0});mt.swapProps=void 0;var eb=P();function tb(){return(0,eb.purry)(rb,arguments)}a(tb,"swapProps");mt.swapProps=tb;function rb(e,t,r){var n,i=e,o=t,s=i[o],u=r,f=i[u];return Ma(Ma({},e),(n={},n[t]=f,n[r]=s,n))}a(rb,"_swapProps")});var kl=g(Ir=>{"use strict";Object.defineProperty(Ir,"__esModule",{value:!0});Ir.take=void 0;var nb=P(),ab=G();function Or(){return(0,nb.purry)(ib,arguments,Or.lazy)}a(Or,"take");Ir.take=Or;function ib(e,t){return(0,ab._reduceLazy)(e,Or.lazy(t))}a(ib,"_take");(function(e){function t(r){return function(n){return r===0?{done:!0,hasNext:!1}:(r--,r===0?{done:!0,hasNext:!0,next:n}:{done:!1,hasNext:!0,next:n})}}a(t,"lazy"),e.lazy=t})(Or||(Ir.take=Or={}))});var Rl=g(gt=>{"use strict";var ob=gt&&gt.__spreadArray||function(e,t,r){if(r||arguments.length===2)for(var n=0,i=t.length,o;n<i;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))};Object.defineProperty(gt,"__esModule",{value:!0});gt.takeFirstBy=void 0;var Ll=Ei(),sb=qe();function cb(){return(0,sb.purryOrderRulesWithArgument)(ub,arguments)}a(cb,"takeFirstBy");gt.takeFirstBy=cb;function ub(e,t,r){if(r<=0)return[];if(r>=e.length)return ob([],e,!0);var n=e.slice(0,r);(0,Ll.heapify)(n,t);for(var i=e.slice(r),o=0,s=i;o<s.length;o++){var u=s[o];(0,Ll.heapMaybeInsert)(n,t,u)}return n}a(ub,"takeFirstByImplementation")});var Dl=g(Ea=>{"use strict";Object.defineProperty(Ea,"__esModule",{value:!0});Ea.takeLastWhile=void 0;var lb=P();function fb(){return(0,lb.purry)(db,arguments)}a(fb,"takeLastWhile");Ea.takeLastWhile=fb;function db(e,t){for(var r=e.length-1;r>=0;r--)if(!t(e[r]))return e.slice(r+1);return e.slice()}a(db,"_takeLastWhile")});var ql=g(Oa=>{"use strict";Object.defineProperty(Oa,"__esModule",{value:!0});Oa.takeWhile=void 0;var pb=P();function mb(){return(0,pb.purry)(gb,arguments)}a(mb,"takeWhile");Oa.takeWhile=mb;function gb(e,t){for(var r=[],n=0,i=e;n<i.length;n++){var o=i[n];if(!t(o))break;r.push(o)}return r}a(gb,"_takeWhile")});var jl=g(Ia=>{"use strict";Object.defineProperty(Ia,"__esModule",{value:!0});Ia.tap=void 0;var yb=P();function hb(){return(0,yb.purry)(vb,arguments)}a(hb,"tap");Ia.tap=hb;function vb(e,t){return t(e),e}a(vb,"_tap")});var xl=g(Aa=>{"use strict";Object.defineProperty(Aa,"__esModule",{value:!0});Aa.times=void 0;var bb=P();function _b(){return(0,bb.purry)(Pb,arguments)}a(_b,"times");Aa.times=_b;function Pb(e,t){if(e<0)throw new RangeError("n must be a non-negative number");for(var r=[],n=0;n<e;n++)r.push(t(n));return r}a(Pb,"_times")});var Nl=g(Cr=>{"use strict";Object.defineProperty(Cr,"__esModule",{value:!0});Cr.uniq=void 0;var Sb=P(),Tb=G();function Ar(){return(0,Sb.purry)(Mb,arguments,Ar.lazy)}a(Ar,"uniq");Cr.uniq=Ar;function Mb(e){return(0,Tb._reduceLazy)(e,Ar.lazy())}a(Mb,"_uniq");(function(e){function t(){var r=new Set;return function(n){return r.has(n)?{done:!1,hasNext:!1}:(r.add(n),{done:!1,hasNext:!0,next:n})}}a(t,"lazy"),e.lazy=t})(Ar||(Cr.uniq=Ar={}))});var Bl=g(Ca=>{"use strict";Object.defineProperty(Ca,"__esModule",{value:!0});Ca.uniqBy=void 0;var Eb=P(),Ob=G();function Ib(){return(0,Eb.purry)(Ab,arguments,Hl)}a(Ib,"uniqBy");Ca.uniqBy=Ib;function Ab(e,t){return(0,Ob._reduceLazy)(e,Hl(t))}a(Ab,"_uniqBy");function Hl(e){var t=new Set;return function(r){var n=e(r);return t.has(n)?{done:!1,hasNext:!1}:(t.add(n),{done:!1,hasNext:!0,next:r})}}a(Hl,"lazyUniqBy")});var zl=g(wr=>{"use strict";Object.defineProperty(wr,"__esModule",{value:!0});wr.uniqWith=void 0;var Cb=P(),Fb=G(),wb=_e();function Fr(){return(0,Cb.purry)(kb,arguments,Fr.lazy)}a(Fr,"uniqWith");wr.uniqWith=Fr;function kb(e,t){var r=Fr.lazy(t);return(0,Fb._reduceLazy)(e,r,!0)}a(kb,"_uniqWith");function Lb(e){return function(t,r,n){return n&&n.findIndex(function(i){return e(t,i)})===r?{done:!1,hasNext:!0,next:t}:{done:!1,hasNext:!1}}}a(Lb,"_lazy");(function(e){e.lazy=(0,wb._toLazyIndexed)(Lb)})(Fr||(wr.uniqWith=Fr={}))});var Wl=g(Fa=>{"use strict";Object.defineProperty(Fa,"__esModule",{value:!0});Fa.values=void 0;function Rb(e){return Object.values(e)}a(Rb,"values");Fa.values=Rb});var Ul=g(kr=>{"use strict";Object.defineProperty(kr,"__esModule",{value:!0});kr.zip=void 0;var Db=P();function co(){return(0,Db.purry)(qb,arguments)}a(co,"zip");kr.zip=co;function qb(e,t){for(var r=e.length>t.length?t.length:e.length,n=[],i=0;i<r;i++)n.push([e[i],t[i]]);return n}a(qb,"_zip");(function(e){e.strict=e})(co||(kr.zip=co={}))});var $l=g(wa=>{"use strict";Object.defineProperty(wa,"__esModule",{value:!0});wa.zipObj=void 0;var jb=P();function xb(){return(0,jb.purry)(Nb,arguments)}a(xb,"zipObj");wa.zipObj=xb;function Nb(e,t){for(var r=e.length>t.length?t.length:e.length,n={},i=0;i<r;i++)n[e[i]]=t[i];return n}a(Nb,"_zipObj")});var Gl=g(ka=>{"use strict";Object.defineProperty(ka,"__esModule",{value:!0});ka.zipWith=void 0;function Hb(){var e=Array.from(arguments);if(typeof e[0]=="function"&&e.length===1)return function(t,r){return uo(t,r,e[0])};if(typeof e[0]=="function"&&e.length===2)return function(t){return uo(t,e[1],e[0])};if(e.length===3)return uo(e[0],e[1],e[2])}a(Hb,"zipWith");ka.zipWith=Hb;function uo(e,t,r){for(var n=e.length>t.length?t.length:e.length,i=[],o=0;o<n;o++)i.push(r(e[o],t[o]));return i}a(uo,"_zipWith")});var yt=g(h=>{"use strict";var Bb=h&&h.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),v=h&&h.__exportStar||function(e,t){for(var r in e)r!=="default"&&!Object.prototype.hasOwnProperty.call(t,r)&&Bb(t,e,r)};Object.defineProperty(h,"__esModule",{value:!0});v(cs(),h);v(us(),h);v(ls(),h);v(fs(),h);v(ps(),h);v(ms(),h);v(gs(),h);v(hs(),h);v(vs(),h);v(bs(),h);v(Ss(),h);v(Es(),h);v(Is(),h);v(As(),h);v(Cs(),h);v(Fs(),h);v(ws(),h);v(ks(),h);v(Ns(),h);v(Hs(),h);v(Bs(),h);v(zs(),h);v($s(),h);v(Vs(),h);v(Ys(),h);v(rc(),h);v(sc(),h);v(lc(),h);v(pc(),h);v(mc(),h);v(gc(),h);v(yc(),h);v(bc(),h);v(Di(),h);v(_c(),h);v(Pc(),h);v(Ec(),h);v(Ac(),h);v(Ni(),h);v(wc(),h);v(Ri(),h);v(kc(),h);v(Rc(),h);v(Dc(),h);v(qc(),h);v(jc(),h);v(Wi(),h);v(xc(),h);v(Nc(),h);v(Hc(),h);v(Bc(),h);v(zc(),h);v(Wc(),h);v(Uc(),h);v($c(),h);v(Gc(),h);v(Vc(),h);v($i(),h);v(Kc(),h);v(Jc(),h);v(Qc(),h);v(Gi(),h);v(Yc(),h);v(_i(),h);v(Xc(),h);v(Zc(),h);v(eu(),h);v(tu(),h);v(iu(),h);v(su(),h);v(lu(),h);v(du(),h);v(gu(),h);v(vu(),h);v(bu(),h);v(_u(),h);v(Tu(),h);v(Ou(),h);v(Iu(),h);v(Au(),h);v(ku(),h);v(Lu(),h);v(Ru(),h);v(Du(),h);v(qu(),h);v(ju(),h);v(Hu(),h);v(Bu(),h);v(zu(),h);v(Wu(),h);v(Ti(),h);v(Uu(),h);v(P(),h);v($u(),h);v(Zi(),h);v(Gu(),h);v(Ju(),h);v(Zu(),h);v(el(),h);v(tl(),h);v(rl(),h);v(nl(),h);v(al(),h);v(il(),h);v(ol(),h);v(sl(),h);v(cl(),h);v(ul(),h);v(dl(),h);v(gl(),h);v(yl(),h);v(bl(),h);v(Pl(),h);v(oo(),h);v(Sl(),h);v(Ml(),h);v(El(),h);v(Al(),h);v(Fl(),h);v(wl(),h);v(kl(),h);v(Rl(),h);v(Dl(),h);v(ql(),h);v(jl(),h);v(xl(),h);v(Ci(),h);v(bi(),h);v(Nl(),h);v(Bl(),h);v(zl(),h);v(Wl(),h);v(Ul(),h);v($l(),h);v(Gl(),h)});var Kl=g(ue=>{"use strict";Object.defineProperty(ue,"__esModule",{value:!0});ue.isPlayedActor=ue.isOwner=ue.getOwner=ue.getHighestName=void 0;function zb(e){return!!e?.id&&!e.pack&&game.actors.has(e.id)}a(zb,"isPlayedActor");ue.isPlayedActor=zb;function Wb(e){return e.token?.name??e.prototypeToken?.name??e.name}a(Wb,"getHighestName");ue.getHighestName=Wb;function Vl(e){let t=a(n=>n.active&&!n.isGM,"isValidUser"),r=game.users.filter(n=>t(n)&&n.character===e);return r.length||(r=game.users.filter(n=>t(n)&&e.testUserPermission(n,"OWNER"))),r.sort((n,i)=>n.id>i.id?1:-1),r[0]||null}a(Vl,"getOwner");ue.getOwner=Vl;function Ub(e){return Vl(e)===game.user}a(Ub,"isOwner");ue.isOwner=Ub});var Jl=g(le=>{"use strict";Object.defineProperty(le,"__esModule",{value:!0});le.renderApplication=le.canRender=le.refreshApplication=le.openApplication=void 0;function $b(e,...t){let r=t.at(-1).id,n=Object.values(ui.windows).find(i=>i instanceof e&&i.id===r);return n?(n.bringToTop(),n):new e(...t).render(!0)}a($b,"openApplication");le.openApplication=$b;function Gb(e){e.setPosition({height:"auto"})}a(Gb,"refreshApplication");le.refreshApplication=Gb;function Vb(e,t){return t||e._state<=Application.RENDER_STATES.NONE}a(Vb,"canRender");le.canRender=Vb;function Kb(e){Object.values(ui.windows).find(r=>r.id===e)?.render()}a(Kb,"renderApplication");le.renderApplication=Kb});var Yl=g(Y=>{"use strict";var Jb=Y&&Y.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),Qb=Y&&Y.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),Yb=Y&&Y.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&Jb(t,e,r);return Qb(t,e),t};Object.defineProperty(Y,"__esModule",{value:!0});Y.getOnly=Y.compareArrays=Y.arrayIncludesOne=void 0;var Ql=Yb(yt());function Xb(e,t){return t.some(r=>e.includes(r))}a(Xb,"arrayIncludesOne");Y.arrayIncludesOne=Xb;function Zb(e,t,r=!1){if(e=r?Ql.compact(e):e,t=r?Ql.compact(t):t.slice(),e.length!==t.length)return!1;for(let n of e){let i=t.findIndex(o=>n===o);if(i===-1)return!1;t.splice(i,1)}return!0}a(Zb,"compareArrays");Y.compareArrays=Zb;function e_(e,t){if(!e)return;let r=Array.isArray(e);if(r&&e.length!==1||!r&&e.size!==1)return;let n=r?e[0]:e.first();if(n)return(!t||t(n))&&n||void 0}a(e_,"getOnly");Y.getOnly=e_});var Xl=g(La=>{"use strict";Object.defineProperty(La,"__esModule",{value:!0});La.getDropTarget=void 0;function t_(e,t,r){return[...e.tokens.placeables].sort((n,i)=>i.document.sort-n.document.sort).find(n=>{if(r&&!r(n))return!1;let i=n.x+(n.hitArea?.right??0),o=n.y+(n.hitArea?.bottom??0);return t.x>=n.x&&t.y>=n.y&&t.x<=i&&t.y<=o})}a(t_,"getDropTarget");La.getDropTarget=t_});var ef=g(Te=>{"use strict";Object.defineProperty(Te,"__esModule",{value:!0});Te.latestChatMessages=Te.refreshLatestMessages=Te.createChatLink=void 0;function r_(e,{label:t,html:r}={}){let n=e instanceof foundry.abstract.Document;!t&&n&&(t=e.name);let i=`@UUID[${n?e.uuid:e}]`;return t&&(i=`${i}{${t}}`),r?TextEditor.enrichHTML(i):i}a(r_,"createChatLink");Te.createChatLink=r_;function*Zl(e,t){let r=ui.chat?.element;if(!r)return;let n=game.messages.contents,i=(t?n.findLastIndex(o=>o===t):n.length)-1;for(let o=i;o>=i-e;o--){let s=n[o];if(!s)return;let u=r.find(`[data-message-id=${s.id}]`);u.length&&(yield{message:s,li:u})}}a(Zl,"latestChatMessages");Te.latestChatMessages=Zl;async function n_(e){for(let{message:t,li:r}of Zl(20)){let n=await t.getHTML();r.replaceWith(n)}}a(n_,"refreshLatestMessages");Te.refreshLatestMessages=n_});var tf=g(Ra=>{"use strict";Object.defineProperty(Ra,"__esModule",{value:!0});Ra.createTimeout=void 0;function a_(e,t=1){let r=null,n=a(()=>{r!==null&&(clearTimeout(r),r=null)},"cancel"),i=a((...o)=>{r!==null&&n(),t<1?e(...o):r=setTimeout(e,t,...o)},"fn");return Object.defineProperty(i,"start",{value:(o,...s)=>{r!==null&&n(),o<1?e(...s):r=setTimeout(e,o,...s)},enumerable:!1,configurable:!1}),Object.defineProperty(i,"cancel",{value:n,enumerable:!1,configurable:!1}),i}a(a_,"createTimeout");Ra.createTimeout=a_});var rf=g(Da=>{"use strict";Object.defineProperty(Da,"__esModule",{value:!0});Da.waitDialog=void 0;var i_=ie();async function o_(e){let t=e.yes.icon??"fa-solid fa-check",r=e.no.icon??"fa-solid fa-xmark",n={yes:{icon:`<i class='${t}'></i>`,label:e.yes.label,callback:e.yes.callback},no:{icon:`<i class='${r}'></i>`,label:e.no.label,callback:e.no.callback??(()=>null)}},i=await(0,i_.render)(e.template,e.data);return Dialog.wait({title:e.title,content:i,buttons:n,default:e.default??"yes",close:()=>null},{id:e.id})}a(o_,"waitDialog");Da.waitDialog=o_});var nf=g(Me=>{"use strict";Object.defineProperty(Me,"__esModule",{value:!0});Me.getSortBounds=Me.getSourceIdCondition=Me.getSourceId=void 0;function lo(e){return e.getFlag("core","sourceId")}a(lo,"getSourceId");Me.getSourceId=lo;function s_(e,t){let r=lo(e);return r?t.includes(r):!1}a(s_,"includesSourceId");function c_(e){return Array.isArray(e)?t=>s_(t,e):t=>lo(t)===e}a(c_,"getSourceIdCondition");Me.getSourceIdCondition=c_;function u_(e){let t=0,r=0;for(let n of e)n.sort>r?r=n.sort:n.sort<t&&(t=n.sort);return{min:t,max:r}}a(u_,"getSortBounds");Me.getSortBounds=u_});var af=g(qa=>{"use strict";Object.defineProperty(qa,"__esModule",{value:!0});qa.withEventManager=void 0;function l_(e){let t=1,r={};return class extends e{registerListener(n,i,o){r[n]??=[];let s=t++;return r[n].push({id:s,listener:i,once:typeof o=="boolean"?o:o?.once??!1,context:typeof o=="object"?o.context:void 0}),s}removeListener(n,i){let o=typeof i=="number"?u=>u.id===i:u=>u.listener===i,s=r[n]?.findIndex(o)??-1;return s===-1?!1:(r[n].splice(s,1),!0)}emitEvent(n,...i){let o=r[n];if(o)for(let{listener:s,once:u,context:f,id:l}of o)f?s.apply(f,i):s(...i),u&&this.removeListener(n,l)}purgeListeners(){r={}}}}a(l_,"withEventManager");qa.withEventManager=l_});var sf=g(w=>{"use strict";var f_=w&&w.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),d_=w&&w.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),p_=w&&w.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&f_(t,e,r);return d_(t,e),t};Object.defineProperty(w,"__esModule",{value:!0});w.updateSourceFlag=w.updateFlag=w.unsetMofuleFlag=w.unsetFlag=w.setFlagProperty=w.setFlag=w.hasModuleFlag=w.getFlagProperty=w.getModuleFlag=w.getFlag=w.flagPath=void 0;var m_=p_(yt()),ht=ie();function g_(e,...t){return e.getFlag(ht.MODULE.id,t.join("."))}a(g_,"getFlag");w.getFlag=g_;function y_(e,...t){let r=t.pop();return e.setFlag(ht.MODULE.id,t.join("."),r)}a(y_,"setFlag");w.setFlag=y_;function h_(e,...t){return e.unsetFlag(ht.MODULE.id,t.join("."))}a(h_,"unsetFlag");w.unsetFlag=h_;function Lr(...e){return`flags.${ht.MODULE.path(e)}`}a(Lr,"flagPath");w.flagPath=Lr;function v_(e,t){let r=m_.mapKeys(t,n=>Lr(n));return e.update(r)}a(v_,"updateFlag");w.updateFlag=v_;function b_(e,...t){let r=t.pop();return e.updateSource({[Lr(...t)]:r})}a(b_,"updateSourceFlag");w.updateSourceFlag=b_;function __(e,...t){return getProperty(e,Lr(...t))}a(__,"getFlagProperty");w.getFlagProperty=__;function P_(e,...t){let r=t.pop();return setProperty(e,Lr(...t),r),e}a(P_,"setFlagProperty");w.setFlagProperty=P_;function of(e){return getProperty(e,`flags.${ht.MODULE.id}`)}a(of,"getModuleFlag");w.getModuleFlag=of;function S_(e){return of(e)!==void 0}a(S_,"hasModuleFlag");w.hasModuleFlag=S_;function T_(e){return e.update({[`flags.-=${ht.MODULE.id}`]:!0})}a(T_,"unsetMofuleFlag");w.unsetMofuleFlag=T_});var lf=g(vt=>{"use strict";Object.defineProperty(vt,"__esModule",{value:!0});vt.render=vt.templatePath=void 0;var cf=ie();function uf(...e){return`modules/${cf.MODULE.id}/templates/${(0,cf.joinStr)("/",e)}.hbs`}a(uf,"templatePath");vt.templatePath=uf;function M_(...e){let t=typeof e.at(-1)=="object"?e.pop():{},r=uf(...e);return renderTemplate(r,t)}a(M_,"render");vt.render=M_});var ff=g(bt=>{"use strict";Object.defineProperty(bt,"__esModule",{value:!0});bt.registerUpstreamHook=bt.createHook=void 0;function E_(e,t){let r=Hooks.on(e,t),n=Hooks.events[e].findIndex(i=>i.id===r);if(n!==0){let[i]=Hooks.events[e].splice(n,1);Hooks.events[e].unshift(i)}return r}a(E_,"registerUpstreamHook");bt.registerUpstreamHook=E_;function O_(e,t){let r=null;return{activate(){r===null&&(r=Hooks.on(e,t))},disable(){r!==null&&(Hooks.off(e,r),r=null)},toggle(n){n?this.activate():this.disable()}}}a(O_,"createHook");bt.createHook=O_});var mf=g(A=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0});A.queryInParent=A.queryInClosest=A.querySelectorArray=A.querySelector=A.prependHTMLFromString=A.parentElement=A.isCheckboxElement=A.htmlElement=A.elementData=A.dataToDatasetString=A.createHTMLFromString=A.closest=A.beforeHTMLFromString=A.appendHTMLFromString=A.afterHTMLFromString=A.addListenerAll=A.addListener=void 0;function I_(e){return e instanceof HTMLElement?e:e[0]}a(I_,"htmlElement");A.htmlElement=I_;function A_(e){return e instanceof HTMLInputElement&&e.type==="checkbox"}a(A_,"isCheckboxElement");A.isCheckboxElement=A_;function ja(e,t=!0){let r=document.createElement("div");r.innerHTML=e;let n=r.children;return n.length===1?n[0]:t?r:n}a(ja,"createHTMLFromString");A.createHTMLFromString=ja;function fo(e,t,r){let n=r?e.bind(r):e;t instanceof HTMLCollection?n(...t):n(t)}a(fo,"applyHtmlMethod");function df(e,t,r=!1){if(!e)return;let n=ja(t,!1);return fo(r?e.prepend:e.append,n,e),n}a(df,"insertHTMLFromString");function C_(e,t){return df(e,t,!1)}a(C_,"appendHTMLFromString");A.appendHTMLFromString=C_;function F_(e,t){return df(e,t,!0)}a(F_,"prependHTMLFromString");A.prependHTMLFromString=F_;function w_(e,t){if(!e)return;let r=ja(t,!1);return fo(e.before,r,e),r}a(w_,"beforeHTMLFromString");A.beforeHTMLFromString=w_;function k_(e,t){if(!e)return;let r=ja(t,!1);return fo(e.after,r,e),r}a(k_,"afterHTMLFromString");A.afterHTMLFromString=k_;function L_(e,t,r,n,i){let o=e.querySelector(t);if(!o)return;let s=typeof r=="string"?r:"click",u=typeof r=="function"?r:n,f=typeof n=="boolean"?n:i;return o.addEventListener(s,l=>u(l,o),f),o}a(L_,"addListener");A.addListener=L_;function R_(e,t,r,n){let i=e.querySelectorAll(t),o=typeof r=="string"?r:"click",s=typeof r=="function"?r:n;for(let u of i)u.addEventListener(o,f=>s(f,u));return i}a(R_,"addListenerAll");A.addListenerAll=R_;function po(e,t){return e?e.querySelector(t):null}a(po,"querySelector");A.querySelector=po;function D_(e,t){return e?Array.from(e.querySelectorAll(t)):[]}a(D_,"querySelectorArray");A.querySelectorArray=D_;function q_(e,t,r){let n=pf(e,t);return po(n,r)}a(q_,"queryInClosest");A.queryInClosest=q_;function j_(e,t){return po(e.parentElement,t)}a(j_,"queryInParent");A.queryInParent=j_;function pf(e,t){return e?e.closest(t):null}a(pf,"closest");A.closest=pf;function x_(e){return e.parentElement}a(x_,"parentElement");A.parentElement=x_;function N_(e){return e.dataset}a(N_,"elementData");A.elementData=N_;function H_(e){return Object.entries(e).map(([t,r])=>{let n=typeof r=="object"?JSON.stringify(r):r;return`data-${t}='${n}'`}).join(" ")}a(H_,"dataToDatasetString");A.dataToDatasetString=H_});var yf=g(Ee=>{"use strict";Object.defineProperty(Ee,"__esModule",{value:!0});Ee.getItems=Ee.hasItemWithSourceId=Ee.getItemWithSourceId=void 0;var gf=ie();function mo(e,t=[]){let r=typeof t=="string"?[t]:t;return r.length?r.flatMap(n=>e.itemTypes[n]):e.items}a(mo,"getItems");Ee.getItems=mo;function B_(e,t,r){return mo(e,r).some((0,gf.getSourceIdCondition)(t))}a(B_,"hasItemWithSourceId");Ee.hasItemWithSourceId=B_;function z_(e,t,r){return mo(e,r).find((0,gf.getSourceIdCondition)(t))}a(z_,"getItemWithSourceId");Ee.getItemWithSourceId=z_});var vo=g(V=>{"use strict";Object.defineProperty(V,"__esModule",{value:!0});V.subLocalize=V.templateLocalize=V.localizePath=V.hasLocalization=V.localizeIfExist=V.localize=V.localeCompare=void 0;var me=ie();function go(...e){e.unshift(me.MODULE.id);let t=typeof e.at(-1)=="object"?e.pop():void 0,r=(0,me.joinStr)(".",e);return typeof t=="object"?game.i18n.format(r,t):game.i18n.localize(r)}a(go,"localize");V.localize=go;function hf(...e){e.unshift(me.MODULE.id);let t=typeof e.at(-1)=="object"?e.pop():void 0,r=(0,me.joinStr)(".",e);if(game.i18n.has(r,!1))return typeof t=="object"?game.i18n.format(r,t):game.i18n.localize(r)}a(hf,"localizeIfExist");V.localizeIfExist=hf;function vf(...e){return game.i18n.has(`${me.MODULE.path(e)}`,!1)}a(vf,"hasLocalization");V.hasLocalization=vf;function yo(...e){return me.MODULE.path(e)}a(yo,"localizePath");V.localizePath=yo;function bf(e){let t=a((r,{hash:n})=>go(e,r,n),"fn");return Object.defineProperties(t,{path:{value:r=>yo(e,r),enumerable:!1,configurable:!1},sub:{value:r=>{let n=e?`${e}.${r}`:r;return ho(n).i18n},enumerable:!1,configurable:!1}}),t}a(bf,"templateLocalize");V.templateLocalize=bf;function ho(e){let t=a((...r)=>go(e,...r),"fn");return Object.defineProperties(t,{ifExist:{value:(...r)=>hf(e,...r),enumerable:!1,configurable:!1},warn:{value:(r,n,i)=>(0,me.warn)(`${e}.${r}`,n,i),enumerable:!1,configurable:!1},info:{value:(r,n,i)=>(0,me.info)(`${e}.${r}`,n,i),enumerable:!1,configurable:!1},error:{value:(r,n,i)=>(0,me.error)(`${e}.${r}`,n,i),enumerable:!1,configurable:!1},has:{value:r=>vf(e,r),enumerable:!1,configurable:!1},path:{value:r=>yo(e,r),enumerable:!1,configurable:!1},sub:{value:r=>ho(`${e}.${r}`),enumerable:!1,configurable:!1},i18n:{get(){return bf(e)},enumerable:!1,configurable:!1}}),t}a(ho,"subLocalize");V.subLocalize=ho;function W_(e,t){return e.localeCompare(t,game.i18n.lang)}a(W_,"localeCompare");V.localeCompare=W_});var Dr=g(_t=>{"use strict";Object.defineProperty(_t,"__esModule",{value:!0});_t.getActiveModule=_t.MODULE=void 0;var U_=ie(),Rr="",_f="",$_={get id(){if(!Rr)throw new Error("Module needs to be registered.");return Rr},get name(){if(!Rr)throw new Error("Module needs to be registered.");return _f},get current(){return game.modules.get(this.id)},throwError(e){throw new Error(`
[${this.name}] ${e}`)},error(e,t){let r=`[${this.name}] ${e}`;t instanceof Error?r+=`
${t.message}`:typeof t=="string"&&(r+=`
${t}`),console.error(r)},log(e){console.log(`[${this.name}] ${e}`)},path(...e){return`${this.id}.${(0,U_.joinStr)(".",...e)}`},register(e,t){if(Rr)throw new Error("Module was already registered.");Rr=e,_f=t}};_t.MODULE=$_;function G_(e){let t=game.modules.get(e);return t?.active?t:void 0}a(G_,"getActiveModule");_t.getActiveModule=G_});var Sf=g(xa=>{"use strict";Object.defineProperty(xa,"__esModule",{value:!0});xa.registerKeybind=void 0;var Pf=vo(),V_=Dr();function K_(e,t){game.keybindings.register(V_.MODULE.id,e,{...t,name:(0,Pf.localizePath)("keybindings",e,"name"),hint:(0,Pf.localizePath)("keybindings",e,"hint")})}a(K_,"registerKeybind");xa.registerKeybind=K_});var Of=g(Oe=>{"use strict";Object.defineProperty(Oe,"__esModule",{value:!0});Oe.unregisterWrapper=Oe.registerWrapper=Oe.createWrapper=void 0;var Tf=ie();function Mf(e,t,r){let n=[],i=Array.isArray(e)?e:[e];for(let o of i){let s=libWrapper.register(Tf.MODULE.id,o,t,r);n.push(s)}return n.length===1?n[0]:n}a(Mf,"registerWrapper");Oe.registerWrapper=Mf;function Ef(e){libWrapper.unregister(Tf.MODULE.id,e)}a(Ef,"unregisterWrapper");Oe.unregisterWrapper=Ef;function J_(e,t,r,n){let i=null;return{activate(){i===null&&(i=Mf(e,t,r??"WRAPPER"),n?.onActivate?.())},disable(){i!==null&&(Ef(i),i=null,n?.onDisable?.())},toggle(o){o?this.activate():this.disable()}}}a(J_,"createWrapper");Oe.createWrapper=J_});var If=g(Ie=>{"use strict";Object.defineProperty(Ie,"__esModule",{value:!0});Ie.warn=Ie.info=Ie.error=void 0;var Q_=ie();function bo(e,t,r,n){let i=typeof t=="string"?t:"info",o=typeof t=="object"?t:typeof r=="object"?r:void 0,s=typeof t=="boolean"?t:typeof r=="boolean"?r:n??!1;ui.notifications.notify((0,Q_.localize)(e,o),i,{permanent:s})}a(bo,"notify");function Y_(e,t,r){bo(e,"warning",t,r)}a(Y_,"warn");Ie.warn=Y_;function X_(e,t,r){bo(e,"info",t,r)}a(X_,"info");Ie.info=X_;function Z_(e,t,r){bo(e,"error",t,r)}a(Z_,"error");Ie.error=Z_});var Ff=g(X=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0});X.setInMemory=X.getInMemoryAndSetIfNot=X.getInMemory=X.isInstanceOf=X.deleteInMemory=X.AsyncFunction=void 0;var _o=Dr(),eP=Object.getPrototypeOf(async function(){}).constructor;X.AsyncFunction=eP;function tP(e,t){if(typeof e!="object")return!1;let r=Reflect.getPrototypeOf(e);for(;r;){if(r.constructor.name===t)return!0;r=Reflect.getPrototypeOf(r)}return!1}a(tP,"isInstanceOf");X.isInstanceOf=tP;function Af(e,...t){return getProperty(e,`modules.${_o.MODULE.id}.${t.join(".")}`)}a(Af,"getInMemory");X.getInMemory=Af;function Cf(e,...t){let r=t.pop();return setProperty(e,`modules.${_o.MODULE.id}.${t.join(".")}`,r)}a(Cf,"setInMemory");X.setInMemory=Cf;function rP(e,...t){let r=t.pop(),n=Af(e,...t);if(n!=null)return n;let i=typeof r=="function"?r():r;return Cf(e,...t,i),i}a(rP,"getInMemoryAndSetIfNot");X.getInMemoryAndSetIfNot=rP;function nP(e,...t){let r=["modules",_o.MODULE.id,...t.flatMap(o=>o.split("."))],n=r.pop(),i=e;for(let o of r){if(typeof i!="object"||!(o in i))return!0;i=i[o]}return delete i[n]}a(nP,"deleteInMemory");X.deleteInMemory=nP});var wf=g(q=>{"use strict";var aP=q&&q.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),iP=q&&q.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),oP=q&&q.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&aP(t,e,r);return iP(t,e),t};Object.defineProperty(q,"__esModule",{value:!0});q.settingPath=q.setSetting=q.registerSettingMenu=q.registerSetting=q.isClientSetting=q.isWorldSetting=q.isMenuSetting=q.getSetting=void 0;var sP=oP(yt()),qr=ie();function cP(e){"choices"in e&&Array.isArray(e.choices)&&(e.choices=sP.mapToObj(e.choices,t=>[t,Ne(e.key,"choices",t)])),e.name??=Ne(e.key,"name"),e.hint??=Ne(e.key,"hint"),e.scope??="world",e.config??=!0,game.settings.register(qr.MODULE.id,e.key,e)}a(cP,"registerSetting");q.registerSetting=cP;function uP(e){e.name??=Ne("menus",e.key,"name"),e.label??=Ne("menus",e.key,"label"),e.hint??=Ne("menus",e.key,"hint"),e.restricted??=!0,e.icon??="fas fa-cogs",game.settings.registerMenu(qr.MODULE.id,e.key,e)}a(uP,"registerSettingMenu");q.registerSettingMenu=uP;function Ne(...e){return qr.MODULE.path("settings",...e)}a(Ne,"settingPath");q.settingPath=Ne;function lP(e){return game.settings.get(qr.MODULE.id,e)}a(lP,"getSetting");q.getSetting=lP;function fP(e,t){return game.settings.set(qr.MODULE.id,e,t)}a(fP,"setSetting");q.setSetting=fP;function dP(e){return"restricted"in e?!e.restricted:"scope"in e&&e.scope==="client"}a(dP,"isClientSetting");q.isClientSetting=dP;function pP(e){return"restricted"in e?!!e.restricted:"scope"in e&&e.scope==="world"}a(pP,"isWorldSetting");q.isWorldSetting=pP;function mP(e){return e.type.prototype instanceof FormApplication}a(mP,"isMenuSetting");q.isMenuSetting=mP});var kf=g(Ae=>{"use strict";Object.defineProperty(Ae,"__esModule",{value:!0});Ae.socketOn=Ae.socketOff=Ae.socketEmit=void 0;var Po=Dr();function gP(e){game.socket.on(`module.${Po.MODULE.id}`,e)}a(gP,"socketOn");Ae.socketOn=gP;function yP(e){game.socket.off(`module.${Po.MODULE.id}`,e)}a(yP,"socketOff");Ae.socketOff=yP;function hP(e){game.socket.emit(`module.${Po.MODULE.id}`,e)}a(hP,"socketEmit");Ae.socketEmit=hP});var Lf=g(W=>{"use strict";var vP=W&&W.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),bP=W&&W.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),_P=W&&W.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&vP(t,e,r);return bP(t,e),t};Object.defineProperty(W,"__esModule",{value:!0});W.stringNumber=W.stringBoolean=W.safeSplit=W.joinStr=W.beautity=void 0;var Na=_P(yt());function PP(e,...t){return Na.pipe(t,Na.flatten(),Na.filter(r=>typeof r=="string"),Na.join(e))}a(PP,"joinStr");W.joinStr=PP;function SP(e,t=","){return e.split(t).map(r=>r.trim()).filter(Boolean)}a(SP,"safeSplit");W.safeSplit=SP;function TP(e){return e.replaceAll(/[-_.]([a-z])/g,(t,r)=>` ${r.toUpperCase()}`).capitalize()}a(TP,"beautity");W.beautity=TP;function MP(e){return String(e)}a(MP,"stringBoolean");W.stringBoolean=MP;function EP(e){return String(e)}a(EP,"stringNumber");W.stringNumber=EP});var Rf=g(Ce=>{"use strict";Object.defineProperty(Ce,"__esModule",{value:!0});Ce.userIsGM=Ce.isActiveGM=Ce.hasGMOnline=void 0;function OP(){return game.user??game.data.users.find(e=>e._id===game.data.userId)}a(OP,"getCurrentUser");function IP(){return game.user===game.users.activeGM}a(IP,"isActiveGM");Ce.isActiveGM=IP;function AP(e){return e??=OP(),e&&e.role>=CONST.USER_ROLES.ASSISTANT}a(AP,"userIsGM");Ce.userIsGM=AP;function CP(){return game.users.some(e=>e.active&&e.isGM)}a(CP,"hasGMOnline");Ce.hasGMOnline=CP});var ie=g(F=>{"use strict";var FP=F&&F.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),j=F&&F.__exportStar||function(e,t){for(var r in e)r!=="default"&&!Object.prototype.hasOwnProperty.call(t,r)&&FP(t,e,r)};Object.defineProperty(F,"__esModule",{value:!0});F.isOfType=void 0;j(Kl(),F);j(Jl(),F);j(Yl(),F);j(Xl(),F);j(ef(),F);j(tf(),F);j(rf(),F);j(nf(),F);j(af(),F);j(sf(),F);j(lf(),F);j(ff(),F);j(mf(),F);j(yf(),F);j(Sf(),F);j(Of(),F);j(vo(),F);j(Dr(),F);j(If(),F);j(Ff(),F);j(wf(),F);j(kf(),F);j(Lf(),F);j(Rf(),F);function wP(e,...t){let r=typeof e;return t.includes(r)}a(wP,"isOfType");F.isOfType=wP});var Q={};ss(Q,{R:()=>E});var E,ge=sm(()=>{E=vi(yt());ce(Q,vi(ie()))});var Pt=g(L=>{"use strict";Object.defineProperty(L,"__esModule",{value:!0});L.tupleHasValue=L.traitSlugToObject=L.setHasElement=L.ordinalString=L.objectHasKey=L.localizer=L.htmlQuery=L.htmlClosest=L.getActionGlyph=L.extractNotes=L.ErrorPF2e=L.createHTMLElement=void 0;var kP=(ge(),De(Q));function LP(e){return Error(`PF2e System | ${e}`)}a(LP,"ErrorPF2e");L.ErrorPF2e=LP;function Df(e,t){return(typeof t=="string"||typeof t=="number")&&t in e}a(Df,"objectHasKey");L.objectHasKey=Df;function RP(e,t){return e.includes(t)}a(RP,"tupleHasValue");L.tupleHasValue=RP;function DP(e,t){return e.has(t)}a(DP,"setHasElement");L.setHasElement=DP;function qP(e){let t=new Intl.PluralRules(game.i18n.lang,{type:"ordinal"}),r=game.i18n.localize(`PF2E.OrdinalSuffixes.${t.select(e)}`);return game.i18n.format("PF2E.OrdinalNumber",{value:e,suffix:r})}a(qP,"ordinalString");L.ordinalString=qP;function jP(e,t){return e instanceof Element?e.closest(t):null}a(jP,"htmlClosest");L.htmlClosest=jP;function xP(e,t){return e instanceof Element||e instanceof Document?e.querySelector(t):null}a(xP,"htmlQuery");L.htmlQuery=xP;function NP(e){return(...[t,r])=>r?game.i18n.format(`${e}.${t}`,r):game.i18n.localize(`${e}.${t}`)}a(NP,"localizer");L.localizer=NP;function HP(e,t){let r={name:e,label:game.i18n.localize(t[e]??e),description:null};return Df(CONFIG.PF2E.traitsDescriptions,e)&&(r.description=CONFIG.PF2E.traitsDescriptions[e]),r}a(HP,"traitSlugToObject");L.traitSlugToObject=HP;var BP={0:"F",free:"F",1:"1",2:"2",3:"3","1 or 2":"1/2","1 to 3":"1 - 3","2 or 3":"2/3","2 rounds":"3,3",reaction:"R"};function zP(e){if(!e&&e!==0)return"";let t=typeof e!="object"?e:e.type==="action"?e.value:e.type,r=String(t??"").toLowerCase().trim();return BP[r]?.replace("-","\u2013")??""}a(zP,"getActionGlyph");L.getActionGlyph=zP;function WP(e,t){return t.flatMap(r=>(e[r]??[]).map(n=>n.clone()))}a(WP,"extractNotes");L.extractNotes=WP;function UP(e,{classes:t=[],dataset:r={},children:n=[],innerHTML:i}={}){let o=document.createElement(e);t.length>0&&o.classList.add(...t);for(let[s,u]of Object.entries(r).filter(([,f])=>!kP.R.isNil(f)&&f!==!1))o.dataset[s]=u===!0?"":String(u);if(i)o.innerHTML=i;else for(let s of n){let u=s instanceof HTMLElement?s:new Text(s);o.appendChild(u)}return o}a(UP,"createHTMLElement");L.createHTMLElement=UP});var jf=g(St=>{"use strict";Object.defineProperty(St,"__esModule",{value:!0});St.transferItemToActor=St.resetActors=void 0;var So=(ge(),De(Q)),qf=Pt();async function $P(e,t,r,n,i=!1){if(!t.isOfType("physical"))throw(0,qf.ErrorPF2e)("Only physical items (with quantities) can be transfered between actors");let o=e.inventory.get(n??"");if(o&&!o?.isOfType("backpack"))throw(0,qf.ErrorPF2e)("containerId refers to a non-container");r=Math.min(r,t.quantity);let s=t.quantity-r;s<1?await t.delete():await t.update({"system.quantity":s});let f=t.toObject();return f.system.quantity=r,f.system.equipped.carryType="worn","invested"in f.system.equipped&&(f.system.equipped.invested=t.traits.has("invested")?!1:null),e.addToInventory(f,o,i)}a($P,"transferItemToActor");St.transferItemToActor=$P;async function GP(e,t={}){e??=[game.actors.contents,game.scenes.contents.flatMap(n=>n.tokens.contents).flatMap(n=>n.actor??[])].flat(),e=So.R.uniq(Array.from(e)),t.sheets??=!0;for(let n of e)n.reset(),t.sheets&&n.render();if(game.pf2e.effectPanel.refresh(),game.settings.get("pf2e","automation.effectExpiration")&&!game.settings.get("pf2e","automation.removeExpiredEffects")){let n=So.R.uniq(Array.from(e).flatMap(i=>i.getActiveTokens(!1,!0)).flatMap(i=>i.scene));for(let i of n)i.reset(),i.isView&&canvas.perception.update({initializeVision:!0},!0)}if(t.tokens)for(let n of So.R.uniq(Array.from(e).flatMap(i=>i.getActiveTokens(!0,!0))))n.simulateUpdate()}a(GP,"resetActors");St.resetActors=GP});var Hf=g(Fe=>{"use strict";Object.defineProperty(Fe,"__esModule",{value:!0});Fe.renderItemSheets=Fe.renderCharacterSheets=Fe.renderActorSheets=void 0;var VP=(ge(),De(Q));function xf(e){let t=Array.isArray(e)?e:[e],r=Object.values(ui.windows).filter(n=>t.some(i=>(0,VP.isInstanceOf)(n,i)));for(let n of r)n.render()}a(xf,"renderApplication");function Nf(e=["ActorSheetPF2e"]){xf(e)}a(Nf,"renderActorSheets");Fe.renderActorSheets=Nf;function KP(){Nf(["CharacterSheetPF2e"])}a(KP,"renderCharacterSheets");Fe.renderCharacterSheets=KP;function JP(e=["ItemSheetPF2e"]){xf(e)}a(JP,"renderItemSheets");Fe.renderItemSheets=JP});var Bf=g(Tt=>{"use strict";Object.defineProperty(Tt,"__esModule",{value:!0});Tt.getTabFilterData=Tt.filterTraits=void 0;function QP(e){let t=game.pf2e.compendiumBrowser.tabs[e];return deepClone(t.defaultFilterData??t.filterData)}a(QP,"getTabFilterData");Tt.getTabFilterData=QP;function YP(e,t,r){let n=t.filter(o=>!o.not).map(o=>o.value),i=t.filter(o=>o.not).map(o=>o.value);return!((n.length||i.length)&&(i.some(s=>e.includes(s))||!(r==="and"?n.every(s=>e.includes(s)):n.some(s=>e.includes(s)))))}a(YP,"filterTraits");Tt.filterTraits=YP});var To=g(Ha=>{"use strict";Object.defineProperty(Ha,"__esModule",{value:!0});Ha.extractEphemeralEffects=void 0;async function XP({affects:e,origin:t,target:r,item:n,domains:i,options:o}){if(!(t&&r))return[];let[s,u]=e==="target"?[t,r]:[r,t],f=[...o,s.getRollOptions(i),u.getSelfRollOptions(e)].flat(),l=n?n.isOfType("spell")?{spell:n}:{weapon:n}:{};return(await Promise.all(i.flatMap(p=>s.synthetics.ephemeralEffects[p]?.[e]??[]).map(p=>p({test:f,resolvables:l})))).flatMap(p=>p??[])}a(XP,"extractEphemeralEffects");Ha.extractEphemeralEffects=XP});var Uf=g(Z=>{"use strict";Object.defineProperty(Z,"__esModule",{value:!0});Z.toggleOffShieldBlock=Z.selfApplyEffectFromMessage=Z.onClickShieldBlock=Z.createTradeMessage=Z.createTradeContent=Z.applyDamageFromMessage=void 0;var Ba=(ge(),De(Q)),He=Pt(),ZP=To();function zf(e,t){return renderTemplate("systems/pf2e/templates/chat/action/content.hbs",{imgPath:t,message:e.replace(/\b1 × /,"")})}a(zf,"createTradeContent");Z.createTradeContent=zf;async function eS(e,t,r,n,i){let o=await zf(t,n.img);return tS(e,o,r,i)}a(eS,"createTradeMessage");Z.createTradeMessage=eS;async function tS(e,t,r,n){return ChatMessage.implementation.create({user:n??game.user.id,speaker:{alias:(0,Ba.getHighestName)(r)},flavor:await rS(e),content:t,type:CONST.CHAT_MESSAGE_TYPES.EMOTE})}a(tS,"createManipulationMessage");function rS(e){return renderTemplate("systems/pf2e/templates/chat/action/flavor.hbs",{action:{title:"PF2E.Actions.Interact.Title",subtitle:e,glyph:(0,He.getActionGlyph)(1)},traits:[{name:"manipulate",label:CONFIG.PF2E.featTraits.manipulate,description:CONFIG.PF2E.traitsDescriptions.manipulate}]})}a(rS,"createManipulateFlavor");async function Wf({message:e,multiplier:t=1,addend:r=0,promptModifier:n=!1,rollIndex:i=0,tokens:o,onDamageApplied:s}){if(n)return nS(e,t,i,o,s);let u=(0,He.htmlQuery)(ui.chat.element[0],`li.chat-message[data-message-id="${e.id}"]`);if(o??=u?.dataset.actorIsTarget&&e.token?[e.token]:game.user.getActiveTokens(),o.length===0){ui.notifications.error("PF2E.ErrorMessage.NoTokenSelected",{localize:!0});return}let f=CONFIG.PF2E.chatDamageButtonShieldToggle,l=e.rolls.at(i);if(!(0,Ba.isInstanceOf)(l,"DamageRoll"))throw(0,He.ErrorPF2e)("Unexpected error retrieving damage roll");let p=t<0?t*l.total+r:l.alter(t,r),d=[...e.flags.pf2e.context?.options??[]],y=d.filter(_=>_.startsWith("self:")).map(_=>_.replace(/^self/,"origin")),m=e.item,b=m?.isOfType("affliction","condition","effect")?m.getRollOptions("item"):[];for(let _ of o){if(!_.actor)continue;d.some(D=>D.startsWith("target"))||d.push(..._.actor.getSelfRollOptions("target"));let S=t>0?"damage-received":"healing-received",T=t>0?await(0,ZP.extractEphemeralEffects)({affects:"target",origin:e.actor,target:_.actor,item:e.item,domains:[S],options:d}):[],M=_.actor.getContextualClone(y,T),O=new Set([...d.filter(D=>!/^(?:self|target):/.test(D)),...b,...y,...M.getSelfRollOptions()]);await M.applyDamage({damage:p,token:_,item:e.item,skipIWR:t<=0,rollOptions:O,shieldBlockRequest:f,outcome:e.flags.pf2e.context?.outcome})}Mo(e.id),s?.(e,o,i)}a(Wf,"applyDamageFromMessage");Z.applyDamageFromMessage=Wf;async function nS(e,t,r,n,i){let o=await renderTemplate("systems/pf2e/templates/chat/damage/adjustment-dialog.hbs"),s=class extends Dialog{static{a(this,"AdjustmentDialog")}activateListeners(f){super.activateListeners(f),f[0].querySelector("input")?.focus()}},u=t<0;new s({title:game.i18n.localize(u?"PF2E.UI.shiftModifyHealingTitle":"PF2E.UI.shiftModifyDamageTitle"),content:o,buttons:{ok:{label:game.i18n.localize("PF2E.OK"),callback:async f=>{let l=(Number(f[0].querySelector("input")?.value)||0)*Math.sign(t);Wf({message:e,multiplier:t,addend:l,promptModifier:!1,rollIndex:r,tokens:n,onDamageApplied:i})}},cancel:{label:"Cancel"}},default:"ok",close:()=>{Mo(e.id)}}).render(!0)}a(nS,"shiftAdjustDamage");function Mo(e){for(let t of["#chat-log","#chat-popout"]){let r=`${t} > li.chat-message[data-message-id="${e}"] button[data-action$=shield-block]`;for(let n of document.body.querySelectorAll(r))n?.classList.remove("shield-activated")}CONFIG.PF2E.chatDamageButtonShieldToggle=!1}a(Mo,"toggleOffShieldBlock");Z.toggleOffShieldBlock=Mo;function aS(e,t,r){let n=a(()=>{if(r)return[r];let o=game.user.getActiveTokens();return o.length===0&&ui.notifications.error("PF2E.ErrorMessage.NoTokenSelected",{localize:!0}),o},"getTokens"),i=a(o=>o.find(u=>!!u.actor)?.actor?.itemTypes.shield.filter(u=>u.isEquipped&&!u.isBroken&&!u.isDestroyed)??[],"getNonBrokenShields");e.classList.contains("tooltipstered")||$(e).tooltipster({animation:"fade",trigger:"click",arrow:!1,content:(0,He.htmlQuery)(t,"div.hover-content"),contentAsHTML:!0,contentCloning:!0,debug:!1,interactive:!0,side:["top"],theme:"crb-hover",functionBefore:()=>{let o=n();if(o.length===0)return!1;let s=i(o),u=o.length===1&&s.length>1,f=e.classList.contains("shield-activated");return u&&!f?!0:u&&e.dataset.shieldId?(e.attributes.removeNamedItem("data-shield-id"),e.classList.remove("shield-activated"),CONFIG.PF2E.chatDamageButtonShieldToggle=!1,!0):(e.classList.toggle("shield-activated"),CONFIG.PF2E.chatDamageButtonShieldToggle=!CONFIG.PF2E.chatDamageButtonShieldToggle,!1)},functionFormat:(o,s,u)=>{let f=n(),l=i(f),p=f.length===1&&l.length>1,d=e.classList.contains("shield-activated");if(p&&!d){let y=(0,He.htmlQuery)(u,"ul.shield-options");if(!y)return $(u);let m=l.map(b=>{let _=document.createElement("input");_.classList.add("data"),_.type="radio",_.name="shield-id",_.value=b.id,_.addEventListener("click",()=>{e.dataset.shieldId=_.value,e.classList.add("shield-activated"),CONFIG.PF2E.chatDamageButtonShieldToggle=!0,o.close()});let S=document.createElement("span");S.classList.add("label"),S.innerHTML=b.name;let T=document.createElement("span");T.classList.add("tag");let M=game.i18n.localize("PF2E.HardnessLabel");T.innerHTML=`${M}: ${b.hardness}`;let O=document.createElement("li");return O.classList.add("item"),O.append(_,S,T),O});y.replaceChildren(...m)}return $(u)}}).tooltipster("open")}a(aS,"onClickShieldBlock");Z.onClickShieldBlock=aS;async function iS(e,t){let r=e.item,n=r?.actor??e.actor;if(!r||!n)return;let i=t.querySelector(".message-content .message-buttons button[data-action='apply-effect'][data-targets]");if(!i)return;i.disabled=!0;let o=fromUuidSync(i.dataset.targets??""),s=r.isOfType("action","feat")&&r.system.selfEffect?await fromUuid(r.system.selfEffect.uuid):null;if((0,Ba.isInstanceOf)(o,"ActorPF2e")&&(0,Ba.isInstanceOf)(s,"EffectPF2e")){let u=r.system.traits.value?.filter(d=>d in CONFIG.PF2E.effectTraits)??[],f=mergeObject(s.toObject(),{_id:null,system:{context:{origin:{actor:n.uuid,token:e.token?.uuid??null,item:r.uuid,spellcasting:null,rollOptions:r.getOriginData().rollOptions},target:{actor:o.uuid,token:o.getActiveTokens(!0,!0).at(0)?.uuid??null},roll:null},traits:{value:u}}});await o.createEmbeddedDocuments("Item",[f]);let l=(()=>{let d=document.createElement("div");return d.innerHTML=e.content,d})(),p=(0,He.htmlQuery)(l,".message-buttons");if(p){let d=(0,He.createHTMLElement)("span",{classes:["effect-applied"]}),y=s.toAnchor({attrs:{draggable:"true"}}),b=game.i18n.format("PF2E.Item.Action.SelfAppliedEffect.Applied",{effect:y.outerHTML});d.innerHTML=b,p.replaceChildren(d),await e.update({content:l.innerHTML})}}}a(iS,"selfApplyEffectFromMessage");Z.selfApplyEffectFromMessage=iS});var za=g(fe=>{"use strict";Object.defineProperty(fe,"__esModule",{value:!0});fe.getSpellCollectionClass=fe.getStatisticClass=fe.getSpellClass=fe.getDamageRollClass=void 0;function oS(e){return e.constructor}a(oS,"getStatisticClass");fe.getStatisticClass=oS;function sS(e){return e.spellcasting.get("rituals").spells.constructor}a(sS,"getSpellCollectionClass");fe.getSpellCollectionClass=sS;function cS(){return CONFIG.PF2E.Item.documentClasses.spell}a(cS,"getSpellClass");fe.getSpellClass=cS;function uS(){return CONFIG.Dice.rolls.find(e=>e.name==="DamageRoll")}a(uS,"getDamageRollClass");fe.getDamageRollClass=uS});var $f=g(Wa=>{"use strict";Object.defineProperty(Wa,"__esModule",{value:!0});Wa.saveTypes=void 0;var lS=["fortitude","reflex","will"];Wa.saveTypes=lS});var Gf=g(Ua=>{"use strict";Object.defineProperty(Ua,"__esModule",{value:!0});Ua.calculateRemainingDuration=void 0;var fS={rounds:6,minutes:60,hours:3600,days:86400};function dS(e,t,r){if(t.unit==="encounter"){let d=e.system.expired;return{expired:!!d,remaining:d?0:1/0}}else if(t.unit==="unlimited"||!("start"in e.system))return{expired:!1,remaining:1/0};let n=e.system.start.value,{combatant:i}=game.combat??{},{unit:o,expiry:s}=t,u=t.value*(fS[t.unit]??0),f=!i&&u===0&&o==="rounds"&&["turn-end","round-end"].includes(s??"")?1:0,l=n+u+f-game.time.worldTime,p={remaining:l,expired:l<=0};if(l===0&&i?.actor){let d=e.system.start.initiative??0,y=i.initiative??0;r??=e.actor?.isOfType("familiar")?e.actor.master??e.actor:e.actor;let m=a(()=>d===y&&i.actor===(e.origin??r),"atTurnStart");p.expired=s==="turn-start"?m():s==="turn-end"?y<d:s==="round-end"?l<=0&&game.time.worldTime>n:!1}return p}a(dS,"calculateRemainingDuration");Ua.calculateRemainingDuration=dS});var Yf=g(x=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0});x.hasFreePropertySlot=x.getEquippedHandwraps=x.getCarryTypeActionData=x.getAnnotationLabel=x.consumeItem=x.changeCarryType=x.calculateItemPrice=x.MoveLootPopup=x.HANDWRAPS_SLUG=x.BANDS_OF_FORCE_SLUGS=void 0;var pS=(ge(),De(Q)),mS=za(),Vf=Pt(),Kf="handwraps-of-mighty-blows";x.HANDWRAPS_SLUG=Kf;var gS=["bands-of-force","bands-of-force-greater","bands-of-force-major"];x.BANDS_OF_FORCE_SLUGS=gS;function Jf(e,t){if(!e)return null;let r=["draw","pick-up","retrieve"].includes(e)?`${e}${t}H`:["grip","sheathe","modular","drop"].includes(e)?e:null;return r?game.pf2e.system.sluggify(r,{camel:"bactrian"}):null}a(Jf,"getAnnotationLabel");x.getAnnotationLabel=Jf;function Qf(e,t,r="interact"){switch(t){case"draw":return[1,"held"];case"pick-up":return[1,"held"];case"retrieve":{let{container:n}=e;if(n?.isHeld)return[1,"held"];let i=n?.system.usage;return[i?.type==="held"||i?.where==="backpack"?2:1,"held"]}case"grip":return[r==="interact"?1:0,"held"];case"sheathe":return[1,"worn"];case"modular":return[1,null];case"drop":return[0,"dropped"];case"tower-shield":return[r==="take-cover"?1:0,null];default:return[1,null]}}a(Qf,"getCarryTypeActionData");x.getCarryTypeActionData=Qf;async function yS(e,t,r,n,i="interact"){let[o,s]=Qf(t,n,i);if(!s||(await e.changeCarryType(t,{carryType:s,handsHeld:r}),!game.combat))return;let u={flavor:"./systems/pf2e/templates/chat/action/flavor.hbs",content:"./systems/pf2e/templates/chat/action/content.hbs"},f=game.pf2e.system.sluggify,l=f(i,{camel:"bactrian"}),p=n?f(n,{camel:"bactrian"}):null,d=Jf(n,r),y={title:`PF2E.Actions.${l}.Title`,subtitle:d?`PF2E.Actions.${l}.${d}.Title`:null,glyph:(0,Vf.getActionGlyph)(o)},[m,b]=i==="raise-a-shield"?[[],`PF2E.Actions.${l}.Content`]:["take-cover","end-cover"].includes(i)?[[],`PF2E.Actions.${l}.${p}.Description`]:[[(0,Vf.traitSlugToObject)("manipulate",CONFIG.PF2E.actionTraits)],`PF2E.Actions.${l}.${d}.Description`],_=await renderTemplate(u.flavor,{action:y,traits:m}),S=await renderTemplate(u.content,{imgPath:t.img,message:game.i18n.format(b,{actor:e.name,weapon:t.name})}),T=e.getActiveTokens(!1,!0).shift();await ChatMessage.implementation.create({content:S,speaker:ChatMessage.getSpeaker({actor:e,token:T}),flavor:_,type:CONST.CHAT_MESSAGE_TYPES.EMOTE})}a(yS,"changeCarryType");x.changeCarryType=yS;function hS(e){let t=e.system.runes.potency;return t>0&&e.system.runes.property.length<t}a(hS,"hasFreePropertySlot");x.hasFreePropertySlot=hS;function vS(e){return e.itemTypes.weapon.find(t=>{let{category:r,slug:n,equipped:i,identification:o}=t._source.system,{carryType:s,invested:u,inSlot:f}=i;return r==="unarmed"&&s==="worn"&&f&&u&&o.status==="identified"&&n===Kf})}a(vS,"getEquippedHandwraps");x.getEquippedHandwraps=vS;function bS(e,t=1,r=1){let n=game.pf2e.Coins.fromPrice(e.price,t);return r===1?n:n.scale(r)}a(bS,"calculateItemPrice");x.calculateItemPrice=bS;async function _S(e,t){let r=t.uses;if(r.max&&r.value<1)return null;if(["wand","scroll"].includes(t.category)&&t.system.spell)return t.consume();let n=t.actor,i=r.max>1,o=r.value===1&&i?"UseExhausted":i?"UseMulti":"UseSingle",s={pf2e:{origin:{sourceId:t.sourceId,uuid:t.uuid,type:t.type}}},u=ChatMessage.getSpeaker({actor:n}),f=(await t.toMessage(e,{create:!1})).content,l=(0,pS.createHTMLFromString)(f);l.querySelector("button[data-action='consume']")?.remove(),l.querySelector("footer")?.remove();let p=l.outerHTML;if(t.system.damage){let d=(0,mS.getDamageRollClass)(),{formula:y,type:m,kind:b}=t.system.damage;new d(`(${y})[${m},${b}]`).toMessage({speaker:u,flavor:p,flags:s})}else ChatMessage.create({speaker:u,content:p,flags:s});if(t.system.uses.autoDestroy&&r.value<=1){let d=t.quantity,y=t.category==="ammo"&&t.system.rules.length>0;return d<=1&&!y?t.delete():t.update({"system.quantity":Math.max(d-1,0),"system.uses.value":r.max})}else return t.update({"system.uses.value":Math.max(r.value-1,0)})}a(_S,"consumeItem");x.consumeItem=_S;var Eo=class extends FormApplication{static{a(this,"MoveLootPopup")}onSubmitCallback;constructor(t,r,n){super(t,r),this.onSubmitCallback=n}async getData(){let[t,r]=this.options.isPurchase?["PF2E.loot.PurchaseLootMessage","PF2E.loot.PurchaseLoot"]:["PF2E.loot.MoveLootMessage","PF2E.loot.MoveLoot"];return{...await super.getData(),quantity:{default:this.options.quantity.default,max:this.options.quantity.max},newStack:this.options.newStack,lockStack:this.options.lockStack,prompt:t,buttonLabel:r}}static get defaultOptions(){return{...super.defaultOptions,id:"MoveLootPopup",classes:[],title:game.i18n.localize("PF2E.loot.MoveLootPopupTitle"),template:"systems/pf2e/templates/popups/loot/move-loot-popup.hbs",width:"auto",quantity:{default:1,max:1},newStack:!1,lockStack:!1,isPurchase:!1}}async _updateObject(t,r){this.onSubmitCallback(r.quantity,r.newStack)}};x.MoveLootPopup=Eo});var Xf=g($a=>{"use strict";Object.defineProperty($a,"__esModule",{value:!0});$a.RollNotePF2e=void 0;var Oo=Pt(),Io=class e{static{a(this,"RollNotePF2e")}selector;title;text;predicate;outcome;visibility;rule;constructor(t){this.selector=t.selector,this.title=t.title??null,this.text=t.text,this.predicate=new game.pf2e.Predicate(t.predicate??[]),this.outcome=[...t.outcome??[]],this.visibility=t.visibility??null,this.rule=t.rule??null}static notesToHTML(t){return t.length===0?null:(0,Oo.createHTMLElement)("ul",{classes:["notes"],children:[...t.flatMap(r=>[`
`,r.toHTML()]),`
`]})}toHTML(){let t=(0,Oo.createHTMLElement)("li",{classes:["roll-note"],dataset:{itemId:this.rule?.item.id,visibility:this.visibility},innerHTML:game.i18n.localize(this.text)});if(t.childNodes.length===1&&t.firstChild instanceof HTMLElement&&(t.innerHTML=t.firstChild.innerHTML),this.title){let r=(0,Oo.createHTMLElement)("strong",{innerHTML:game.i18n.localize(this.title)});t.prepend(r," ")}return t}clone(){return new e({...this.toObject(),rule:this.rule})}toObject(){return{selector:this.selector,title:this.title,text:this.text,predicate:this.predicate.toObject(),outcome:this.outcome,visibility:this.visibility}}};$a.RollNotePF2e=Io});var ed=g(R=>{"use strict";Object.defineProperty(R,"__esModule",{value:!0});R.warnInvalidDrop=R.upgradeStatisticRank=R.spellSlotGroupIdToNumber=R.getSummarizedSpellsDataForRender=R.getRankLabel=R.getHighestSyntheticStatistic=R.getHighestSpellcastingStatistic=R.getActorMaxRank=R.createCounteractStatistic=R.coerceToSpellGroupId=R.MAGIC_TRADITIONS=R.EFFECT_AREA_SHAPES=void 0;var K=(ge(),De(Q)),Mt=Ga(),PS=["burst","cone","cube","cylinder","emanation","line","square"];R.EFFECT_AREA_SHAPES=PS;var SS=new Set(["arcane","divine","occult","primal"]);R.MAGIC_TRADITIONS=SS;function TS(e){let t=deepClone(e.data);return t.modifiers=(e.modifiers??[]).map(r=>r.toObject()),t}a(TS,"getStatisticData");function MS(e,t){let r=(0,Mt.getStatisticClass)(e.skills.acrobatics),n=deepClone(t);return n.modifiers=t.modifiers.map(i=>new game.pf2e.Modifier(i)),new r(e,n)}a(MS,"createStatisticFromRawData");function ES(e,t){if(e.rank&&e.rank>=t)return e;let r=TS(e);return MS(e.actor,r)}a(ES,"upgradeStatisticRank");R.upgradeStatisticRank=ES;function OS(e){let t=e.actor,r=t.isOfType("npc")?e.statistic.check.modifiers.find(i=>i.type==="untyped"&&i.slug==="base")?.clone():null,n=(0,Mt.getStatisticClass)(e.statistic);return new n(t,{slug:"counteract",label:"PF2E.Item.Spell.Counteract.Label",attribute:e.statistic.attribute,rank:e.statistic.rank||1,check:{type:"check",modifiers:K.R.compact([r])}})}a(OS,"createCounteractStatistic");R.createCounteractStatistic=OS;function IS(e,t=!0){let r=Array.from(e.synthetics.statistics.values()),n=t?[...r,...Object.values(e.classDCs)]:r;if(!n.length)return;let i=e.classDC,o=K.R.groupBy(n,K.R.prop("mod")),s=K.R.pipe(o,K.R.keys,K.R.sortBy([K.R.identity,"desc"]),K.R.first());return i&&s&&i.mod===s?i:o[s][0]}a(IS,"getHighestSyntheticStatistic");R.getHighestSyntheticStatistic=IS;function AS(e){let t=e.spellcasting.spellcastingFeatures;if(!t.length)return;let r=e.classDC?.attribute,n=K.R.groupBy(t,s=>s.statistic.mod),i=K.R.pipe(n,K.R.keys,K.R.sortBy([s=>Number(s),"desc"]),K.R.first()),o=n[i].map(s=>({tradition:s.tradition,statistic:s.statistic}));return o.length===1||!r?o[0]:o.find(s=>s.statistic.attribute===r)||o[0]}a(AS,"getHighestSpellcastingStatistic");R.getHighestSpellcastingStatistic=AS;function CS(e){return Math.max(1,Math.ceil(e.level/2))}a(CS,"getActorMaxRank");R.getActorMaxRank=CS;function FS(e){return game.i18n.format("PF2E.Item.Spell.Rank.Ordinal",{rank:(0,Mt.ordinalString)(e)})}a(FS,"getRankLabel");R.getRankLabel=FS;function wS(e){if(e==="cantrips")return e;let t=Number(e)||NaN;return t.between(1,10)?t:null}a(wS,"coerceToSpellGroupId");R.coerceToSpellGroupId=wS;function Zf(e){if(e==="cantrips")return 0;let t=Number(e??NaN);return t.between(0,10)?t:null}a(Zf,"spellSlotGroupIdToNumber");R.spellSlotGroupIdToNumber=Zf;function kS(e,{spell:t,groupId:r}){let n=(0,Mt.localizer)("PF2E.Item.Spell.Warning");if(e==="invalid-rank"&&typeof r=="number"){let i=game.i18n.format("PF2E.Item.Spell.Rank.Ordinal",{rank:(0,Mt.ordinalString)(t.baseRank)}),o=game.i18n.format("PF2E.Item.Spell.Rank.Ordinal",{rank:(0,Mt.ordinalString)(r)});ui.notifications.warn(n("InvalidRank",{spell:t.name,spellRank:i,targetRank:o}))}else if(e==="cantrip-mismatch"){let i=t.isCantrip?"CantripToRankedSlots":"NonCantripToCantrips";ui.notifications.warn(n(i,{spell:t.name}))}else if(e==="invalid-spell"){let i=game.i18n.localize("PF2E.TraitFocus");ui.notifications.warn(n("WrongSpellType",{type:i}))}}a(kS,"warnInvalidDrop");R.warnInvalidDrop=kS;async function LS(e,t,r,n){n??=await Promise.all(e.spellcasting.collections.map(l=>l.entry.getSheetData({spells:l})));let i=e.system.resources?.focus??{value:0,max:0},o=(0,K.getActiveModule)("pf2e-dailies"),s=[],u=[],f=!1;for(let l of n){let p=l.id,d=l.statistic?.dc.value,y=d?`${l.name} - ${game.i18n.format("PF2E.DCWithValue",{dc:d,text:""})}`:l.name,m=l.isFocusPool,b=l.isRitual,_=l.category==="charges",S=l.isStaff,T=l.isInnate,M=l.isPrepared,O=l.isSpontaneous,D=l.isFlexible,k=l.category==="items"?e.items.get(p.split("-")[0]):void 0;for(let B of l.groups){if(!B.active.length||B.uses?.max===0)continue;let I=Zf(B.id),U=[],pe=B.id==="cantrips",Le=!pe&&_&&!o?.active,Ue=typeof B.uses?.value=="number"?B.uses:void 0;for(let Re=0;Re<B.active.length;Re++){let ve=B.active[Re];if(!ve?.spell||ve.uses?.max===0)continue;let{spell:ae}=ve,Dt=ae.id,$e=pe||m||k||M&&!D?void 0:_&&!Le?l.uses:ve.uses??Ue;U.push({name:ae.name,itemId:Dt,entryId:p,groupId:B.id,slotId:Re,action:ae.system.time.value,castRank:ve.castRank??ae.rank,expended:m?!pe&&i.value<=0:ve.expended,img:ae.img,range:ae.system.range.value||"-&nbsp;",rank:ae.rank,entryName:l.name,entryDc:d,entryTooltip:y,consumable:k,isBroken:Le,isFocus:m,isRitual:b,isCharges:_,isStaff:S,isInnate:T,isPrepared:M,isSpontaneous:O,isFlexible:D,uses:$e?{...$e,input:S?"":_?"system.slots.slot1.value":T?"system.location.uses.value":`system.slots.slot${I}.value`,itemId:S?"":T?Dt:p}:void 0,order:_?0:M?1:m?2:T?3:O?4:5,category:k?`PF2E.Item.Consumable.Category.${k.category}`:S?r("staff"):_?r("charges"):T?"PF2E.PreparationTypeInnate":O?"PF2E.PreparationTypeSpontaneous":D?"PF2E.SpellFlexibleLabel":m?"PF2E.TraitFocus":"PF2E.SpellPreparedLabel"})}if(U.length){if(m)if(pe)f=!0;else{s[12]??=[],s[12].push(...U);continue}else if(b){s[13]??=[],s[13].push(...U);continue}u[I]??=B.label,s[I]??=[],s[I].push(...U)}}}if(s.length){let d=t?a((y,m)=>y.order===m.order?(0,K.localeCompare)(y.name,m.name):y.order-m.order,"orderSort"):a((y,m)=>(0,K.localeCompare)(y.name,m.name),"nameSort");for(let y=0;y<s.length;y++){let m=s[y];!m||y>11||m.sort(d)}}return u[12]="PF2E.Focus.Spells",u[13]="PF2E.Actor.Character.Spellcasting.Tab.Rituals",{labels:u,spells:s,focusPool:i,isOwner:e.isOwner,hasFocusCantrip:f}}a(LS,"getSummarizedSpellsDataForRender");R.getSummarizedSpellsDataForRender=LS});var rd=g(Va=>{"use strict";Object.defineProperty(Va,"__esModule",{value:!0});Va.createConsumableFromSpell=void 0;var td=(ge(),De(Q)),Ao=Ga(),RS="tLa4bewBhyqzi6Ow",DS={1:"RjuupS9xyXDLgyIr",2:"Y7UD64foDbDMV9sx",3:"ZmefGBXGJF3CFDbn",4:"QSQZJ5BC3DeHv153",5:"tjLvRWklAylFhBHQ",6:"4sGIy77COooxhQuC",7:"fomEZZ4MxVVK3uVu",8:"iPki3yuoucnj7bIt",9:"cFHomF3tty8Wi1e5",10:"o1XIHJ4MJyroAHfF"},qS={1:"UJWiN0K3jqVjxvKk",2:"vJZ49cgi8szuQXAD",3:"wrDmWkGxmwzYtfiA",4:"Sn7v9SsbEDMUIwrO",5:"5BF7zMnrPYzyigCs",6:"kiXh4SUWKr166ZeM",7:"nmXPj9zuMRQBNT60",8:"Qs8RgNH6thRPv2jt",9:"Fgv722039TVM5JTc"},jS={cantripDeck5:"PF2E.Item.Physical.FromSpell.CantripDeck5",scroll:"PF2E.Item.Physical.FromSpell.Scroll",wand:"PF2E.Item.Physical.FromSpell.Wand"};function xS(e,t){switch(e){case"cantripDeck5":return RS;case"scroll":return DS[t]??null;default:return qS[t]??null}}a(xS,"getIdForSpellConsumable");function NS(e,t,r){let n=jS[e]||`${e} of {name} (Rank {level})`;return game.i18n.format(n,{name:t,level:r})}a(NS,"getNameForSpellConsumable");async function HS(e,{type:t,heightenedLevel:r=e.baseRank,mystified:n=!1,temp:i,itemName:o,itemImg:s}){let u=game.packs.find(m=>m.collection==="pf2e.equipment-srd"),f=xS(t,r),l=await u?.getDocument(f??"");if(!(0,td.isInstanceOf)(l,"ConsumablePF2e"))throw(0,Ao.ErrorPF2e)("Failed to retrieve consumable item");let p={...l.toObject(),_id:null},d=p.system.traits;d.value=td.R.uniq([...d.value,...e.traits]),d.rarity=e.rarity,d.value.includes("magical")&&d.value.some(m=>(0,Ao.setHasElement)(Ao.MAGIC_TRADITIONS,m))&&d.value.splice(d.value.indexOf("magical"),1),d.value.sort(),p.name=NS(o??t,e.name,r);let y=p.system.description.value;return p.system.description.value=(()=>{let m=document.createElement("p");m.append(e.sourceId?`@UUID[${e.sourceId}]{${e.name}}`:e.description);let b=document.createElement("div"),_=document.createElement("hr");return b.append(m,_),_.insertAdjacentHTML("afterend",y),b.innerHTML})(),t!=="cantripDeck5"&&(p.system.spell=mergeObject(e._source,{_id:randomID(),system:{location:{value:null,heightenedLevel:r}}},{inplace:!1})),n&&(p.system.identification.status="unidentified"),typeof s=="string"&&(p.img=s),i&&(p.system.temporary=!0),p}a(HS,"createConsumableFromSpell");Va.createConsumableFromSpell=HS});var ad=g(ee=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0});ee.getTranslatedSkills=ee.SKILL_LONG_FORMS=ee.SKILL_EXPANDED=ee.SKILL_DICTIONARY=ee.SKILL_ABBREVIATIONS=ee.ATTRIBUTE_ABBREVIATIONS=void 0;var BS=["acr","arc","ath","cra","dec","dip","itm","med","nat","occ","prf","rel","soc","ste","sur","thi"];ee.SKILL_ABBREVIATIONS=BS;var nd={acr:"acrobatics",arc:"arcana",ath:"athletics",cra:"crafting",dec:"deception",dip:"diplomacy",itm:"intimidation",med:"medicine",nat:"nature",occ:"occultism",prf:"performance",rel:"religion",soc:"society",ste:"stealth",sur:"survival",thi:"thievery"};ee.SKILL_DICTIONARY=nd;var zS={acrobatics:{attribute:"dex",shortForm:"acr"},arcana:{attribute:"int",shortForm:"arc"},athletics:{attribute:"str",shortForm:"ath"},crafting:{attribute:"int",shortForm:"cra"},deception:{attribute:"cha",shortForm:"dec"},diplomacy:{attribute:"cha",shortForm:"dip"},intimidation:{attribute:"cha",shortForm:"itm"},medicine:{attribute:"wis",shortForm:"med"},nature:{attribute:"wis",shortForm:"nat"},occultism:{attribute:"int",shortForm:"occ"},performance:{attribute:"cha",shortForm:"prf"},religion:{attribute:"wis",shortForm:"rel"},society:{attribute:"int",shortForm:"soc"},stealth:{attribute:"dex",shortForm:"ste"},survival:{attribute:"wis",shortForm:"sur"},thievery:{attribute:"dex",shortForm:"thi"}};ee.SKILL_EXPANDED=zS;var WS=new Set(["str","dex","con","int","wis","cha"]);ee.ATTRIBUTE_ABBREVIATIONS=WS;var US=new Set(Object.values(nd));ee.SKILL_LONG_FORMS=US;var Ka;function $S(){if(!Ka){Ka={};for(let[e,t]of Object.entries(CONFIG.PF2E.skillList))Ka[e]=game.i18n.localize(t).toLocaleLowerCase(game.i18n.lang)}return deepClone(Ka)}a($S,"getTranslatedSkills");ee.getTranslatedSkills=$S});var id=g(Ja=>{"use strict";Object.defineProperty(Ja,"__esModule",{value:!0});Ja.getTemplateTokens=void 0;function GS(e,{collisionOrigin:t,collisionType:r="move"}={}){let{grid:n,dimensions:i}=canvas,o=e instanceof MeasuredTemplateDocument?e.object:e;if(!canvas.scene||!o?.highlightId||!n||!i)return[];let s=n.getHighlightLayer(o.highlightId);if(!s||n.type!==CONST.GRID_TYPES.SQUARE)return[];let u=t??o.center,f=canvas.tokens.quadtree.getObjects(s.getLocalBounds(void 0,!0)),l=n.size,p=[];for(let d of f){let y=d.document,m=[];for(let b=0;b<y.height;b++){let _=Math.floor(d.x/l)*l,T=Math.floor(d.y/l)*l+b*l;if(m.push(`${_}.${T}`),y.width>1)for(let M=1;M<y.width;M++)m.push(`${_+M*l}.${T}`)}for(let b of m){if(!s.positions.has(b))continue;let[_,S]=b.split(".").map(O=>Number(O)),T={x:_+i.size*.5,y:S+i.size*.5};if(T.x<0||T.y<0)continue;if(!(canvas.ready&&r&&CONFIG.Canvas.polygonBackends[r].testCollision(u,T,{type:r,mode:"any"}))){p.push(d);break}}}return p}a(GS,"getTemplateTokens");Ja.getTemplateTokens=GS});var Ga=g(N=>{"use strict";var VS=N&&N.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),J=N&&N.__exportStar||function(e,t){for(var r in e)r!=="default"&&!Object.prototype.hasOwnProperty.call(t,r)&&VS(t,e,r)};Object.defineProperty(N,"__esModule",{value:!0});J(jf(),N);J(Hf(),N);J(Bf(),N);J(Uf(),N);J(za(),N);J(za(),N);J($f(),N);J(Gf(),N);J(Yf(),N);J(Xf(),N);J(To(),N);J(ed(),N);J(rd(),N);J(ad(),N);J(id(),N);J(Pt(),N)});var c={};ss(c,{R:()=>E});ge();ce(c,Q);ce(c,vi(Ga()));var od=[];function sd(e,t){let r=(0,c.htmlElement)(t),n=(0,c.querySelector)(r,`.tab[data-tab="${c.MODULE.id}"]`);if(!n)return;for(let{tool:o,key:s}of od){let u=n.querySelector(`[data-setting-id="${c.MODULE.id}.${s}"]`);if(u){let f=(0,c.localize)("settings",o,"title");(0,c.beforeHTMLFromString)(u,`<h3>${f}</h3>`)}}let i=n.querySelectorAll("[data-setting-id]");for(let o of i){let{settingId:s}=(0,c.elementData)(o);if(game.settings.settings.get(s).requiresReload){let f=(0,c.querySelector)(o,"label");f.textContent=`${f.textContent} ${(0,c.localize)("settings.requiresReload")}`}}}a(sd,"onRenderSettingsConfig");function cd(e,t){for(let{name:r,settings:n}of e){for(let o of n)o.key=`${r}.${o.key}`,(0,c.registerSetting)(o);let i=t?n.find(o=>o.config!==!1):n.find(o=>o.scope==="client"&&o.config!==!1);i&&od.push({tool:r,key:i.key})}}a(cd,"registerToolsSettings");function oe(e,t){let r=null,n={},i=a(function(o,...s){try{return t.call(this,Object.values(n),o,...s)}catch(u){c.MODULE.error(`an error occured in the shared wrapper'
${e}`,u);let f=s.splice(0)[0];return f(...s)}},"wrapper");return{activate(o,s){o in n||(n[o]=s),r===null&&(r=(0,c.registerWrapper)(e,i,"WRAPPER"))},disable(o){o in n&&delete n[o],r!==null&&isEmpty(n)&&((0,c.unregisterWrapper)(r),r=null)},toggle(o,s,u){u?this.activate(o,s):this.disable(o)}}}a(oe,"createSharedWrapper");var ud="CONFIG.Actor.sheetClasses.character['pf2e.CharacterSheetPF2e'].cls.prototype._render",re="CONFIG.Actor.sheetClasses.character['pf2e.CharacterSheetPF2e'].cls.prototype._renderInner",ne="CONFIG.Actor.sheetClasses.character['pf2e.CharacterSheetPF2e'].cls.prototype.activateListeners",ld={[ud]:oe(ud,KS),[re]:oe(re,JS),[ne]:oe(ne,QS)};async function KS(e,t,...r){if(!Co(this))return t(...r);for(let n of e)await n.call(this,"before",...r);await t(...r);for(let n of e)await n.call(this,"after",...r)}a(KS,"characterSheetPF2eRender");async function JS(e,t,r){let n=await t(r),i=(0,c.htmlElement)(n);if(!Co(this))return n;for(let o of e)await o.call(this,i,r);return n}a(JS,"characterSheetPF2eRenderInner");function QS(e,t,r){if(t(r),!Co(this))return;let n=(0,c.htmlElement)(r);for(let i of e)i.call(this,n)}a(QS,"characterSheetPF2eActivateListeners");function Co(e){let t=e.actor;return(0,c.isPlayedActor)(t)&&t.permission>CONST.DOCUMENT_PERMISSION_LEVELS.LIMITED}a(Co,"hasValidCharacter");var Et="CONFIG.PF2E.Item.documentClasses.weapon.prototype.prepareBaseData",dd="CONFIG.PF2E.Item.documentClasses.weapon.prototype.prepareDerivedData",Qa="CONFIG.PF2E.Item.documentClasses.armor.prototype.prepareBaseData",pd="CONFIG.PF2E.Item.documentClasses.armor.prototype.prepareDerivedData",md={[Et]:oe(Et,fd),[Qa]:oe(Qa,fd)};function fd(e,t){for(let r of e)r.call(this);t()}a(fd,"prepareBaseData");var Ya="TextEditor.enrichHTML",gd={[Ya]:oe(Ya,YS)};function YS(e,t,r,n){let i=t(r,n);if(typeof i=="string"){for(let o of e)i=o.call(this,i);return i}return Promise.resolve().then(async()=>{i=await i;for(let o of e)i=o.call(this,i);return i})}a(YS,"textEditorEnrichHTML");var Ot="ChatMessage.prototype.getHTML",yd={[Ot]:oe(Ot,XS)};async function XS(e,t){let r=await t(),n=(0,c.htmlElement)(r);for(let i of e)await i.call(this,n);return r}a(XS,"chatMessageGetHTML");var Xa={...ld,...md,...gd,...yd};function C(e){let t=E.pipe(e.settings,E.reduce((d,y)=>(Object.defineProperty(d,y.key,{get(){return(0,c.getSetting)(y.key)}}),d),{})),r=e.name,n=eT(e),[i,o]=n&&"activateAll"in n?[void 0,n]:n?[n,void 0]:[void 0,void 0],s=ZS(e),[u,f]=s&&"activateAll"in s?[void 0,s]:s?[s,void 0]:[void 0,void 0],l=(0,c.subLocalize)(r);return{config:e,settings:t,hook:i,hooks:o,wrapper:u,wrappers:f,waitDialog:a(async(d,y,m={})=>{let b=l.sub(d),_=y.data??{};return _.i18n??=b.i18n,Dialog.wait({title:y.title??b("title"),content:y.content??await(0,c.render)(`${r}/${d}`,_),buttons:{yes:{label:b("yes"),icon:`<i class="${y.yes??"fa-solid fa-check"}"></i>`,callback:c.htmlElement},no:{label:b("no"),icon:`<i class="${y.no??"fa-solid fa-xmark"}"></i>`,callback:()=>null}},render:S=>{let T=(0,c.htmlElement)(S);y.onRender?.(T)},close:()=>null},{...m,id:b("dialog")})},"waitDialog"),flagPath:(...d)=>(0,c.flagPath)(r,...d),getFlag:(d,...y)=>(0,c.getFlag)(d,r,...y),setFlag:(d,...y)=>(0,c.setFlag)(d,r,...y),unsetFlag:(d,...y)=>(0,c.unsetFlag)(d,r,...y),updateSourceFlag:(d,...y)=>(0,c.updateSourceFlag)(d,r,...y),getFlagProperty:(d,...y)=>(0,c.getFlagProperty)(d,r,...y),setFlagProperty:(d,...y)=>(0,c.setFlagProperty)(d,r,...y),getInMemory:(d,...y)=>(0,c.getInMemory)(d,r,...y),setInMemory:(d,...y)=>(0,c.setInMemory)(d,r,...y),getInMemoryAndSetIfNot:(d,...y)=>(0,c.getInMemoryAndSetIfNot)(d,r,...y),deleteInMemory:(d,...y)=>(0,c.deleteInMemory)(d,r,...y),render:(...d)=>{let y=d.at(-1);return y.i18n=l.sub(d[0]).i18n,(0,c.render)(r,...d)},localize:l,templatePath:(...d)=>(0,c.templatePath)(r,...d),socket:tT(e)}}a(C,"createTool");function ZS(e){if(!Array.isArray(e.wrappers)||e.wrappers.length===0)return;let t=[];for(let{key:i,type:o,path:s,callback:u}of e.wrappers){let f;if(s in Xa){let l=randomID();f={activate(){Xa[s].activate(l,u)},disable(){Xa[s].disable(l)},toggle(p){Xa[s].toggle(l,u,p)}}}else{let l=null,p=a(function(...d){try{return u.call(this,...d)}catch(y){if(c.MODULE.error(`an error occured in the tool '${e.name}'
wrapper: ${s}`,y),o!=="OVERRIDE"){let m=d.splice(0)[0];return m(...d)}}},"wrapped");f={activate(){l===null&&(l=(0,c.registerWrapper)(s,p,o??"WRAPPER"))},disable(){l!==null&&((0,c.unregisterWrapper)(l),l=null)},toggle(d){d?this.activate():this.disable()}}}t.push([i,f])}if(t.length===1)return t[0][1];let r=t.map(([i,o])=>o);return{...t.every(i=>!!i[0])?E.fromPairs(t):{},activateAll(){for(let i of r)i.activate()},disableAll(){for(let i of r)i.disable()},toggleAll(i){for(let o of r)o.toggle(i)}}}a(ZS,"createToolWrappers");function eT(e){if(!Array.isArray(e.hooks)||e.hooks.length===0)return;let t=[];for(let{event:n,listener:i,isUpstream:o}of e.hooks){let s=null,u={activate(){s===null&&(s=o?(0,c.registerUpstreamHook)(n,i):Hooks.on(n,i))},disable(){s!==null&&(Hooks.off(n,s),s=null)},toggle(f){f?this.activate():this.disable()}};t.push([n,u])}if(t.length===1)return t[0][1];let r=t.map(([n,i])=>i);return{...E.fromPairs(t),activateAll(){for(let n of r)n.activate()},disableAll(){for(let n of r)n.disable()},toggleAll(n){for(let i of r)i.toggle(n)}}}a(eT,"createToolHooks");function tT(e){if(typeof e.onSocket!="function")return;let t=!1,r=a((n,i)=>{n.__tool__===e.name&&(delete n.__tool__,e.onSocket(n,i))},"onSocket");return{emit(n){(0,c.socketEmit)({...n,__tool__:e.name})},activate(){t||(t=!0,(0,c.socketOn)(r))},disable(){t&&(t=!1,(0,c.socketOff)(r))},toggle(n){n?this.activate():this.disable()}}}a(tT,"createToolSocket");var{config:hd,localize:rT,settings:jr,hook:nT,wrappers:aT}=C({name:"arp",settings:[{key:"enabled",type:Boolean,default:!1,requiresReload:!0},{key:"force",type:Boolean,default:!0,requiresReload:!0}],hooks:[{event:"renderPhysicalItemSheetPF2e",listener:mT}],wrappers:[{path:Et,callback:lT},{path:dd,callback:fT},{path:Qa,callback:dT},{path:pd,callback:pT}],init:()=>{jr.enabled&&(aT.activateAll(),jr.force&&nT.activate())},ready:e=>{e&&jr.enabled&&game.settings.get("pf2e","automaticBonusVariant")!=="noABP"&&(game.settings.set("pf2e","automaticBonusVariant","noABP"),rT.warn("arp.forceVariant",!0))}}),iT={1:35,2:935,3:8935,4:8935},oT={1:65,2:1065,3:31065},sT={1:160,2:1060,3:20560,4:20560},cT={1:340,2:3440,3:49440};function xr(e,t=!1){return e&&!e.getFlag("pf2e","disableABP")&&(!t||e.isOfType("character"))}a(xr,"isValidActor");function uT(e){return!!e._source.system.baseItem&&["shield-boss","shield-spikes"].includes(e._source.system.baseItem)}a(uT,"isShieldWeapon");function vd(e){let t=e._source.system.traits.value,{group:r,category:n,slug:i}=e._source.system;return n==="unarmed"&&i!==c.HANDWRAPS_SLUG?!!(0,c.getEquippedHandwraps)(e.actor):(r!=="shield"||uT(e))&&!t.includes("alchemical")&&!t.includes("bomb")}a(vd,"isValidWeapon");function bd(e){return!0}a(bd,"isValidArmor");function lT(){let e=this.actor;if(!xr(e,!0)||!vd(this))return;let t=this._source.system.traits.value;if(t.includes("alchemical")&&t.includes("bomb"))return;let r=e.level,n=jr.force,i=r<2?0:r<10?1:r<16?2:3,o=r<4?0:r<12?1:r<19?2:3;(n||this.system.runes.potency<=i)&&(this.system.runes.potency=i),(n||this.system.runes.striking<=o)&&(this.system.runes.striking=o)}a(lT,"weaponPrepareBaseData");function fT(e){if(e(),!xr(this.actor)||this.isSpecific||!vd(this))return;let t=this.price.value.toObject();if(!t.gp)return;let r=this.system.runes.potency,n=this.system.runes.striking;r&&(t.gp-=iT[r]),n&&(t.gp-=oT[n]);let i=new game.pf2e.Coins(t);(r||n)&&!this.system.runes.property.length&&(i=i.plus(this._source.system.price.value)),this.system.price.value=i}a(fT,"weaponPrepareDerivedData");function dT(){let e=this.actor;if(!xr(e,!0)||!bd(this))return;let t=e.level,r=jr.force,n=t<5?0:t<11?1:t<18?2:3,i=t<8?0:t<14?1:t<20?2:3;(r||this.system.runes.potency<=n)&&(this.system.runes.potency=n),(r||this.system.runes.resilient<=i)&&(this.system.runes.resilient=i)}a(dT,"armorPrepareBaseData");function pT(e){if(e(),!xr(this.actor)||this.isSpecific||!bd(this))return;let t=this.price.value.toObject();if(!t.gp)return;let r=this.system.runes.potency,n=this.system.runes.resilient;r&&(t.gp-=sT[r]),n&&(t.gp-=cT[n]);let i=new game.pf2e.Coins(t);(r||n)&&!this.system.runes.property.length&&(i=i.plus(this._source.system.price.value)),this.system.price.value=i}a(pT,"armorPrepareDerivedData");function mT(e,t){let r=e.item;if(!r.isOfType("weapon","armor")||!xr(r.actor,!0))return;let i=(0,c.htmlElement)(t).querySelector(".material-runes");if(!i)return;let o=["potency","striking","resilient"].map(u=>`[name="system.runes.${u}"]`).join(", "),s=i.querySelectorAll(`[data-tab=details] fieldset .form-group:has(${o})`);for(let u of s)u.style.display="none"}a(mT,"onRenderPhysicalItemSheetPF2e");var{config:Pd,settings:gT,hooks:_d}=C({name:"debug",settings:[{key:"enabled",type:Boolean,default:!1,config:!1,scope:"client",onChange:e=>{_d.toggleAll(e)}}],hooks:[{event:"renderApplication",listener:Fo},{event:"renderActorSheet",listener:Fo},{event:"renderItemSheet",listener:Fo}],init:()=>{_d.toggleAll(gT.enabled)}});function Fo(e,t){let r=(0,c.htmlElement)(t);(0,c.addListener)(r,".document-id-link",n=>{if(!n.shiftKey)return;let i=e.object;if(!i)return;n.preventDefault(),n.stopPropagation();let o=i.type??i.documentName.toLowerCase(),s=2,u=o;for(;window[u];)u=`${o}${s++}`;window[u]=i,console.log(u,i)})}a(Fo,"onRender");var wo=debounce(vT,1),{localize:yT,config:Sd,settings:Za,hook:hT}=C({name:"effectsPanel",settings:[{key:"remove",type:Boolean,default:!1,scope:"client",onChange:wo},{key:"condition",type:Boolean,default:!1,scope:"client",onChange:wo}],hooks:[{event:"renderEffectsPanel",listener:bT}],init:wo});function vT(){hT.toggle(Za.condition||Za.remove),game.pf2e.effectPanel?.render()}a(vT,"setup");function bT(e,t){let r=e.actor;if(!r)return;let i=(0,c.htmlElement)(t).querySelectorAll(".effect-item[data-item-id]"),o=`<div>${yT("remove")}</div>`,s=`<a data-action="edit" data-tooltip="PF2E.EditItemTitle">
        <i class="fa-solid fa-fw fa-pencil"></i>
    </a>`;for(let u of i){let{itemId:f}=(0,c.elementData)(u),l=r.items.get(f);if(l&&(Za.remove&&!l.isLocked&&l.badge&&l.badge.type==="counter"&&((0,c.appendHTMLFromString)((0,c.querySelector)(u,".effect-info .instructions"),o),(0,c.addListener)(u,".icon","contextmenu",(p,d)=>_T(p,d,r),!0)),Za.condition&&l.isOfType("condition")&&l.slug!=="persistent-damage")){let p=(0,c.querySelector)(u,".effect-info > h1");if(!p)continue;(0,c.appendHTMLFromString)(p,s),(0,c.addListener)(p,"[data-action='edit']",(d,y)=>PT(d,y,r))}}}a(bT,"onRenderEffectsPanel");function _T(e,t,r){if(!e.shiftKey)return;let n=Td(t,r);!n?.badge||n.isLocked||n.badge.type!=="counter"||(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),n.delete())}a(_T,"onRemoveEffect");function PT(e,t,r){let n=Td(t,r);n?.isOfType("condition")&&(e.preventDefault(),n.sheet.render(!0))}a(PT,"onEditCondition");function Td(e,t){let r=(0,c.closest)(e,".effect-item[data-item-id]");if(!r)return;let{itemId:n}=(0,c.elementData)(r);return t.items.get(n)}a(Td,"getEffect");var ko=debounce(TT,1),{config:Ed,localize:ei,socket:Lo,settings:Ro,hook:ST}=C({name:"giveth",settings:[{key:"enabled",type:Boolean,default:!1,onChange:ko},{key:"message",type:Boolean,default:!0,onChange:ko}],hooks:[{event:"dropCanvasData",listener:MT,isUpstream:!0}],onSocket:ET,ready:ko});function TT(){let e=game.user.isGM,t=Ro.enabled;Lo.toggle(e&&t),ST.toggle(!e&&t&&Ro.message)}a(TT,"setup");function MT(e,t){if(t.type!=="Item"||!t.fromInventory||!t.uuid)return!0;let r=fromUuidSync(t.uuid);if(!r?.isOfType("physical"))return!0;let n=r.actor;if(!Md(n)||!n.isOwner)return!0;let i=(0,c.getDropTarget)(e,t,f=>{let l=f.actor;return f.document.actorLink&&Md(l,t.actorId)})?.actor;if(!i||i.isOwner)return!0;if(!(0,c.hasGMOnline)())return ei.error("error.noGM"),!0;let o=r.quantity;if(o<1)return ei.warn("error.zero"),!1;let s={itemId:r.id,originId:n.id,targetId:i.id};if(o===1)return Lo.emit(s),!1;let u=!!i.inventory.findStackableItem(r._source);return new c.MoveLootPopup(n,{quantity:{max:o,default:o},lockStack:!u,isPurchase:!1},(f,l)=>{s.quantity=f,s.newStack=l,Lo.emit(s)}).render(!0),!1}a(MT,"onDropCanvasData");async function ET({itemId:e,originId:t,targetId:r,newStack:n=!1,quantity:i=1},o){let s=game.actors.get(t),u=game.actors.get(r),f=s?.inventory.get(e);if(!s||!u||!f||f.quantity<1)return;let l=Math.min(i,f.quantity),p=await(0,c.transferItemToActor)(u,f,l,void 0,n);if(!Ro.message||!p)return;let d=ei("trade",{giver:(0,c.getHighestName)(s),quantity:l,item:p.link,recipient:(0,c.getHighestName)(u)});(0,c.createTradeMessage)(ei("subtitle"),d,s,p,o)}a(ET,"giveth");function Md(e,t){return(0,c.isPlayedActor)(e)&&(!t||e.id!==t)&&e.hasPlayerOwner&&!e.isToken&&e.isOfType("character","npc","vehicle")}a(Md,"isValidActor");var Ad="Compendium.pf2e.rollable-tables.RollTable.zgZoI7h0XjjJrrNK",OT="Compendium.pf2e.journals.JournalEntry.BSp4LUSaOmUyjBko",{config:Cd,settings:we,localize:z,wrappers:Od,socket:Be,waitDialog:ti,render:IT,getFlag:AT,setFlag:CT,setFlagProperty:FT}=C({name:"heroActions",settings:[{key:"enabled",type:Boolean,default:!1,onChange:e=>{Od.toggleAll(e),Be.toggle(e),(0,c.renderCharacterSheets)()}},{key:"table",type:String,default:""},{key:"count",type:Number,default:0,range:{min:0,max:10,step:1},onChange:c.renderCharacterSheets},{key:"trade",type:Boolean,default:!0,onChange:c.renderCharacterSheets},{key:"private",type:Boolean,default:!1}],wrappers:[{path:re,callback:wT},{path:ne,callback:kT}],api:{canTrade:Fd,discardHeroActions:qd,drawHeroAction:xd,drawHeroActions:jd,getDeckTable:jo,getHeroActionDetails:ri,getHeroActions:de,giveHeroActions:Bd,removeHeroActions:NT,sendActionToChat:Rd,tradeHeroAction:kd,usesCountVariant:Do,useHeroAction:Dd},onSocket:(e,t)=>{switch(e.type){case"trade-request":{e.receiver.id===game.user.id&&qT(e,t);break}case"trade-error":{e.sender.id===game.user.id&&LT(e,t);break}case"trade-reject":{e.sender.id===game.user.id&&RT(e,t);break}case"trade-accept":{game.users.activeGM===game.user&&DT(e,t);break}}},ready:()=>{let e=we.enabled;Od.toggleAll(e),Be.toggle(e)}});function Fd(){return we.trade}a(Fd,"canTrade");function Do(){return we.count>0}a(Do,"usesCountVariant");async function wT(e){let t=this.actor,r=de(t),n=Do(),i=t.heroPoints.value,o=i-r.length,s=!n&&o<0,u=!n&&o>0,f=await IT("sheet",{actions:r,usesCount:n,mustDiscard:s,mustDraw:u,canUse:n&&i>0||o>=0,canTrade:r.length&&!s&&!u&&Fd(),diff:Math.abs(o),isOwner:t.isOwner,isGM:game.user.isGM}),l=(0,c.querySelector)(e,".tab[data-tab=actions] .tab-content .tab[data-tab=encounter]"),p=(0,c.querySelector)(l,":scope > .strikes-list:not(.skill-action-list)");(0,c.afterHTMLFromString)(p,f)}a(wT,"characterSheetPF2eRenderInner");function kT(e){let t=this.actor,r=(0,c.querySelector)(e,".tab[data-tab=actions] .tab-content .tab[data-tab=encounter]"),n=(0,c.querySelector)(r,".heroActions-list");if(!n||!r)return;(0,c.addListener)(r,"[data-action='hero-actions-draw']",()=>jd(t)),(0,c.addListener)(r,"[data-action='hero-actions-trade']",()=>kd(t,this)),game.user.isGM&&(0,c.addListener)(r,"[data-action='give-actions']",()=>Bd(t));let i=a((o,s)=>{(0,c.addListenerAll)(n,`[data-action="${o}"]`,(u,f)=>{let l=(0,c.closest)(f,"[data-uuid]");if(!l)return;let{uuid:p}=(0,c.elementData)(l);s(t,p,l)})},"addActionListener");i("hero-action-discard",jT),i("hero-action-use",Dd),i("hero-action-chat",Rd),i("hero-action-expand",Ld)}a(kT,"characterSheetPF2eActivateListeners");function At(e){return e?.isOfType("character")?!0:(z.warn("error.onlyCharacter"),!1)}a(At,"isValidActor");function wd(e){let t=game.actors.get(e.sender.cid),r=game.actors.get(e.receiver.cid);if(!t?.isOfType("character")||!r?.isOfType("character")){Be.emit({...e,type:"trade-error"});return}let n=de(t),i=de(r),o=n.findIndex(u=>u.uuid===e.sender.uuid),s=i.findIndex(u=>u.uuid===e.receiver.uuid);if(o===-1||e.receiver.uuid&&s===-1){Be.emit({...e,type:"trade-error"});return}return{sender:{actor:t,actions:n,index:o},receiver:{actor:r,actions:i,index:s}}}a(wd,"getTradeDataFromPacket");function LT(e,t){z.error("error.tradeError",{sender:game.actors.get(e.sender.cid)?.name??e.sender.cid,receiver:game.actors.get(e.receiver.cid)?.name??e.receiver.cid})}a(LT,"onTradeError");function RT(e,t){z.warn("trade.rejected",{sender:game.actors.get(e.sender.cid)?.name??e.sender.cid,receiver:game.actors.get(e.receiver.cid)?.name??e.receiver.cid})}a(RT,"onTradeRejected");function DT(e,t){let r=wd(e);if(!r)return;let{sender:n,receiver:i}=r;qo(n,i,t)}a(DT,"onTradeAccepted");async function qT(e,t){let r=wd(e);if(!r)return;let{sender:n,receiver:i}=r,o=we.private,s=z.sub("trade.request"),f=`<div>${s("flavor",{sender:n.actor.name,receiver:i.actor.name})}</div>`;if(o){let p=i.actions.map(({uuid:d,name:y},m)=>`<div class="action" data-uuid="${d}">
                <input type="radio" name="action" value="${d}" ${m===0?"checked":""} />
                <label data-action="description"> ${y}</label>
            </div>`);f+=p.join("")}else{let p=s("give",{give:`@UUID[${e.sender.uuid}]`}),d=s("want",{want:`@UUID[${e.receiver.uuid}]`});f+=`<div>${p}</div><div>${d}</div>`}let l=await ti("trade.request",{yes:"fa-solid fa-handshake",content:await TextEditor.enrichHTML(f,{async:!0}),onRender:p=>{(0,c.addListenerAll)(p,"[data-action='description']",async(d,y)=>{let m=(0,c.closest)(y,".action");if(!m)return;let{uuid:b}=(0,c.elementData)(m);(await fromUuid(b))?.sheet.render(!0)})}});if(l===null){Be.emit({...e,type:"trade-reject"});return}if(o&&(e.receiver.uuid=(0,c.querySelector)(l,"[name='action']:checked").value),game.user.isGM){qo(n,i,t);return}Be.emit({...e,type:"trade-accept"})}a(qT,"onTradeRequest");async function kd(e,t){if(!At(e))return;if(!(0,c.hasGMOnline)()){z.error("error.noGM");return}let r=de(e);if(!r.length){z.warn("error.noAction");return}let n=e.heroPoints.value;if(!Do()&&n<r.length){z.warn("error.mustDiscard",{nb:r.length-n});return}let o=we.private,s=game.actors.filter(m=>m!==e&&m.isOfType("character")&&m.hasPlayerOwner).map(m=>({name:m.name,id:m.id,actions:de(m),isPrivate:o&&!m.isOwner})).filter(m=>m.actions.length>0);if(s.length===0){z.warn("error.noOther");return}let f=await ti("trade",{yes:"fa-duotone fa-share-from-square",data:{actions:r,others:s},onRender:a(m=>{(0,c.addListener)(m,"[name='target']","change",(b,_)=>{let S=_.value,T=m.querySelectorAll("[data-target-id]");for(let M of T)M.classList.toggle("selected",M.dataset.targetId===S);t&&(0,c.refreshApplication)(t)}),(0,c.addListenerAll)(m,"[data-action='description']",async(b,_)=>{let S=(0,c.closest)(_,".action");if(!S)return;let{uuid:T}=(0,c.elementData)(S);(await fromUuid(T))?.sheet.render(!0)})},"onRender")},{width:500});if(f===null)return;let l=(0,c.querySelector)(f,".header [name='target']")?.value,p=game.actors.get(l);if(!p)return;let d=(0,c.querySelector)(f,".left [name='action']:checked")?.value,y=f.querySelector(`.right [name="action-${l}"]:checked`)?.value;if(!(!d||!y)){if(p.isOwner&&y){let m=s.find(b=>b.id===l).actions;qo({actor:e,actions:r,index:r.findIndex(b=>b.uuid===d)},{actor:p,actions:m,index:m.findIndex(b=>b.uuid===y)});return}Be.emit({type:"trade-request",sender:{id:game.user.id,cid:e.id,uuid:d},receiver:{id:(0,c.getOwner)(p)?.id??game.users.activeGM.id,cid:l,uuid:y}})}}a(kd,"tradeHeroAction");function qo(e,t,r){let n=e.actions.splice(e.index,1)[0],i=t.actions.splice(t.index,1)[0];e.actions.push(i),t.actions.push(n),It(e.actor,e.actions),It(t.actor,t.actions),ni(e.actor,[n,i],"exchanged",{senderId:r,other:t.actor.name})}a(qo,"exchangeHeroActions");async function Ld(e,t,r){let i=(0,c.querySelector)(r,".item-summary");if(!i.classList.contains("loaded")){let o=await ri(t);if(!o)return;let s=await TextEditor.enrichHTML(o.description,{async:!0}),u=(0,c.querySelector)(i,".item-description");(0,c.appendHTMLFromString)(u,s),i.classList.add("loaded")}i.hidden?gsap.fromTo(i,{height:0,opacity:0,hidden:!1},{height:"auto",opacity:1,duration:.4}):gsap.to(i,{height:0,duration:.4,opacity:0,paddingTop:0,paddingBottom:0,margin:0,clearProps:"all",onComplete:()=>{i.hidden=!0}})}a(Ld,"onExpandAction");async function Rd(e,t){if(!At(e))return;let r=await ri(t);r&&ChatMessage.implementation.create({content:`<h3>${r.name}</h3>${r.description}`,speaker:ChatMessage.getSpeaker({actor:e})})}a(Rd,"sendActionToChat");async function Dd(e,t){if(!At(e))return;let r=e.heroPoints.value;if(r<1){z.warn("error.notEnoughPoint");return}let n=de(e),i=n.findIndex(u=>u.uuid===t);if(i===-1)return;n.splice(i,1);let o=await ri(t);if(!o)return;let s=FT({"system.resources.heroPoints.value":r-1},"actions",n);e.update(s),ChatMessage.implementation.create({flavor:`<h4 class="action">${z("message.used")}</h4>`,content:`<h3>${o.name}</h3>${o.description}`,speaker:ChatMessage.getSpeaker({actor:e})})}a(Dd,"useHeroAction");async function ri(e){let t=await fromUuid(e);if(!t){z.error("error.noDetails");return}let r=t instanceof JournalEntry?t:t.parent,n=t instanceof JournalEntry?t.pages.contents[0]:t,i=n?.text.content;if(!i){z.error("error.noDetails");return}return r.uuid===OT&&(i=i.replace(/^<p>/,"<p><strong>Trigger</strong> ")),{name:n.name,description:i}}a(ri,"getHeroActionDetails");function jT(e,t,r){let n=(0,c.closest)(r,".actions-list"),i=Number((0,c.elementData)(n).discard),o=(0,c.querySelectorArray)(n,".item.discarded").map(s=>(0,c.elementData)(s).uuid);o.includes(t)?r.classList.remove("discarded"):o.length+1>=i?(o.push(t),qd(e,o)):r.classList.add("discarded")}a(jT,"onDiscardAction");function qd(e,t){if(!At(e))return;let r=de(e),n=[];t=Array.isArray(t)?t:[t];for(let i of t){let o=r.findIndex(s=>s.uuid===i);o!==-1&&(n.push(r[o]),r.splice(o,1))}n.length!==0&&(It(e,r),ni(e,n,"discarded"))}a(qd,"discardHeroActions");async function jd(e){if(!At(e))return;let t=[],r=we.count,i=r>0?[]:de(e),o=r||e.heroPoints.value-i.length;if(o<=0){z.warn("error.notEnoughPoint");return}for(let s=0;s<o;s++){let u=await xd();if(u!==void 0){if(u===null)return;i.push(u),t.push(u)}}t.length&&(It(e,i),ni(e,t,"drawn"))}a(jd,"drawHeroActions");function ni(e,t,r,{senderId:n=game.user.id,other:i}={}){let o=t.map(({uuid:l})=>`@UUID[${l}]`),s=z.sub("message"),u=r==="exchanged"?`<div>${s("offer",{offer:o[0]})}</div>
            <div>${s("receive",{receive:o[1]})}</div>`:o.map(l=>`<div>${l}</div>`).join(""),f={flavor:`<h4 class="action">${s(r,{nb:t.length,name:i})}</h4>`,content:u,speaker:ChatMessage.getSpeaker({actor:e}),user:n};we.private&&(f.type=CONST.CHAT_MESSAGE_TYPES.ROLL,f.rollMode=CONST.DICE_ROLL_MODES.PRIVATE),ChatMessage.implementation.create(f)}a(ni,"createActionsMessage");async function xd(){let e=await jo(),t=z.sub("table");if(!e)return t.error("notFound",!0),null;if(!e.formula)if(game.user.isGM){if(e.compendium)return t.error("noFormulaCompendium",!0),null;await e.normalize()}else return t.error("noFormula",!0),null;e.replacement===!1&&(e.results.some(s=>!s.drawn)||await e.resetResults());let r=(await e.draw({displayChat:!1})).results[0];if(!r){t.warn("noDraw");return}let n=Hd(r);if(!n){t.warn("drawError");return}let i=await Nd(r,n);return{uuid:n,name:i}}a(xd,"drawHeroAction");async function Nd(e,t){return e.type!==CONST.TABLE_RESULT_TYPES.TEXT?e.text:/@UUID\[[\w\.]+\]{([\w -]+)}/.exec(e.text)?.[1]??(t&&(await fromUuid(t))?.name)}a(Nd,"getLabelfromTableResult");function Hd(e){if(e.type===CONST.TABLE_RESULT_TYPES.TEXT)return/@UUID\[([\w\.-]+)\]/.exec(e.text)?.[1];if(e.type===CONST.TABLE_RESULT_TYPES.DOCUMENT)return`${e.documentCollection}.${e.documentId}`;if(e.type===CONST.TABLE_RESULT_TYPES.COMPENDIUM)return`Compendium.${e.documentCollection}.${e.documentId}`}a(Hd,"documentUuidFromTableResult");async function Id(e){if(!e)return;let t=await fromUuid(e);return t&&t instanceof RollTable?t:void 0}a(Id,"getTableFromUuid");function xT(){return game.tables.find(e=>e.getFlag("core","sourceId")===Ad)}a(xT,"getDefaultWorldTable");async function jo(){return await Id(we.table)??xT()??await Id(Ad)}a(jo,"getDeckTable");function de(e){return AT(e,"actions")?.slice()??[]}a(de,"getHeroActions");function It(e,t){return CT(e,"actions",t)}a(It,"setHeroActions");async function Bd(e){if(!game.user.isGM){z.warn("error.notGM");return}if(!At(e))return;let t=await jo();if(!t)return z.error("table.notFound",!0),null;let r=t.replacement===!1,n=de(e),i=(await Promise.all(t.results.map(async p=>{let d=Hd(p);if(!(!d||n.find(y=>y.uuid===d)))return{key:p.id,uuid:d,name:await Nd(p,d),drawn:r&&p.drawn}}))).filter(Boolean),o=await ti("giveActions",{yes:"fa-solid fa-gift",data:{actions:i,isUnique:r},onRender:p=>{(0,c.addListenerAll)(p,"[data-action='expand']",(d,y)=>{let m=(0,c.closest)(y,"[data-uuid]");if(!m)return;let{uuid:b}=(0,c.elementData)(m);Ld(e,b,m)})}});if(!o)return;let s=(0,c.querySelectorArray)(o,"[name='action']:checked").map(p=>{let d=(0,c.closest)(p,".action");return(0,c.elementData)(d)}),u=(0,c.querySelector)(o,"[name='drawn']")?.checked,f=(0,c.querySelector)(o,"[name='message']").checked,l=[];for(let{uuid:p,name:d,key:y}of s){if(n.push({uuid:p,name:d}),!u)continue;let m=t.results.get(y);m&&!m.drawn&&l.push(y)}l.length&&t.updateEmbeddedDocuments("TableResult",l.map(p=>({_id:p,drawn:!0}))),It(e,n),f&&ni(e,s,"given")}a(Bd,"giveHeroActions");async function NT(){if(!game.user.isGM){z.warn("error.notGM");return}let e=z.sub("removeActions"),t=a(i=>{let o=(0,c.querySelector)(i,"[name='all']"),s=(0,c.querySelectorArray)(i,"[name='actor']");o.addEventListener("change",()=>{let u=o.checked;for(let f of s)f.checked=u});for(let u of s)u.addEventListener("change",()=>{let f=s.filter(l=>l.checked);s.length===f.length?(o.indeterminate=!1,o.checked=!0):f.length?(o.indeterminate=!0,o.checked=f.length>s.length/2):(o.indeterminate=!1,o.checked=!1)})},"onRender"),r=await ti("removeActions",{yes:"fa-solid fa-trash",data:{actors:game.actors.filter(i=>i.type==="character")},onRender:t});if(!r)return;let n=E.pipe((0,c.querySelectorArray)(r,"[name='actor']:checked"),E.map(i=>game.actors.get(i.value)),E.compact);if(n.length){for(let i of n)It(i,[]);e.info("removed")}}a(NT,"removeHeroActions");var{config:Ud,settings:zd,wrappers:Wd}=C({name:"noBulk",settings:[{key:"dropped",type:Boolean,default:!1,requiresReload:!0},{key:"coins",type:Boolean,default:!1,requiresReload:!0}],wrappers:[{key:"dropped",path:"CONFIG.Actor.documentClass.prototype.prepareEmbeddedDocuments",callback:HT},{key:"coins",path:"CONFIG.PF2E.Item.documentClasses.treasure.prototype.prepareBaseData",callback:BT}],init:()=>{Wd.dropped.toggle(zd.dropped),Wd.coins.toggle(zd.coins)}});function HT(e){e();let t=this.inventory.bulk.constructor,r=null;Object.defineProperty(this.inventory.bulk,"value",{get(){return r||(r=t.computeTotalBulk(this.actor.inventory.filter(n=>!n.isInContainer&&n.system.equipped.carryType!=="dropped"),this.actor.size),r)}})}a(HT,"actorPrepareEmbeddedDocuments");function BT(e){e(),this.isCoinage&&(this.system.bulk.value=0)}a(BT,"treasurePreparedBaseData");var{config:Gd,settings:$d,hooks:ai}=C({name:"unided",settings:[{key:"create",type:Boolean,default:!1,onChange:e=>{ai.preCreateItem.toggle(e)}},{key:"update",type:Boolean,default:!1,onChange:e=>{ai.preUpdateItem.toggle(e)}}],hooks:[{event:"preCreateItem",listener:zT},{event:"preUpdateItem",listener:WT}],init:()=>{ai.preCreateItem.toggle($d.create),ai.preUpdateItem.toggle($d.update)}});function zT(e){!e.img||!e.isOfType("physical")||e.updateSource({"system.identification.unidentified.img":e.img})}a(zT,"onPrecreateItem");function WT(e,t){!("img"in e)||!e.isOfType("physical")||setProperty(t,"system.identification.unidentified.img",t.img)}a(WT,"onPreUpdateItem");var Vd=debounce($T,1),{config:Jd,settings:Kd,hook:UT}=C({name:"untarget",settings:[{key:"force",type:Boolean,default:!1,onChange:Vd},{key:"enabled",type:Boolean,default:!1,scope:"client",onChange:Vd}],hooks:[{event:"updateCombat",listener:GT}]});function $T(){UT.toggle(Kd.force||Kd.enabled)}a($T,"setup");function GT(e,t){if(!("turn"in t)&&!("round"in t))return;let r=game.user;r.updateTokenTargets(),r.broadcastActivity({targets:[]})}a(GT,"onUpdateCombat");var{config:Yd,settings:Xd,hook:Qd,waitDialog:VT}=C({name:"templateHelper",settings:[{key:"enabled",type:Boolean,default:!1,scope:"client",onChange:e=>{Qd.toggle(e)}},{key:"dismiss",type:String,choices:["disabled","orphan","all"],default:"disabled",scope:"client"}],hooks:[{event:"createMeasuredTemplate",listener:KT}],init:()=>{Qd.toggle(Xd.enabled)}});async function KT(e,t,r){let n=game.user;if(n.id!==r)return;let i=e.actor,o=i?i.token?.object??i.getActiveTokens()[0]:void 0,s=await VT("menu",{title:e.item?.name,yes:"fa-solid fa-bullseye-arrow",data:{noSelf:!o}},{width:300});if(s){let f=(0,c.querySelector)(s,"[name='targets']:checked")?.value,l=(0,c.querySelector)(s,"[name='neutral']")?.checked,p=(0,c.querySelector)(s,"[name='self']")?.checked,d=i?i.alliance:n.isGM?"opposition":"party",y=d==="party"?"opposition":d==="opposition"?"party":null,_=(0,c.getTemplateTokens)(e).filter(S=>{let T=S.actor;if(S.document.hidden||!T?.isOfType("creature","hazard","vehicle"))return!1;if(o&&S===o)return p;let M=T.alliance;return M===null?l:f==="all"||f==="allies"&&M===d||f==="enemies"&&M===y}).map(S=>S.id);n.updateTokenTargets(_),n.broadcastActivity({targets:_})}let u=Xd.dismiss;u!=="disabled"&&(u==="all"||e.message?.getFlag("pf2e","context.type")!=="spell-cast")&&e.delete()}a(KT,"onCreateMeasuredTemplate");var{config:ep,settings:tp,wrappers:Zd,localize:JT,render:QT}=C({name:"spellsSummary",settings:[{key:"enabled",type:Boolean,default:!1,scope:"client",onChange:e=>{Zd.toggleAll(e),(0,c.renderCharacterSheets)()}},{key:"sort",type:Boolean,default:!1,scope:"client",onChange:c.renderCharacterSheets}],wrappers:[{path:re,callback:YT},{path:ne,callback:XT}],ready:()=>{Zd.toggleAll(tp.enabled)}});async function YT(e,t){let r=this.actor,n=Object.values(t.spellCollectionGroups).flat(),i=await(0,c.getSummarizedSpellsDataForRender)(r,tp.sort,JT.path,n),o=await QT("sheet",i),s=`<a data-tab="spells-summary" 
    data-group="spell-collections">Spell Summary</a>`,u=xo(e),f=(0,c.querySelector)(u,".tab[data-tab='known-spells']"),l=(0,c.querySelector)(u,"nav [data-tab='known-spells']");(0,c.beforeHTMLFromString)(l,s),(0,c.beforeHTMLFromString)(f,o)}a(YT,"characterSheetPF2eRenderInner");function XT(e){let t=this.actor;(0,c.addListener)(e,"nav.sheet-navigation .item[data-tab='spellcasting']",(o,s)=>ZT.call(this,e,s));let r=(0,c.getActiveModule)("pf2e-dailies");if(!r)return;let n=xo(e),i=(0,c.querySelector)(n,".tab.spells-summary");i&&((0,c.addListenerAll)(i,"[data-action='update-staff-charges']","change",(o,s)=>{let u=s.valueAsNumber;r.api.setStaffChargesValue(t,u)}),(0,c.addListenerAll)(i,"[data-action='reset-staff-charges']",()=>{r.api.setStaffChargesValue(t)}))}a(XT,"characterSheetPF2eActivateListeners");function ZT(e,t){if(!t.classList.contains("active"))return;let r=xo(e),n=(0,c.querySelector)(r,"nav"),o=(0,c.querySelector)(n,"[data-tab='spells-summary']")?.classList.contains("active")?"known-spells":"spells-summary";this.activateTab(o,{group:"spell-collections"})}a(ZT,"toggleSpellcastingTab");function xo(e){return(0,c.querySelector)(e,".sheet-content .tab[data-tab='spellcasting']")}a(xo,"getSpellcastingTab");var eM=["Compendium.pf2e.feats-srd.Item.yeSyGnYDkl2GUNmu","Compendium.pf2e.feats-srd.Item.LI9VtCaL5ZRk0Wo8"],tM=new Map([["Compendium.pf2e.feats-srd.Item.nRjyyDulHnP5OewA",{replace:"Compendium.pf2e.feats-srd.Item.DqD7htz8Sd1dh3BT",effect:"Compendium.pf2e.feat-effects.Item.UZKIKLuwpQu47feK"}]]),rM=new Map([["Compendium.pf2e.classfeatures.Item.09iL38CZZEa0q0Mt",{effect:"Compendium.pf2e.feat-effects.Item.fsjO5oTKttsbpaKl",action:"Compendium.pf2e.actionspf2e.Item.HbejhIywqIufrmVM"}],["Compendium.pf2e.feats-srd.Item.xQuNswWB3eg1UM28",{effect:"Compendium.pf2e.feat-effects.Item.2Qpt0CHuOMeL48rN"}],["Compendium.pf2e.feats-srd.Item.R7c4PyTNkZb0yvoT",{effect:"Compendium.pf2e.feat-effects.Item.qX62wJzDYtNxDbFv"}],["Compendium.pf2e.feats-srd.Item.bvOsJNeI0ewvQsFa",{effect:"Compendium.pf2e.feat-effects.Item.er5tvDNvpbcnlbHQ"}]]),{config:ap,settings:nM,hooks:rp,wrappers:np,localize:aM,render:iM,waitDialog:oM}=C({name:"stances",settings:[{key:"enabled",type:Boolean,default:!1,scope:"client",onChange:e=>{rp.toggleAll(e),np.toggleAll(e),(0,c.renderCharacterSheets)()}}],hooks:[{event:"preDeleteCombatant",listener:uM},{event:"createCombatant",listener:fM},{event:"deleteCombatant",listener:lM}],wrappers:[{path:re,callback:sM},{path:ne,callback:cM}],api:{canUseStances:Ho,getStances:ii,isValidStance:cp,toggleStance:ip},ready:()=>{let e=nM.enabled;rp.toggleAll(e),np.toggleAll(e)}});async function sM(e,t){let r=this.actor;if(!r.isOwner)return;let n=ii(r);if(!n.length)return;let i=sp(e),o=await iM("sheet",{inCombat:Ho(r),stances:n});(0,c.beforeHTMLFromString)((0,c.querySelector)(i,"header"),o)}a(sM,"characterSheetPF2eRenderInner");function cM(e){let t=this.actor;if(!t.isOwner)return;let r=sp(e);r&&(0,c.addListenerAll)(r,".pf2e-stances .stance",(n,i)=>{let o=(0,c.elementData)(i).effectUuid;ip(t,o,n.ctrlKey)})}a(cM,"characterSheetPF2eActivateListeners");function uM(e){let t=e.actor;if(!t?.isOfType("character"))return;let r=op(t);if(!r.length){t.sheet.render();return}t.deleteEmbeddedDocuments("Item",r.map(({effectID:n})=>n))}a(uM,"onPreDeleteCombatant");function lM(e){(0,c.renderCharacterSheets)()}a(lM,"onDeleteCombatant");async function fM(e){let t=e.actor;if(!t?.isOfType("character"))return;if(game.user.isGM||!(0,c.isOwner)(t)){t.sheet.render();return}let r=ii(t);if(!r.length||r.some(({effectID:u})=>!!u)||!(0,c.hasItemWithSourceId)(t,eM,"feat"))return;if(r.length===1){No(t,r[0].effectUUID);return}let o=await oM("opening",{yes:"fa-solid fa-person-running",data:{stances:r,actor:t}}),s=o?(0,c.querySelector)(o,"[name='stance']:checked")?.value:r[0].effectUUID;s&&No(t,s)}a(fM,"onCreateCombatant");async function ip(e,t,r){if(!r&&!Ho(e)){aM.warn("error.noCombat");return}let n=op(e);n.find(o=>o.effectUUID===t)||await No(e,t),n.length&&e.deleteEmbeddedDocuments("Item",n.map(({effectID:o})=>o))}a(ip,"toggleStance");function op(e){return ii(e).filter(r=>!!r.effectID)}a(op,"getStanceEffects");async function No(e,t){let r=await fromUuid(t);if(!(r instanceof Item)||!r.isOfType("effect"))return;let n=r.toObject();setProperty(n,"flags.core.sourceId",t);let[i]=await e.createEmbeddedDocuments("Item",[n]);i?.toMessage()}a(No,"addStance");function Ho(e){return e.getActiveTokens(!0,!0).some(t=>t.inCombat)}a(Ho,"canUseStances");function sp(e){return(0,c.querySelector)(e,".sheet-content [data-tab=actions] .tab-content .actions-panels [data-tab=encounter]")}a(sp,"getEncounterTab");function ii(e){let t=[],r=new Set;for(let n of e.itemTypes.feat){let i=n.sourceId;if(!i)continue;let o=tM.get(i),s=rM.get(i);if(!o&&!s&&!cp(n))continue;let u=o?.effect??s?.effect??n.system.selfEffect.uuid,f=fromUuidSync(u);if(!f)continue;o?.replace&&r.add(o.replace);let l=(0,c.getItemWithSourceId)(e,u,"effect"),p=s?.action&&(0,c.getItemWithSourceId)(e,s.action,"action")||n;t.push({name:(o&&fromUuidSync(o.replace)?.name)??n.name,itemName:n.name,uuid:i,img:f.img,effectUUID:u,effectID:l?.id,actionUUID:p.sourceId,actionID:p.id})}return t.filter(({uuid:n})=>!r.has(n))}a(ii,"getStances");function cp(e){return e.isOfType("feat")&&e.system.traits.value.includes("stance")&&!!e.system.selfEffect?.uuid}a(cp,"isValidStance");var dM=["health","turn","skills","hero","weapon","armor"],pM=["health","turn","armor"],{config:fp,settings:mM,hooks:gM,wrappers:yM,localize:up,render:hM,getFlag:oi,unsetFlag:vM,flagPath:lp,getFlagProperty:bM,getInMemory:Bo,setInMemory:_M}=C({name:"share",settings:[{key:"enabled",type:Boolean,default:!1,requiresReload:!0}],wrappers:[{path:"DocumentSheet.prototype._renderInner",callback:PM},{path:"CONFIG.Actor.documentClass.prototype.prepareBaseData",callback:CM},{path:"CONFIG.Actor.documentClass.prototype.prepareDerivedData",callback:FM},{path:"CONFIG.Actor.documentClass.prototype.prepareData",callback:wM},{path:"CONFIG.Combatant.documentClass.prototype.startTurn",callback:EM},{path:"CONFIG.Combatant.documentClass.prototype.endTurn",callback:OM},{path:"CONFIG.Combat.documentClass.prototype.resetActors",callback:MM,type:"OVERRIDE"},{path:"CONFIG.PF2E.Item.documentClasses.effect.prototype.remainingDuration",callback:TM,type:"OVERRIDE"},{path:Et,callback:SM}],hooks:[{event:"updateActor",listener:AM},{event:"deleteActor",listener:IM}],init:e=>{let t=mM.enabled;gM.toggleAll(t),yM.toggleAll(t)}});async function PM(e,...t){let r=await e(...t);if(!game.user.isGM||!(0,c.isInstanceOf)(this,"CreatureConfig"))return r;let n=this.actor;if(!(0,c.isPlayedActor)(n)||!n.isOfType("character","npc"))return r;let i=oi(n,"config"),o=Ct(n).length?[]:game.actors.filter(d=>pp(d,n.id)).map(d=>({value:d.id,label:d.name})),u=(n.isOfType("character")?dM:pM).map(d=>({label:up("config",d,"label"),hint:up("config",d,"hint"),checked:i?.[d]??!1,input:lp("config",d)})),f=(0,c.htmlElement)(r),l=await hM("config",{masterInput:lp("config.master"),masters:o,masterId:i?.master??"",groups:u}),p=(0,c.querySelector)(f,":scope > button[type='submit']");return(0,c.beforeHTMLFromString)(p,l),r}a(PM,"documentSheetRenderInner");function SM(){let e=this.actor;if(!e?.isOfType("character"))return;let{config:t,master:r}=Nr(e)??{};if(!t?.weapon||!r)return;let n=E.pipe(r.itemTypes.weapon,E.filter(i=>!!i.isInvested&&!!i.system.runes.property),E.sortBy([i=>i.system.runes.property,"desc"],[i=>i.system.runes.striking,"desc"],[i=>i.system.runes.property.length,"desc"]),E.first());n&&(this.system.runes.potency=n.system.runes.potency,this.system.runes.striking=n.system.runes.striking,this.system.runes.property=n.system.runes.property.slice())}a(SM,"weaponPrepareBaseData");function TM(){let e=this.actor,t=e?si(e):void 0;return(0,c.calculateRemainingDuration)(this,this.system.duration,t)}a(TM,"effectRemainingDuration");async function MM(){let e=E.pipe(this.combatants.contents,E.flatMap(t=>{let r=t.actor;if(!r)return[];if(!r.isOfType("character"))return[r];let n=r.familiar,i=Ct(r,"turn");return[r,n,...i]}),E.compact);(0,c.resetActors)(e,{sheets:!1,tokens:!0})}a(MM,"combatResetActors");async function EM(e){await e();let{actor:t,encounter:r}=this;if(!r||!t?.isOfType("character","npc"))return;let n=Ct(t,"turn");for(let i of n){if(!i||i.combatant)return;let o="turn-start",s={};for(let u of i?.rules??[])await u.onUpdateEncounter?.({event:o,actorUpdates:s});await i?.update(s);for(let u of i.itemTypes.effect)await u.onEncounterEvent(o);if(i.isOfType("character")&&i.familiar)for(let u of i.familiar.itemTypes.effect)await u.onEncounterEvent(o)}}a(EM,"combatantStartTurn");async function OM(e,t){await e(t);let{actor:r,encounter:n}=this;if(!n||!r?.isOfType("character","npc"))return;let i=Ct(r,"turn");for(let o of i){if(!o||o.combatant)return;let s=game.scenes.get(this.sceneId),u=o.getDependentTokens({linked:!0,scenes:s})[0],f=o.conditions.active;for(let p of f)await p.onEndTurn({token:u});let l="turn-end";for(let p of o.itemTypes.effect)await p.onEncounterEvent(l);if(o.isOfType("character")&&o.familiar)for(let p of o.familiar.itemTypes.effect)await p.onEncounterEvent(l)}}a(OM,"combatantEndTurn");function IM(e){if(!e.primaryUpdater||!e.isOfType("character","npc"))return;let t=si(e);t&&dp(t,e);let r=Ct(e);for(let n of r)vM(n,"config.master")}a(IM,"onDeleteActor");function AM(e,t){let r=e.isOfType("character");if(!e.primaryUpdater||!r&&!e.isOfType("npc"))return;if(bM(t,"config.master")!==void 0){let u=si(e);u&&dp(u,e)}let i=Nr(e);if(!i)return;let{master:o,config:s}=i;if(s.health){let u=getProperty(t,"system.attributes.hp");u&&o.update({"system.attributes.hp":deepClone(u)})}if(r&&s.hero){let u=getProperty(t,"system.resources.heroPoints");u&&o.update({"system.resources.heroPoints":deepClone(u)})}}a(AM,"onUpdateActor");function CM(e){if(e(),!this.isOfType("character","npc"))return;let t=si(this);if(!t)return;let r=this.uuid,n=Bo(t,"slaves");n?n.includes(r)||n.push(r):_M(t,"slaves",[r])}a(CM,"actorPrepareBaseData");function dp(e,t){let r=Bo(e,"slaves");if(!r)return;let n=t.uuid,i=r.indexOf(n);i!==-1&&r.splice(i,1)}a(dp,"removeSlave");function FM(e){if(!game.ready||!this.isOfType("character","npc"))return e();let{master:t,config:r}=Nr(this)??{};if(!r?.armor||!t)return e();let n=t.wornArmor,i=E.pipe(t.itemTypes.equipment,E.filter(u=>c.BANDS_OF_FORCE_SLUGS.includes(u.slug)&&!!u.isInvested),E.sortBy([u=>u.slug,"desc"]),E.first()),o=(i?c.BANDS_OF_FORCE_SLUGS.indexOf(i.slug):-1)+1;if(!n?.isInvested&&!o)return e();let s=["ac","saving-throw"];for(let u of s){let f=n?.system.runes[u==="ac"?"potency":"resilient"]||0;if(!f&&!o)continue;let l=a((d={})=>{let y=f>o?n.name:i.name,m=game.pf2e.system.sluggify(y),b=new game.pf2e.Modifier({slug:m,label:y,modifier:Math.max(f,o),type:"potency"});return d.test&&b.test(d.test),b},"construct");(this.synthetics.modifiers[u]??=[]).push(l)}e()}a(FM,"actorPrepareDerivedData");function wM(e){e();let t=this.isOfType("character");if(!game.ready||!t&&!this.isOfType("npc"))return;let r=Ct(this);if(r.length){for(let o of r){o.reset(),o.sheet.render();for(let s of o.getActiveTokens())s.renderFlags.set({refreshBars:!0})}return}let{master:n,config:i}=Nr(this)??{};if(!(!i||!n)){if(i.health){let o=n.system.attributes.hp;this.system.attributes.hp=mergeObject(new game.pf2e.StatisticModifier("hp"),o)}if(t&&i.hero&&(this.system.resources.heroPoints.max=n.system.resources.heroPoints.max,this.system.resources.heroPoints.value=n.system.resources.heroPoints.value),t&&i.skills){let o=(0,c.getStatisticClass)(this.skills.acrobatics);for(let s of c.SKILL_ABBREVIATIONS){let u=c.SKILL_DICTIONARY[s],f=n.skills[u];if((this.skills[u].rank??0)>f.rank)continue;let p=c.SKILL_EXPANDED[u].attribute,d=new o(this,{slug:u,label:CONFIG.PF2E.skills[s]??u,attribute:p,domains:[u,`${p}-based`,"skill-check","all"],modifiers:[],lore:!1,rank:f.rank,check:{type:"skill-check"}});this.skills[u]=d,this.system.skills[s]=mergeObject(d.getTraceData(),{attribute:p,rank:f.rank})}}}}a(wM,"actorPrepareData");function si(e){return Nr(e)?.master}a(si,"getMaster");function Nr(e){let t=oi(e,"config");if(!t?.master)return;let r=game.actors.get(t.master);return pp(r)?{master:r,config:t}:void 0}a(Nr,"getMasterAndConfig");function Ct(e,t){return E.pipe(Bo(e,"slaves")??[],E.map(r=>fromUuidSync(r)),E.compact,E.filter(r=>kM(r)&&(!t||!!oi(r,"config",t))))}a(Ct,"getSlaves");function kM(e){return(0,c.isInstanceOf)(e,"ActorPF2e")&&(0,c.isPlayedActor)(e)&&e.isOfType("character","npc")}a(kM,"isValidSlave");function pp(e,t){return(0,c.isPlayedActor)(e)&&!!e.prototypeToken.actorLink&&(!t||e.id!==t)&&e.isOfType("character")&&!e.traits.has("eidolon")&&!e.traits.has("minion")&&!oi(e,"config.master")}a(pp,"isValidMaster");var Ft=["criticalFailure","failure","success","criticalSuccess"],ci={LOWER_BY_TWO:-2,LOWER:-1,INCREASE:1,INCREASE_BY_TWO:2,TO_CRITICAL_FAILURE:"criticalFailure",TO_FAILURE:"failure",TO_SUCCESS:"success",TO_CRITICAL_SUCCESS:"criticalSuccess"},li=class e{static{a(this,"DegreeOfSuccess")}value;unadjusted;adjustment;dieResult;rollTotal;dc;constructor(t,r,n=null){t instanceof Roll?(this.dieResult=(t.isDeterministic?t.terms.find(i=>i instanceof NumericTerm):t.dice.find(i=>i instanceof Die&&i.faces===20))?.total??1,this.rollTotal=t.total):(this.dieResult=t.dieValue,this.rollTotal=t.dieValue+t.modifier),this.dc=typeof r=="number"?{value:r}:r,this.unadjusted=this.#n(),this.adjustment=this.#r(this.unadjusted,n),this.value=this.adjustment?this.#t(this.adjustment.amount,this.unadjusted):this.unadjusted}static CRITICAL_FAILURE=0;static FAILURE=1;static SUCCESS=2;static CRITICAL_SUCCESS=3;#r(t,r){if(!r)return null;for(let n of["all",...Ft]){let{label:i,amount:o}=r[n]??{};if(o&&i&&!(t===e.CRITICAL_SUCCESS&&o===ci.INCREASE)&&!(t===e.CRITICAL_FAILURE&&o===ci.LOWER)&&(n==="all"||Ft.indexOf(n)===t))return{label:i,amount:o}}return null}#t(t,r){switch(t){case"criticalFailure":return 0;case"failure":return 1;case"success":return 2;case"criticalSuccess":return 3;default:return Math.clamped(r+t,0,3)}}#e(t){return this.dieResult===20?this.#t(ci.INCREASE,t):this.dieResult===1?this.#t(ci.LOWER,t):t}#n(){let t=this.dc.value;return this.rollTotal-t>=10?this.#e(e.CRITICAL_SUCCESS):t-this.rollTotal>=10?this.#e(e.CRITICAL_FAILURE):this.rollTotal>=t?this.#e(e.SUCCESS):this.#e(e.FAILURE)}};var LM={"target-apply-healing":-1,"target-half-damage":.5,"target-apply-damage":1,"target-double-damage":2,"target-triple-damage":3},RM={fortitude:{icon:"fa-solid fa-chess-rook",label:"PF2E.SavesFortitude"},reflex:{icon:"fa-solid fa-person-running",label:"PF2E.SavesReflex"},will:{icon:"fa-solid fa-brain",label:"PF2E.SavesWill"}},$o={hero:{icon:"fa-solid fa-hospital-symbol",reroll:"PF2E.RerollMenu.HeroPoint",rerolled:"PF2E.RerollMenu.MessageHeroPoint"},new:{icon:"fa-solid fa-dice",reroll:"PF2E.RerollMenu.KeepNew",rerolled:"PF2E.RerollMenu.MessageKeep.new"},lower:{icon:"fa-solid fa-dice-one",reroll:"PF2E.RerollMenu.KeepLower",rerolled:"PF2E.RerollMenu.MessageKeep.lower"},higher:{icon:"fa-solid fa-dice-six",reroll:"PF2E.RerollMenu.KeepHigher",rerolled:"PF2E.RerollMenu.MessageKeep.higher"}},mp=debounce(()=>(0,c.refreshLatestMessages)(20),1),{config:bp,settings:fi,hooks:gp,wrappers:wt,localize:te,socket:Hr,render:zo,getFlag:se,setFlag:di,updateSourceFlag:Go,setFlagProperty:ke,deleteInMemory:yp,getInMemory:DM,setInMemory:hp,waitDialog:qM}=C({name:"targetHelper",settings:[{key:"enabled",type:Boolean,default:!1,requiresReload:!0},{key:"addTargets",type:Boolean,default:!0,scope:"client",onChange:e=>{fi.enabled&&e?(wt.enrichHTML.activate(),wt.messageGetHTML.activate(),document.body.addEventListener("dragstart",Uo,!0)):(wt.enrichHTML.disable(),wt.messageGetHTML.disable(),document.body.removeEventListener("dragstart",Uo,!0)),mp()}},{key:"smallButtons",type:Boolean,default:!0,scope:"client",onChange:()=>{mp()}}],hooks:[{event:"preCreateChatMessage",listener:WM},{event:"getChatLogEntryContext",listener:zM}],wrappers:[{key:"messageGetHTML",path:Ot,callback:UM},{key:"enrichHTML",path:Ya,callback:NM}],onSocket:jM,init:e=>{fi.enabled&&(Hr.toggle(e),gp.getChatLogEntryContext.activate(),gp.preCreateChatMessage.activate(),fi.addTargets&&(wt.enrichHTML.activate(),wt.messageGetHTML.activate(),document.body.addEventListener("dragstart",Uo,!0)))}});function jM(e,t){if((0,c.isActiveGM)())switch(e.type){case"update-applied":{game.messages.get(e.message)?.update(e.updates);break}case"dice-so-nice":{Vo(e.roll,e.target,!0);break}case"update-save":{let r=game.messages.get(e.message);r&&di(r,"saves",e.updates);break}}}a(jM,"onSocket");var xM=/(class="inline-check[\w0-9 -]*")/g;function NM(e){return e.replace(xM,"$1 draggable='true'")}a(NM,"textEditorEnrichHTML");function _p(e){return e.rolls[0].options.evaluatePersistent}a(_p,"isPersistentDamageMessage");var vp;function HM(e){return vp??=(()=>{let t=[game.i18n.localize("PF2E.Encounter.Broadcast.FastHealing.fast-healing.ReceivedMessage"),game.i18n.localize("PF2E.Encounter.Broadcast.FastHealing.regeneration.ReceivedMessage")];return new RegExp(`^<div>(${t.join("|")})</div>`)})(),vp.test(e.flavor)}a(HM,"isRegenMessage");function Pp(e){return e.isDamageRoll}a(Pp,"isDamageMessage");function BM(e){return!!e&&e.damageKinds.size>0}a(BM,"isDamageSpell");function Br(e){return se(e,"targets")??[]}a(Br,"getMessageTargets");function Sp(){return E.pipe(Array.from(game.user.targets),E.filter(e=>!!e.actor?.isOfType("creature","hazard","vehicle")),E.map(e=>e.document.uuid))}a(Sp,"getCurrentTargets");function zM(e,t){let r=a(n=>{let i=n.data("messageId"),o=game.messages.get(i);if(o)return{message:o,canRollSave:DM(o,"canRollSave")}},"getMessageData");t.unshift({icon:'<i class="fa-solid fa-dice-d20"></i>',name:te.path("context.rollAll"),condition:n=>!!r(n)?.canRollSave?.length,callback:async n=>{let{canRollSave:i,message:o}=r(n)??{};if(!o||!i?.length)return;let s=Ip(o);if(!s)return;let u=await Promise.all(i.map(l=>fromUuid(l))),f=E.compact(u);f.length&&Ep(new MouseEvent("click"),o,s,f)}})}a(zM,"onGetChatLogEntryContext");function WM(e){let t=Pp(e)&&!_p(e),r=e.item,n=r?.isOfType("spell");if(!t&&!n)return;let i=e.token,o=i?.actor,s=[],u=n?r.system.defense?.save:void 0;if(!(!t&&n&&!u)){if(!Br(e).length)if(t&&HM(e))s.push(["isRegen",!0]),o&&s.push(["targets",[i.uuid]]);else{let f=Sp();f.length&&s.push(["targets",f])}if(t&&e.rolls.length===2){let f=e.rolls.findIndex(p=>p.options.splashOnly),l=e.rolls.findIndex(p=>!p.options.splashOnly&&p.options.damage?.modifiers?.some(d=>"damageCategory"in d&&d.damageCategory==="splash"));f!==-1&&l!==-1&&s.push(["splashIndex",f])}if(n&&u){let f=r.spellcasting?.statistic?.dc.value;typeof f=="number"&&s.push(["save",{...u,dc:f,author:o?.uuid}])}s.length&&Go(e,Object.fromEntries(s))}}a(WM,"onPreCreateChatMessage");async function UM(e){if(!this.isContentVisible)return;if(yp(this,"canRollSave"),yp(this,"canApplyDamage"),Pp(this)){if(_p(this))return;await $M(this,e);return}let t=this.item;!t||!t.isOfType("spell")||(BM(t)?(0,c.addListener)(e,"[data-action='spell-damage']",()=>{let r=this.id,n=se(this,"save");n&&Hooks.once("preCreateChatMessage",i=>{Go(i,"messageId",r),Go(i,"save",n)})}):await QM(this,e))}a(UM,"chatMessageGetHTML");async function $M(e,t){let r=(0,c.querySelector)(t,".message-content");if(!r)return;let n=(0,c.querySelectorArray)(r,".damage-application"),i=(0,c.querySelector)(r,".dice-result .dice-total");if(!n.length||!i)return;let o=await Op(e);t.addEventListener("drop",GM);let s=(0,c.createHTMLFromString)("<div class='pf2e-toolbelt-target-buttons'></div>");if(i.append(s),game.user.isGM||e.isAuthor){let p=Tp(e);s.append(p)}if(o?.targets.length){let d=`<button class="pf2e-toolbelt-target-toggleDamageRows" 
            title="${te("toggleDamageRows")}">
                <i class="fa-solid fa-plus expand"></i>
                <i class="fa-solid fa-minus collapse"></i>
            </button>`,y=(0,c.createHTMLFromString)(d);y.addEventListener("click",m=>{m.stopPropagation(),y.classList.toggle("expanded");for(let b of n)b.classList.toggle("hidden")});for(let m of n)m.classList.add("hidden");s.append(y)}else return;let u=fi.smallButtons,f=n.map(p=>{let d=p.cloneNode(!0);d.classList.remove("damage-application"),d.classList.add("target-damage-application"),u&&d.classList.add("small");let y=d.querySelectorAll("[data-action]");for(let m of y){let b=m.dataset.action;m.dataset.action=`target-${b}`}return d}),l=(0,c.createHTMLFromString)("<div class='pf2e-toolbelt-target-targetRows'></div>");for(let{template:p,isOwner:d,save:y,uuid:m,applied:b}of o.targets){let _=document.createElement("hr"),S=(0,c.createHTMLFromString)(p);if(l.append(_),l.append(S),!d)continue;let T=JM(y);for(let M=0;M<f.length;M++){let D=f[M].cloneNode(!0);D.dataset.rollIndex=String(M),D.dataset.targetUuid=m,D.classList.toggle("applied",!!b[M]||T&&y.result.success==="criticalSuccess"),T&&D.classList.add(y.result.success),l.append(D)}}r.after(l),Mp(e,l,o.save),(0,c.addListenerAll)(l,"[data-action^='target-']",(p,d)=>VM(p,d,e))}a($M,"damageChatMessageGetHTML");var Wo;function Uo(e){let t=e.target,r=e.dataTransfer;if(!r||!(t instanceof HTMLAnchorElement)||!t.classList.contains("inline-check"))return;let n=(0,c.elementData)(t);if(!n.pf2Dc||!c.saveTypes.includes(n.pf2Check)||!["reflex","will","fortitude"].includes(n.pf2Check)){e.preventDefault();return}e.stopPropagation();let i={dc:Number(n.pf2Dc),basic:!1,statistic:n.pf2Check,options:n.pf2RollOptions?.split(",").map(o=>o.trim())??[],traits:n.pf2Traits?.split(",").map(o=>o.trim())??[],type:`${c.MODULE.id}-check-roll`};if(n.isBasic==null){let o=t.querySelector("span.label")?.lastChild?.textContent?.trim();if(o){if(!Wo){let s=Object.values(CONFIG.PF2E.saves).map(f=>game.i18n.localize(f)),u=game.i18n.format("PF2E.InlineCheck.BasicWithSave",{save:`(${s.join("|")})`});Wo=new RegExp(u)}i.basic=Wo.test(o)}}r.setData("text/plain",JSON.stringify(i))}a(Uo,"onDragStart");function GM(e){let t=e.target?.closest("li.chat-message");if(!t)return;let r=TextEditor.getDragEventData(e);if(!r)return;let{type:n,dc:i,basic:o,options:s,statistic:u,traits:f}=r;if(n!==`${c.MODULE.id}-check-roll`)return;let l=t.dataset.messageId,p=game.messages.get(l);if(!p||!p.isDamageRoll)return;if(!game.user.isGM&&!p.isAuthor){te.warn("drop.unauth");return}if(se(p,"save")){te.warn("drop.already");return}let d={};ke(d,"save",{basic:o,dc:i,statistic:u}),ke(d,"rollOptions",[...s,...f]),p.update(d),te.info("drop.added")}a(GM,"onChatMessageDrop");async function VM(e,t,r){let{rollIndex:n,targetUuid:i}=(0,c.elementData)((0,c.closest)(t,"[data-target-uuid]")),o=await fromUuid(i);if(!o)return;let{action:s}=(0,c.elementData)(t);if(s==="target-shield-block"){let u=r.id;t.classList.contains("shield-activated")||(0,c.toggleOffShieldBlock)(u),requestAnimationFrame(()=>{(0,c.onClickShieldBlock)(t,(0,c.closest)(t,".chat-message"),o)});return}(0,c.applyDamageFromMessage)({message:r,multiplier:LM[s],addend:0,promptModifier:e.shiftKey,rollIndex:Number(n),tokens:[o],onDamageApplied:KM})}a(VM,"onTargetButton");function KM(e,t,r){let n={},[i]=t,o=i.id,s=se(e,"splashIndex");if(ke(n,"applied",o,String(r),!0),s!==void 0){let u=s===0?1:0;if(r===s)ke(n,"applied",o,String(u),!0);else{ke(n,"applied",o,String(s),!0);let f=Br(e);for(let l of f){let p=l.split(".").at(-1);p!==o&&ke(n,"applied",p,String(u),!0)}}}game.user.isGM||e.isAuthor?e.update(n):Hr.emit({type:"update-applied",message:e.id,updates:n})}a(KM,"onDamageApplied");function JM(e){return!!(e?.result&&e.basic)}a(JM,"isBasicSave");async function QM(e,t){let r=await Op(e);if(!r?.save)return;let n=(0,c.querySelector)(t,".message-content");if(!n)return;let i=n?.querySelector(".card-buttons"),o=i?.querySelector("[data-action='spell-save']");if(o&&(game.user.isGM||e.isAuthor)){let l=(0,c.createHTMLFromString)("<div class='pf2e-toolbelt-target-wrapper'></div>"),p=Tp(e);l.append(p,o),i.prepend(l)}let{targets:s,save:u}=r;if(!s.length)return;let f=(0,c.createHTMLFromString)("<div class='pf2e-toolbelt-target-targetRows'></div>");for(let{template:l}of s){let p=document.createElement("hr"),d=(0,c.createHTMLFromString)(l);f.append(p),f.append(d)}n.after(f),Mp(e,f,u)}a(QM,"spellChatMessageGetHTML");function Tp(e){let r=`<button class="pf2e-toolbelt-target-setTargets" data-action="set-targets"
        title="${te("setTargets")}">
        <i class="fa-solid fa-bullseye-arrow"></i>
    </button>`,n=(0,c.createHTMLFromString)(r);return n.addEventListener("click",i=>XM(i,e)),n}a(Tp,"createSetTargetsBtn");async function Mp(e,t,r){let n=t.querySelectorAll("[data-target-uuid]");for(let i of n){let{targetUuid:o}=(0,c.elementData)(i),s=await fromUuid(o);s&&((0,c.addListener)(i,"[data-action='ping-target']",()=>{canvas.ping(s.center)}),(0,c.addListener)(i,"[data-action='open-target-sheet']",()=>{s.actor?.sheet.render(!0)}),r&&((0,c.addListener)(i,"[data-action='roll-save']",u=>{Ep(u,e,r,[s])}),(0,c.addListener)(i,"[data-action='reroll-save']",u=>{YM(u,e,r,s)})))}}a(Mp,"addHeaderListeners");async function Ep(e,t,{dc:r,statistic:n},i){let o=game.user,s={};await Promise.all(i.map(u=>{let f=u.actor;if(!f)return;let l=f.saves[n];if(!l)return;let p=t.item,d=se(t,"rollOptions"),y=!o.settings.showCheckDialogs,m=i.length>1||(e.shiftKey?!y:y);return new Promise(b=>{l.check.roll({event:e,dc:{value:r},item:p,origin:f,skipDialog:m,extraRollOptions:d,createMessage:!1,callback:async(_,S,T)=>{await Vo(_,u);let M=T.getFlag("pf2e","context"),O=T.getFlag("pf2e","modifiers"),D={whispers:T.whisper.filter(k=>game.users.get(k)?.isGM),value:_.total,die:_.terms[0].total,success:S,roll:JSON.stringify(_.toJSON()),dosAdjustments:M.dosAdjustments,unadjustedOutcome:M.unadjustedOutcome,notes:M.notes,modifiers:O.filter(k=>k.enabled).map(({label:k,modifier:B})=>({label:k,modifier:B}))};s[u.id]=D,b()}})})})),o.isGM||t.isAuthor?di(t,"saves",s):Hr.emit({type:"update-save",message:t.id,updates:s})}a(Ep,"rollSaves");async function YM(e,t,{dc:r,statistic:n},i){let o=i?.actor;if(!o)return;let s=se(t,`saves.${i.id}`);if(!s?.roll||s.rerolled)return;let u=E.pipe(Object.entries($o),o.isOfType("character")&&o.heroPoints.value>0?E.identity:E.filter(([I])=>I!=="hero"),E.map.indexed(([I,{icon:U,reroll:pe}],Le)=>{let Ue=game.i18n.localize(pe);return`<label>
                <input type="radio" name="reroll" value="${I}" ${Le===0?"checked":""}>
                <i class="${U}"></i> ${Ue}
            </label>`}),E.compact,E.join("")),f=await qM("reroll",{title:`${i.name} - ${te("reroll.title")}`,content:u,yes:"fa-solid fa-rotate rotate"});if(!f)return;let p=(0,c.querySelector)(f,"[name='reroll']:checked").value,d=p==="hero",y=d?"new":p;if(d){let{value:I,max:U}=o.heroPoints;if(I<1){te.warn("reroll.noPoints");return}await o.update({"system.resources.heroPoints.value":Math.clamped(I-1,0,U)})}let m=Roll.fromJSON(s.roll),b=m.clone();b.options.isReroll=!0,Hooks.callAll("pf2e.preReroll",Roll.fromJSON(s.roll),b,d,y);let _=await b.evaluate({async:!0});await Vo(_,i),Hooks.callAll("pf2e.reroll",Roll.fromJSON(s.roll),_,d,y);let S=y==="higher"&&m.total>_.total||y==="lower"&&m.total<_.total?m:_;if(S===_){let I=new li(_,r,s.dosAdjustments);S.options.degreeOfSuccess=I.value}let T=o.saves[n].domains,M=se(t,"rollOptions")??[],O=Ft[S.degreeOfSuccess],k=[...(0,c.extractNotes)(o.synthetics.rollNotes,T)]?.map(I=>I instanceof c.RollNotePF2e?I:new c.RollNotePF2e(I)).filter(I=>I.predicate.test([...M,...I.rule?.item.getRollOptions("parent")??[]])?I.outcome.length===0?!0:!!(O&&I.outcome.includes(O)):!1)??[],B={whispers:s.whispers,value:S.total,die:S.terms[0].total,success:O,roll:JSON.stringify(S.toJSON()),dosAdjustments:deepClone(s.dosAdjustments),modifiers:deepClone(s.modifiers),notes:k.map(I=>I.toObject()),rerolled:p};S.options.keeleyAdd10&&B.modifiers.push({label:te("target.chat.save.reroll.keeley"),modifier:10}),game.user.isGM||t.isAuthor?di(t,"saves",i.id,B):Hr.emit({type:"update-save",message:t.id,updates:{[i.id]:B}})}a(YM,"rerollSave");async function Vo(e,t,r=!1){if(!game.dice3d)return;let n=game.user,i=!r&&game.pf2e.settings.metagame.breakdowns;return e=e instanceof Roll?e:Roll.fromData(e),t=typeof t=="string"?await fromUuid(t):t,!r&&!i?Hr.emit({type:"dice-so-nice",roll:e.toJSON(),target:t?.uuid}):r&&!n.isGM&&!t?.playersCanSeeName&&(e.ghost=!0),game.dice3d.showForRoll(e,n,i)}a(Vo,"roll3dDice");async function XM(e,t){e.stopPropagation();let r=Sp();await di(t,"targets",r),requestAnimationFrame(()=>ui.chat.scrollBottom({popout:!0,waitImages:!0}))}a(XM,"onSetTargets");async function Op(e){let t=Br(e),r=Ip(e);if(!t.length&&!r)return;let n=game.user,i=n.isGM,o=n.id,s=r?.author?await fromUuid(r.author):void 0,u=i||game.pf2e.settings.metagame.dcs||s?.hasPlayerOwner,f=i||game.pf2e.settings.metagame.breakdowns,l=i||game.pf2e.settings.metagame.results;if(r){let b=game.i18n.format("PF2E.SavingThrowWithName",{saveName:game.i18n.localize(r.label)}),_=u?te("tooltip.dcWithValue",{dc:r.dc}):"";r.tooltipLabel=`${b} ${_}`,r.tooltip=await zo("tooltip",{check:r.tooltipLabel})}let p=[],d=[],y=await Promise.all(t.map(async b=>{let _=await fromUuid(b);if(!_)return;let S=_.id,T=_.actor;if(!T)return;let M=_.hidden||T.hasCondition("unnoticed","undetected");if(!i&&M)return;let O=T.isOwner,D=T.hasPlayerOwner,k=O||D,B=r&&!!T.saves?.[r.statistic],I=se(e,`saves.${S}`);B&&!D&&!I&&p.push(b);let U=await(async()=>{if(!B||!I)return;let ae=I.rerolled,Dt=B&&O&&!ae,$e=I.value-r.dc,Zp=(k||f)&&I.unadjustedOutcome&&I.success!==I.unadjustedOutcome?I.dosAdjustments?.[I.unadjustedOutcome]?.label:void 0,as=!D&&I.whispers.length,is=i||!as,em=I.notes.map(tm=>new c.RollNotePF2e(tm)),os=c.RollNotePF2e.notesToHTML(em);os?.classList.add("pf2e-toolbelt-target-notes");let Wr="";return is&&((k||f)&&(Wr+=`(<i class="fa-solid fa-dice-d20"></i> ${I.die}) `),(k||l)&&(Wr+=te(`tooltip.result.${u?"withOffset":"withoutOffset"}`,{success:game.i18n.localize(`PF2E.Check.Result.Degree.Check.${I.success}`),offset:$e>=0?`+${$e}`:$e}))),{...I,notes:os?.outerHTML,canReroll:Dt,isPrivate:as,canSeeResult:is,tooltip:await zo("tooltip",{check:r.tooltipLabel,result:Wr?te("tooltip.result.format",{result:Wr}):void 0,modifiers:k||f?I.modifiers:[],adjustment:Zp,canReroll:Dt,rerolled:ae?$o[ae]:void 0})}})(),pe=r&&{...r,result:U},Le=(0,c.getActiveModule)("anonymous"),Ue=i?!0:Le?.api.playersSeeName(_.actor)??(!game.pf2e.settings.tokens.nameVisibility||_.playersCanSeeName),Re=Ue?_.name:Le?.api.getName(_.actor)??te("unnamed"),ve=se(e,`applied.${S}`)??[];return{isOwner:O,canSeeName:Ue,hasPlayerOwner:D,uuid:b,target:_,applied:ve,save:pe,template:await zo("header",{name:Re,isGM:i,isOwner:O,hasPlayerOwner:D,isHidden:M,uuid:b,showSuccess:k||l,save:B&&pe,canReroll:U?.canReroll,isPrivate:i&&U?.isPrivate,canSeeResult:U?.canSeeResult,rerolled:U?.rerolled?$o[U.rerolled]:void 0})}}));hp(e,"canRollSave",p),hp(e,"canApplyDamage",d);let m=E.compact(y);return i?m.sort((b,_)=>Number(b.hasPlayerOwner)-Number(_.hasPlayerOwner)):m.sort((b,_)=>!b.isOwner&&!_.isOwner?Number(_.hasPlayerOwner)-Number(b.hasPlayerOwner):Number(_.isOwner)-Number(b.isOwner)),{targets:m,save:r,isRegen:se(e,"isRegen")}}a(Op,"getMessageData");function Ip(e){let t=se(e,"save");if(t)return{...t,...RM[t.statistic]}}a(Ip,"getSaveFlag");var{config:wp,settings:ZM,hook:Ap,localize:eE,getFlag:pi,render:kp,setFlagProperty:Ko}=C({name:"mergeDamage",settings:[{key:"enabled",type:Boolean,default:!1,scope:"client",onChange:e=>{Ap.toggle(e),(0,c.refreshLatestMessages)(20)}}],hooks:[{event:"renderChatMessage",listener:tE}],init:()=>{Ap.toggle(ZM.enabled),(0,c.refreshLatestMessages)(20)}});async function tE(e,t){let r=e.actor;if(!game.user.isGM&&!e.isAuthor||!r||!Fp(e))return;let n=(0,c.htmlElement)(t),i=pi(e,"merged"),o=await kp("buttons",{merged:i}),s=(0,c.createHTMLFromString)(o),u=Jo(e);i&&n.classList.add("merged"),(0,c.querySelector)(n,".dice-result .dice-total")?.append(s),(0,c.addListener)(s,"[data-action='merge-damage']",f=>{f.stopPropagation();for(let{message:l}of(0,c.latestChatMessages)(5,e)){if(l.actor!==r||!Fp(l))continue;let p=Jo(l);if((0,c.compareArrays)(u,p)){rE(e,l);return}}eE.warn("noMatch")}),(0,c.addListener)(s,"[data-action='split-damage']",async f=>{f.stopPropagation();let l=pi(e,"data")?.flatMap(p=>p.source);l&&(await e.delete(),ChatMessage.implementation.createDocuments(l))})}a(tE,"onRenderChatMessage");async function rE(e,t){let r={},n=Cp(t).concat(Cp(e)),i=game.i18n.localize("PF2E.DamageRoll");for(let{name:m,notes:b,tags:_,modifiers:S,outcome:T}of n){r[m]??={label:`${i}: ${m}`,tags:_,notes:[],results:[]},b&&!r[m].notes.includes(b)&&r[m].notes.push(b);let M=r[m].results.find(O=>O.outcome===T&&O.modifiers===S);M?M.count++:r[m].results.push({outcome:T,modifiers:S,label:game.i18n.localize(`PF2E.Check.Result.Degree.Attack.${T??Ft[2]}`),count:1})}let o=[],s=e.rolls[0],u=t.rolls[0];for(let m of[u,s]){let b=m.instances;for(let _ of b){let S=o.find(T=>T.type===_.type&&T.persistent===_.persistent);if(S){S.total+=_.total,S.terms.push(..._.toJSON().terms),S.formulas.push(..._.terms.map(T=>T.expression));for(let T of _.materials)S.materials.add(T)}else o.push({type:_.type,persistent:_.persistent,total:_.total,materials:new Set(_.materials),terms:_.toJSON().terms.slice(),formulas:_.terms.map(T=>T.expression),formula:"",term:null})}}for(let m of o){if(m.persistent){let b=(0,c.getDamageRollClass)(),{index:_}=m.formulas.reduce((S,T,M)=>{let O=new b(T).expectedValue;return O<=S.value?S:{value:O,index:M}},{value:0,index:-1});m.formulas=[m.formulas[_]],m.terms=[m.terms[_]]}m.formula=`(${m.formulas.join(" + ")})[${m.type}]`,m.term=m.terms.length<2?m.terms[0]:Lp(m.terms)}let f=s.options.showBreakdown&&u.options.showBreakdown,l=(s.options.ignoredResistances??[]).concat(u.options.ignoredResistances??[]),p={class:"DamageRoll",options:{critRule:s.options.critRule,ignoredResistances:l,showBreakdown:f},dice:[],formula:`{${o.map(({formula:m})=>m).join(", ")}}`,total:E.sumBy(o,m=>m.total),evaluated:!0,terms:[{class:"InstancePool",options:{},evaluated:!0,terms:o.map(({formula:m})=>m),modifiers:[],rolls:o.map(({formula:m,total:b,term:_,type:S,materials:T})=>({class:"DamageInstance",options:{flavor:[S,...T].join(",")},dice:[],formula:m,total:b,terms:[_],evaluated:!0})),results:o.map(({total:m})=>({result:m,active:!0}))}]};await ChatMessage.deleteDocuments([e.id,t.id]);let d=[p];for(let m of[t,e])m.rolls.length>1&&d.push(...m.rolls.slice(1).map(b=>b.toJSON()));let y={flavor:await kp("merged",{groups:r,showBreakdown:f}),type:CONST.CHAT_MESSAGE_TYPES.ROLL,speaker:e.speaker,flags:{pf2e:{context:{options:E.uniq(n.flatMap(({options:m})=>m))}}},rolls:d};ke(y,"targets",Jo(e)),Ko(y,"type","damage-roll"),Ko(y,"merged",!0),Ko(y,"data",n),ChatMessage.implementation.create(y)}a(rE,"mergeDamages");function Lp(e){return{class:"Grouping",options:{},evaluated:!0,term:{class:"ArithmeticExpression",options:{},evaluated:!0,operator:"+",operands:[e.shift(),e.length>1?Lp(e):e[0]]}}}a(Lp,"createTermGroup");function Cp(e){let t=pi(e,"data");if(t)return t;let r=e.toObject();delete r._id,delete r.timestamp;let n=r.flags.pf2e,i=(0,c.createHTMLFromString)(e.flavor),o=i.querySelector(":scope > h4.action + .tags")?.outerHTML.trim()??"",s=i.querySelector(":scope > .tags.modifiers")?.outerHTML.trim()??"",u=i.querySelector(":scope > .notes")?.outerHTML.trim()??"",f=n.context.options.filter(l=>/^(item|self):/.test(l));return[{source:r,name:n.strike?.name??e.item.name,outcome:n.context.outcome,options:f,modifiers:s,notes:u,tags:o}]}a(Cp,"getMessageData");function Fp(e){return pi(e,"type")==="damage-roll"||e.getFlag("pf2e","context.type")==="damage-roll"}a(Fp,"isDamageRoll");function Jo(e){let t=Br(e);if(t.length)return t;let r=e.getFlag("pf2e","context.target.token");return r?[r]:[]}a(Jo,"getTargets");var{config:Rp,settings:nE,wrapper:aE}=C({name:"hideDamage",settings:[{key:"enabled",type:Boolean,default:!1,onChange:()=>{(0,c.refreshLatestMessages)(20)}}],wrappers:[{key:"messageGetHTML",path:Ot,callback:iE}],init:()=>{aE.toggle(nE.enabled)}});async function iE(e){if(!this.isContentVisible||!this.isDamageRoll)return;let t=this.actor;if(!t||t.hasPlayerOwner)return;let r=game.user.isGM,n=e.querySelector(".dice-result .dice-total"),i=n?.querySelector(":scope > .total"),o=n?.querySelector(":scope > .instances");i&&(r?i.dataset.visibility="gm":i.innerText="???"),o&&(r?o.dataset.visibility="gm":o.remove())}a(iE,"chatMessageGetHTML");var{config:Hp,settings:Bp,localize:Dp,wrappers:qp,getFlag:oE,setFlag:sE,unsetFlag:cE,render:uE}=C({name:"actionable",settings:[{key:"enabled",type:Boolean,default:!1,onChange:e=>{qp.toggleAll(e),(0,c.renderCharacterSheets)(),(0,c.renderItemSheets)(["AbilitySheetPF2e","FeatSheetPF2e"])}},{key:"message",type:Boolean,default:!0,scope:"client",onChange:()=>{(0,c.renderCharacterSheets)()}}],wrappers:[{path:re,callback:lE},{path:ne,callback:fE},{path:"CONFIG.Item.sheetClasses.action['pf2e.AbilitySheetPF2e'].cls.prototype._renderInner",callback:jp},{path:"CONFIG.Item.sheetClasses.action['pf2e.AbilitySheetPF2e'].cls.prototype.activateListeners",callback:xp},{path:"CONFIG.Item.sheetClasses.action['pf2e.AbilitySheetPF2e'].cls.prototype._onDrop",callback:Np,type:"OVERRIDE"},{path:"CONFIG.Item.sheetClasses.feat['pf2e.FeatSheetPF2e'].cls.prototype._renderInner",callback:jp},{path:"CONFIG.Item.sheetClasses.feat['pf2e.FeatSheetPF2e'].cls.prototype.activateListeners",callback:xp},{path:"CONFIG.Item.sheetClasses.feat['pf2e.FeatSheetPF2e'].cls.prototype._onDrop",callback:Np,type:"OVERRIDE"}],ready:()=>{qp.toggleAll(Bp.enabled)}});async function lE(e){let t=this.actor,r=ye.actions,n=Bp.message,i=e.querySelectorAll(".tab[data-tab='actions'] .actions-list:not(.heroActions-list):not(.strikes-list) .action[data-item-id]");for(let o of i){let{itemId:s}=(0,c.elementData)(o),u=t.items.get(s);if(!u?.isOfType("feat","action")||u.system.selfEffect||!await kt(u))continue;let l=Qo(u);l.dataset.useActionMacro="true",n||(l.dataset.skipMessage="true"),r&&u.frequency&&(u.frequency.value>=1?l.dataset.toolbeltUse="true":l.disabled=!0),o.querySelector(".button-group")?.append(l)}}a(lE,"characterSheetPF2eRenderInner");function fE(e){let t=this.actor;(0,c.addListenerAll)(e,".use-action[data-use-action-macro='true']",async(r,n)=>{let i=mi(t,n);if(!i?.isOfType("action","feat"))return;(await kt(i))?.execute({actor:t}),!n.dataset.skipMessage&&!n.dataset.toolbeltUse&&i.toMessage(r)})}a(fE,"characterSheetPF2eActivateListeners");async function kt(e){let t=oE(e,"macro");return t?fromUuid(t):null}a(kt,"getActionMacro");async function jp(e,t){let r=await e(t),n=this.item;if(n.system.actionType.value==="passive"||n.permission<=CONST.DOCUMENT_PERMISSION_LEVELS.LIMITED)return r;let i=(0,c.htmlElement)(r),o=Dp("itemSheet.label"),s=(0,c.querySelector)(i,"[data-drop-zone='self-applied-effect']");if(!s)return r;let u=(0,c.querySelector)(s,":scope > label"),f=(0,c.querySelector)(s,".hint");u&&(u.innerText+=` / ${o}`),f&&(f.innerText+=Dp("itemSheet.hint"));let l=s?.querySelector(".drop-zone.empty");if(!l)return r;let p=await kt(n);if(p)l.outerHTML=await uE("dropzone",{macro:p});else{let d=(0,c.querySelector)(l,".name");d&&(d.innerText+=` / ${o}`)}return r}a(jp,"actionSheetPF2eRenderInner");function xp(e,t){e(t);let r=this.item;if(r.system.actionType.value==="passive"||r.permission<=CONST.DOCUMENT_PERMISSION_LEVELS.LIMITED)return;let n=(0,c.htmlElement)(t),i=(0,c.querySelector)(n,"[data-drop-zone='self-applied-effect']");i&&((0,c.addListener)(i,"[data-action='open-macro-sheet']",async()=>{(await kt(r))?.sheet.render(!0)}),(0,c.addListener)(i,"[data-action='delete-macro']",()=>{cE(r,"macro")}))}a(xp,"actionSheetPF2eActivateListeners");async function Np(e){let t=this.item;if(!this.isEditable||t.system.actionType.value==="passive")return;let r=await(async()=>{try{let n=e.dataTransfer?.getData("text/plain"),i=JSON.parse(n??"{}");return typeof i!="object"?null:i.type==="Item"?await Item.implementation.fromDropData(i)??null:i.type==="Macro"?await Macro.fromDropData(i)??null:null}catch{return null}})();if(!((0,c.isInstanceOf)(r,"ItemPF2e")&&r.isOfType("effect"))&&!(r instanceof Macro))throw(0,c.ErrorPF2e)("Invalid item drop");if(r instanceof Item){await t.update({"system.selfEffect":{uuid:t.uuid,name:t.name}});return}await sE(t,"macro",r.uuid)}a(Np,"actionSheetPF2eOnDrop");var zp=debounce(dE,1),{config:Up,settings:ye,hook:Wp,wrappers:$p}=C({name:"useButton",settings:[{key:"actions",type:Boolean,default:!1,scope:"client",onChange:zp},{key:"consumables",type:Boolean,default:!1,scope:"client",onChange:zp},{key:"selfApplied",type:Boolean,default:!1,scope:"client",onChange:e=>{Wp.toggle(e)}}],hooks:[{event:"createChatMessage",listener:gE}],wrappers:[{path:re,callback:pE},{path:ne,callback:mE}],ready:()=>{Wp.toggle(ye.selfApplied),$p.toggleAll(ye.actions||ye.consumables)}});function dE(){$p.toggleAll(ye.actions||ye.consumables),(0,c.renderCharacterSheets)()}a(dE,"setupWrappers");async function pE(e){let t=this.actor;if(ye.consumables){let r=e.querySelectorAll(".tab[data-tab='inventory'] .inventory-list [data-item-types='consumable'] > [data-item-id]");for(let n of r){let{itemId:i}=(0,c.elementData)(n),o=t.items.get(i);if(!o?.isOfType("consumable")||o.category==="ammo")continue;let[s,u]=o.uses.value<1?["span","PF2E.Item.Consumable.Uses.None"]:["a","PF2E.Action.Use"],f=`<${s} class="use-consumable" data-tooltip="${u}">
                <i class="fa-solid fa-play"></i>
            </${s}>`,l=(0,c.createHTMLFromString)(f);o.uses.value&&(l.dataset.action="toolbelt-use-consumable"),n.querySelector(".item-controls")?.prepend(l)}}if(ye.actions){let r=e.querySelectorAll(".tab[data-tab='actions'] .actions-list:not(.heroActions-list):not(.strikes-list) .action[data-item-id]");for(let n of r){let{itemId:i}=(0,c.elementData)(n),o=t.items.get(i);if(!o?.isOfType("feat","action")||!o.frequency||await kt(o))continue;let s;o.system.selfEffect?s=n.querySelector("[data-action='use-action']"):(s=Qo(o),n.querySelector(".button-group")?.append(s)),s instanceof HTMLButtonElement&&(o.frequency.value>=1?s.dataset.toolbeltUse="true":s.disabled=!0)}}}a(pE,"characterSheetPF2eRenderInner");function Qo(e){let t=game.i18n.localize("PF2E.Action.Use"),r=(0,c.getActionGlyph)(e.actionCost),n=`<button type="button" class="use-action">
            <span>${t}</span>
            <span class="action-glyph">${r}</span>
    </button>`;return(0,c.createHTMLFromString)(n)}a(Qo,"createActionUseButton");function mi(e,t){let{itemId:r}=(0,c.elementData)((0,c.closest)(t,"[data-item-id]"));return e.items.get(r)}a(mi,"getItemFromActionButton");function mE(e){let t=this.actor;(0,c.addListenerAll)(e,"[data-action='toolbelt-use-consumable']",(r,n)=>{let i=mi(t,n);i?.isOfType("consumable")&&i.category!=="ammo"&&(0,c.consumeItem)(r,i)}),(0,c.addListenerAll)(e,".use-action[data-toolbelt-use='true']",(r,n)=>{let i=mi(t,n);if(!i?.isOfType("feat","action"))return;let{value:o}=i.frequency;o<1||(i.update({"system.frequency.value":o-1}),!n.dataset.skipMessage&&!i.system.selfEffect&&i.toMessage(r))})}a(mE,"characterSheetPF2eActivateListeners");async function gE(e){if(!e.isAuthor||e.getFlag("pf2e","context.type")!=="self-effect")return;let t=Hooks.on("renderChatMessage",(r,n)=>{if(r!==e)return;let i=(0,c.htmlElement)(n);Hooks.off("renderChatMessage",t),(0,c.selfApplyEffectFromMessage)(e,i)})}a(gE,"onCreateChatMessage");var Yo="\u221E",ts=100,gi={buy:{min:0,max:2,default:.5},sell:{min:0,max:5,default:1}},{config:Vp,settings:Gp,wrappers:he,localize:H,socket:Kp,getFlag:Lt,setFlag:yE,setFlagProperty:Rt,render:Jp,getInMemory:ze,getInMemoryAndSetIfNot:hE,setInMemory:rs,deleteInMemory:yi,templatePath:vE}=C({name:"betterMerchant",settings:[{key:"enabled",type:Boolean,default:!1,requiresReload:!0}],wrappers:[{key:"actorTransferItem",path:"CONFIG.Actor.documentClass.prototype.transferItemToActor",callback:bE,type:"MIXED"},{key:"lootSheetRenderInner",path:"CONFIG.Actor.sheetClasses.loot['pf2e.LootSheetPF2e'].cls.prototype._renderInner",callback:OE},{key:"lootSheetListeners",path:"CONFIG.Actor.sheetClasses.loot['pf2e.LootSheetPF2e'].cls.prototype.activateListeners",callback:IE},{key:"lootActorTransfer",path:"CONFIG.PF2E.Actor.documentClasses.loot.prototype.transferItemToActor",callback:_E,type:"OVERRIDE"},{key:"browserRenderInner",path:"game.pf2e.compendiumBrowser.constructor.prototype._renderInner",callback:TE},{key:"browserEquipmentTabRenderResults",path:"game.pf2e.compendiumBrowser.tabs.equipment.constructor.prototype.renderResults",callback:ME},{key:"browserListeners",path:"game.pf2e.compendiumBrowser.constructor.prototype.activateListeners",callback:EE},{key:"browserClose",path:"game.pf2e.compendiumBrowser.constructor.prototype.close",callback:SE},{key:"itemDerivedData",path:"CONFIG.Item.documentClass.prototype.prepareDerivedData",callback:PE}],api:{testItem:hi,compareItemWithFilter:Yp},onSocket:Qp,init:()=>{Gp.enabled&&(he.itemDerivedData.activate(),he.actorTransferItem.activate(),he.lootActorTransfer.activate())},ready:e=>{Gp.enabled&&(he.lootSheetRenderInner.activate(),e&&(Kp.activate(),he.lootSheetListeners.activate(),he.browserRenderInner.activate(),he.browserEquipmentTabRenderResults.activate(),he.browserListeners.activate(),he.browserClose.activate()))}});async function bE(e,...t){let[r,n,i=1]=t;if(!n.isOfType("physical")||!r.isOfType("loot")||!r.isMerchant)return e(...t);let o=this.hasPlayerOwner;if(this.isOfType("npc")&&!o||!this.isOfType("character","party"))return e(...t);if(!this.canUserModify(game.user,"update"))return ui.notifications.error(game.i18n.localize("PF2E.ErrorMessage.CantMoveItemSource")),null;if(!r.canUserModify(game.user,"update"))return ui.notifications.error(game.i18n.localize("PF2E.ErrorMessage.CantMoveItemDestination")),null;let s=Math.min(i,n.quantity),u=hi(r,n,"buy",s);if(!u){H.warn("buy.refuse",{actor:r.name,item:n.name,quantity:s===1?"":`x${s}`});return}game.user.isGM?Qp({buyer:r,seller:this,filter:u.filter,item:n,price:u.price.toObject(),quantity:s},game.user.id):Kp.emit({buyer:r.uuid,seller:this.uuid,item:n.uuid,filter:u.filter.id,price:u.price.toObject(),quantity:s})}a(bE,"actorTransferItemToActor");async function Qp(e,t){let r=e.buyer instanceof Actor?e.buyer:await fromUuid(e.buyer),n=e.seller instanceof Actor?e.seller:await fromUuid(e.seller),i=e.item instanceof Item?e.item:await fromUuid(e.item),o=r?We(r,"buy",!0):[],s=typeof e.filter=="string"?o.find(b=>b.id===e.filter):e.filter;if(!r||!n||!i||!o.length||!s){H.error("buy.error",{user:game.users.get(t).name});return}let u=Math.min(e.quantity,i.quantity),f=await(0,c.transferItemToActor)(r,i,u);if(!f){H.error("buy.error");return}let l={},p=o.pop(),d=new game.pf2e.Coins(e.price),y=d.goldValue;if(p.purse!==1/0&&(s.useDefault||s.id==="default")&&Rt(l,"default.buy.purse",p.purse-y),s.id!=="default"&&s.purse!==1/0){let b=o.findIndex(_=>_.id===s.id);s.purse-=y,o.splice(b,1,s),Rt(l,"filters.buy",o)}await r.update(l),await n.inventory.addCoins(d);let m=H("buy.message.content",{buyer:(0,c.getHighestName)(r),quantity:u,item:f.link,seller:(0,c.getHighestName)(n),price:parseFloat(y.toFixed(2))});(0,c.createTradeMessage)(H("buy.message.subtitle"),m,r,f,t)}a(Qp,"buyItem");async function _E(...e){let[t,r,n]=e,i=Actor.implementation.prototype;if(!(this.isOwner&&t.isOwner))return i.transferItemToActor.apply(this,e);if(this.isMerchant&&r.isOfType("physical")){let o=game.pf2e.Coins.fromPrice(r.price,n),s=hi(this,r,"sell",n);if(s)if(s&&await t.inventory.removeCoins(o)){let u=o.goldValue,f=Lt(this,"filters","sell")?.slice()??[],l=Lt(this,"default","sell"),p=Rt({},"default.sell.purse",(l?.purse??0)+u);if(s.filter.id!=="default"){let d=f.findIndex(y=>y.id===s.filter.id);d!==-1&&(s.filter.purse+=u,f.splice(d,1,s.filter),Rt(p,"filters.sell",f))}return await this.update(p),i.transferItemToActor.apply(this,e)}else return null;else return H.warn("sell.refuse",{actor:this.name,item:r.name}),null}return i.transferItemToActor.apply(this,e)}a(_E,"lootActorTransferItemToActor");function PE(e){if(e(),!this.isOfType("physical")||this.isOfType("treasure"))return;let t=this.actor;if(!t?.isOfType("loot")||!t.isMerchant)return;yi(this);let r=Lt(t,"infiniteAll"),n=hi(t,this,"sell");r&&(this.system.quantity=9999),n&&n.filter.ratio!==1&&(this.system.price.value=n.price,rs(this,"filter",n.filter.id))}a(PE,"itemPrepareDerivedData");function hi(e,t,r,n=1){let i=We(e,r,!0),o=i.pop();for(let u of i){let{enabled:f,ratio:l,purse:p,useDefault:d,filter:y}=u;if(!f)continue;let m=(0,c.calculateItemPrice)(t,n,l),b=m.goldValue;if(!(r==="buy"&&(p<b||d&&o.purse<b))&&Yp(t,y))return{price:m,filter:u}}if(!o.enabled)return;let s=(0,c.calculateItemPrice)(t,n,o.ratio);if(!(r==="buy"&&o.purse<s.goldValue))return{price:s,filter:o}}a(hi,"testItem");function Yp(e,t){if(t.search?.text){let T=e.name.toLocaleLowerCase(game.i18n.lang),M="Segmenter"in Intl?new Intl.Segmenter(game.i18n.lang,{granularity:"word"}):{segment(k){return[{segment:k}]}};if(!Array.from(M.segment(t.search.text)).map(k=>k.segment.toLocaleLowerCase(game.i18n.lang).replace(/['"]/g,"")).filter(k=>k.length>1).some(k=>T.includes(k)))return!1}let{checkboxes:r,multiselects:n,ranges:i,sliders:o}=t,s=e.level;if(o?.level&&(s<o.level.values.min||s>o.level.values.max))return!1;let u=e.price.value.copperValue;if(i?.price&&(u<i.price.values.min||u>i.price.values.max))return!1;let f=r?.itemTypes?.selected;if(f&&f.length>0&&!f.includes(e.type))return!1;let l="category"in e?e.category:"",p="group"in e?e.group:"",d=r?.armorTypes?.selected;if(d&&d.length>0&&!(0,c.arrayIncludesOne)(d,[l,p]))return!1;let y=r?.weaponTypes?.selected;if(y&&y.length>0&&!(0,c.arrayIncludesOne)(y,[l,p]))return!1;let m=n?.traits;if(m&&!(0,c.filterTraits)([...e.traits],m.selected,m.conjunction))return!1;let b=game.pf2e.system.sluggify(e.system.publication?.title??e.system.source?.value??"").trim(),_=r?.source?.selected;if(_&&_.length>0&&!_.includes(b))return!1;let S=r?.rarity?.selected;return!(S&&S.length>0&&!S.includes(e.rarity))}a(Yp,"compareItemWithFilter");async function SE(e,t){yi(this),e(t)}a(SE,"browserClose");async function TE(e,t){let r=await e(t),n=ze(this);if(!n?.actor.isMerchant)return r;let i=(0,c.htmlElement)(r),o=(0,c.querySelector)(i,"section.content .tab[data-tab='equipment'] .list-buttons");if(!o)return r;i.classList.add("toolbelt-merchant");for(let s of o.querySelectorAll("button"))s.remove();if(n.type==="pull"){let s=await Jp("browserPull",{});(0,c.appendHTMLFromString)(o,s);let u=E.pipe(n.actor.inventory.contents,E.map(f=>f.sourceId),E.compact);yi(this,"selection"),rs(this,"owned",u)}else{let s=H("filter",n.filterType),u=H("browserFilter",n.edit?"edit":"create",{type:s});(0,c.appendHTMLFromString)(o,`<button type='button' data-action="validate-filter">${u}</button>>`)}return r}a(TE,"browserRenderInner");function Xp(e,t,r){r??=ze(e.browser,"owned")??[],t.length=0;for(let{uuid:n}of e.currentIndex)if(!r.includes(n)&&(t.push(n),t.length>=ts))break;return t}a(Xp,"fillSelection");async function ME(e,t){let r=this.browser,n=await e(t),i=ze(r);if(!i||!i.actor.isMerchant)return n;for(let l of n)for(let p of l.querySelectorAll(":scope > a"))p.remove();if(i.type!=="pull")return n;let o=hE(r,"selection",()=>{let l=Xp(this,[],i.owned);return Xo(l),l}),s=o.length>=ts?`data-tooltip="${H("browserPull.limit")}" disabled`:"",f=`<i class="fa-solid fa-box" data-tooltip="${H("browserPull.owned")}"></i>`;for(let l of n){let{entryUuid:p}=(0,c.elementData)(l);if(i.owned.includes(p)){l.insertAdjacentHTML("beforeend",f);continue}let d=o.includes(p)?"checked":"";l.insertAdjacentHTML("beforeend",`<input type='checkbox' data-uuid="${p}" 
			${d} ${d?"":s}>`);let y=l.querySelector("input");y?.addEventListener("change",()=>{if(y.checked)o.push(p);else{let m=o.indexOf(p);o.splice(m,1)}Xo(o)})}return n}a(ME,"browserEquipmentTabRenderResults");function Xo(e,t=!1){let n=document.getElementById("compendium-browser")?.querySelector(".content-box.toolbelt-merchant .content .tab[data-tab=equipment]");if(!n)return;let i=(0,c.querySelector)(n,".list-buttons");if(!i)return;let o=game.pf2e.compendiumBrowser.tabs.equipment,s=e.length,u=o.currentIndex.length,f=s>=ts,l=H("browserPull.limit"),p=i.querySelectorAll(":scope > div span"),d=n.querySelectorAll(".result-list .item input");if(p.length&&(p[0].textContent=String(s),p[1].textContent=String(u)),!t){let y=i.querySelector(":scope > label input");y&&(s===0?(y.indeterminate=!1,y.checked=!1):f||s>=u?(y.indeterminate=!1,y.checked=!0):(y.indeterminate=!0,y.checked=!0))}(0,c.querySelector)(i,"button").disabled=s===0;for(let y of d){let b=!y.checked&&f;y.disabled=b,y.dataset.tooltip=b?l:""}}a(Xo,"updateBrowser");function EE(e,t){e(t);let r=ze(this);if(!r?.actor?.isMerchant)return;let n=(0,c.htmlElement)(t),i=(0,c.querySelector)(n,"section.content .tab[data-tab='equipment']"),o=(0,c.querySelector)(i,".list-buttons");if(!o)return;let s=r.actor,u=this,f=u.tabs.equipment;r.type==="pull"?((0,c.addListener)(o,"[data-action='add-to-merchant']",async()=>{let l=ze(u,"selection")??[],p=H("browserPull.confirm",{nb:l.length});if(!await Dialog.confirm({title:`${H("sheet.browser")} - ${s.name}`,content:`<div style="margin-bottom: 0.5em;">${p}</div>`}))return;H.info("browserPull.wait"),u.close();let y=E.pipe(await Promise.all(l.map(m=>fromUuid(m))),E.compact,E.map(m=>m.toObject()));y.length&&await s.createEmbeddedDocuments("Item",y),H.info("browserPull.finished")}),(0,c.addListener)(o,"[data-action='toggle-select-all']",(l,p)=>{let d=p.checked,y=ze(u,"selection")??[];d?Xp(f,y):y.length=0;let m=i.querySelectorAll(".item input");for(let b of m){let{uuid:_}=(0,c.elementData)(b);b.checked=y.includes(_)}Xo(y,!1)})):(0,c.addListener)(o,"[data-action='validate-filter']",async()=>{let l=f.filterData,p=await f.getFilterData(),d={},y=l.search.text.trim();y&&setProperty(d,"search.text",y);for(let S of["checkboxes","multiselects"])for(let[T,M]of Object.entries(l[S])){if(!M.selected.length)continue;let O=`${S}.${T}`;setProperty(d,`${O}.selected`,M.selected),"conjunction"in M&&setProperty(d,`${O}.conjunction`,M.conjunction)}for(let S of["ranges","sliders"]){let T=p[S];for(let[M,O]of Object.entries(l[S])){let D=T[M];objectsEqual(O.values,D.values)||setProperty(d,`${S}.${M}.values`,O.values)}}if(isEmpty(d)){H.warn("browserFilter.empty");return}u.close();let m=We(s,r.filterType,!1);if(r.edit){let S=m.find(T=>T.id===r.edit);if(S){S.filter=d,zr(s,r.filterType,m);return}}let b=randomID(),_={id:b,name:b,enabled:!0,filter:d,useDefault:!0};m.unshift(_),zr(s,r.filterType,m)})}a(EE,"browserActivateListeners");async function OE(e,t){let r=await e(t),n=this.actor;if(!n?.isMerchant)return r;let i=game.user.isGM,o=(0,c.htmlElement)(r),s=Lt(n,"infiniteAll");if(i){let l=(0,c.querySelector)(o,".sheet-sidebar"),p=await Jp("sheet",{infiniteAll:s});(0,c.afterHTMLFromString)((0,c.querySelector)(l,".image-container"),p)}let u=i?We(n,"sell",!0):!1,f=o.querySelectorAll(".sheet-body .inventory-list .items > [data-item-id]");for(let l of f){let{itemId:p}=(0,c.elementData)(l),d=n.items.get(p);if(d){if(u){let y=ze(d,"filter"),m=u.find(b=>b.id===y);if(m){let b=(0,c.querySelector)(l,".price");b&&(b.classList.add(m.ratio<1?"cheap":"expensive"),b.dataset.tooltip=`${m.name} (${m.ratio})`)}}if(s){let y=(0,c.querySelector)(l,".quantity");y&&(y.innerHTML=Yo)}}}if(i&&s){let l=(0,c.querySelector)(o,".total-bulk span"),p=(0,c.querySelector)(o,".coinage .wealth .item-name:last-child span");l&&(l.innerHTML=game.i18n.format("PF2E.Actor.Inventory.TotalBulk",{bulk:Yo})),p&&(p.innerHTML=Yo)}return r}a(OE,"lootSheetPF2eRenderInner");function IE(e,t){e(t);let r=this.actor;if(!r?.isMerchant)return;let n=(0,c.htmlElement)(t),i=(0,c.querySelector)(n,".better-merchant");i&&((0,c.addListener)(i,"[data-action='open-equipment-tab']",()=>{es({actor:r,type:"pull",owned:[]})}),(0,c.addListener)(i,"[data-action='open-filtes-menu']",()=>{new Zo(r).render(!0)}),(0,c.addListener)(i,"[name='infiniteAll']","change",(o,s)=>{let u=s.checked;yE(r,"infiniteAll",u)}))}a(IE,"lootSheetPF2eActivateListeners");var Zo=class extends Application{static{a(this,"FiltersMenu")}actor;constructor(t){super(),this.actor=t}get id(){return H("filters.app")}get title(){return H("filters.title",this.actor)}get template(){return vE("filters")}render(t,r){return this.actor.apps[this.appId]=this,super.render(t,r)}async close(t){await super.close(t),delete this.actor.apps?.[this.appId]}getData(){let t=this.actor,r=H.sub("filters"),n=We(t,"buy",!0),i=We(t,"sell",!0),o=a(s=>{let u=s.length-1;return(f,l)=>({...f,purse:f.purse===1/0?void 0:typeof f.purse=="number"?Math.floor(f.purse):f.purse,cannotUp:l===0||l===u,cannotDown:l>=u-1})},"templateFilter");return{i18n:r.i18n,buyFilters:n.map(o(n)),sellFilters:i.map(o(i)),ratios:gi}}activateListeners(t){let r=(0,c.htmlElement)(t),i=game.pf2e.compendiumBrowser.tabs.equipment;(0,c.addListenerAll)(r,"[data-action='add-filter']",(s,u)=>{let{type:f}=(0,c.elementData)(u);es({actor:this.actor,type:"filter",filterType:f,edit:!1})});let o=a(s=>{let u=(0,c.elementData)((0,c.closest)(s,"[data-id]")),{type:f,id:l}=u,p=We(this.actor,f,!0),d=p.findIndex(y=>y.id===l);return{...u,itemFilters:p,filterIndex:d}},"getItemData");(0,c.addListenerAll)(r,"input","change",(s,u)=>{let{itemFilters:f,filterIndex:l,type:p}=o(u),d=f.at(l);if(!d)return;let y=u.name,m=u.type==="checkbox"?u.checked:u.type==="number"?u.valueAsNumber:u.value.trim();setProperty(d,y,m),zr(this.actor,p,f)}),(0,c.addListenerAll)(r,"input[type='text'], input[type='number']","keydown",(s,u)=>{s.key==="Enter"&&u.blur()}),(0,c.addListenerAll)(r,"[data-action='move-filter']",(s,u)=>{let{itemFilters:f,filterIndex:l,type:p}=o(u),{direction:d}=(0,c.elementData)(u),y=d==="up"?l-1:l+1;if(y<0||y>=f.length)return;let m=E.swapIndices(f,l,y);zr(this.actor,p,m)}),(0,c.addListenerAll)(r,"[data-action='delete-filter']",async(s,u)=>{let{type:f,filterIndex:l,itemFilters:p}=o(u);if(l===-1)return;let d=p.at(l);await Dialog.confirm({title:H("filters.delete.title"),content:H("filters.delete.content",{name:d.name||d.id})})&&(p.splice(l,1),zr(this.actor,f,p))}),(0,c.addListenerAll)(r,"[data-action='edit-filter']",async(s,u)=>{let{type:f,id:l,filterIndex:p,itemFilters:d}=o(u),y=await i.getFilterData(),m=d.at(p)?.filter;if(!m)return;let b=mergeObject(y,m);if(m.ranges)for(let _ in m.ranges){let S=b.ranges[_];S.isExpanded=!0}if(m.sliders)for(let _ in m.sliders){let S=b.sliders[_];S.isExpanded=!0}if(m.checkboxes)for(let _ in m.checkboxes){let S=b.checkboxes[_];S.isExpanded=!0;for(let T of S.selected)S.options[T].selected=!0}es({actor:this.actor,type:"filter",filterType:f,edit:l},b)})}};async function es(e,t){let r=game.pf2e.compendiumBrowser,n=r.tabs.equipment;yi(r),rs(r,e),n.open(t??await n.getFilterData())}a(es,"openEquipmentTab");function We(e,t,r){let n=Lt(e,"filters",t)?.slice()??[];if(r){let i=Lt(e,"default",t)??{enabled:!0};n.push({...i,id:"default",name:H("filters.default",t),enabled:i.enabled??!0,locked:!0,useDefault:!0})}return n.map(i=>({...i,name:i.name.trim()||i.id,ratio:AE(t,i.ratio),purse:typeof i.purse=="number"?Math.max(0,i.purse):t==="buy"?1/0:0}))}a(We,"getFilters");function zr(e,t,r){let n={},i=r.findIndex(o=>o.id==="default");if(i!==-1){let o=r.splice(i,1)[0];Rt(n,"default",t,{ratio:o.ratio,purse:o.purse,enabled:o.enabled})}return Rt(n,"filters",t,r),e.update(n)}a(zr,"setFilters");function AE(e,t){return typeof t!="number"?gi[e].default:Math.clamped(t,gi[e].min,gi[e].max).toNearest(.1,"floor")}a(AE,"clampPriceRatio");c.MODULE.register("pf2e-toolbelt","PF2e Toolbelt");var ns=[Hp,hd,Vp,Pd,Jd,Sd,Ed,Cd,Rp,wp,Ud,fp,Gd,ep,ap,bp,Yd,Up];Hooks.once("init",()=>{let e=(0,c.userIsGM)();cd(ns,e);let t=c.MODULE.current;t.api={};for(let{init:r,api:n,name:i}of ns)r?.(e),typeof n=="object"&&(t.api[i]=n)});Hooks.once("ready",()=>{let e=game.user.isGM;for(let{ready:t}of ns)t?.(e)});Hooks.on("renderSettingsConfig",sd);})();
//# sourceMappingURL=main.js.map
